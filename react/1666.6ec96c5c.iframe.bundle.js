"use strict";(self.webpackChunk_carbon_labs_react=self.webpackChunk_carbon_labs_react||[]).push([[1666],{"../../node_modules/storybook-addon-accessibility-checker/dist/_browser-chunks/CheckerWrapper-X4M7ICPY.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CheckerWrapper:()=>CheckerWrapper});var _chunk_JFJ5UJ7Q_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/storybook-addon-accessibility-checker/dist/_browser-chunks/chunk-JFJ5UJ7Q.js"),_CheckerWrapper=class _CheckerWrapper{constructor(config){this.config=config,this.ruleTKLevel={}}static async getWrapper(config){const retVal=new _CheckerWrapper;return await retVal.initialize(),retVal}async initialize(){await __webpack_require__.e(2167).then(__webpack_require__.t.bind(__webpack_require__,"../../node_modules/accessibility-checker-engine/ace-window.js",23));const CheckerPackage=window.ace_ibma,{Checker}=CheckerPackage;this.checker=new Checker,this.guidelines=this.checker.getGuidelines().filter(guideline=>(!this.config?.guidelines||0===this.config.guidelines.length)&&"IBM_Accessibility"===guideline.id||this.config?.guidelines&&this.config.guidelines.length>0&&this.config?.guidelines?.includes(guideline.id)),this.guidelines.forEach(guideline=>{guideline.checkpoints.forEach(checkpoint=>{checkpoint.rules?.forEach(rule=>{this.ruleTKLevel[rule.id]=rule.toolkitLevel})})})}configureEngine(){this.guidelines.forEach(guideline=>{guideline.checkpoints.forEach(checkpoint=>{(checkpoint.rules||[]).forEach(ruleIter=>{const rule=ruleIter,ruleConfig=this.config?.rules?.find(cfgRule=>cfgRule.id===rule.id);ruleConfig?rule.enabled=!1!==ruleConfig.enabled:!0===this.config?.disableOtherRules&&(rule.enabled=!1)})}),this.checker.addGuideline(guideline)})}async run(htmlElement){this.configureEngine();const report=await this.checker.check(htmlElement,this.guidelines.map(guideline=>guideline.id));if(this.config?.rules){const selRules=this.config.rules.filter(rule=>rule.selector);selRules.length>0&&(report.results=report.results.filter(issue=>{const ruleConfig=selRules.find(rule=>rule.id===issue.ruleId);return!ruleConfig||!ruleConfig.selector||1!==issue.node.nodeType||issue.node.matches(ruleConfig.selector)}))}let skipCount=1,skipWalk=htmlElement;for(;"html"!==skipWalk.nodeName&&skipWalk.parentElement;)skipWalk=skipWalk.parentElement,skipCount+=1;return this.convertResult(htmlElement,report,skipCount)}convertResult(htmlElement,report,skipCount){try{const{results}=report;return{testEngine:{name:"accessibility-checker-engine",version:"3.1.62"},testRunner:{name:"accessibility-checker"},timestamp:(new Date).toISOString(),url:document.location.href,toolOptions:{},inapplicable:[],passes:this.convertCollection(htmlElement,report,results.filter(issue=>"PASS"===issue.value[1]),skipCount),incomplete:this.convertCollection(htmlElement,report,results.filter(issue=>"VIOLATION"===issue.value[0]&&("POTENTIAL"===issue.value[1]||"MANUAL"===issue.value[1])),skipCount),violations:this.convertCollection(htmlElement,report,results.filter(issue=>"VIOLATION"===issue.value[0]&&"FAIL"===issue.value[1]),skipCount)}}catch(err){return console.error(err),{}}}xpathToCSS(xpath){return xpath.substring(1).replace(/\//g," > ").replace(/\[(\d+)\]/g,":nth-of-type($1)")}convertCollection(htmlElement,report,issues,skipCount){const issueMap={};issues.forEach(issue=>{issueMap[issue.ruleId]=issueMap[issue.ruleId]||[],issueMap[issue.ruleId].push(issue)});const retVal=[];return Object.keys(issueMap).forEach(key=>{const nextIssue=issueMap[key][0],nextCollection={id:key,impact:"",tags:[],description:"",help:report.nls?report.nls[key][0]:"",helpUrl:this.getHelpUrl(nextIssue),nodes:issueMap[key].map(issue=>this.convertIssue(htmlElement,issue,skipCount)).filter(issue=>!!issue)};nextCollection.nodes.length>0&&retVal.push(nextCollection)}),retVal}convertIssue(htmlElement,issue,skipCount){const pathParts=issue.path.dom.substring(1).split("/");if(skipCount>=pathParts.length)return;let selector=this.xpathToCSS(`/${pathParts.slice(skipCount).join("/")}`);selector=this.simplifySelector(htmlElement,selector);let impact="serious";if(issue.ruleId in this.ruleTKLevel){const tkLevel=this.ruleTKLevel[issue.ruleId];"1"===tkLevel&&(impact="critical"),"2"===tkLevel&&(impact="serious"),"3"===tkLevel&&(impact="minor")}return{any:[{impact,message:issue.message}],all:[],none:[],target:[selector]}}simplifySelector(htmlElement,selector){let selectorSections=selector.split(" > ");for(let idx=0;idx<selectorSections.length;idx+=1){let parents="";idx>0&&(parents=`${selectorSections.slice(0,idx).join(" > ")} > `);const selectedElement=htmlElement.querySelector(parents+selectorSections[idx]);selectedElement&&(selectedElement?.hasAttribute("id")&&htmlElement.querySelector(`${parents}#${CSS.escape(selectedElement.getAttribute("id"))}`)===selectedElement&&1===htmlElement.querySelectorAll(`${parents}#${CSS.escape(selectedElement.getAttribute("id"))}`).length?selectorSections[idx]=`#${CSS.escape(selectedElement.getAttribute("id"))}`:selectedElement?.hasAttribute("class")&&htmlElement.querySelector(`${parents}.${CSS.escape(selectedElement.getAttribute("class"))}`)===selectedElement&&1===htmlElement.querySelectorAll(`${parents}.${CSS.escape(selectedElement.getAttribute("class"))}`).length?selectorSections[idx]=`.${CSS.escape(selectedElement.getAttribute("class"))}`:htmlElement.querySelector(parents+selectedElement.nodeName)===selectedElement&&1===htmlElement.querySelectorAll(parents+selectedElement.nodeName).length&&(selectorSections[idx]=selectedElement.nodeName.toLowerCase()))}for(;selectorSections.length>1&&htmlElement.querySelector(selectorSections.slice(1).join(" > "))===htmlElement.querySelector(selectorSections.join(" > "))&&1===htmlElement.querySelectorAll(selectorSections.slice(1).join(" > ")).length;)selectorSections=selectorSections.slice(1);return htmlElement.querySelector(selectorSections.join(" "))!==htmlElement.querySelector(selectorSections.join(" > "))||htmlElement.querySelectorAll(selectorSections.join(" ")).length>1?selectorSections.join(" > "):selectorSections.join(" ")}getHelpUrl(issue){if(issue.help)return issue.help;return`${this.checker.engine.getHelp(issue.ruleId,issue.reasonId)}`}};(0,_chunk_JFJ5UJ7Q_js__WEBPACK_IMPORTED_MODULE_0__.K)(_CheckerWrapper,"CheckerWrapper");var CheckerWrapper=_CheckerWrapper}}]);