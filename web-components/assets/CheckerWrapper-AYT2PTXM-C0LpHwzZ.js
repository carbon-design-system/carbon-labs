const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ace-window-DFN3DAGX.js","./iframe-ClXo_xvh.js","./preload-helper-C1FmrZbK.js"])))=>i.map(i=>d[i]);
import{_ as g}from"./preload-helper-C1FmrZbK.js";import{_ as d}from"./iframe-ClXo_xvh.js";var u=class h{constructor(e){this.config=e,this.ruleTKLevel={}}static async getWrapper(e){const o=new h(e);return await o.initialize(),o}async initialize(){await g(()=>import("./ace-window-DFN3DAGX.js").then(t=>t.a),__vite__mapDeps([0,1,2]),import.meta.url);const e=window.ace_ibma,{Checker:o}=e;this.checker=new o,this.guidelines=this.checker.getGuidelines().filter(t=>{var n,r,i,c;return(!((n=this.config)!=null&&n.guidelines)||this.config.guidelines.length===0)&&t.id==="IBM_Accessibility"||((r=this.config)==null?void 0:r.guidelines)&&this.config.guidelines.length>0&&((c=(i=this.config)==null?void 0:i.guidelines)==null?void 0:c.includes(t.id))}),this.guidelines.forEach(t=>{t.checkpoints.forEach(n=>{var r;(r=n.rules)==null||r.forEach(i=>{this.ruleTKLevel[i.id]=i.toolkitLevel})})})}configureEngine(){this.guidelines.forEach(e=>{e.checkpoints.forEach(o=>{(o.rules||[]).forEach(t=>{var i,c,l;const n=t,r=(c=(i=this.config)==null?void 0:i.rules)==null?void 0:c.find(s=>s.id===n.id);r?n.enabled=r.enabled!==!1:((l=this.config)==null?void 0:l.disableOtherRules)===!0&&(n.enabled=!1)})}),this.checker.addGuideline(e)})}async run(e){var r;this.configureEngine();const o=await this.checker.check(e,this.guidelines.map(i=>i.id));if((r=this.config)!=null&&r.rules){const i=this.config.rules.filter(c=>c.selector);i.length>0&&(o.results=o.results.filter(c=>{const l=i.find(s=>s.id===c.ruleId);return!l||!l.selector||c.node.nodeType!==1||c.node.matches(l.selector)}))}let t=1,n=e;for(;n.nodeName!=="html"&&n.parentElement;)n=n.parentElement,t+=1;return this.convertResult(e,o,t)}convertResult(e,o,t){var n,r,i,c;try{const{results:l}=o;return{testEngine:{name:"accessibility-checker-engine",version:""},testRunner:{name:"accessibility-checker"},testEnvironment:{userAgent:"",windowHeight:((r=(n=e==null?void 0:e.ownerDocument)==null?void 0:n.defaultView)==null?void 0:r.innerHeight)||0,windowWidth:((c=(i=e==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)==null?void 0:c.innerWidth)||0},timestamp:new Date().toISOString(),url:document.location.href,toolOptions:{},inapplicable:[],passes:this.convertCollection(e,o,l.filter(s=>s.value[1]==="PASS"),t),incomplete:this.convertCollection(e,o,l.filter(s=>s.value[0]==="VIOLATION"&&(s.value[1]==="POTENTIAL"||s.value[1]==="MANUAL")),t),violations:this.convertCollection(e,o,l.filter(s=>s.value[0]==="VIOLATION"&&s.value[1]==="FAIL"),t)}}catch(l){return console.error(l),{}}}xpathToCSS(e){return e.substring(1).replace(/\//g," > ").replace(/\[(\d+)\]/g,":nth-of-type($1)")}convertCollection(e,o,t,n){const r={};t.forEach(c=>{r[c.ruleId]=r[c.ruleId]||[],r[c.ruleId].push(c)});const i=[];return Object.keys(r).forEach(c=>{const l=r[c][0],s={id:c,impact:null,tags:[],description:"",help:o.nls?o.nls[c][0]:"",helpUrl:this.getHelpUrl(l),nodes:r[c].map(a=>this.convertIssue(e,a,n)).filter(a=>!!a)};s.nodes.length>0&&i.push(s)}),i}convertIssue(e,o,t){const n=o.path.dom.substring(1).split("/");if(t>=n.length)return;let r=this.xpathToCSS(`/${n.slice(t).join("/")}`);r=this.simplifySelector(e,r);let i="serious";if(o.ruleId in this.ruleTKLevel){const c=this.ruleTKLevel[o.ruleId];c==="1"&&(i="critical"),c==="2"&&(i="serious"),c==="3"&&(i="minor")}return{any:[{impact:i,message:o.message}],all:[],none:[],target:[r],html:o.snippet}}simplifySelector(e,o){let t=o.split(" > ");for(let n=0;n<t.length;n+=1){let r="";n>0&&(r=`${t.slice(0,n).join(" > ")} > `);const i=e.querySelector(r+t[n]);i&&(i!=null&&i.hasAttribute("id")&&e.querySelector(`${r}#${CSS.escape(i.getAttribute("id"))}`)===i&&e.querySelectorAll(`${r}#${CSS.escape(i.getAttribute("id"))}`).length===1?t[n]=`#${CSS.escape(i.getAttribute("id"))}`:i!=null&&i.hasAttribute("class")&&e.querySelector(`${r}.${CSS.escape(i.getAttribute("class"))}`)===i&&e.querySelectorAll(`${r}.${CSS.escape(i.getAttribute("class"))}`).length===1?t[n]=`.${CSS.escape(i.getAttribute("class"))}`:e.querySelector(r+i.nodeName)===i&&e.querySelectorAll(r+i.nodeName).length===1&&(t[n]=i.nodeName.toLowerCase()))}for(;t.length>1&&e.querySelector(t.slice(1).join(" > "))===e.querySelector(t.join(" > "))&&e.querySelectorAll(t.slice(1).join(" > ")).length===1;)t=t.slice(1);return e.querySelector(t.join(" "))!==e.querySelector(t.join(" > "))||e.querySelectorAll(t.join(" ")).length>1?t.join(" > "):t.join(" ")}getHelpUrl(e){return e.help?e.help:`${this.checker.engine.getHelp(e.ruleId,e.reasonId)}`}};d(u,"CheckerWrapper");var S=u;export{S as CheckerWrapper};
