const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ace-window-kW5r6mPe.js","./iframe-DK8lcuco.js","./preload-helper-C1FmrZbK.js"])))=>i.map(i=>d[i]);
import{_ as g}from"./preload-helper-C1FmrZbK.js";import{_ as f}from"./iframe-DK8lcuco.js";var u=class h{constructor(t){this.config=t,this.ruleTKLevel={}}static async getWrapper(t){const c=new h;return await c.initialize(),c}async initialize(){await g(()=>import("./ace-window-kW5r6mPe.js").then(r=>r.a),__vite__mapDeps([0,1,2]),import.meta.url);const t=window.ace_ibma,{Checker:c}=t;this.checker=new c,this.guidelines=this.checker.getGuidelines().filter(r=>{var l,i,e,s;return(!((l=this.config)!=null&&l.guidelines)||this.config.guidelines.length===0)&&r.id==="IBM_Accessibility"||((i=this.config)==null?void 0:i.guidelines)&&this.config.guidelines.length>0&&((s=(e=this.config)==null?void 0:e.guidelines)==null?void 0:s.includes(r.id))}),this.guidelines.forEach(r=>{r.checkpoints.forEach(l=>{var i;(i=l.rules)==null||i.forEach(e=>{this.ruleTKLevel[e.id]=e.toolkitLevel})})})}configureEngine(){this.guidelines.forEach(t=>{t.checkpoints.forEach(c=>{(c.rules||[]).forEach(r=>{var e,s,n;const l=r,i=(s=(e=this.config)==null?void 0:e.rules)==null?void 0:s.find(o=>o.id===l.id);i?l.enabled=i.enabled!==!1:((n=this.config)==null?void 0:n.disableOtherRules)===!0&&(l.enabled=!1)})}),this.checker.addGuideline(t)})}async run(t){var i;this.configureEngine();const c=await this.checker.check(t,this.guidelines.map(e=>e.id));if((i=this.config)!=null&&i.rules){const e=this.config.rules.filter(s=>s.selector);e.length>0&&(c.results=c.results.filter(s=>{const n=e.find(o=>o.id===s.ruleId);return!n||!n.selector||s.node.nodeType!==1||s.node.matches(n.selector)}))}let r=1,l=t;for(;l.nodeName!=="html"&&l.parentElement;)l=l.parentElement,r+=1;return this.convertResult(t,c,r)}convertResult(t,c,r){try{const{results:l}=c;return{testEngine:{name:"accessibility-checker-engine",version:"3.1.62"},testRunner:{name:"accessibility-checker"},timestamp:new Date().toISOString(),url:document.location.href,toolOptions:{},inapplicable:[],passes:this.convertCollection(t,c,l.filter(i=>i.value[1]==="PASS"),r),incomplete:this.convertCollection(t,c,l.filter(i=>i.value[0]==="VIOLATION"&&(i.value[1]==="POTENTIAL"||i.value[1]==="MANUAL")),r),violations:this.convertCollection(t,c,l.filter(i=>i.value[0]==="VIOLATION"&&i.value[1]==="FAIL"),r)}}catch(l){return console.error(l),{}}}xpathToCSS(t){return t.substring(1).replace(/\//g," > ").replace(/\[(\d+)\]/g,":nth-of-type($1)")}convertCollection(t,c,r,l){const i={};r.forEach(s=>{i[s.ruleId]=i[s.ruleId]||[],i[s.ruleId].push(s)});const e=[];return Object.keys(i).forEach(s=>{const n=i[s][0],o={id:s,impact:"",tags:[],description:"",help:c.nls?c.nls[s][0]:"",helpUrl:this.getHelpUrl(n),nodes:i[s].map(a=>this.convertIssue(t,a,l)).filter(a=>!!a)};o.nodes.length>0&&e.push(o)}),e}convertIssue(t,c,r){const l=c.path.dom.substring(1).split("/");if(r>=l.length)return;let i=this.xpathToCSS(`/${l.slice(r).join("/")}`);i=this.simplifySelector(t,i);let e="serious";if(c.ruleId in this.ruleTKLevel){const s=this.ruleTKLevel[c.ruleId];s==="1"&&(e="critical"),s==="2"&&(e="serious"),s==="3"&&(e="minor")}return{any:[{impact:e,message:c.message}],all:[],none:[],target:[i]}}simplifySelector(t,c){let r=c.split(" > ");for(let l=0;l<r.length;l+=1){let i="";l>0&&(i=`${r.slice(0,l).join(" > ")} > `);const e=t.querySelector(i+r[l]);e&&(e!=null&&e.hasAttribute("id")&&t.querySelector(`${i}#${CSS.escape(e.getAttribute("id"))}`)===e&&t.querySelectorAll(`${i}#${CSS.escape(e.getAttribute("id"))}`).length===1?r[l]=`#${CSS.escape(e.getAttribute("id"))}`:e!=null&&e.hasAttribute("class")&&t.querySelector(`${i}.${CSS.escape(e.getAttribute("class"))}`)===e&&t.querySelectorAll(`${i}.${CSS.escape(e.getAttribute("class"))}`).length===1?r[l]=`.${CSS.escape(e.getAttribute("class"))}`:t.querySelector(i+e.nodeName)===e&&t.querySelectorAll(i+e.nodeName).length===1&&(r[l]=e.nodeName.toLowerCase()))}for(;r.length>1&&t.querySelector(r.slice(1).join(" > "))===t.querySelector(r.join(" > "))&&t.querySelectorAll(r.slice(1).join(" > ")).length===1;)r=r.slice(1);return t.querySelector(r.join(" "))!==t.querySelector(r.join(" > "))||t.querySelectorAll(r.join(" ")).length>1?r.join(" > "):r.join(" ")}getHelpUrl(t){return t.help?t.help:`${this.checker.engine.getHelp(t.ruleId,t.reasonId)}`}};f(u,"CheckerWrapper");var S=u;export{S as CheckerWrapper};
