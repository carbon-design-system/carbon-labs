import{n as gt,t as En}from"./property-B7qFMDfR.js";import{h as Tn,g as Mn,i as Ln,c as Bn,b as Ge}from"./iframe-DJhAwP_w.js";import{r as je}from"./state-ro6c5RWN.js";import{s as li}from"./settings-BQP9c3yA.js";import"./loading-DDFrQV79.js";import{_ as Pn,a as Dn}from"./16-Bf4PArtD.js";import{_ as In}from"./16-Dmu1QWqc.js";import{_ as $n}from"./16-D5maUdCH.js";import{i as Rr}from"./icon-loader-DIBBKQSJ.js";let kn=class si{static clone(e){let t=Array.isArray(e)?Array():{};for(let r in e){let i=e[r];typeof i.clone=="function"?t[r]=i.clone():t[r]=typeof i=="object"?si.clone(i):i}return t}static equals(e,t){if(e.length!==t.length)return!1;let r=e.slice().sort(),i=t.slice().sort();for(var s=0;s<r.length;s++)if(r[s]!==i[s])return!1;return!0}static print(e){if(e.length==0)return"";let t="(";for(let r=0;r<e.length;r++)t+=e[r].id?e[r].id+", ":e[r]+", ";return t=t.substring(0,t.length-2),t+")"}static each(e,t){for(let r=0;r<e.length;r++)t(e[r])}static get(e,t,r){for(let i=0;i<e.length;i++)if(e[i][t]==r)return e[i]}static contains(e,t){if(!t.property&&!t.func){for(let r=0;r<e.length;r++)if(e[r]==t.value)return!0}else if(t.func){for(let r=0;r<e.length;r++)if(t.func(e[r]))return!0}else for(let r=0;r<e.length;r++)if(e[r][t.property]==t.value)return!0;return!1}static intersection(e,t){let r=new Array;for(let i=0;i<e.length;i++)for(let s=0;s<t.length;s++)e[i]===t[s]&&r.push(e[i]);return r}static unique(e){let t={};return e.filter(function(r){return t[r]!==void 0?!1:t[r]=!0})}static count(e,t){let r=0;for(let i=0;i<e.length;i++)e[i]===t&&r++;return r}static toggle(e,t){let r=Array(),i=!1;for(let s=0;s<e.length;s++)e[s]!==t?r.push(e[s]):i=!0;return i||r.push(t),r}static remove(e,t){let r=Array();for(let i=0;i<e.length;i++)e[i]!==t&&r.push(e[i]);return r}static removeUnique(e,t){let r=e.indexOf(t);return r>-1&&e.splice(r,1),e}static removeAll(e,t){return e.filter(function(r){return t.indexOf(r)===-1})}static merge(e,t){let r=new Array(e.length+t.length);for(let i=0;i<e.length;i++)r[i]=e[i];for(let i=0;i<t.length;i++)r[e.length+i]=t[i];return r}static containsAll(e,t){let r=0;for(let i=0;i<e.length;i++)for(let s=0;s<t.length;s++)e[i]===t[s]&&r++;return r===t.length}static sortByAtomicNumberDesc(e){let t=e.map(function(r,i){return{index:i,value:r.atomicNumber.split(".").map(Number)}});return t.sort(function(r,i){let s=Math.min(i.value.length,r.value.length),a=0;for(;a<s&&i.value[a]===r.value[a];)a++;return a===s?i.value.length-r.value.length:i.value[a]-r.value[a]}),t.map(function(r){return e[r.index]})}static deepCopy(e){let t=Array();for(let r=0;r<e.length;r++){let i=e[r];i instanceof Array?t[r]=si.deepCopy(i):t[r]=i}return t}};var lr=kn;let On=class Vt{static round(e,t){return t=t||1,+(Math.round(e+"e"+t)+"e-"+t)}static meanAngle(e){let t=0,r=0;for(var i=0;i<e.length;i++)t+=Math.sin(e[i]),r+=Math.cos(e[i]);return Math.atan2(t/e.length,r/e.length)}static innerAngle(e){return Vt.toRad((e-2)*180/e)}static polyCircumradius(e,t){return e/(2*Math.sin(Math.PI/t))}static apothem(e,t){return e*Math.cos(Math.PI/t)}static apothemFromSideLength(e,t){let r=Vt.polyCircumradius(e,t);return Vt.apothem(r,t)}static centralAngle(e){return Vt.toRad(360/e)}static toDeg(e){return e*Vt.degFactor}static toRad(e){return e*Vt.radFactor}static parityOfPermutation(e){let t=new Uint8Array(e.length),r=0,i=function(a,n=0){return t[a]===1?n:(n++,t[a]=1,i(e[a],n))};for(var s=0;s<e.length;s++){if(t[s]===1)continue;let a=i(s);r+=1-a%2}return r%2?-1:1}static get radFactor(){return Math.PI/180}static get degFactor(){return 180/Math.PI}static get twoPI(){return 2*Math.PI}};var or=On;let zn=class ce{constructor(e,t){arguments.length==0?(this.x=0,this.y=0):arguments.length==1?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t)}clone(){return new ce(this.x,this.y)}toString(){return"("+this.x+","+this.y+")"}add(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}divide(e){return this.x/=e,this.y/=e,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}invert(){return this.x=-this.x,this.y=-this.y,this}angle(){return Math.atan2(this.y,this.x)}distance(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}distanceSq(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)}clockwise(e){let t=this.y*e.x,r=this.x*e.y;return t>r?-1:t===r?0:1}relativeClockwise(e,t){let r=(this.y-e.y)*(t.x-e.x),i=(this.x-e.x)*(t.y-e.y);return r>i?-1:r===i?0:1}rotate(e){let t=new ce(0,0),r=Math.cos(e),i=Math.sin(e);return t.x=this.x*r-this.y*i,t.y=this.x*i+this.y*r,this.x=t.x,this.y=t.y,this}rotateAround(e,t){let r=Math.sin(e),i=Math.cos(e);this.x-=t.x,this.y-=t.y;let s=this.x*i-this.y*r,a=this.x*r+this.y*i;return this.x=s+t.x,this.y=a+t.y,this}rotateTo(e,t,r=0){this.x+=.001,this.y-=.001;let i=ce.subtract(this,t),s=ce.subtract(e,t),a=ce.angle(s,i);return this.rotateAround(a+r,t),this}rotateAwayFrom(e,t,r){this.rotateAround(r,t);let i=this.distanceSq(e);this.rotateAround(-2*r,t),this.distanceSq(e)<i&&this.rotateAround(2*r,t)}getRotateAwayFromAngle(e,t,r){let i=this.clone();i.rotateAround(r,t);let s=i.distanceSq(e);return i.rotateAround(-2*r,t),i.distanceSq(e)<s?r:-r}getRotateTowardsAngle(e,t,r){let i=this.clone();i.rotateAround(r,t);let s=i.distanceSq(e);return i.rotateAround(-2*r,t),i.distanceSq(e)>s?r:-r}getRotateToAngle(e,t){let r=ce.subtract(this,t),i=ce.subtract(e,t),s=ce.angle(i,r);return Number.isNaN(s)?0:s}isInPolygon(e){let t=!1;for(let r=0,i=e.length-1;r<e.length;i=r++)e[r].y>this.y!=e[i].y>this.y&&this.x<(e[i].x-e[r].x)*(this.y-e[r].y)/(e[i].y-e[r].y)+e[r].x&&(t=!t);return t}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}normalize(){return this.divide(this.length()),this}normalized(){return ce.divideScalar(this,this.length())}whichSide(e,t){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}sameSideAs(e,t,r){let i=this.whichSide(e,t),s=r.whichSide(e,t);return i<0&&s<0||i==0&&s==0||i>0&&s>0}static add(e,t){return new ce(e.x+t.x,e.y+t.y)}static subtract(e,t){return new ce(e.x-t.x,e.y-t.y)}static multiply(e,t){return new ce(e.x*t.x,e.y*t.y)}static multiplyScalar(e,t){return new ce(e.x,e.y).multiplyScalar(t)}static midpoint(e,t){return new ce((e.x+t.x)/2,(e.y+t.y)/2)}static normals(e,t){let r=ce.subtract(t,e);return[new ce(-r.y,r.x),new ce(r.y,-r.x)]}static units(e,t){let r=ce.subtract(t,e);return[new ce(-r.y,r.x).normalize(),new ce(r.y,-r.x).normalize()]}static divide(e,t){return new ce(e.x/t.x,e.y/t.y)}static divideScalar(e,t){return new ce(e.x/t,e.y/t)}static dot(e,t){return e.x*t.x+e.y*t.y}static angle(e,t){let r=ce.dot(e,t);return Math.acos(r/(e.length()*t.length()))}static threePointangle(e,t,r){let i=ce.subtract(t,e),s=ce.subtract(r,t),a=e.distance(t),n=t.distance(r);return Math.acos(ce.dot(i,s)/(a*n))}static scalarProjection(e,t){let r=t.normalized();return ce.dot(e,r)}static averageDirection(e){let t=new ce(0,0);for(var r=0;r<e.length;r++){let i=e[r];t.add(i)}return t.normalize()}};var $t=zn,Qr,Ci;function Qt(){if(Ci)return Qr;Ci=1;const q=or,e=lr,t=$t;Mr();class r{constructor(s,a=0,n=0){this.id=null,this.value=s,this.position=new t(a||0,n||0),this.previousPosition=new t(0,0),this.parentVertexId=null,this.children=Array(),this.spanningTreeChildren=Array(),this.edges=Array(),this.positioned=!1,this.angle=null,this.dir=1,this.neighbourCount=0,this.neighbours=Array(),this.neighbouringElements=Array(),this.forcePositioned=!1}setPosition(s,a){this.position.x=s,this.position.y=a}setPositionFromVector(s){this.position.x=s.x,this.position.y=s.y}addChild(s){this.children.push(s),this.neighbours.push(s),this.neighbourCount++}addRingbondChild(s,a){if(this.children.push(s),this.value.bracket){let n=1;this.id===0&&this.value.bracket.hcount===0&&(n=0),this.value.bracket.hcount===1&&a===0&&(n=2),this.value.bracket.hcount===1&&a===1&&(this.neighbours.length<3?n=2:n=3),this.value.bracket.hcount===null&&a===0&&(n=1),this.value.bracket.hcount===null&&a===1&&(this.neighbours.length<3?n=1:n=2),this.neighbours.splice(n,0,s)}else this.neighbours.push(s);this.neighbourCount++}setParentVertexId(s){this.neighbourCount++,this.parentVertexId=s,this.neighbours.push(s)}isTerminal(){return this.value.hasAttachedPseudoElements?!0:this.parentVertexId===null&&this.children.length<2||this.children.length===0}clone(){let s=new r(this.value,this.position.x,this.position.y);return s.id=this.id,s.previousPosition=new t(this.previousPosition.x,this.previousPosition.y),s.parentVertexId=this.parentVertexId,s.children=e.clone(this.children),s.spanningTreeChildren=e.clone(this.spanningTreeChildren),s.edges=e.clone(this.edges),s.positioned=this.positioned,s.angle=this.angle,s.forcePositioned=this.forcePositioned,s}equals(s){return this.id===s.id}getAngle(s=null,a=!1){let n=null;return s?n=t.subtract(this.position,s):n=t.subtract(this.position,this.previousPosition),a?q.toDeg(n.angle()):n.angle()}getTextDirection(s,a=!1){let n=this.getDrawnNeighbours(s),u=Array();if(s.length===1)return"right";for(let d=0;d<n.length;d++)u.push(this.getAngle(s[n[d]].position));let o=q.meanAngle(u);if(this.isTerminal()||a)Math.round(o*100)/100===1.57&&(o=o-.2),o=Math.round(Math.round(o/Math.PI)*Math.PI);else{let d=Math.PI/2;o=Math.round(Math.round(o/d)*d)}return o===2?"down":o===-2?"up":o===0||o===-0?"right":o===3||o===-3?"left":"down"}getNeighbours(s=null){if(s===null)return this.neighbours.slice();let a=Array();for(let n=0;n<this.neighbours.length;n++)this.neighbours[n]!==s&&a.push(this.neighbours[n]);return a}getDrawnNeighbours(s){let a=Array();for(let n=0;n<this.neighbours.length;n++)s[this.neighbours[n]].value.isDrawn&&a.push(this.neighbours[n]);return a}getNeighbourCount(){return this.neighbourCount}getSpanningTreeNeighbours(s=null){let a=Array();for(let n=0;n<this.spanningTreeChildren.length;n++)(s===void 0||s!=this.spanningTreeChildren[n])&&a.push(this.spanningTreeChildren[n]);return this.parentVertexId!=null&&(s===void 0||s!=this.parentVertexId)&&a.push(this.parentVertexId),a}getNextInRing(s,a,n){let u=this.getNeighbours();for(let o=0;o<u.length;o++)if(e.contains(s[u[o]].value.rings,{value:a})&&u[o]!=n)return u[o];return null}}return Qr=r,Qr}var jr,xi;function ki(){if(xi)return jr;xi=1,Qt(),hr();class q{constructor(t,r){this.id=null,this.firstRingId=t.id,this.secondRingId=r.id,this.vertices=new Set;for(var i=0;i<t.members.length;i++){let s=t.members[i];for(let a=0;a<r.members.length;a++){let n=r.members[a];s===n&&this.addVertex(s)}}}addVertex(t){this.vertices.add(t)}updateOther(t,r){this.firstRingId===r?this.secondRingId=t:this.firstRingId=t}containsRing(t){return this.firstRingId===t||this.secondRingId===t}isBridge(t){if(this.vertices.size>2)return!0;for(let r of this.vertices)if(t[r].value.rings.length>2)return!0;return!1}static isBridge(t,r,i,s){let a=null;for(let n=0;n<t.length;n++)if(a=t[n],a.firstRingId===i&&a.secondRingId===s||a.firstRingId===s&&a.secondRingId===i)return a.isBridge(r);return!1}static getNeighbours(t,r){let i=[];for(let s=0;s<t.length;s++){let a=t[s];a.firstRingId===r?i.push(a.secondRingId):a.secondRingId===r&&i.push(a.firstRingId)}return i}static getVertices(t,r,i){for(let s=0;s<t.length;s++){let a=t[s];if(a.firstRingId===r&&a.secondRingId===i||a.firstRingId===i&&a.secondRingId===r)return[...a.vertices]}}}return jr=q,jr}var ei,Ni;function hr(){if(Ni)return ei;Ni=1;const q=lr,e=$t;Qt();const t=ki();class r{constructor(s){this.id=null,this.members=s,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new e(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}clone(){let s=new r(this.members);return s.id=this.id,s.insiders=q.clone(this.insiders),s.neighbours=q.clone(this.neighbours),s.positioned=this.positioned,s.center=this.center.clone(),s.rings=q.clone(this.rings),s.isBridged=this.isBridged,s.isPartOfBridged=this.isPartOfBridged,s.isSpiro=this.isSpiro,s.isFused=this.isFused,s.centralAngle=this.centralAngle,s.canFlip=this.canFlip,s}getSize(){return this.members.length}getPolygon(s){let a=[];for(let n=0;n<this.members.length;n++)a.push(s[this.members[n]].position);return a}getAngle(){return Math.PI-this.centralAngle}eachMember(s,a,n,u){n=n||n===0?n:this.members[0];let o=n,d=0;for(;o!=null&&d<100;){let g=o;a(g),o=s[o].getNextInRing(s,this.id,u),u=g,o==n&&(o=null),d++}}getOrderedNeighbours(s){let a=Array(this.neighbours.length);for(let n=0;n<this.neighbours.length;n++){let u=t.getVertices(s,this.id,this.neighbours[n]);a[n]={n:u.length,neighbour:this.neighbours[n]}}return a.sort(function(n,u){return u.n-n.n}),a}isBenzeneLike(s){let a=this.getDoubleBondCount(s),n=this.members.length;return a===3&&n===6||a===2&&n===5}getDoubleBondCount(s){let a=0;for(let n=0;n<this.members.length;n++){let u=s[this.members[n]].value;(u.bondType==="="||u.branchBond==="=")&&a++}return a}contains(s){for(let a=0;a<this.members.length;a++)if(this.members[a]==s)return!0;return!1}}return ei=r,ei}var ti,Ri;function Mr(){if(Ri)return ti;Ri=1;const q=lr;Qt(),hr();class e{constructor(r,i="-"){this.idx=null,this.element=r.length===1?r.toUpperCase():r,this.drawExplicit=!1,this.ringbonds=Array(),this.rings=Array(),this.bondType=i,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=Array(),this.bridgedRing=null,this.anchoredRings=Array(),this.bracket=null,this.plane=0,this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=Array(),this.isPartOfAromaticRing=r!==this.element,this.bondCount=0,this.chirality="",this.isStereoCenter=!1,this.priority=0,this.mainChain=!1,this.hydrogenDirection="down",this.subtreeDepth=1,this.hasHydrogen=!1,this.class=void 0}addNeighbouringElement(r){this.neighbouringElements.push(r)}attachPseudoElement(r,i,s=0,a=0){s===null&&(s=0),a===null&&(a=0);let n=s+r+a;this.attachedPseudoElements[n]?this.attachedPseudoElements[n].count+=1:this.attachedPseudoElements[n]={element:r,count:1,hydrogenCount:s,previousElement:i,charge:a},this.hasAttachedPseudoElements=!0}getAttachedPseudoElements(){let r={},i=this;return Object.keys(this.attachedPseudoElements).sort().forEach(function(s){r[s]=i.attachedPseudoElements[s]}),r}getAttachedPseudoElementsCount(){return Object.keys(this.attachedPseudoElements).length}isHeteroAtom(){return this.element!=="C"&&this.element!=="H"}addAnchoredRing(r){q.contains(this.anchoredRings,{value:r})||this.anchoredRings.push(r)}getRingbondCount(){return this.ringbonds.length}backupRings(){this.originalRings=Array(this.rings.length);for(let r=0;r<this.rings.length;r++)this.originalRings[r]=this.rings[r]}restoreRings(){this.rings=Array(this.originalRings.length);for(let r=0;r<this.originalRings.length;r++)this.rings[r]=this.originalRings[r]}haveCommonRingbond(r,i){for(let s=0;s<r.ringbonds.length;s++)for(let a=0;a<i.ringbonds.length;a++)if(r.ringbonds[s].id==i.ringbonds[a].id)return!0;return!1}neighbouringElementsEqual(r){if(r.length!==this.neighbouringElements.length)return!1;r.sort(),this.neighbouringElements.sort();for(var i=0;i<this.neighbouringElements.length;i++)if(r[i]!==this.neighbouringElements[i])return!1;return!0}getAtomicNumber(){return e.atomicNumbers[this.element]}getMaxBonds(){return e.maxBonds[this.element]}static get maxBonds(){return{H:1,C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}static get atomicNumbers(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}static get mass(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}}return ti=e,ti}const Kt=$t;let _n=class Oi{constructor(e=new Kt(0,0),t=new Kt(0,0),r=null,i=null,s=!1,a=!1){this.from=e,this.to=t,this.elementFrom=r,this.elementTo=i,this.chiralFrom=s,this.chiralTo=a}clone(){return new Oi(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}getLength(){return Math.sqrt(Math.pow(this.to.x-this.from.x,2)+Math.pow(this.to.y-this.from.y,2))}getAngle(){return Kt.subtract(this.getRightVector(),this.getLeftVector()).angle()}getRightVector(){return this.from.x<this.to.x?this.to:this.from}getLeftVector(){return this.from.x<this.to.x?this.from:this.to}getRightElement(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}getLeftElement(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}getRightChiral(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}getLeftChiral(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}setRightVector(e,t){return this.from.x<this.to.x?(this.to.x=e,this.to.y=t):(this.from.x=e,this.from.y=t),this}setLeftVector(e,t){return this.from.x<this.to.x?(this.from.x=e,this.from.y=t):(this.to.x=e,this.to.y=t),this}rotateToXAxis(){let e=this.getLeftVector();return this.setRightVector(e.x+this.getLength(),e.y),this}rotate(e){let t=this.getLeftVector(),r=this.getRightVector(),i=Math.sin(e),s=Math.cos(e),a=s*(r.x-t.x)-i*(r.y-t.y)+t.x,n=i*(r.x-t.x)-s*(r.y-t.y)+t.y;return this.setRightVector(a,n),this}shortenFrom(e){let t=Kt.subtract(this.to,this.from);return t.normalize(),t.multiplyScalar(e),this.from.add(t),this}shortenTo(e){let t=Kt.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e),this.to.add(t),this}shortenRight(e){return this.from.x<this.to.x?this.shortenTo(e):this.shortenFrom(e),this}shortenLeft(e){return this.from.x<this.to.x?this.shortenFrom(e):this.shortenTo(e),this}shorten(e){let t=Kt.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e/2),this.to.add(t),this.from.subtract(t),this}};var oi=_n;let Hn=class zi{constructor(e,t,r=1){this.id=null,this.sourceId=e,this.targetId=t,this.weight=r,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.wedge=""}setBondType(e){this.bondType=e,this.weight=zi.bonds[e]}static get bonds(){return{"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}};var _i=Hn;function Fn(q){return q===1?"+":q===2?"2+":q===-1?"-":q===-2?"2-":""}var Hi={getChargeText:Fn};const Jt=or,Fe=$t;Qt();hr();const{getChargeText:Ei}=Hi;let Wn=class{constructor(e,t,r){typeof e=="string"||e instanceof String?this.canvas=document.getElementById(e):this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.themeManager=t,this.opts=r,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2,this.halfBondThickness=this.opts.bondThickness/2}updateSize(e,t){this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,this.ratio!==1?(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0)):(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio)}setTheme(e){this.colors=e}scale(e){let t=-Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,s=Number.MAX_VALUE;for(var a=0;a<e.length;a++){if(!e[a].value.isDrawn)continue;let g=e[a].position;t<g.x&&(t=g.x),r<g.y&&(r=g.y),i>g.x&&(i=g.x),s>g.y&&(s=g.y)}var n=this.opts.padding;t+=n,r+=n,i-=n,s-=n,this.drawingWidth=t-i,this.drawingHeight=r-s;var u=this.canvas.offsetWidth/this.drawingWidth,o=this.canvas.offsetHeight/this.drawingHeight,d=u<o?u:o;this.ctx.scale(d,d),this.offsetX=-i,this.offsetY=-s,u<o?this.offsetY+=this.canvas.offsetHeight/(2*d)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*d)-this.drawingWidth/2}reset(){this.ctx.setTransform(1,0,0,1,0,0)}getColor(e){return e=e.toUpperCase(),e in this.colors?this.colors[e]:this.colors.C}drawCircle(e,t,r,i,s=!0,a=!1,n=""){let u=this.ctx,o=this.offsetX,d=this.offsetY;u.save(),u.lineWidth=1.5,u.beginPath(),u.arc(e+o,t+d,r,0,Jt.twoPI,!0),u.closePath(),a?(s?(u.fillStyle="#f00",u.fill()):(u.strokeStyle="#f00",u.stroke()),this.drawDebugText(e,t,n)):s?(u.fillStyle=i,u.fill()):(u.strokeStyle=i,u.stroke()),u.restore()}drawLine(e,t=!1,r=1){let i=this.ctx,s=this.offsetX,a=this.offsetY,n=e.clone().shorten(4),u=n.getLeftVector().clone(),o=n.getRightVector().clone();u.x+=s,u.y+=a,o.x+=s,o.y+=a,t||(i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.moveTo(u.x,u.y),i.lineTo(o.x,o.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness+1.2,i.strokeStyle=this.themeManager.getColor("BACKGROUND"),i.stroke(),i.globalCompositeOperation="source-over",i.restore()),u=e.getLeftVector().clone(),o=e.getRightVector().clone(),u.x+=s,u.y+=a,o.x+=s,o.y+=a,i.save(),i.beginPath(),i.moveTo(u.x,u.y),i.lineTo(o.x,o.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness;let d=this.ctx.createLinearGradient(u.x,u.y,o.x,o.y);d.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),t&&(i.setLineDash([1,1.5]),i.lineWidth=this.opts.bondThickness/1.5),r<1&&(i.globalAlpha=r),i.strokeStyle=d,i.stroke(),i.restore()}drawWedge(e,t=1){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let r=this.ctx,i=this.offsetX,s=this.offsetY,a=e.clone().shorten(5),n=a.getLeftVector().clone(),u=a.getRightVector().clone();n.x+=i,n.y+=s,u.x+=i,u.y+=s,n=e.getLeftVector().clone(),u=e.getRightVector().clone(),n.x+=i,n.y+=s,u.x+=i,u.y+=s,r.save();let o=Fe.normals(n,u);o[0].normalize(),o[1].normalize();let d=e.getRightChiral(),g=n,c=u;d&&(g=u,c=n);let b=Fe.add(g,Fe.multiplyScalar(o[0],this.halfBondThickness)),S=Fe.add(c,Fe.multiplyScalar(o[0],1.5+this.halfBondThickness)),A=Fe.add(c,Fe.multiplyScalar(o[1],1.5+this.halfBondThickness)),B=Fe.add(g,Fe.multiplyScalar(o[1],this.halfBondThickness));r.beginPath(),r.moveTo(b.x,b.y),r.lineTo(S.x,S.y),r.lineTo(A.x,A.y),r.lineTo(B.x,B.y);let P=this.ctx.createRadialGradient(u.x,u.y,this.opts.bondLength,u.x,u.y,0);P.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),P.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),r.fillStyle=P,r.fill(),r.restore()}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let t=this.ctx,r=this.offsetX,i=this.offsetY,s=e.getLeftVector().clone(),a=e.getRightVector().clone();s.x+=r,s.y+=i,a.x+=r,a.y+=i,t.save();let n=Fe.normals(s,a);n[0].normalize(),n[1].normalize();let u=e.getRightChiral(),o,d,g,c,b=e.clone();u?(o=a,d=s,b.shortenRight(1),g=b.getRightVector().clone(),c=b.getLeftVector().clone()):(o=s,d=a,b.shortenLeft(1),g=b.getLeftVector().clone(),c=b.getRightVector().clone()),g.x+=r,g.y+=i,c.x+=r,c.y+=i;let S=Fe.subtract(d,o).normalize();t.strokeStyle=this.themeManager.getColor("C"),t.lineCap="round",t.lineWidth=this.opts.bondThickness,t.beginPath();let A=e.getLength(),B=1.25/(A/(this.opts.bondThickness*3)),P=!1;for(var M=0;M<1;M+=B){let x=Fe.multiplyScalar(S,M*A),L=Fe.add(o,x),I=1.5*M,J=Fe.multiplyScalar(n[0],I);!P&&M>.5&&(t.stroke(),t.beginPath(),t.strokeStyle=this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C"),P=!0),L.subtract(J),t.moveTo(L.x,L.y),L.add(Fe.multiplyScalar(J,2)),t.lineTo(L.x,L.y)}t.stroke(),t.restore()}drawDebugText(e,t,r){let i=this.ctx;i.save(),i.font="5px Droid Sans, sans-serif",i.textAlign="start",i.textBaseline="top",i.fillStyle="#ff0000",i.fillText(r,e+this.offsetX,t+this.offsetY),i.restore()}drawBall(e,t,r){let i=this.ctx;i.save(),i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,this.opts.bondLength/4.5,0,Jt.twoPI,!1),i.fillStyle=this.themeManager.getColor(r),i.fill(),i.restore()}drawPoint(e,t,r){let i=this.ctx,s=this.offsetX,a=this.offsetY;i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.arc(e+s,t+a,1.5,0,Jt.twoPI,!0),i.closePath(),i.fill(),i.globalCompositeOperation="source-over",i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,.75,0,Jt.twoPI,!1),i.fillStyle=this.themeManager.getColor(r),i.fill(),i.restore()}drawText(e,t,r,i,s,a,n,u,o,d={}){let g=this.ctx,c=this.offsetX,b=this.offsetY;g.save(),g.textAlign="start",g.textBaseline="alphabetic";let S="",A=0;n&&(S=Ei(n),g.font=this.fontSmall,A=g.measureText(S).width);let B="0",P=0;u>0&&(B=u.toString(),g.font=this.fontSmall,P=g.measureText(B).width),n===1&&r==="N"&&d.hasOwnProperty("0O")&&d.hasOwnProperty("0O-1")&&(d={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},n=0),g.font=this.fontLarge,g.fillStyle=this.themeManager.getColor("BACKGROUND");let M=g.measureText(r);M.totalWidth=M.width+A,M.height=parseInt(this.fontLarge,10);let x=M.width>this.opts.fontSizeLarge?M.width:this.opts.fontSizeLarge;x/=1.5,g.globalCompositeOperation="destination-out",g.beginPath(),g.arc(e+c,t+b,x,0,Jt.twoPI,!0),g.closePath(),g.fill(),g.globalCompositeOperation="source-over";let L=-M.width/2,I=-M.width/2;g.fillStyle=this.themeManager.getColor(r),g.fillText(r,e+c+L,t+this.opts.halfFontSizeLarge+b),L+=M.width,n&&(g.font=this.fontSmall,g.fillText(S,e+c+L,t-this.opts.fifthFontSizeSmall+b),L+=A),u>0&&(g.font=this.fontSmall,g.fillText(B,e+c+I-P,t-this.opts.fifthFontSizeSmall+b),I-=P),g.font=this.fontLarge;let J=0,oe=0;if(i===1){let Q=e+c,K=t+b+this.opts.halfFontSizeLarge;J=this.hydrogenWidth,I-=J,s==="left"?Q+=I:s==="right"||s==="up"&&a||s==="down"&&a?Q+=L:s==="up"&&!a?(K-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,Q-=this.halfHydrogenWidth):s==="down"&&!a&&(K+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,Q-=this.halfHydrogenWidth),g.fillText("H",Q,K),L+=J}else if(i>1){let Q=e+c,K=t+b+this.opts.halfFontSizeLarge;J=this.hydrogenWidth,g.font=this.fontSmall,oe=g.measureText(i).width,I-=J+oe,s==="left"?Q+=I:s==="right"||s==="up"&&a||s==="down"&&a?Q+=L:s==="up"&&!a?(K-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,Q-=this.halfHydrogenWidth):s==="down"&&!a&&(K+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,Q-=this.halfHydrogenWidth),g.font=this.fontLarge,g.fillText("H",Q,K),g.font=this.fontSmall,g.fillText(i,Q+this.halfHydrogenWidth+oe,K+this.opts.fifthFontSizeSmall),L+=J+this.halfHydrogenWidth+oe}for(let Q in d){if(!d.hasOwnProperty(Q))continue;let K=0,j=0,be=d[Q].element,le=d[Q].count,Re=d[Q].hydrogenCount,Ke=d[Q].charge;g.font=this.fontLarge,le>1&&Re>0&&(K=g.measureText("(").width,j=g.measureText(")").width);let ze=g.measureText(be).width,Ve=0,Je="",ft=0;J=0,Re>0&&(J=this.hydrogenWidth),g.font=this.fontSmall,le>1&&(Ve=g.measureText(le).width),Ke!==0&&(Je=Ei(Ke),ft=g.measureText(Je).width),oe=0,Re>1&&(oe=g.measureText(Re).width),g.font=this.fontLarge;let ye=e+c,Ee=t+b+this.opts.halfFontSizeLarge;g.fillStyle=this.themeManager.getColor(be),le>0&&(I-=Ve),le>1&&Re>0&&(s==="left"?(I-=j,g.fillText(")",ye+I,Ee)):(g.fillText("(",ye+L,Ee),L+=K)),s==="left"?(I-=ze,g.fillText(be,ye+I,Ee)):(g.fillText(be,ye+L,Ee),L+=ze),Re>0&&(s==="left"?(I-=J+oe,g.fillText("H",ye+I,Ee),Re>1&&(g.font=this.fontSmall,g.fillText(Re,ye+I+J,Ee+this.opts.fifthFontSizeSmall))):(g.fillText("H",ye+L,Ee),L+=J,Re>1&&(g.font=this.fontSmall,g.fillText(Re,ye+L,Ee+this.opts.fifthFontSizeSmall),L+=oe))),g.font=this.fontLarge,le>1&&Re>0&&(s==="left"?(I-=K,g.fillText("(",ye+I,Ee)):(g.fillText(")",ye+L,Ee),L+=j)),g.font=this.fontSmall,le>1&&(s==="left"?g.fillText(le,ye+I+K+j+J+oe+ze,Ee+this.opts.fifthFontSizeSmall):(g.fillText(le,ye+L,Ee+this.opts.fifthFontSizeSmall),L+=Ve)),Ke!==0&&(s==="left"?g.fillText(Je,ye+I+K+j+J+oe+ze,t-this.opts.fifthFontSizeSmall+b):(g.fillText(Je,ye+L,t-this.opts.fifthFontSizeSmall+b),L+=ft))}g.restore()}getChargeText(e){return e===1?"+":e===2?"2+":e===-1?"-":e===-2?"2-":""}drawDebugPoint(e,t,r="",i="#f00"){this.drawCircle(e,t,2,i,!0,!0,r)}drawAromaticityRing(e){let t=this.ctx,r=Jt.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.themeManager.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,r-this.opts.bondSpacing,0,Math.PI*2,!0),t.closePath(),t.stroke(),t.restore()}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}};var Xn=Wn;const Ti=or,Vn=Qt(),qn=_i;hr();const Yn=Mr();let Un=class ar{constructor(e,t=!1){this.vertices=Array(),this.edges=Array(),this.atomIdxToVertexId=Array(),this.vertexIdsToEdgeId={},this.isomeric=t,this._atomIdx=0,this._time=0,this._init(e)}_init(e,t=0,r=null,i=!1){const s=e.atom.element?e.atom.element:e.atom;let a=new Yn(s,e.bond);(s!=="H"||!e.hasNext&&r===null)&&(a.idx=this._atomIdx,this._atomIdx++),a.branchBond=e.branchBond,a.ringbonds=e.ringbonds,a.bracket=e.atom.element?e.atom:null,a.class=e.atom.class;let n=new Vn(a),u=this.vertices[r];if(this.addVertex(n),a.idx!==null&&this.atomIdxToVertexId.push(n.id),r!==null){n.setParentVertexId(r),n.value.addNeighbouringElement(u.value.element),u.addChild(n.id),u.value.addNeighbouringElement(a.element),u.spanningTreeChildren.push(n.id);let c=new qn(r,n.id,1);i?(c.setBondType(n.value.branchBond||"-"),n.id,c.setBondType(n.value.branchBond||"-"),n.id):(c.setBondType(u.value.bondType||"-"),u.id),this.addEdge(c)}let o=e.ringbondCount+1;a.bracket&&(o+=a.bracket.hcount);let d=0;if(a.bracket&&a.bracket.chirality){a.isStereoCenter=!0,d=a.bracket.hcount;for(var g=0;g<d;g++)this._init({atom:"H",isBracket:"false",branches:Array(),branchCount:0,ringbonds:Array(),ringbondCount:!1,next:null,hasNext:!1,bond:"-"},g,n.id,!0)}for(var g=0;g<e.branchCount;g++)this._init(e.branches[g],g+o,n.id,!0);e.hasNext&&this._init(e.next,e.branchCount+o,n.id)}clear(){this.vertices=Array(),this.edges=Array(),this.vertexIdsToEdgeId={}}addVertex(e){return e.id=this.vertices.length,this.vertices.push(e),e.id}addEdge(e){let t=this.vertices[e.sourceId],r=this.vertices[e.targetId];return e.id=this.edges.length,this.edges.push(e),this.vertexIdsToEdgeId[e.sourceId+"_"+e.targetId]=e.id,this.vertexIdsToEdgeId[e.targetId+"_"+e.sourceId]=e.id,e.isPartOfAromaticRing=t.value.isPartOfAromaticRing&&r.value.isPartOfAromaticRing,t.value.bondCount+=e.weight,r.value.bondCount+=e.weight,t.edges.push(e.id),r.edges.push(e.id),e.id}getEdge(e,t){let r=this.vertexIdsToEdgeId[e+"_"+t];return r===void 0?null:this.edges[r]}getEdges(e){let t=Array(),r=this.vertices[e];for(var i=0;i<r.neighbours.length;i++)t.push(this.vertexIdsToEdgeId[e+"_"+r.neighbours[i]]);return t}hasEdge(e,t){return this.vertexIdsToEdgeId[e+"_"+t]!==void 0}getVertexList(){let e=[this.vertices.length];for(var t=0;t<this.vertices.length;t++)e[t]=this.vertices[t].id;return e}getEdgeList(){let e=Array(this.edges.length);for(var t=0;t<this.edges.length;t++)e[t]=[this.edges[t].sourceId,this.edges[t].targetId];return e}getAdjacencyMatrix(){let e=this.vertices.length,t=Array(e);for(var r=0;r<e;r++)t[r]=new Array(e),t[r].fill(0);for(var r=0;r<this.edges.length;r++){let s=this.edges[r];t[s.sourceId][s.targetId]=1,t[s.targetId][s.sourceId]=1}return t}getComponentsAdjacencyMatrix(){let e=this.vertices.length,t=Array(e),r=this.getBridges();for(var i=0;i<e;i++)t[i]=new Array(e),t[i].fill(0);for(var i=0;i<this.edges.length;i++){let a=this.edges[i];t[a.sourceId][a.targetId]=1,t[a.targetId][a.sourceId]=1}for(var i=0;i<r.length;i++)t[r[i][0]][r[i][1]]=0,t[r[i][1]][r[i][0]]=0;return t}getSubgraphAdjacencyMatrix(e){let t=e.length,r=Array(t);for(var i=0;i<t;i++){r[i]=new Array(t),r[i].fill(0);for(var s=0;s<t;s++)i!==s&&this.hasEdge(e[i],e[s])&&(r[i][s]=1)}return r}getDistanceMatrix(){let e=this.vertices.length,t=this.getAdjacencyMatrix(),r=Array(e);for(var i=0;i<e;i++)r[i]=Array(e),r[i].fill(1/0);for(var i=0;i<e;i++)for(var s=0;s<e;s++)t[i][s]===1&&(r[i][s]=1);for(var a=0;a<e;a++)for(var i=0;i<e;i++)for(var s=0;s<e;s++)r[i][s]>r[i][a]+r[a][s]&&(r[i][s]=r[i][a]+r[a][s]);return r}getSubgraphDistanceMatrix(e){let t=e.length,r=this.getSubgraphAdjacencyMatrix(e),i=Array(t);for(var s=0;s<t;s++)i[s]=Array(t),i[s].fill(1/0);for(var s=0;s<t;s++)for(var a=0;a<t;a++)r[s][a]===1&&(i[s][a]=1);for(var n=0;n<t;n++)for(var s=0;s<t;s++)for(var a=0;a<t;a++)i[s][a]>i[s][n]+i[n][a]&&(i[s][a]=i[s][n]+i[n][a]);return i}getAdjacencyList(){let e=this.vertices.length,t=Array(e);for(var r=0;r<e;r++){t[r]=[];for(var i=0;i<e;i++)r!==i&&this.hasEdge(this.vertices[r].id,this.vertices[i].id)&&t[r].push(i)}return t}getSubgraphAdjacencyList(e){let t=e.length,r=Array(t);for(var i=0;i<t;i++){r[i]=Array();for(var s=0;s<t;s++)i!==s&&this.hasEdge(e[i],e[s])&&r[i].push(s)}return r}getBridges(){let e=this.vertices.length,t=new Array(e),r=new Array(e),i=new Array(e),s=new Array(e),a=this.getAdjacencyList(),n=Array();t.fill(!1),s.fill(null),this._time=0;for(var u=0;u<e;u++)t[u]||this._bridgeDfs(u,t,r,i,s,a,n);return n}traverseBF(e,t){let r=this.vertices.length,i=new Array(r);i.fill(!1);for(var s=[e];s.length>0;){let n=s.shift(),u=this.vertices[n];t(u);for(var a=0;a<u.neighbours.length;a++){let o=u.neighbours[a];i[o]||(i[o]=!0,s.push(o))}}}getTreeDepth(e,t){if(e===null||t===null)return 0;let r=this.vertices[e].getSpanningTreeNeighbours(t),i=0;for(var s=0;s<r.length;s++){let a=r[s],n=this.getTreeDepth(a,e);n>i&&(i=n)}return i+1}traverseTree(e,t,r,i=999999,s=!1,a=1,n=null){if(n===null&&(n=new Uint8Array(this.vertices.length)),a>i+1||n[e]===1)return;n[e]=1;let u=this.vertices[e],o=u.getNeighbours(t);(!s||a>1)&&r(u);for(var d=0;d<o.length;d++)this.traverseTree(o[d],e,r,i,s,a+1,n)}kkLayout(e,t,r,i,s,a=.1,n=.1,u=2e3,o=50,d=1e9){let g=s;for(var c=e.length;c--;)var b=this.vertices[e[c]].neighbours.length;let S=this.getSubgraphDistanceMatrix(e),A=e.length,B=Ti.polyCircumradius(500,A),P=Ti.centralAngle(A),M=0,x=new Float32Array(A),L=new Float32Array(A),I=Array(A);for(c=A;c--;){let Z=this.vertices[e[c]];Z.positioned?(x[c]=Z.position.x,L[c]=Z.position.y):(x[c]=t.x+Math.cos(M)*B,L[c]=t.y+Math.sin(M)*B),I[c]=Z.positioned,M+=P}let J=Array(A);for(c=A;c--;){J[c]=new Array(A);for(var b=A;b--;)J[c][b]=s*S[c][b]}let oe=Array(A);for(c=A;c--;){oe[c]=Array(A);for(var b=A;b--;)oe[c][b]=g*Math.pow(S[c][b],-2)}let Q=Array(A),K=new Float32Array(A),j=new Float32Array(A);for(c=A;c--;)Q[c]=Array(A);c=A;let be,le,Re,Ke,ze,Ve,Je;for(;c--;){be=x[c],le=L[c],Re=0,Ke=0;let Z=A;for(;Z--;)c!==Z&&(ze=x[Z],Ve=L[Z],Je=1/Math.sqrt((be-ze)*(be-ze)+(le-Ve)*(le-Ve)),Q[c][Z]=[oe[c][Z]*(be-ze-J[c][Z]*(be-ze)*Je),oe[c][Z]*(le-Ve-J[c][Z]*(le-Ve)*Je)],Q[Z][c]=Q[c][Z],Re+=Q[c][Z][0],Ke+=Q[c][Z][1]);K[c]=Re,j[c]=Ke}let ft=function(Z){return[K[Z]*K[Z]+j[Z]*j[Z],K[Z],j[Z]]},ye=function(){let Z=0,Pe=0,et=0,_e=0;for(c=A;c--;){let[tt,Le,qe]=ft(c);tt>Z&&I[c]===!1&&(Z=tt,Pe=c,et=Le,_e=qe)}return[Pe,Z,et,_e]},Ee=function(Z,Pe,et){let _e=0,tt=0,Le=0,qe=x[Z],Ye=L[Z],zt=J[Z],Qe=oe[Z];for(c=A;c--;){if(c===Z)continue;let bt=x[c],rt=L[c],dt=zt[c],Rt=Qe[c],Et=(qe-bt)*(qe-bt),wt=1/Math.pow(Et+(Ye-rt)*(Ye-rt),1.5);_e+=Rt*(1-dt*(Ye-rt)*(Ye-rt)*wt),tt+=Rt*(1-dt*Et*wt),Le+=Rt*(dt*(qe-bt)*(Ye-rt)*wt)}_e===0&&(_e=.1),tt===0&&(tt=.1),Le===0&&(Le=.1);let De=Pe/_e+et/Le;De/=Le/_e-tt/Le;let Te=-(Le*De+Pe)/_e;x[Z]+=Te,L[Z]+=De;let Ie=Q[Z];Pe=0,et=0,qe=x[Z],Ye=L[Z];let mt,ct,_t,Ce,Ht;for(c=A;c--;)Z!==c&&(mt=x[c],ct=L[c],_t=Ie[c][0],Ce=Ie[c][1],Ht=1/Math.sqrt((qe-mt)*(qe-mt)+(Ye-ct)*(Ye-ct)),Te=Qe[c]*(qe-mt-zt[c]*(qe-mt)*Ht),De=Qe[c]*(Ye-ct-zt[c]*(Ye-ct)*Ht),Ie[c]=[Te,De],Pe+=Te,et+=De,K[c]+=Te-_t,j[c]+=De-Ce);K[Z]=Pe,j[Z]=et},xt=0,Nt=0,vt=0,kt=0,qt=0,Ot=0;for(;d>a&&u>qt;)for(qt++,[xt,d,Nt,vt]=ye(),kt=d,Ot=0;kt>n&&o>Ot;)Ot++,Ee(xt,Nt,vt),[kt,Nt,vt]=ft(xt);for(c=A;c--;){let Z=e[c],Pe=this.vertices[Z];Pe.position.x=x[c],Pe.position.y=L[c],Pe.positioned=!0,Pe.forcePositioned=!0}}_bridgeDfs(e,t,r,i,s,a,n){t[e]=!0,r[e]=i[e]=++this._time;for(var u=0;u<a[e].length;u++){let o=a[e][u];t[o]?o!==s[e]&&(i[e]=Math.min(i[e],r[o])):(s[o]=e,this._bridgeDfs(o,t,r,i,s,a,n),i[e]=Math.min(i[e],i[o]),i[o]>r[e]&&n.push([e,o]))}}static getConnectedComponents(e){let t=e.length,r=new Array(t),i=new Array;r.fill(!1);for(var s=0;s<t;s++)if(!r[s]){let a=Array();r[s]=!0,a.push(s),ar._ccGetDfs(s,r,e,a),a.length>1&&i.push(a)}return i}static getConnectedComponentCount(e){let t=e.length,r=new Array(t),i=0;r.fill(!1);for(var s=0;s<t;s++)r[s]||(r[s]=!0,i++,ar._ccCountDfs(s,r,e));return i}static _ccCountDfs(e,t,r){for(var i=0;i<r[e].length;i++)!r[e][i]||t[i]||e===i||(t[i]=!0,ar._ccCountDfs(i,t,r))}static _ccGetDfs(e,t,r,i){for(var s=0;s<r[e].length;s++)!r[e][s]||t[s]||e===s||(t[s]=!0,i.push(s),ar._ccGetDfs(s,t,r,i))}};var Fi=Un;const Gn=Fi;let Zn=class at{static getRings(e,t=!1){let r=e.getComponentsAdjacencyMatrix();if(r.length===0)return null;let i=Gn.getConnectedComponents(r),s=Array();for(var a=0;a<i.length;a++){let o=i[a],d=e.getSubgraphAdjacencyMatrix([...o]),g=new Uint16Array(d.length),c=new Uint16Array(d.length);for(var n=0;n<d.length;n++){c[n]=0,g[n]=0;for(var u=0;u<d[n].length;u++)g[n]+=d[n][u]}let b=0;for(var n=0;n<d.length;n++)for(var u=n+1;u<d.length;u++)b+=d[n][u];let S=b-d.length+1,A=!0;for(var n=0;n<g.length;n++)g[n]!==3&&(A=!1);if(A&&(S=2+b-d.length),S===1){s.push([...o]);continue}t&&(S=999);let{d:B,pe:P,pe_prime:M}=at.getPathIncludedDistanceMatrices(d),x=at.getRingCandidates(B,P,M),L=at.getSSSR(x,B,d,P,M,g,c,S);for(var n=0;n<L.length;n++){let J=Array(L[n].size),oe=0;for(let Q of L[n])J[oe++]=o[Q];s.push(J)}}return s}static matrixToString(e){let t="";for(var r=0;r<e.length;r++){for(var i=0;i<e[r].length;i++)t+=e[r][i]+" ";t+=`
`}return t}static getPathIncludedDistanceMatrices(e){let t=e.length,r=Array(t),i=Array(t),s=Array(t);for(var a=0,n=0,u=0,o=t;o--;){r[o]=Array(t),i[o]=Array(t),s[o]=Array(t);for(var g=t;g--;)r[o][g]=o===g||e[o][g]===1?e[o][g]:Number.POSITIVE_INFINITY,r[o][g]===1?i[o][g]=[[[o,g]]]:i[o][g]=Array(),s[o][g]=Array()}for(var d=t,g;d--;)for(o=t;o--;)for(g=t;g--;){const c=r[o][g],b=r[o][d]+r[d][g];if(c>b){var a,n,u;if(c===b+1)for(s[o][g]=[i[o][g].length],a=i[o][g].length;a--;)for(s[o][g][a]=[i[o][g][a].length],n=i[o][g][a].length;n--;)for(s[o][g][a][n]=[i[o][g][a][n].length],u=i[o][g][a][n].length;u--;)s[o][g][a][n][u]=[i[o][g][a][n][0],i[o][g][a][n][1]];else s[o][g]=Array();for(r[o][g]=b,i[o][g]=[[]],a=i[o][d][0].length;a--;)i[o][g][0].push(i[o][d][0][a]);for(a=i[d][g][0].length;a--;)i[o][g][0].push(i[d][g][0][a])}else if(c===b){if(i[o][d].length&&i[d][g].length){var a;if(i[o][g].length){let A=Array();for(a=i[o][d][0].length;a--;)A.push(i[o][d][0][a]);for(a=i[d][g][0].length;a--;)A.push(i[d][g][0][a]);i[o][g].push(A)}else{let A=Array();for(a=i[o][d][0].length;a--;)A.push(i[o][d][0][a]);for(a=i[d][g][0].length;a--;)A.push(i[d][g][0][a]);i[o][g][0]=A}}}else if(c===b-1){var a;if(s[o][g].length){let A=Array();for(a=i[o][d][0].length;a--;)A.push(i[o][d][0][a]);for(a=i[d][g][0].length;a--;)A.push(i[d][g][0][a]);s[o][g].push(A)}else{let A=Array();for(a=i[o][d][0].length;a--;)A.push(i[o][d][0][a]);for(a=i[d][g][0].length;a--;)A.push(i[d][g][0][a]);s[o][g][0]=A}}}return{d:r,pe:i,pe_prime:s}}static getRingCandidates(e,t,r){let i=e.length,s=Array(),a=0;for(let n=0;n<i;n++)for(let u=0;u<i;u++)e[n][u]===0||t[n][u].length===1&&r[n][u]===0||(r[n][u].length!==0?a=2*(e[n][u]+.5):a=2*e[n][u],a!==1/0&&s.push([a,t[n][u],r[n][u]]));return s.sort(function(n,u){return n[0]-u[0]}),s}static getSSSR(e,t,r,i,s,a,n,u){let o=Array(),d=Array();for(let c=0;c<e.length;c++)if(e[c][0]%2!==0)for(let b=0;b<e[c][2].length;b++){let S=e[c][1][0].concat(e[c][2][b]);for(var g=0;g<S.length;g++)S[g][0].constructor===Array&&(S[g]=S[g][0]);let A=at.bondsToAtoms(S);if(at.getBondCount(A,r)===A.size&&!at.pathSetsContain(o,A,S,d,a,n)&&(o.push(A),d=d.concat(S)),o.length>u)return o}else for(let b=0;b<e[c][1].length-1;b++){let S=e[c][1][b].concat(e[c][1][b+1]);for(var g=0;g<S.length;g++)S[g][0].constructor===Array&&(S[g]=S[g][0]);let A=at.bondsToAtoms(S);if(at.getBondCount(A,r)===A.size&&!at.pathSetsContain(o,A,S,d,a,n)&&(o.push(A),d=d.concat(S)),o.length>u)return o}return o}static getEdgeCount(e){let t=0,r=e.length;for(var i=r-1;i--;)for(var s=r;s--;)e[i][s]===1&&t++;return t}static getEdgeList(e){let t=e.length,r=Array();for(var i=t-1;i--;)for(var s=t;s--;)e[i][s]===1&&r.push([i,s]);return r}static bondsToAtoms(e){let t=new Set;for(var r=e.length;r--;)t.add(e[r][0]),t.add(e[r][1]);return t}static getBondCount(e,t){let r=0;for(let i of e)for(let s of e)i!==s&&(r+=t[i][s]);return r/2}static pathSetsContain(e,t,r,i,s,a){for(var n=e.length;n--;){if(at.isSupersetOf(t,e[n]))return!0;if(e[n].size===t.size&&at.areSetsEqual(e[n],t))return!0}let u=0,o=!1;for(n=r.length;n--;)for(var d=i.length;d--;)(r[n][0]===i[d][0]&&r[n][1]===i[d][1]||r[n][1]===i[d][0]&&r[n][0]===i[d][1])&&u++,u===r.length&&(o=!0);let g=!1;if(o){for(let c of t)if(a[c]<s[c]){g=!0;break}}if(o&&!g)return!0;for(let c of t)a[c]++;return!1}static areSetsEqual(e,t){if(e.size!==t.size)return!1;for(let r of e)if(!t.has(r))return!1;return!0}static isSupersetOf(e,t){for(var r of t)if(!e.has(r))return!1;return!0}};var Kn=Zn;let Jn=class{constructor(e,t){this.colors=e,this.theme=this.colors[t]}getColor(e){return e&&(e=e.toUpperCase(),e in this.theme)?this.theme[e]:this.theme.C}setTheme(e){this.colors.hasOwnProperty(e)&&(this.theme=this.colors[e])}};var hi=Jn;let Qn=class{static extend(){let e=this,t={},r=!1,i=0,s=arguments.length;Object.prototype.toString.call(arguments[0])==="[object Boolean]"&&(r=arguments[0],i++);let a=function(n){for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&(r&&Object.prototype.toString.call(n[u])==="[object Object]"?t[u]=e.extend(!0,t[u],n[u]):t[u]=n[u])};for(;i<s;i++){let n=arguments[i];a(n)}return t}};var ui=Qn;const me=or,pt=lr,G=$t,Ae=oi;Qt();const jn=_i,Er=Mr(),Mi=hr(),Tr=ki(),es=Xn,Li=Fi,ts=Kn,rs=hi,is=ui;let ns=class{constructor(e){this.graph=null,this.doubleBondConfigCount=0,this.doubleBondConfig=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,scale:0,bondThickness:1,bondLength:30,shortBondLength:.8,bondSpacing:.17*30,atomVisualization:"default",isomeric:!0,debug:!1,terminalCarbons:!1,explicitHydrogens:!0,overlapSensitivity:.42,overlapResolutionIterations:1,compactDrawing:!0,fontFamily:"Arial, Helvetica, sans-serif",fontSizeLarge:11,fontSizeSmall:3,padding:10,experimentalSSSR:!1,kkThreshold:.1,kkInnerThreshold:.1,kkMaxIteration:2e4,kkMaxInnerIteration:50,kkMaxEnergy:1e9,weights:{colormap:null,additionalPadding:20,sigma:10,interval:0,opacity:1},themes:{dark:{C:"#fff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#aaa",BACKGROUND:"#141414"},light:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666",BACKGROUND:"#fff"},oldschool:{C:"#000",O:"#000",N:"#000",F:"#000",CL:"#000",BR:"#000",I:"#000",P:"#000",S:"#000",B:"#000",SI:"#000",H:"#000",BACKGROUND:"#fff"},solarized:{C:"#586e75",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#657b83",BACKGROUND:"#fff"},"solarized-dark":{C:"#93a1a1",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#839496",BACKGROUND:"#fff"},matrix:{C:"#678c61",O:"#2fc079",N:"#4f7e7e",F:"#90d762",CL:"#82d967",BR:"#23755a",I:"#409931",P:"#c1ff8a",S:"#faff00",B:"#50b45a",SI:"#409931",H:"#426644",BACKGROUND:"#fff"},github:{C:"#24292f",O:"#cf222e",N:"#0969da",F:"#2da44e",CL:"#6fdd8b",BR:"#bc4c00",I:"#8250df",P:"#bf3989",S:"#d4a72c",B:"#fb8f44",SI:"#bc4c00",H:"#57606a",BACKGROUND:"#fff"},carbon:{C:"#161616",O:"#da1e28",N:"#0f62fe",F:"#198038",CL:"#007d79",BR:"#fa4d56",I:"#8a3ffc",P:"#ff832b",S:"#f1c21b",B:"#8a3800",SI:"#e67e22",H:"#525252",BACKGROUND:"#fff"},cyberpunk:{C:"#ea00d9",O:"#ff3131",N:"#0abdc6",F:"#00ff9f",CL:"#00fe00",BR:"#fe9f20",I:"#ff00ff",P:"#fe7f00",S:"#fcee0c",B:"#ff00ff",SI:"#ffffff",H:"#913cb1",BACKGROUND:"#fff"},gruvbox:{C:"#665c54",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#79740e",BR:"#d65d0e",I:"#b16286",P:"#af3a03",S:"#d79921",B:"#689d6a",SI:"#427b58",H:"#7c6f64",BACKGROUND:"#fbf1c7"},"gruvbox-dark":{C:"#ebdbb2",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#b8bb26",BR:"#d65d0e",I:"#b16286",P:"#fe8019",S:"#d79921",B:"#8ec07c",SI:"#83a598",H:"#bdae93",BACKGROUND:"#282828"},custom:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666",BACKGROUND:"#fff"}}},this.opts=is.extend(!0,this.defaultOptions,e),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}draw(e,t,r="light",i=!1){this.initDraw(e,r,i),this.infoOnly||(this.themeManager=new rs(this.opts.themes,r),this.canvasWrapper=new es(t,this.themeManager,this.opts)),i||(this.processGraph(),this.canvasWrapper.scale(this.graph.vertices),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset(),this.opts.debug&&(console.log(this.graph),console.log(this.rings),console.log(this.ringConnections)))}edgeRingCount(e){let t=this.graph.edges[e],r=this.graph.vertices[t.sourceId],i=this.graph.vertices[t.targetId];return Math.min(r.value.rings.length,i.value.rings.length)}getBridgedRings(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&e.push(this.rings[t]);return e}getFusedRings(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isFused&&e.push(this.rings[t]);return e}getSpiros(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isSpiro&&e.push(this.rings[t]);return e}printRingInfo(){let e="";for(var t=0;t<this.rings.length;t++){const r=this.rings[t];e+=r.id+";",e+=r.members.length+";",e+=r.neighbours.length+";",e+=r.isSpiro?"true;":"false;",e+=r.isFused?"true;":"false;",e+=r.isBridged?"true;":"false;",e+=r.rings.length+";",e+=`
`}return e}rotateDrawing(){let e=0,t=0,r=0;for(var i=0;i<this.graph.vertices.length;i++){let n=this.graph.vertices[i];if(n.value.isDrawn)for(var s=i+1;s<this.graph.vertices.length;s++){let u=this.graph.vertices[s];if(!u.value.isDrawn)continue;let o=n.position.distanceSq(u.position);o>r&&(r=o,e=i,t=s)}}let a=-G.subtract(this.graph.vertices[e].position,this.graph.vertices[t].position).angle();if(!isNaN(a)){let n=a%.523599;n<.2617995?a=a-n:a+=.523599-n;for(var i=0;i<this.graph.vertices.length;i++)i!==t&&this.graph.vertices[i].position.rotateAround(a,this.graph.vertices[t].position);for(var i=0;i<this.rings.length;i++)this.rings[i].center.rotateAround(a,this.graph.vertices[t].position)}}getTotalOverlapScore(){return this.totalOverlapScore}getRingCount(){return this.rings.length}hasBridgedRing(){return this.bridgedRing}getHeavyAtomCount(){let e=0;for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.element!=="H"&&e++;return e}getMolecularFormula(e=null){let t="",r=new Map,i=e===null?this.graph:new Li(e,this.opts.isomeric);for(var s=0;s<i.vertices.length;s++){let n=i.vertices[s].value;if(r.has(n.element)?r.set(n.element,r.get(n.element)+1):r.set(n.element,1),n.bracket&&!n.bracket.chirality&&(r.has("H")?r.set("H",r.get("H")+n.bracket.hcount):r.set("H",n.bracket.hcount)),!n.bracket){let u=Er.maxBonds[n.element]-n.bondCount;n.isPartOfAromaticRing&&u--,r.has("H")?r.set("H",r.get("H")+u):r.set("H",u)}}if(r.has("C")){let n=r.get("C");t+="C"+(n>1?n:""),r.delete("C")}if(r.has("H")){let n=r.get("H");t+="H"+(n>1?n:""),r.delete("H")}return Object.keys(Er.atomicNumbers).sort().map(n=>{if(r.has(n)){let u=r.get(n);t+=n+(u>1?u:"")}}),t}getRingbondType(e,t){if(e.value.getRingbondCount()<1||t.value.getRingbondCount()<1)return null;for(var r=0;r<e.value.ringbonds.length;r++)for(var i=0;i<t.value.ringbonds.length;i++)if(e.value.ringbonds[r].id===t.value.ringbonds[i].id)return e.value.ringbonds[r].bondType==="-"?t.value.ringbonds[i].bond:e.value.ringbonds[r].bond;return null}initDraw(e,t,r,i){this.data=e,this.infoOnly=r,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new Li(e,this.opts.isomeric),this.rings=Array(),this.ringConnections=Array(),this.originalRings=Array(),this.originalRingConnections=Array(),this.bridgedRing=!1,this.doubleBondConfigCount=null,this.doubleBondConfig=null,this.highlight_atoms=i,this.initRings(),this.initHydrogens()}processGraph(){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();let e=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(var t=0;t<this.opts.overlapResolutionIterations;t++)for(var r=0;r<this.graph.edges.length;r++){let i=this.graph.edges[r];if(this.isEdgeRotatable(i)){let s=this.graph.getTreeDepth(i.sourceId,i.targetId),a=this.graph.getTreeDepth(i.targetId,i.sourceId),n=i.targetId,u=i.sourceId;if(s>a&&(n=i.sourceId,u=i.targetId),this.getSubtreeOverlapScore(u,n,e.vertexScores).value>this.opts.overlapSensitivity){let d=this.graph.vertices[n],g=this.graph.vertices[u],c=g.getNeighbours(n);if(c.length===1){let b=this.graph.vertices[c[0]],S=b.position.getRotateAwayFromAngle(d.position,g.position,me.toRad(120));this.rotateSubtree(b.id,g.id,S,g.position);let A=this.getOverlapScore().total;A>this.totalOverlapScore?this.rotateSubtree(b.id,g.id,-S,g.position):this.totalOverlapScore=A}else if(c.length===2){if(g.value.rings.length!==0&&d.value.rings.length!==0)continue;let b=this.graph.vertices[c[0]],S=this.graph.vertices[c[1]];if(b.value.rings.length===1&&S.value.rings.length===1){if(b.value.rings[0]!==S.value.rings[0])continue}else{if(b.value.rings.length!==0||S.value.rings.length!==0)continue;{let A=b.position.getRotateAwayFromAngle(d.position,g.position,me.toRad(120)),B=S.position.getRotateAwayFromAngle(d.position,g.position,me.toRad(120));this.rotateSubtree(b.id,g.id,A,g.position),this.rotateSubtree(S.id,g.id,B,g.position);let P=this.getOverlapScore().total;P>this.totalOverlapScore?(this.rotateSubtree(b.id,g.id,-A,g.position),this.rotateSubtree(S.id,g.id,-B,g.position)):this.totalOverlapScore=P}}}e=this.getOverlapScore()}}}this.resolveSecondaryOverlaps(e.scores),this.opts.isomeric&&this.annotateStereochemistry(),this.opts.compactDrawing&&this.opts.atomVisualization==="default"&&this.initPseudoElements(),this.rotateDrawing()}initRings(){let e=new Map;for(var t=this.graph.vertices.length-1;t>=0;t--){let s=this.graph.vertices[t];if(s.value.ringbonds.length!==0)for(var r=0;r<s.value.ringbonds.length;r++){let a=s.value.ringbonds[r].id,n=s.value.ringbonds[r].bond;if(!e.has(a))e.set(a,[s.id,n]);else{let u=s.id,o=e.get(a)[0],d=e.get(a)[1],g=new jn(u,o,1);g.setBondType(d||n||"-");let c=this.graph.addEdge(g),b=this.graph.vertices[o];s.addRingbondChild(o,r),s.value.addNeighbouringElement(b.value.element),b.addRingbondChild(u,r),b.value.addNeighbouringElement(s.value.element),s.edges.push(c),b.edges.push(c),e.delete(a)}}}let i=ts.getRings(this.graph,this.opts.experimentalSSSR);if(i!==null){for(var t=0;t<i.length;t++){let a=[...i[t]],n=this.addRing(new Mi(a));for(var r=0;r<a.length;r++)this.graph.vertices[a[r]].value.rings.push(n)}for(var t=0;t<this.rings.length-1;t++)for(var r=t+1;r<this.rings.length;r++){let n=this.rings[t],u=this.rings[r],o=new Tr(n,u);o.vertices.size>0&&this.addRingConnection(o)}for(var t=0;t<this.rings.length;t++){let a=this.rings[t];a.neighbours=Tr.getNeighbours(this.ringConnections,a.id)}for(var t=0;t<this.rings.length;t++){let a=this.rings[t];this.graph.vertices[a.members[0]].value.addAnchoredRing(a.id)}for(this.backupRingInformation();this.rings.length>0;){let s=-1;for(var t=0;t<this.rings.length;t++){let o=this.rings[t];this.isPartOfBridgedRing(o.id)&&!o.isBridged&&(s=o.id)}if(s===-1)break;let a=this.getRing(s),n=this.getBridgedRingRings(a.id);this.bridgedRing=!0,this.createBridgedRing(n,a.members[0]);for(var t=0;t<n.length;t++)this.removeRing(n[t])}}}initHydrogens(){if(!this.opts.explicitHydrogens)for(var e=0;e<this.graph.vertices.length;e++){let t=this.graph.vertices[e];if(t.value.element!=="H")continue;let r=this.graph.vertices[t.neighbours[0]];r.value.hasHydrogen=!0,(!r.value.isStereoCenter||r.value.rings.length<2&&!r.value.bridgedRing||r.value.bridgedRing&&r.value.originalRings.length<2)&&(t.value.isDrawn=!1)}}getBridgedRingRings(e){let t=Array(),r=this,i=function(s){let a=r.getRing(s);t.push(s);for(var n=0;n<a.neighbours.length;n++){let u=a.neighbours[n];t.indexOf(u)===-1&&u!==s&&Tr.isBridge(r.ringConnections,r.graph.vertices,s,u)&&i(u)}};return i(e),pt.unique(t)}isPartOfBridgedRing(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].containsRing(e)&&this.ringConnections[t].isBridge(this.graph.vertices))return!0;return!1}createBridgedRing(e,t){let r=new Set,i=new Set,s=new Set;for(var a=0;a<e.length;a++){let g=this.getRing(e[a]);g.isPartOfBridged=!0;for(var n=0;n<g.members.length;n++)i.add(g.members[n]);for(var n=0;n<g.neighbours.length;n++){let b=g.neighbours[n];e.indexOf(b)===-1&&s.add(g.neighbours[n])}}let u=new Set;for(let g of i){let c=this.graph.vertices[g],b=pt.intersection(e,c.value.rings);c.value.rings.length===1||b.length===1?r.add(c.id):u.add(c.id)}Array();let o=Array();for(let g of u){let c=this.graph.vertices[g],b=!1;for(let S=0;S<c.edges.length;S++)this.edgeRingCount(c.edges[S])===1&&(b=!0);b?(c.value.isBridgeNode=!0,r.add(c.id)):(c.value.isBridge=!0,r.add(c.id))}let d=new Mi([...r]);this.addRing(d),d.isBridged=!0,d.neighbours=[...s];for(var a=0;a<e.length;a++)d.rings.push(this.getRing(e[a]).clone());for(var a=0;a<d.members.length;a++)this.graph.vertices[d.members[a]].value.bridgedRing=d.id;for(var a=0;a<o.length;a++){let c=this.graph.vertices[o[a]];c.value.rings=Array()}for(let g of r){let c=this.graph.vertices[g];c.value.rings=pt.removeAll(c.value.rings,e),c.value.rings.push(d.id)}for(var a=0;a<e.length;a++)for(var n=a+1;n<e.length;n++)this.removeRingConnectionsBetween(e[a],e[n]);for(let g of s){let c=this.getRingConnections(g,e);for(var n=0;n<c.length;n++)this.getRingConnection(c[n]).updateOther(d.id,g);this.getRing(g).neighbours.push(d.id)}return d}areVerticesInSameRing(e,t){for(var r=0;r<e.value.rings.length;r++)for(var i=0;i<t.value.rings.length;i++)if(e.value.rings[r]===t.value.rings[i])return!0;return!1}getCommonRings(e,t){let r=Array();for(var i=0;i<e.value.rings.length;i++)for(var s=0;s<t.value.rings.length;s++)e.value.rings[i]==t.value.rings[s]&&r.push(e.value.rings[i]);return r}getLargestOrAromaticCommonRing(e,t){let r=this.getCommonRings(e,t),i=0,s=null;for(var a=0;a<r.length;a++){let n=this.getRing(r[a]),u=n.getSize();if(n.isBenzeneLike(this.graph.vertices))return n;u>i&&(i=u,s=n)}return s}getVerticesAt(e,t,r){let i=Array();for(var s=0;s<this.graph.vertices.length;s++){let a=this.graph.vertices[s];if(a.id===r||!a.positioned)continue;e.distanceSq(a.position)<=t*t&&i.push(a.id)}return i}getClosestVertex(e){let t=99999,r=null;for(var i=0;i<this.graph.vertices.length;i++){let s=this.graph.vertices[i];if(s.id===e.id)continue;let a=e.position.distanceSq(s.position);a<t&&(t=a,r=s)}return r}addRing(e){return e.id=this.ringIdCounter++,this.rings.push(e),e.id}removeRing(e){this.rings=this.rings.filter(function(r){return r.id!==e}),this.ringConnections=this.ringConnections.filter(function(r){return r.firstRingId!==e&&r.secondRingId!==e});for(var t=0;t<this.rings.length;t++){let r=this.rings[t];r.neighbours=r.neighbours.filter(function(i){return i!==e})}}getRing(e){for(var t=0;t<this.rings.length;t++)if(this.rings[t].id==e)return this.rings[t]}addRingConnection(e){return e.id=this.ringConnectionIdCounter++,this.ringConnections.push(e),e.id}removeRingConnection(e){this.ringConnections=this.ringConnections.filter(function(t){return t.id!==e})}removeRingConnectionsBetween(e,t){let r=Array();for(var i=0;i<this.ringConnections.length;i++){let s=this.ringConnections[i];(s.firstRingId===e&&s.secondRingId===t||s.firstRingId===t&&s.secondRingId===e)&&r.push(s.id)}for(var i=0;i<r.length;i++)this.removeRingConnection(r[i])}getRingConnection(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].id==e)return this.ringConnections[t]}getRingConnections(e,t){let r=Array();for(var i=0;i<this.ringConnections.length;i++){let a=this.ringConnections[i];for(var s=0;s<t.length;s++){let n=t[s];(a.firstRingId===e&&a.secondRingId===n||a.firstRingId===n&&a.secondRingId===e)&&r.push(a.id)}}return r}getOverlapScore(){let e=0,t=new Float32Array(this.graph.vertices.length);for(var r=0;r<this.graph.vertices.length;r++)t[r]=0;for(var r=0;r<this.graph.vertices.length;r++)for(var i=this.graph.vertices.length;--i>r;){let n=this.graph.vertices[r],u=this.graph.vertices[i];if(!n.value.isDrawn||!u.value.isDrawn)continue;let o=G.subtract(n.position,u.position).lengthSq();if(o<this.opts.bondLengthSq){let d=(this.opts.bondLength-Math.sqrt(o))/this.opts.bondLength;e+=d,t[r]+=d,t[i]+=d}}let s=Array();for(var r=0;r<this.graph.vertices.length;r++)s.push({id:r,score:t[r]});return s.sort(function(a,n){return n.score-a.score}),{total:e,scores:s,vertexScores:t}}chooseSide(e,t,r){let i=e.getNeighbours(t.id),s=t.getNeighbours(e.id),a=i.length,n=s.length,u=pt.merge(i,s),o=[0,0];for(var d=0;d<u.length;d++)this.graph.vertices[u[d]].position.sameSideAs(e.position,t.position,r[0])?o[0]++:o[1]++;let g=[0,0];for(var d=0;d<this.graph.vertices.length;d++)this.graph.vertices[d].position.sameSideAs(e.position,t.position,r[0])?g[0]++:g[1]++;return{totalSideCount:g,totalPosition:g[0]>g[1]?0:1,sideCount:o,position:o[0]>o[1]?0:1,anCount:a,bnCount:n}}setRingCenter(e){let t=e.getSize(),r=new G(0,0);for(var i=0;i<t;i++)r.add(this.graph.vertices[e.members[i]].position);e.center=r.divide(t)}getSubringCenter(e,t){let r=t.value.originalRings,i=e.center,s=Number.MAX_VALUE;for(var a=0;a<r.length;a++)for(var n=0;n<e.rings.length;n++)r[a]===e.rings[n].id&&e.rings[n].getSize()<s&&(i=e.rings[n].center,s=e.rings[n].getSize());return i}drawEdges(e){let t=this,r=Array(this.graph.edges.length);if(r.fill(!1),this.graph.traverseBF(0,function(s){let a=t.graph.getEdges(s.id);for(var n=0;n<a.length;n++){let u=a[n];r[u]||(r[u]=!0,t.drawEdge(u,e))}}),!this.bridgedRing)for(var i=0;i<this.rings.length;i++){let s=this.rings[i];this.isRingAromatic(s)&&this.canvasWrapper.drawAromaticityRing(s)}}drawEdge(e,t){let r=this,i=this.graph.edges[e],s=this.graph.vertices[i.sourceId],a=this.graph.vertices[i.targetId],n=s.value.element,u=a.value.element;if((!s.value.isDrawn||!a.value.isDrawn)&&this.opts.atomVisualization==="default")return;let o=s.position,d=a.position,g=this.getEdgeNormals(i),c=pt.clone(g);if(c[0].multiplyScalar(10).add(o),c[1].multiplyScalar(10).add(o),i.bondType==="="||this.getRingbondType(s,a)==="="||i.isPartOfAromaticRing&&this.bridgedRing){let b=this.areVerticesInSameRing(s,a),S=this.chooseSide(s,a,c);if(b){let B=this.getLargestOrAromaticCommonRing(s,a).center;g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let P=null;B.sameSideAs(s.position,a.position,G.add(o,g[0]))?P=new Ae(G.add(o,g[0]),G.add(d,g[0]),n,u):P=new Ae(G.add(o,g[1]),G.add(d,g[1]),n,u),P.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),i.isPartOfAromaticRing?this.canvasWrapper.drawLine(P,!0):this.canvasWrapper.drawLine(P),this.canvasWrapper.drawLine(new Ae(o,d,n,u))}else if(i.center||s.isTerminal()&&a.isTerminal()){g[0].multiplyScalar(r.opts.halfBondSpacing),g[1].multiplyScalar(r.opts.halfBondSpacing);let A=new Ae(G.add(o,g[0]),G.add(d,g[0]),n,u),B=new Ae(G.add(o,g[1]),G.add(d,g[1]),n,u);this.canvasWrapper.drawLine(A),this.canvasWrapper.drawLine(B)}else if(S.anCount==0&&S.bnCount>1||S.bnCount==0&&S.anCount>1){g[0].multiplyScalar(r.opts.halfBondSpacing),g[1].multiplyScalar(r.opts.halfBondSpacing);let A=new Ae(G.add(o,g[0]),G.add(d,g[0]),n,u),B=new Ae(G.add(o,g[1]),G.add(d,g[1]),n,u);this.canvasWrapper.drawLine(A),this.canvasWrapper.drawLine(B)}else if(S.sideCount[0]>S.sideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let A=new Ae(G.add(o,g[0]),G.add(d,g[0]),n,u);A.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(A),this.canvasWrapper.drawLine(new Ae(o,d,n,u))}else if(S.sideCount[0]<S.sideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let A=new Ae(G.add(o,g[1]),G.add(d,g[1]),n,u);A.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(A),this.canvasWrapper.drawLine(new Ae(o,d,n,u))}else if(S.totalSideCount[0]>S.totalSideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let A=new Ae(G.add(o,g[0]),G.add(d,g[0]),n,u);A.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(A),this.canvasWrapper.drawLine(new Ae(o,d,n,u))}else if(S.totalSideCount[0]<=S.totalSideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let A=new Ae(G.add(o,g[1]),G.add(d,g[1]),n,u);A.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(A),this.canvasWrapper.drawLine(new Ae(o,d,n,u))}}else if(i.bondType==="#"){g[0].multiplyScalar(r.opts.bondSpacing/1.5),g[1].multiplyScalar(r.opts.bondSpacing/1.5);let b=new Ae(G.add(o,g[0]),G.add(d,g[0]),n,u),S=new Ae(G.add(o,g[1]),G.add(d,g[1]),n,u);this.canvasWrapper.drawLine(b),this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(new Ae(o,d,n,u))}else if(i.bondType!=="."){let b=s.value.isStereoCenter,S=a.value.isStereoCenter;i.wedge==="up"?this.canvasWrapper.drawWedge(new Ae(o,d,n,u,b,S)):i.wedge==="down"?this.canvasWrapper.drawDashedWedge(new Ae(o,d,n,u,b,S)):this.canvasWrapper.drawLine(new Ae(o,d,n,u,b,S))}if(t){let b=G.midpoint(o,d);this.canvasWrapper.drawDebugText(b.x,b.y,"e: "+e)}}drawVertices(e){for(var t=this.graph.vertices.length,t=0;t<this.graph.vertices.length;t++){let i=this.graph.vertices[t],s=i.value,a=0,n=0,u=i.value.bondCount,o=s.element,d=Er.maxBonds[o]-u,g=i.getTextDirection(this.graph.vertices),c=this.opts.terminalCarbons||o!=="C"||s.hasAttachedPseudoElements?i.isTerminal():!1,b=s.element==="C";if(s.element==="N"&&s.isPartOfAromaticRing&&(d=0),s.bracket&&(d=s.bracket.hcount,a=s.bracket.charge,n=s.bracket.isotope),this.opts.atomVisualization==="allballs")this.canvasWrapper.drawBall(i.position.x,i.position.y,o);else if(s.isDrawn&&(!b||s.drawExplicit||c||s.hasAttachedPseudoElements)||this.graph.vertices.length===1)this.opts.atomVisualization==="default"?this.canvasWrapper.drawText(i.position.x,i.position.y,o,d,g,c,a,n,this.graph.vertices.length,s.getAttachedPseudoElements()):this.opts.atomVisualization==="balls"&&this.canvasWrapper.drawBall(i.position.x,i.position.y,o);else if(i.getNeighbourCount()===2&&i.forcePositioned==!0){let S=this.graph.vertices[i.neighbours[0]].position,A=this.graph.vertices[i.neighbours[1]].position,B=G.threePointangle(i.position,S,A);Math.abs(Math.PI-B)<.1&&this.canvasWrapper.drawPoint(i.position.x,i.position.y,o)}if(e){let S="v: "+i.id+" "+pt.print(s.ringbonds);this.canvasWrapper.drawDebugText(i.position.x,i.position.y,S)}}if(this.opts.debug)for(var t=0;t<this.rings.length;t++){let i=this.rings[t].center;this.canvasWrapper.drawDebugPoint(i.x,i.y,"r: "+this.rings[t].id)}}position(){let e=null;for(var t=0;t<this.graph.vertices.length;t++)if(this.graph.vertices[t].value.bridgedRing!==null){e=this.graph.vertices[t];break}for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&(e=this.graph.vertices[this.rings[t].members[0]]);this.rings.length>0&&e===null&&(e=this.graph.vertices[this.rings[0].members[0]]),e===null&&(e=this.graph.vertices[0]),this.createNextBond(e,null,0)}backupRingInformation(){this.originalRings=Array(),this.originalRingConnections=Array();for(var e=0;e<this.rings.length;e++)this.originalRings.push(this.rings[e]);for(var e=0;e<this.ringConnections.length;e++)this.originalRingConnections.push(this.ringConnections[e]);for(var e=0;e<this.graph.vertices.length;e++)this.graph.vertices[e].value.backupRings()}restoreRingInformation(){let e=this.getBridgedRings();this.rings=Array(),this.ringConnections=Array();for(var t=0;t<e.length;t++){let i=e[t];for(var r=0;r<i.rings.length;r++){let s=i.rings[r];this.originalRings[s.id].center=s.center}}for(var t=0;t<this.originalRings.length;t++)this.rings.push(this.originalRings[t]);for(var t=0;t<this.originalRingConnections.length;t++)this.ringConnections.push(this.originalRingConnections[t]);for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.restoreRings()}createRing(e,t=null,r=null,i=null){if(e.positioned)return;t=t||new G(0,0);let s=e.getOrderedNeighbours(this.ringConnections),a=r?G.subtract(r.position,t).angle():0,n=me.polyCircumradius(this.opts.bondLength,e.getSize()),u=me.centralAngle(e.getSize());e.centralAngle=u;let o=a,d=this,g=r?r.id:null;if(e.members.indexOf(g)===-1&&(r&&(r.positioned=!1),g=e.members[0]),e.isBridged){this.graph.kkLayout(e.members.slice(),t,r.id,e,this.opts.bondLength,this.opts.kkThreshold,this.opts.kkInnerThreshold,this.opts.kkMaxIteration,this.opts.kkMaxInnerIteration,this.opts.kkMaxEnergy),e.positioned=!0,this.setRingCenter(e),t=e.center;for(var c=0;c<e.rings.length;c++)this.setRingCenter(e.rings[c])}else e.eachMember(this.graph.vertices,function(S){let A=d.graph.vertices[S];A.positioned||A.setPosition(t.x+Math.cos(o)*n,t.y+Math.sin(o)*n),o+=u,(!e.isBridged||e.rings.length<3)&&(A.angle=o,A.positioned=!0)},g,i?i.id:null);e.positioned=!0,e.center=t;for(var c=0;c<s.length;c++){let A=this.getRing(s[c].neighbour);if(A.positioned)continue;let B=Tr.getVertices(this.ringConnections,e.id,A.id);if(B.length===2){e.isFused=!0,A.isFused=!0;let P=this.graph.vertices[B[0]],M=this.graph.vertices[B[1]],x=G.midpoint(P.position,M.position),L=G.normals(P.position,M.position);L[0].normalize(),L[1].normalize();let I=me.polyCircumradius(this.opts.bondLength,A.getSize()),J=me.apothem(I,A.getSize());L[0].multiplyScalar(J).add(x),L[1].multiplyScalar(J).add(x);let oe=L[0];G.subtract(t,L[1]).lengthSq()>G.subtract(t,L[0]).lengthSq()&&(oe=L[1]);let Q=G.subtract(P.position,oe),K=G.subtract(M.position,oe);Q.clockwise(K)===-1?A.positioned||this.createRing(A,oe,P,M):A.positioned||this.createRing(A,oe,M,P)}else if(B.length===1){e.isSpiro=!0,A.isSpiro=!0;let P=this.graph.vertices[B[0]],M=G.subtract(t,P.position);M.invert(),M.normalize();let x=me.polyCircumradius(this.opts.bondLength,A.getSize());M.multiplyScalar(x),M.add(P.position),A.positioned||this.createRing(A,M,P)}}for(var c=0;c<e.members.length;c++){let A=this.graph.vertices[e.members[c]],B=A.neighbours;for(var b=0;b<B.length;b++){let P=this.graph.vertices[B[b]];P.positioned||(P.value.isConnectedToRing=!0,this.createNextBond(P,A,0))}}}rotateSubtree(e,t,r,i){let s=this;this.graph.traverseTree(e,t,function(a){a.position.rotateAround(r,i);for(var n=0;n<a.value.anchoredRings.length;n++){let u=s.rings[a.value.anchoredRings[n]];u&&u.center.rotateAround(r,i)}})}getSubtreeOverlapScore(e,t,r){let i=this,s=0,a=new G(0,0),n=0;return this.graph.traverseTree(e,t,function(u){if(!u.value.isDrawn)return;let o=r[u.id];o>i.opts.overlapSensitivity&&(s+=o,n++);let d=i.graph.vertices[u.id].position.clone();d.multiplyScalar(o),a.add(d)}),a.divide(s),{value:s/n,center:a}}getCurrentCenterOfMass(){let e=new G(0,0),t=0;for(var r=0;r<this.graph.vertices.length;r++){let i=this.graph.vertices[r];i.positioned&&(e.add(i.position),t++)}return e.divide(t)}getCurrentCenterOfMassInNeigbourhood(e,t=this.opts.bondLength*2){let r=new G(0,0),i=0,s=t*t;for(var a=0;a<this.graph.vertices.length;a++){let n=this.graph.vertices[a];n.positioned&&e.distanceSq(n.position)<s&&(r.add(n.position),i++)}return r.divide(i)}resolvePrimaryOverlaps(){let e=Array(),t=Array(this.graph.vertices.length);for(var r=0;r<this.rings.length;r++){let a=this.rings[r];for(var i=0;i<a.members.length;i++){let n=this.graph.vertices[a.members[i]];if(t[n.id])continue;t[n.id]=!0;let u=this.getNonRingNeighbours(n.id);if(u.length>1){let o=Array();for(var s=0;s<n.value.rings.length;s++)o.push(n.value.rings[s]);e.push({common:n,rings:o,vertices:u})}else if(u.length===1&&n.value.rings.length===2){let o=Array();for(var s=0;s<n.value.rings.length;s++)o.push(n.value.rings[s]);e.push({common:n,rings:o,vertices:u})}}}for(var r=0;r<e.length;r++){let n=e[r];if(n.vertices.length===2){let u=n.vertices[0],o=n.vertices[1];if(!u.value.isDrawn||!o.value.isDrawn)continue;let d=(2*Math.PI-this.getRing(n.rings[0]).getAngle())/6;this.rotateSubtree(u.id,n.common.id,d,n.common.position),this.rotateSubtree(o.id,n.common.id,-d,n.common.position);let g=this.getOverlapScore(),c=this.getSubtreeOverlapScore(u.id,n.common.id,g.vertexScores),b=this.getSubtreeOverlapScore(o.id,n.common.id,g.vertexScores),S=c.value+b.value;this.rotateSubtree(u.id,n.common.id,-2*d,n.common.position),this.rotateSubtree(o.id,n.common.id,2*d,n.common.position),g=this.getOverlapScore(),c=this.getSubtreeOverlapScore(u.id,n.common.id,g.vertexScores),b=this.getSubtreeOverlapScore(o.id,n.common.id,g.vertexScores),c.value+b.value>S&&(this.rotateSubtree(u.id,n.common.id,2*d,n.common.position),this.rotateSubtree(o.id,n.common.id,-2*d,n.common.position))}else n.vertices.length===1&&n.rings.length}}resolveSecondaryOverlaps(e){for(var t=0;t<e.length;t++)if(e[t].score>this.opts.overlapSensitivity){let r=this.graph.vertices[e[t].id];if(r.isTerminal()){let i=this.getClosestVertex(r);if(i){let s=null;i.isTerminal()?s=i.id===0?this.graph.vertices[1].position:i.previousPosition:s=i.id===0?this.graph.vertices[1].position:i.position;let a=r.id===0?this.graph.vertices[1].position:r.previousPosition;r.position.rotateAwayFrom(s,a,me.toRad(20))}}}}getLastVertexWithAngle(e){let t=0,r=null;for(;!t&&e;)r=this.graph.vertices[e],t=r.angle,e=r.parentVertexId;return r}createNextBond(e,t=null,r=0,i=!1,s=!1){if(e.positioned&&!s)return;let a=!1;if(t){let u=this.graph.getEdge(e.id,t.id);(u.bondType==="/"||u.bondType==="\\")&&++this.doubleBondConfigCount%2===1&&this.doubleBondConfig===null&&(this.doubleBondConfig=u.bondType,a=!0,t.parentVertexId===null&&e.value.branchBond&&(this.doubleBondConfig==="/"?this.doubleBondConfig="\\":this.doubleBondConfig==="\\"&&(this.doubleBondConfig="/")))}if(!s)if(t)if(t.value.rings.length>0){let u=t.neighbours,o=null,d=new G(0,0);if(t.value.bridgedRing===null&&t.value.rings.length>1)for(var n=0;n<u.length;n++){let g=this.graph.vertices[u[n]];if(pt.containsAll(g.value.rings,t.value.rings)){o=g;break}}if(o===null){for(var n=0;n<u.length;n++){let c=this.graph.vertices[u[n]];c.positioned&&this.areVerticesInSameRing(c,t)&&d.add(G.subtract(c.position,t.position))}d.invert().normalize().multiplyScalar(this.opts.bondLength).add(t.position)}else d=o.position.clone().rotateAround(Math.PI,t.position);e.previousPosition=t.position,e.setPositionFromVector(d),e.positioned=!0}else{let u=new G(this.opts.bondLength,0);u.rotate(r),u.add(t.position),e.setPositionFromVector(u),e.previousPosition=t.position,e.positioned=!0}else{let u=new G(this.opts.bondLength,0);u.rotate(me.toRad(-60)),e.previousPosition=u,e.setPosition(this.opts.bondLength,0),e.angle=me.toRad(-60),e.value.bridgedRing===null&&(e.positioned=!0)}if(e.value.bridgedRing!==null){let u=this.getRing(e.value.bridgedRing);if(!u.positioned){let o=G.subtract(e.previousPosition,e.position);o.invert(),o.normalize();let d=me.polyCircumradius(this.opts.bondLength,u.members.length);o.multiplyScalar(d),o.add(e.position),this.createRing(u,o,e)}}else if(e.value.rings.length>0){let u=this.getRing(e.value.rings[0]);if(!u.positioned){let o=G.subtract(e.previousPosition,e.position);o.invert(),o.normalize();let d=me.polyCircumradius(this.opts.bondLength,u.getSize());o.multiplyScalar(d),o.add(e.position),this.createRing(u,o,e)}}else{e.value.isStereoCenter;let u=e.getNeighbours(),o=Array();for(var n=0;n<u.length;n++)this.graph.vertices[u[n]].value.isDrawn&&o.push(u[n]);t&&(o=pt.remove(o,t.id));let d=e.getAngle();if(o.length===1){let g=this.graph.vertices[o[0]];if(e.value.bondType==="#"||t&&t.value.bondType==="#"||e.value.bondType==="="&&t&&t.value.rings.length===0&&t.value.bondType==="="&&e.value.branchBond!=="-"){if(e.value.drawExplicit=!1,t){let b=this.graph.getEdge(e.id,t.id);b.center=!0}let c=this.graph.getEdge(e.id,g.id);c.center=!0,(e.value.bondType==="#"||t&&t.value.bondType==="#")&&(g.angle=0),g.drawExplicit=!0,this.createNextBond(g,e,d+g.angle)}else if(t&&t.value.rings.length>0){let c=me.toRad(60),b=-c,S=new G(this.opts.bondLength,0),A=new G(this.opts.bondLength,0);S.rotate(c).add(e.position),A.rotate(b).add(e.position);let B=this.getCurrentCenterOfMass(),P=S.distanceSq(B),M=A.distanceSq(B);g.angle=P<M?b:c,this.createNextBond(g,e,d+g.angle)}else{let c=e.angle;if(t&&t.neighbours.length>3?c>0?c=Math.min(1.0472,c):c<0?c=Math.max(-1.0472,c):c=1.0472:c||(c=this.getLastVertexWithAngle(e.id).angle,c||(c=1.0472)),t&&!a){let b=this.graph.getEdge(e.id,g.id).bondType;b==="/"?(this.doubleBondConfig==="/"||this.doubleBondConfig==="\\"&&(c=-c),this.doubleBondConfig=null):b==="\\"&&(this.doubleBondConfig==="/"?c=-c:this.doubleBondConfig,this.doubleBondConfig=null)}i?g.angle=c:g.angle=-c,this.createNextBond(g,e,d+g.angle)}}else if(o.length===2){let g=e.angle;g||(g=1.0472);let c=this.graph.getTreeDepth(o[0],e.id),b=this.graph.getTreeDepth(o[1],e.id),S=this.graph.vertices[o[0]],A=this.graph.vertices[o[1]];S.value.subtreeDepth=c,A.value.subtreeDepth=b;let B=this.graph.getTreeDepth(t?t.id:null,e.id);t&&(t.value.subtreeDepth=B);let P=0,M=1;A.value.element==="C"&&S.value.element!=="C"&&b>1&&c<5?(P=1,M=0):A.value.element!=="C"&&S.value.element==="C"&&c>1&&b<5?(P=0,M=1):b>c&&(P=1,M=0);let x=this.graph.vertices[o[P]],L=this.graph.vertices[o[M]];this.graph.getEdge(e.id,x.id),this.graph.getEdge(e.id,L.id);let I=!1;B<c&&B<b&&(I=!0),L.angle=g,x.angle=-g,this.doubleBondConfig==="\\"?L.value.branchBond==="\\"&&(L.angle=-g,x.angle=g):this.doubleBondConfig==="/"&&L.value.branchBond==="/"&&(L.angle=-g,x.angle=g),this.createNextBond(L,e,d+L.angle,I),this.createNextBond(x,e,d+x.angle,I)}else if(o.length===3){let g=this.graph.getTreeDepth(o[0],e.id),c=this.graph.getTreeDepth(o[1],e.id),b=this.graph.getTreeDepth(o[2],e.id),S=this.graph.vertices[o[0]],A=this.graph.vertices[o[1]],B=this.graph.vertices[o[2]];S.value.subtreeDepth=g,A.value.subtreeDepth=c,B.value.subtreeDepth=b,c>g&&c>b?(S=this.graph.vertices[o[1]],A=this.graph.vertices[o[0]],B=this.graph.vertices[o[2]]):b>g&&b>c&&(S=this.graph.vertices[o[2]],A=this.graph.vertices[o[0]],B=this.graph.vertices[o[1]]),t&&t.value.rings.length<1&&S.value.rings.length<1&&A.value.rings.length<1&&B.value.rings.length<1&&this.graph.getTreeDepth(A.id,e.id)===1&&this.graph.getTreeDepth(B.id,e.id)===1&&this.graph.getTreeDepth(S.id,e.id)>1?(S.angle=-e.angle,e.angle>=0?(A.angle=me.toRad(30),B.angle=me.toRad(90)):(A.angle=-me.toRad(30),B.angle=-me.toRad(90)),this.createNextBond(S,e,d+S.angle),this.createNextBond(A,e,d+A.angle),this.createNextBond(B,e,d+B.angle)):(S.angle=0,A.angle=me.toRad(90),B.angle=-me.toRad(90),this.createNextBond(S,e,d+S.angle),this.createNextBond(A,e,d+A.angle),this.createNextBond(B,e,d+B.angle))}else if(o.length===4){let g=this.graph.getTreeDepth(o[0],e.id),c=this.graph.getTreeDepth(o[1],e.id),b=this.graph.getTreeDepth(o[2],e.id),S=this.graph.getTreeDepth(o[3],e.id),A=this.graph.vertices[o[0]],B=this.graph.vertices[o[1]],P=this.graph.vertices[o[2]],M=this.graph.vertices[o[3]];A.value.subtreeDepth=g,B.value.subtreeDepth=c,P.value.subtreeDepth=b,M.value.subtreeDepth=S,c>g&&c>b&&c>S?(A=this.graph.vertices[o[1]],B=this.graph.vertices[o[0]],P=this.graph.vertices[o[2]],M=this.graph.vertices[o[3]]):b>g&&b>c&&b>S?(A=this.graph.vertices[o[2]],B=this.graph.vertices[o[0]],P=this.graph.vertices[o[1]],M=this.graph.vertices[o[3]]):S>g&&S>c&&S>b&&(A=this.graph.vertices[o[3]],B=this.graph.vertices[o[0]],P=this.graph.vertices[o[1]],M=this.graph.vertices[o[2]]),A.angle=-me.toRad(36),B.angle=me.toRad(36),P.angle=-me.toRad(108),M.angle=me.toRad(108),this.createNextBond(A,e,d+A.angle),this.createNextBond(B,e,d+B.angle),this.createNextBond(P,e,d+P.angle),this.createNextBond(M,e,d+M.angle)}}}getCommonRingbondNeighbour(e){let t=e.neighbours;for(var r=0;r<t.length;r++){let i=this.graph.vertices[t[r]];if(pt.containsAll(i.value.rings,e.value.rings))return i}return null}isPointInRing(e){for(var t=0;t<this.rings.length;t++){let r=this.rings[t];if(!r.positioned)continue;let i=me.polyCircumradius(this.opts.bondLength,r.getSize()),s=i*i;if(e.distanceSq(r.center)<s)return!0}return!1}isEdgeInRing(e){let t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return this.areVerticesInSameRing(t,r)}isEdgeRotatable(e){let t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return!(e.bondType!=="-"||t.isTerminal()||r.isTerminal()||t.value.rings.length>0&&r.value.rings.length>0&&this.areVerticesInSameRing(t,r))}isRingAromatic(e){for(var t=0;t<e.members.length;t++)if(!this.graph.vertices[e.members[t]].value.isPartOfAromaticRing)return!1;return!0}getEdgeNormals(e){let t=this.graph.vertices[e.sourceId].position,r=this.graph.vertices[e.targetId].position;return G.units(t,r)}getNonRingNeighbours(e){let t=Array(),r=this.graph.vertices[e],i=r.neighbours;for(var s=0;s<i.length;s++){let a=this.graph.vertices[i[s]];pt.intersection(r.value.rings,a.value.rings).length===0&&a.value.isBridge==!1&&t.push(a)}return t}annotateStereochemistry(){let e=10;for(var t=0;t<this.graph.vertices.length;t++){let a=this.graph.vertices[t];if(!a.value.isStereoCenter)continue;let n=a.getNeighbours(),u=n.length,o=Array(u);for(var r=0;r<u;r++){let K=new Uint8Array(this.graph.vertices.length),j=Array(Array());K[a.id]=1,this.visitStereochemistry(n[r],a.id,K,j,e,0);for(var i=0;i<j.length;i++)j[i].sort(function(be,le){return le-be});o[r]=[r,j]}let d=0,g=0;for(var r=0;r<o.length;r++){o[r][1].length>d&&(d=o[r][1].length);for(var i=0;i<o[r][1].length;i++)o[r][1][i].length>g&&(g=o[r][1][i].length)}for(var r=0;r<o.length;r++){let j=d-o[r][1].length;for(var i=0;i<j;i++)o[r][1].push([]);o[r][1].push([n[r]]);for(var i=0;i<o[r][1].length;i++){let le=g-o[r][1][i].length;for(var s=0;s<le;s++)o[r][1][i].push(0)}}o.sort(function(K,j){for(var be=0;be<K[1].length;be++)for(var le=0;le<K[1][be].length;le++){if(K[1][be][le]>j[1][be][le])return-1;if(K[1][be][le]<j[1][be][le])return 1}return 0});let c=new Uint8Array(u);for(var r=0;r<u;r++)c[r]=o[r][0],a.value.priority=r;let b=this.graph.vertices[n[c[0]]].position,S=this.graph.vertices[n[c[1]]].position,A=this.graph.vertices[n[c[2]]].position,B=b.relativeClockwise(S,a.position);b.relativeClockwise(A,a.position);let P=B===-1,M=a.value.bracket.chirality==="@"?-1:1,x=me.parityOfPermutation(c)*M===1?"R":"S",L="down",I="up";(P&&x!=="R"||!P&&x!=="S")&&(a.value.hydrogenDirection="up",L="up",I="down"),a.value.hasHydrogen&&(this.graph.getEdge(a.id,n[c[c.length-1]]).wedge=L);let J=new Array(n.length-1),oe=a.value.rings.length>1&&a.value.hasHydrogen,Q=a.value.hasHydrogen?1:0;for(var r=0;r<c.length-Q;r++){J[r]=new Uint32Array(2);let j=this.graph.vertices[n[c[r]]];J[r][0]+=j.value.isStereoCenter?0:1e5,J[r][0]+=this.areVerticesInSameRing(j,a)?0:1e4,J[r][0]+=j.value.isHeteroAtom()?1e3:0,J[r][0]-=j.value.subtreeDepth===0?1e3:0,J[r][0]+=1e3-j.value.subtreeDepth,J[r][1]=n[c[r]]}if(J.sort(function(K,j){return K[0]>j[0]?-1:K[0]<j[0]?1:0}),!oe){let K=J[0][1];if(a.value.hasHydrogen)this.graph.getEdge(a.id,K).wedge=I;else{let j=I;for(var r=c.length-1;r>=0&&(j===L?j=I:j=L,n[c[r]]!==K);r--);this.graph.getEdge(a.id,K).wedge=j}}a.value.chirality=x}}visitStereochemistry(e,t,r,i,s,a,n=0){r[e]=1;let u=this.graph.vertices[e],o=u.value.getAtomicNumber();i.length<=a&&i.push(Array());for(var d=0;d<this.graph.getEdge(e,t).weight;d++)i[a].push(n*1e3+o);let g=this.graph.vertices[e].neighbours;for(var d=0;d<g.length;d++)r[g[d]]!==1&&a<s-1&&this.visitStereochemistry(g[d],e,r.slice(),i,s,a+1,o);if(a<s-1){let c=0;for(var d=0;d<g.length;d++)c+=this.graph.getEdge(e,g[d]).weight;for(var d=0;d<u.value.getMaxBonds()-c;d++)i.length<=a+1&&i.push(Array()),i[a+1].push(o*1e3+1)}}initPseudoElements(){for(var e=0;e<this.graph.vertices.length;e++){const r=this.graph.vertices[e],i=r.neighbours;let s=Array(i.length);for(var t=0;t<i.length;t++)s[t]=this.graph.vertices[i[t]];if(r.getNeighbourCount()<3||r.value.rings.length>0||r.value.element==="P"||r.value.element==="C"&&s.length===3&&s[0].value.element==="N"&&s[1].value.element==="N"&&s[2].value.element==="N")continue;let a=0,n=0;for(var t=0;t<s.length;t++){let d=s[t],g=d.value.element,c=d.getNeighbourCount();g!=="C"&&g!=="H"&&c===1&&a++,c>1&&n++}if(n>1||a<2)continue;let u=null;for(var t=0;t<s.length;t++){let d=s[t];d.getNeighbourCount()>1&&(u=d)}for(var t=0;t<s.length;t++){let d=s[t];if(d.getNeighbourCount()>1)continue;d.value.isDrawn=!1;let g=Er.maxBonds[d.value.element]-d.value.bondCount,c="";d.value.bracket&&(g=d.value.bracket.hcount,c=d.value.bracket.charge||0),r.value.attachPseudoElement(d.value.element,u?u.value.element:null,g,c)}}for(var e=0;e<this.graph.vertices.length;e++){const i=this.graph.vertices[e],s=i.value,a=s.element;if(a==="C"||a==="H"||!s.isDrawn)continue;const n=i.neighbours;let u=Array(n.length);for(var t=0;t<n.length;t++)u[t]=this.graph.vertices[n[t]];for(var t=0;t<u.length;t++){let d=u[t].value;if(!d.hasAttachedPseudoElements||d.getAttachedPseudoElementsCount()!==2)continue;const g=d.getAttachedPseudoElements();g.hasOwnProperty("0O")&&g.hasOwnProperty("3C")&&(d.isDrawn=!1,i.value.attachPseudoElement("Ac","",0))}}}};var ss=ns;const{getChargeText:ca}=Hi,as=oi,We=$t,ls=or;function os(q){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=t.length,i=0;i<q;i++)e+=t.charAt(Math.floor(Math.random()*r));return e}let hs=class lt{constructor(e,t,r,i=!0){if(typeof t=="string"||t instanceof String?this.svg=document.getElementById(t):this.svg=t,this.container=null,this.opts=r,this.uid=os(5),this.gradientId=0,this.backgroundItems=[],this.paths=[],this.vertices=[],this.gradients=[],this.highlights=[],this.drawingWidth=0,this.drawingHeight=0,this.halfBondThickness=this.opts.bondThickness/2,this.themeManager=e,this.maskElements=[],this.maxX=-Number.MAX_VALUE,this.maxY=-Number.MAX_VALUE,this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,i)for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this.style=document.createElementNS("http://www.w3.org/2000/svg","style"),this.style.appendChild(document.createTextNode(`
                .element {
                    font: ${this.opts.fontSizeLarge}pt ${this.opts.fontFamily};
                }
                .sub {
                    font: ${this.opts.fontSizeSmall}pt ${this.opts.fontFamily};
                }
            `)),this.svg?this.svg.appendChild(this.style):(this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),container.appendChild(this.style))}constructSvg(){let e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t=document.createElementNS("http://www.w3.org/2000/svg","mask"),r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","g"),a=document.createElementNS("http://www.w3.org/2000/svg","g"),n=this.paths,u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttributeNS(null,"x",this.minX),u.setAttributeNS(null,"y",this.minY),u.setAttributeNS(null,"width",this.maxX-this.minX),u.setAttributeNS(null,"height",this.maxY-this.minY),u.setAttributeNS(null,"fill","white"),t.appendChild(u),t.setAttributeNS(null,"id",this.uid+"-text-mask");for(let o of n)s.appendChild(o);for(let o of this.backgroundItems)r.appendChild(o);for(let o of this.highlights)i.appendChild(o);for(let o of this.vertices)a.appendChild(o);for(let o of this.maskElements)t.appendChild(o);for(let o of this.gradients)e.appendChild(o);if(s.setAttributeNS(null,"mask","url(#"+this.uid+"-text-mask)"),this.updateViewbox(this.opts.scale),r.setAttributeNS(null,"style",`transform: translateX(${this.minX}px) translateY(${this.minY}px)`),this.svg)this.svg.appendChild(e),this.svg.appendChild(t),this.svg.appendChild(r),this.svg.appendChild(i),this.svg.appendChild(s),this.svg.appendChild(a);else return this.container.appendChild(e),this.container.appendChild(t),this.container.appendChild(r),this.container.appendChild(s),this.container.appendChild(a),this.container}addLayer(e){this.backgroundItems.push(e.firstChild)}createGradient(e){let t=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),r=this.uid+`-line-${this.gradientId++}`,i=e.getLeftVector(),s=e.getRightVector(),a=i.x,n=i.y,u=s.x,o=s.y;t.setAttributeNS(null,"id",r),t.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),t.setAttributeNS(null,"x1",a),t.setAttributeNS(null,"y1",n),t.setAttributeNS(null,"x2",u),t.setAttributeNS(null,"y2",o);let d=document.createElementNS("http://www.w3.org/2000/svg","stop");d.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.setAttributeNS(null,"offset","20%");let g=document.createElementNS("http://www.w3.org/2000/svg","stop");return g.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getRightElement()||this.themeManager.getColor("C"))),g.setAttributeNS(null,"offset","100%"),t.appendChild(d),t.appendChild(g),this.gradients.push(t),r}createSubSuperScripts(e,t){let r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.setAttributeNS(null,"baseline-shift",t),r.appendChild(document.createTextNode(e)),r.setAttributeNS(null,"class","sub"),r}static createUnicodeCharge(e){return e===1?"":e===-1?"":e>1?lt.createUnicodeSuperscript(e)+"":e<-1?lt.createUnicodeSuperscript(e)+"":""}determineDimensions(e){for(var t=0;t<e.length;t++){if(!e[t].value.isDrawn)continue;let i=e[t].position;this.maxX<i.x&&(this.maxX=i.x),this.maxY<i.y&&(this.maxY=i.y),this.minX>i.x&&(this.minX=i.x),this.minY>i.y&&(this.minY=i.y)}let r=this.opts.padding;this.maxX+=r,this.maxY+=r,this.minX-=r,this.minY-=r,this.drawingWidth=this.maxX-this.minX,this.drawingHeight=this.maxY-this.minY}updateViewbox(e){let t=this.minX,r=this.minY,i=this.maxX-this.minX,s=this.maxY-this.minY;if(e<=0)if(i>s){let a=i-s;s=i,r-=a/2}else{let a=s-i;i=s,t-=a/2}else this.svg&&(this.svg.style.width=e*i+"px",this.svg.style.height=e*s+"px");this.svg.setAttributeNS(null,"viewBox",`${t} ${r} ${i} ${s}`)}drawBall(e,t,r){let i=this.opts.bondLength/4.5;e-i<this.minX&&(this.minX=e-i),e+i>this.maxX&&(this.maxX=e+i),t-i<this.minY&&(this.minY=t-i),t+i>this.maxY&&(this.maxY=t+i);let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",t),s.setAttributeNS(null,"r",i),s.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(s)}drawWedge(e){let t=e.getLeftVector().clone(),r=e.getRightVector().clone(),i=We.normals(t,r);i[0].normalize(),i[1].normalize();let s=e.getRightChiral(),a=t,n=r;s&&(a=r,n=t);let u=We.add(a,We.multiplyScalar(i[0],this.halfBondThickness)),o=We.add(n,We.multiplyScalar(i[0],3+this.opts.fontSizeLarge/4)),d=We.add(n,We.multiplyScalar(i[1],3+this.opts.fontSizeLarge/4)),g=We.add(a,We.multiplyScalar(i[1],this.halfBondThickness)),c=document.createElementNS("http://www.w3.org/2000/svg","polygon"),b=this.createGradient(e,t.x,t.y,r.x,r.y);c.setAttributeNS(null,"points",`${u.x},${u.y} ${o.x},${o.y} ${d.x},${d.y} ${g.x},${g.y}`),c.setAttributeNS(null,"fill",`url('#${b}')`),this.paths.push(c)}drawAtomHighlight(e,t,r="#03fc9d"){let i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",t),i.setAttributeNS(null,"r",this.opts.bondLength/3),i.setAttributeNS(null,"fill",r),this.highlights.push(i)}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let t=e.getLeftVector().clone(),r=e.getRightVector().clone(),i=We.normals(t,r);i[0].normalize(),i[1].normalize();let s=e.getRightChiral(),a,n;s?(a=r,n=t):(a=t,n=r);let u=We.subtract(n,a).normalize(),o=e.getLength(),d=1.25/(o/(this.opts.bondLength/10)),g=this.createGradient(e);for(let c=0;c<1;c+=d){let b=We.multiplyScalar(u,c*o),S=We.add(a,b),A=this.opts.fontSizeLarge/2*c,B=We.multiplyScalar(i[0],A);S.subtract(B);let P=S.clone();P.add(We.multiplyScalar(B,2)),this.drawLine(new as(S,P),null,g)}}drawDebugPoint(e,t,r="",i="#f00"){let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",t),s.setAttributeNS(null,"r","2"),s.setAttributeNS(null,"fill","#f00"),this.vertices.push(s),this.drawDebugText(e,t,r)}drawDebugText(e,t,r){let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttributeNS(null,"x",e),i.setAttributeNS(null,"y",t),i.setAttributeNS(null,"class","debug"),i.setAttributeNS(null,"fill","#ff0000"),i.setAttributeNS(null,"style",`
                font: 5px Droid Sans, sans-serif;
            `),i.appendChild(document.createTextNode(r)),this.vertices.push(i)}drawRing(e,t,r){let i=document.createElementNS("http://www.w3.org/2000/svg","circle"),s=ls.apothemFromSideLength(this.opts.bondLength,r);i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",t),i.setAttributeNS(null,"r",s-this.opts.bondSpacing),i.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),i.setAttributeNS(null,"stroke-width",this.opts.bondThickness),i.setAttributeNS(null,"fill","none"),this.paths.push(i)}drawLine(e,t=!1,r=null,i="round"){this.opts;let s=[["stroke-width",this.opts.bondThickness],["stroke-linecap",i],["stroke-dasharray",t?"5, 5":"none"]],a=e.getLeftVector(),n=e.getRightVector(),u=a.x,o=a.y,d=n.x,g=n.y,c=s.map(S=>S.join(":")).join(";"),b=document.createElementNS("http://www.w3.org/2000/svg","line");b.setAttributeNS(null,"x1",u),b.setAttributeNS(null,"y1",o),b.setAttributeNS(null,"x2",d),b.setAttributeNS(null,"y2",g),b.setAttributeNS(null,"style",c),this.paths.push(b),r==null&&(r=this.createGradient(e,u,o,d,g)),b.setAttributeNS(null,"stroke",`url('#${r}')`)}drawPoint(e,t,r){let i=.75;e-i<this.minX&&(this.minX=e-i),e+i>this.maxX&&(this.maxX=e+i),t-i<this.minY&&(this.minY=t-i),t+i>this.maxY&&(this.maxY=t+i);let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",t),s.setAttributeNS(null,"r","1.5"),s.setAttributeNS(null,"fill","black"),this.maskElements.push(s);let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttributeNS(null,"cx",e),a.setAttributeNS(null,"cy",t),a.setAttributeNS(null,"r",i),a.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(a)}drawText(e,t,r,i,s,a,n,u,o,d={}){let g=[],c=r;n!==0&&n!==null&&(c+=lt.createUnicodeCharge(n)),u!==0&&u!==null&&(c=lt.createUnicodeSuperscript(u)+c),g.push([c,r]),i===1?g.push(["H","H"]):i>1&&g.push(["H"+lt.createUnicodeSubscript(i),"H"]),n===1&&r==="N"&&d.hasOwnProperty("0O")&&d.hasOwnProperty("0O-1")&&(d={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},n=0);for(let b in d){if(!d.hasOwnProperty(b))continue;let S=d[b],A=S.element;S.count>1&&(A+=lt.createUnicodeSubscript(S.count)),S.charge!==""&&(A+=lt.createUnicodeCharge(n)),g.push([A,S.element]),S.hydrogenCount===1?g.push(["H","H"]):S.hydrogenCount>1&&g.push(["H"+lt.createUnicodeSubscript(S.hydrogenCount),"H"])}this.write(g,s,e,t,o===1)}write(e,t,r,i,s){let a=lt.measureText(e[0][1],this.opts.fontSizeLarge,this.opts.fontFamily);t==="left"&&e[0][0]!==e[0][1]&&(a.width*=2),s?(r+a.width*e.length>this.maxX&&(this.maxX=r+a.width*e.length),r-a.width/2<this.minX&&(this.minX=r-a.width/2),i-a.height<this.minY&&(this.minY=i-a.height),i+a.height>this.maxY&&(this.maxY=i+a.height)):(t!=="right"?(r+a.width*e.length>this.maxX&&(this.maxX=r+a.width*e.length),r-a.width*e.length<this.minX&&(this.minX=r-a.width*e.length)):t!=="left"&&(r+a.width*e.length>this.maxX&&(this.maxX=r+a.width*e.length),r-a.width/2<this.minX&&(this.minX=r-a.width/2)),i-a.height<this.minY&&(this.minY=i-a.height),i+a.height>this.maxY&&(this.maxY=i+a.height),t==="down"&&i+.8*a.height*e.length>this.maxY&&(this.maxY=i+.8*a.height*e.length),t==="up"&&i-.8*a.height*e.length<this.minY&&(this.minY=i-.8*a.height*e.length));let n=r,u=i,o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttributeNS(null,"class","element");let d=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"fill","#ffffff"),t==="left"&&(e=e.reverse()),(t==="right"||t==="down"||t==="up")&&(r-=a.width/2),t==="left"&&(r+=a.width/2),e.forEach((b,S)=>{const A=b[0],B=b[1];let P=document.createElementNS("http://www.w3.org/2000/svg","tspan");P.setAttributeNS(null,"fill",this.themeManager.getColor(B)),P.textContent=A,(t==="up"||t==="down")&&(P.setAttributeNS(null,"x","0px"),t==="up"?P.setAttributeNS(null,"y",`-${.9*S}em`):P.setAttributeNS(null,"y",`${.9*S}em`)),o.appendChild(P)}),o.setAttributeNS(null,"data-direction",t),t==="left"||t==="right"?(o.setAttributeNS(null,"dominant-baseline","alphabetic"),o.setAttributeNS(null,"y","0.36em")):o.setAttributeNS(null,"dominant-baseline","central"),t==="left"&&o.setAttributeNS(null,"text-anchor","end"),d.appendChild(o),d.setAttributeNS(null,"style",`transform: translateX(${r}px) translateY(${i}px)`);let g=this.opts.fontSizeLarge*.75;e[0][1].length>1&&(g=this.opts.fontSizeLarge*1.1);let c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttributeNS(null,"cx",n),c.setAttributeNS(null,"cy",u),c.setAttributeNS(null,"r",g),c.setAttributeNS(null,"fill","black"),this.maskElements.push(c),this.vertices.push(d)}toCanvas(e,t,r){(typeof e=="string"||e instanceof String)&&(e=document.getElementById(e));let i=new Image;i.onload=function(){e.width=t,e.height=r,e.getContext("2d").drawImage(i,0,0,t,r)},i.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(this.svg.outerHTML)}static createUnicodeSubscript(e){let t="";return e.toString().split("").forEach(r=>{t+=["","","","","","","","","",""][parseInt(r)]}),t}static createUnicodeSuperscript(e){let t="";return e.toString().split("").forEach(r=>{parseInt(r)&&(t+=["","","","","","","","","",""][parseInt(r)])}),t}static replaceNumbersWithSubscript(e){let t={0:"",1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:""};for(const[r,i]of Object.entries(t))e=e.replaceAll(r,i);return e}static measureText(e,t,r,i=.9){const a=document.createElement("canvas").getContext("2d");a.font=`${t}pt ${r}`;let n=a.measureText(e),u=Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight);return{width:n.width>u?n.width:u,height:(Math.abs(n.actualBoundingBoxAscent)+Math.abs(n.actualBoundingBoxAscent))*i}}static svgToCanvas(e,t,r,i,s=null){e.setAttributeNS(null,"width",r),e.setAttributeNS(null,"height",i);let a=new Image;return a.onload=function(){t.width=r,t.height=i;let n=t.getContext("2d");n.imageSmoothingEnabled=!1,n.drawImage(a,0,0,r,i),s&&s(t)},a.onerror=function(n){console.log(n)},a.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(e.outerHTML),t}static svgToImg(e,t,r,i){let s=document.createElement("canvas");this.svgToCanvas(e,s,r,i,a=>{t.src=s.toDataURL("image/png")})}static writeText(e,t,r,i,s=Number.MAX_SAFE_INTEGER){let a=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","style");n.appendChild(document.createTextNode(`
        .text {
            font: ${r}pt ${i};
            dominant-baseline: ideographic;
        }
    `)),a.appendChild(n);let u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttributeNS(null,"class","text");let o=0,d=0,g=[];return e.split(`
`).forEach(c=>{let b=lt.measureText(c,r,i,1);if(b.width>=s){let S=0,A=0,B=c.split(" "),P=0;for(let M=0;M<B.length;M++){let x=lt.measureText(B[M],r,i,1);S+x.width>s&&(g.push({text:B.slice(P,M).join(" "),width:S,height:A}),S=0,A=0,P=M),x.height>A&&(A=x.height),S+=x.width}P<B.length&&g.push({text:B.slice(P,B.length).join(" "),width:S,height:A})}else g.push({text:c,width:b.width,height:b.height})}),g.forEach((c,b)=>{d+=c.height;let S=document.createElementNS("http://www.w3.org/2000/svg","tspan");S.setAttributeNS(null,"fill",t.getColor("C")),S.textContent=c.text,S.setAttributeNS(null,"x","0px"),S.setAttributeNS(null,"y",`${d}px`),u.appendChild(S),c.width>o&&(o=c.width)}),a.appendChild(u),{svg:a,width:o,height:d}}};var gi=hs;function us(q){function e(c,b){var S=c.length,A=S===0||S>0&&S-1 in c,B=0;if(A)for(;B<S&&b.call(c[B],B,c[B])!==!1;B++);else for(B in c)if(b.call(c[B],B,c[B])===!1)break}function t(c){var b=parseInt(c).toString(16);return b.length==1?"0"+b:b}function r(c,b,S,A){return A=parseInt(A),A===void 0||A===255?"#"+t(c)+t(b)+t(S):A===0?!1:"rgba("+c+","+b+","+S+","+A/255+")"}function i(c,b,S){return"M"+c+" "+b+"h"+S}function s(c,b){return'<path stroke="'+c+'" d="'+b+`" />
`}function a(c){var b="";return e(c,function(S,A){if(S=r.apply(null,S.split(",")),S!==!1){var B=[],P,M=1;e(A,function(){P&&this[1]===P[1]&&this[0]===P[0]+M?M++:(P&&(B.push(i(P[0],P[1],M)),M=1),P=this)}),B.push(i(P[0],P[1],M)),b+=s(S,B.join(""))}}),b}var n=function(c){var b={},S=c.data,A=S.length,B=c.width;c.height;for(var P=0,M=0,x=0,L;x<A;x+=4)S[x+3]>0&&(L=S[x]+","+S[x+1]+","+S[x+2]+","+S[x+3],b[L]=b[L]||[],P=x/4%B,M=Math.floor(x/4/B),b[L].push([P,M]));return b};let u=n(q),o=a(u),d='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -0.5 '+q.width+" "+q.height+'" shape-rendering="crispEdges"><g shape-rendering="crispEdges">'+o+"</g></svg>";var g=document.createElement("div");return g.innerHTML=d,g.firstChild}var gs=us,Wi={exports:{}};/**
 * chroma.js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2024, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 * derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -------------------------------------------------------
 *
 * chroma.js includes colors from colorbrewer2.org, which are released under
 * the following license:
 *
 * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
 * and The Pennsylvania State University.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 *
 * ------------------------------------------------------
 *
 * Named colors are taken from X11 Color Names.
 * http://www.w3.org/TR/css3-color/#svg-color
 *
 * @preserve
 */(function(q,e){(function(t,r){q.exports=r()})(Tn,function(){function t(l,h,f){return h===void 0&&(h=0),f===void 0&&(f=1),c(b(h,l),f)}function r(l){l._clipped=!1,l._unclipped=l.slice(0);for(var h=0;h<=3;h++)h<3?((l[h]<0||l[h]>255)&&(l._clipped=!0),l[h]=t(l[h],0,255)):h===3&&(l[h]=t(l[h],0,1));return l}for(var i={},s=0,a=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];s<a.length;s+=1){var n=a[s];i["[object "+n+"]"]=n.toLowerCase()}function u(l){return i[Object.prototype.toString.call(l)]||"object"}function o(l,h){return h===void 0&&(h=null),l.length>=3?Array.prototype.slice.call(l):u(l[0])=="object"&&h?h.split("").filter(function(f){return l[0][f]!==void 0}).map(function(f){return l[0][f]}):l[0]}function d(l){if(l.length<2)return null;var h=l.length-1;return u(l[h])=="string"?l[h].toLowerCase():null}var g=Math.PI,c=Math.min,b=Math.max,S=g*2,A=g/3,B=g/180,P=180/g,M={format:{},autodetect:[]},x=function(){for(var h=[],f=arguments.length;f--;)h[f]=arguments[f];var p=this;if(u(h[0])==="object"&&h[0].constructor&&h[0].constructor===this.constructor)return h[0];var y=d(h),C=!1;if(!y){C=!0,M.sorted||(M.autodetect=M.autodetect.sort(function(k,H){return H.p-k.p}),M.sorted=!0);for(var w=0,N=M.autodetect;w<N.length;w+=1){var E=N[w];if(y=E.test.apply(E,h),y)break}}if(M.format[y]){var D=M.format[y].apply(null,C?h:h.slice(0,-1));p._rgb=r(D)}else throw new Error("unknown format: "+h);p._rgb.length===3&&p._rgb.push(1)};x.prototype.toString=function(){return u(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var L="2.6.0",I=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(I.Color,[null].concat(l)))};I.Color=x,I.version=L;var J=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"cmyk");var f=l[0],p=l[1],y=l[2],C=l[3],w=l.length>4?l[4]:1;return C===1?[0,0,0,w]:[f>=1?0:255*(1-f)*(1-C),p>=1?0:255*(1-p)*(1-C),y>=1?0:255*(1-y)*(1-C),w]},oe=Math.max,Q=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"rgb"),p=f[0],y=f[1],C=f[2];p=p/255,y=y/255,C=C/255;var w=1-oe(p,oe(y,C)),N=w<1?1/(1-w):0,E=(1-p-w)*N,D=(1-y-w)*N,k=(1-C-w)*N;return[E,D,k,w]};x.prototype.cmyk=function(){return Q(this._rgb)},I.cmyk=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["cmyk"])))},M.format.cmyk=J,M.autodetect.push({p:2,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"cmyk"),u(l)==="array"&&l.length===4)return"cmyk"}});var K=function(l){return Math.round(l*100)/100},j=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"hsla"),p=d(l)||"lsa";return f[0]=K(f[0]||0),f[1]=K(f[1]*100)+"%",f[2]=K(f[2]*100)+"%",p==="hsla"||f.length>3&&f[3]<1?(f[3]=f.length>3?f[3]:1,p="hsla"):f.length=3,p+"("+f.join(",")+")"},be=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"rgba");var f=l[0],p=l[1],y=l[2];f/=255,p/=255,y/=255;var C=c(f,p,y),w=b(f,p,y),N=(w+C)/2,E,D;return w===C?(E=0,D=Number.NaN):E=N<.5?(w-C)/(w+C):(w-C)/(2-w-C),f==w?D=(p-y)/(w-C):p==w?D=2+(y-f)/(w-C):y==w&&(D=4+(f-p)/(w-C)),D*=60,D<0&&(D+=360),l.length>3&&l[3]!==void 0?[D,E,N,l[3]]:[D,E,N]},le=Math.round,Re=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"rgba"),p=d(l)||"rgb";return p.substr(0,3)=="hsl"?j(be(f),p):(f[0]=le(f[0]),f[1]=le(f[1]),f[2]=le(f[2]),(p==="rgba"||f.length>3&&f[3]<1)&&(f[3]=f.length>3?f[3]:1,p="rgba"),p+"("+f.slice(0,p==="rgb"?3:4).join(",")+")")},Ke=Math.round,ze=function(){for(var l,h=[],f=arguments.length;f--;)h[f]=arguments[f];h=o(h,"hsl");var p=h[0],y=h[1],C=h[2],w,N,E;if(y===0)w=N=E=C*255;else{var D=[0,0,0],k=[0,0,0],H=C<.5?C*(1+y):C+y-C*y,O=2*C-H,X=p/360;D[0]=X+1/3,D[1]=X,D[2]=X-1/3;for(var W=0;W<3;W++)D[W]<0&&(D[W]+=1),D[W]>1&&(D[W]-=1),6*D[W]<1?k[W]=O+(H-O)*6*D[W]:2*D[W]<1?k[W]=H:3*D[W]<2?k[W]=O+(H-O)*(2/3-D[W])*6:k[W]=O;l=[Ke(k[0]*255),Ke(k[1]*255),Ke(k[2]*255)],w=l[0],N=l[1],E=l[2]}return h.length>3?[w,N,E,h[3]]:[w,N,E,1]},Ve=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,Je=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,ft=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,ye=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Ee=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,xt=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Nt=Math.round,vt=function(l){l=l.toLowerCase().trim();var h;if(M.format.named)try{return M.format.named(l)}catch{}if(h=l.match(Ve)){for(var f=h.slice(1,4),p=0;p<3;p++)f[p]=+f[p];return f[3]=1,f}if(h=l.match(Je)){for(var y=h.slice(1,5),C=0;C<4;C++)y[C]=+y[C];return y}if(h=l.match(ft)){for(var w=h.slice(1,4),N=0;N<3;N++)w[N]=Nt(w[N]*2.55);return w[3]=1,w}if(h=l.match(ye)){for(var E=h.slice(1,5),D=0;D<3;D++)E[D]=Nt(E[D]*2.55);return E[3]=+E[3],E}if(h=l.match(Ee)){var k=h.slice(1,4);k[1]*=.01,k[2]*=.01;var H=ze(k);return H[3]=1,H}if(h=l.match(xt)){var O=h.slice(1,4);O[1]*=.01,O[2]*=.01;var X=ze(O);return X[3]=+h[4],X}};vt.test=function(l){return Ve.test(l)||Je.test(l)||ft.test(l)||ye.test(l)||Ee.test(l)||xt.test(l)},x.prototype.css=function(l){return Re(this._rgb,l)},I.css=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["css"])))},M.format.css=vt,M.autodetect.push({p:5,test:function(l){for(var h=[],f=arguments.length-1;f-- >0;)h[f]=arguments[f+1];if(!h.length&&u(l)==="string"&&vt.test(l))return"css"}}),M.format.gl=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"rgba");return f[0]*=255,f[1]*=255,f[2]*=255,f},I.gl=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["gl"])))},x.prototype.gl=function(){var l=this._rgb;return[l[0]/255,l[1]/255,l[2]/255,l[3]]};var kt=Math.floor,qt=function(){for(var l,h,f,p,y,C,w=[],N=arguments.length;N--;)w[N]=arguments[N];w=o(w,"hcg");var E=w[0],D=w[1],k=w[2],H,O,X;k=k*255;var W=D*255;if(D===0)H=O=X=k;else{E===360&&(E=0),E>360&&(E-=360),E<0&&(E+=360),E/=60;var ee=kt(E),ie=E-ee,se=k*(1-D),he=se+W*(1-ie),$e=se+W*ie,Be=se+W;switch(ee){case 0:l=[Be,$e,se],H=l[0],O=l[1],X=l[2];break;case 1:h=[he,Be,se],H=h[0],O=h[1],X=h[2];break;case 2:f=[se,Be,$e],H=f[0],O=f[1],X=f[2];break;case 3:p=[se,he,Be],H=p[0],O=p[1],X=p[2];break;case 4:y=[$e,se,Be],H=y[0],O=y[1],X=y[2];break;case 5:C=[Be,se,he],H=C[0],O=C[1],X=C[2];break}}return[H,O,X,w.length>3?w[3]:1]},Ot=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"rgb"),p=f[0],y=f[1],C=f[2],w=c(p,y,C),N=b(p,y,C),E=N-w,D=E*100/255,k=w/(255-E)*100,H;return E===0?H=Number.NaN:(p===N&&(H=(y-C)/E),y===N&&(H=2+(C-p)/E),C===N&&(H=4+(p-y)/E),H*=60,H<0&&(H+=360)),[H,D,k]};x.prototype.hcg=function(){return Ot(this._rgb)},I.hcg=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["hcg"])))},M.format.hcg=qt,M.autodetect.push({p:1,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"hcg"),u(l)==="array"&&l.length===3)return"hcg"}});var Z=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,Pe=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,et=function(l){if(l.match(Z)){(l.length===4||l.length===7)&&(l=l.substr(1)),l.length===3&&(l=l.split(""),l=l[0]+l[0]+l[1]+l[1]+l[2]+l[2]);var h=parseInt(l,16),f=h>>16,p=h>>8&255,y=h&255;return[f,p,y,1]}if(l.match(Pe)){(l.length===5||l.length===9)&&(l=l.substr(1)),l.length===4&&(l=l.split(""),l=l[0]+l[0]+l[1]+l[1]+l[2]+l[2]+l[3]+l[3]);var C=parseInt(l,16),w=C>>24&255,N=C>>16&255,E=C>>8&255,D=Math.round((C&255)/255*100)/100;return[w,N,E,D]}throw new Error("unknown hex color: "+l)},_e=Math.round,tt=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"rgba"),p=f[0],y=f[1],C=f[2],w=f[3],N=d(l)||"auto";w===void 0&&(w=1),N==="auto"&&(N=w<1?"rgba":"rgb"),p=_e(p),y=_e(y),C=_e(C);var E=p<<16|y<<8|C,D="000000"+E.toString(16);D=D.substr(D.length-6);var k="0"+_e(w*255).toString(16);switch(k=k.substr(k.length-2),N.toLowerCase()){case"rgba":return"#"+D+k;case"argb":return"#"+k+D;default:return"#"+D}};x.prototype.hex=function(l){return tt(this._rgb,l)},I.hex=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["hex"])))},M.format.hex=et,M.autodetect.push({p:4,test:function(l){for(var h=[],f=arguments.length-1;f-- >0;)h[f]=arguments[f+1];if(!h.length&&u(l)==="string"&&[3,4,5,6,7,8,9].indexOf(l.length)>=0)return"hex"}});var Le=Math.cos,qe=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"hsi");var f=l[0],p=l[1],y=l[2],C,w,N;return isNaN(f)&&(f=0),isNaN(p)&&(p=0),f>360&&(f-=360),f<0&&(f+=360),f/=360,f<1/3?(N=(1-p)/3,C=(1+p*Le(S*f)/Le(A-S*f))/3,w=1-(N+C)):f<2/3?(f-=1/3,C=(1-p)/3,w=(1+p*Le(S*f)/Le(A-S*f))/3,N=1-(C+w)):(f-=2/3,w=(1-p)/3,N=(1+p*Le(S*f)/Le(A-S*f))/3,C=1-(w+N)),C=t(y*C*3),w=t(y*w*3),N=t(y*N*3),[C*255,w*255,N*255,l.length>3?l[3]:1]},Ye=Math.min,zt=Math.sqrt,Qe=Math.acos,De=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"rgb"),p=f[0],y=f[1],C=f[2];p/=255,y/=255,C/=255;var w,N=Ye(p,y,C),E=(p+y+C)/3,D=E>0?1-N/E:0;return D===0?w=NaN:(w=(p-y+(p-C))/2,w/=zt((p-y)*(p-y)+(p-C)*(y-C)),w=Qe(w),C>y&&(w=S-w),w/=S),[w*360,D,E]};x.prototype.hsi=function(){return De(this._rgb)},I.hsi=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["hsi"])))},M.format.hsi=qe,M.autodetect.push({p:2,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"hsi"),u(l)==="array"&&l.length===3)return"hsi"}}),x.prototype.hsl=function(){return be(this._rgb)},I.hsl=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["hsl"])))},M.format.hsl=ze,M.autodetect.push({p:2,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"hsl"),u(l)==="array"&&l.length===3)return"hsl"}});var Te=Math.floor,Ie=function(){for(var l,h,f,p,y,C,w=[],N=arguments.length;N--;)w[N]=arguments[N];w=o(w,"hsv");var E=w[0],D=w[1],k=w[2],H,O,X;if(k*=255,D===0)H=O=X=k;else{E===360&&(E=0),E>360&&(E-=360),E<0&&(E+=360),E/=60;var W=Te(E),ee=E-W,ie=k*(1-D),se=k*(1-D*ee),he=k*(1-D*(1-ee));switch(W){case 0:l=[k,he,ie],H=l[0],O=l[1],X=l[2];break;case 1:h=[se,k,ie],H=h[0],O=h[1],X=h[2];break;case 2:f=[ie,k,he],H=f[0],O=f[1],X=f[2];break;case 3:p=[ie,se,k],H=p[0],O=p[1],X=p[2];break;case 4:y=[he,ie,k],H=y[0],O=y[1],X=y[2];break;case 5:C=[k,ie,se],H=C[0],O=C[1],X=C[2];break}}return[H,O,X,w.length>3?w[3]:1]},mt=Math.min,ct=Math.max,_t=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"rgb");var f=l[0],p=l[1],y=l[2],C=mt(f,p,y),w=ct(f,p,y),N=w-C,E,D,k;return k=w/255,w===0?(E=Number.NaN,D=0):(D=N/w,f===w&&(E=(p-y)/N),p===w&&(E=2+(y-f)/N),y===w&&(E=4+(f-p)/N),E*=60,E<0&&(E+=360)),[E,D,k]};x.prototype.hsv=function(){return _t(this._rgb)},I.hsv=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["hsv"])))},M.format.hsv=Ie,M.autodetect.push({p:2,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"hsv"),u(l)==="array"&&l.length===3)return"hsv"}});var Ce={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Ht=Math.pow,bt=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"lab");var f=l[0],p=l[1],y=l[2],C,w,N,E,D,k;return w=(f+16)/116,C=isNaN(p)?w:w+p/500,N=isNaN(y)?w:w-y/200,w=Ce.Yn*dt(w),C=Ce.Xn*dt(C),N=Ce.Zn*dt(N),E=rt(3.2404542*C-1.5371385*w-.4985314*N),D=rt(-.969266*C+1.8760108*w+.041556*N),k=rt(.0556434*C-.2040259*w+1.0572252*N),[E,D,k,l.length>3?l[3]:1]},rt=function(l){return 255*(l<=.00304?12.92*l:1.055*Ht(l,1/2.4)-.055)},dt=function(l){return l>Ce.t1?l*l*l:Ce.t2*(l-Ce.t0)},Rt=Math.pow,Et=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"rgb"),p=f[0],y=f[1],C=f[2],w=Br(p,y,C),N=w[0],E=w[1],D=w[2],k=116*E-16;return[k<0?0:k,500*(N-E),200*(E-D)]},wt=function(l){return(l/=255)<=.04045?l/12.92:Rt((l+.055)/1.055,2.4)},jt=function(l){return l>Ce.t3?Rt(l,1/3):l/Ce.t2+Ce.t0},Br=function(l,h,f){l=wt(l),h=wt(h),f=wt(f);var p=jt((.4124564*l+.3575761*h+.1804375*f)/Ce.Xn),y=jt((.2126729*l+.7151522*h+.072175*f)/Ce.Yn),C=jt((.0193339*l+.119192*h+.9503041*f)/Ce.Zn);return[p,y,C]};x.prototype.lab=function(){return Et(this._rgb)},I.lab=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["lab"])))},M.format.lab=bt,M.autodetect.push({p:2,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"lab"),u(l)==="array"&&l.length===3)return"lab"}});var ur=Math.sin,Pr=Math.cos,er=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"lch"),p=f[0],y=f[1],C=f[2];return isNaN(C)&&(C=0),C=C*B,[p,Pr(C)*y,ur(C)*y]},gr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"lch");var f=l[0],p=l[1],y=l[2],C=er(f,p,y),w=C[0],N=C[1],E=C[2],D=bt(w,N,E),k=D[0],H=D[1],O=D[2];return[k,H,O,l.length>3?l[3]:1]},Dr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"hcl").reverse();return gr.apply(void 0,f)},Ir=Math.sqrt,fr=Math.atan2,cr=Math.round,dr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"lab"),p=f[0],y=f[1],C=f[2],w=Ir(y*y+C*C),N=(fr(C,y)*P+360)%360;return cr(w*1e4)===0&&(N=Number.NaN),[p,w,N]},tr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"rgb"),p=f[0],y=f[1],C=f[2],w=Et(p,y,C),N=w[0],E=w[1],D=w[2];return dr(N,E,D)};x.prototype.lch=function(){return tr(this._rgb)},x.prototype.hcl=function(){return tr(this._rgb).reverse()},I.lch=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["lch"])))},I.hcl=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["hcl"])))},M.format.lch=gr,M.format.hcl=Dr,["lch","hcl"].forEach(function(l){return M.autodetect.push({p:2,test:function(){for(var h=[],f=arguments.length;f--;)h[f]=arguments[f];if(h=o(h,l),u(h)==="array"&&h.length===3)return l}})});var yt={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};x.prototype.name=function(){for(var l=tt(this._rgb,"rgb"),h=0,f=Object.keys(yt);h<f.length;h+=1){var p=f[h];if(yt[p]===l)return p.toLowerCase()}return l},M.format.named=function(l){if(l=l.toLowerCase(),yt[l])return et(yt[l]);throw new Error("unknown color name: "+l)},M.autodetect.push({p:5,test:function(l){for(var h=[],f=arguments.length-1;f-- >0;)h[f]=arguments[f+1];if(!h.length&&u(l)==="string"&&yt[l.toLowerCase()])return"named"}});var $r=function(l){if(u(l)=="number"&&l>=0&&l<=16777215){var h=l>>16,f=l>>8&255,p=l&255;return[h,f,p,1]}throw new Error("unknown num color: "+l)},kr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"rgb"),p=f[0],y=f[1],C=f[2];return(p<<16)+(y<<8)+C};x.prototype.num=function(){return kr(this._rgb)},I.num=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["num"])))},M.format.num=$r,M.autodetect.push({p:5,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l.length===1&&u(l[0])==="number"&&l[0]>=0&&l[0]<=16777215)return"num"}});var pr=Math.round;x.prototype.rgb=function(l){return l===void 0&&(l=!0),l===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(pr)},x.prototype.rgba=function(l){return l===void 0&&(l=!0),this._rgb.slice(0,4).map(function(h,f){return f<3?l===!1?h:pr(h):h})},I.rgb=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["rgb"])))},M.format.rgb=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"rgba");return f[3]===void 0&&(f[3]=1),f},M.autodetect.push({p:3,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"rgba"),u(l)==="array"&&(l.length===3||l.length===4&&u(l[3])=="number"&&l[3]>=0&&l[3]<=1))return"rgb"}});var Yt=Math.log,vr=function(l){var h=l/100,f,p,y;return h<66?(f=255,p=h<6?0:-155.25485562709179-.44596950469579133*(p=h-2)+104.49216199393888*Yt(p),y=h<20?0:-254.76935184120902+.8274096064007395*(y=h-10)+115.67994401066147*Yt(y)):(f=351.97690566805693+.114206453784165*(f=h-55)-40.25366309332127*Yt(f),p=325.4494125711974+.07943456536662342*(p=h-50)-28.0852963507957*Yt(p),y=255),[f,p,y,1]},Or=Math.round,zr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];for(var f=o(l,"rgb"),p=f[0],y=f[2],C=1e3,w=4e4,N=.4,E;w-C>N;){E=(w+C)*.5;var D=vr(E);D[2]/D[0]>=y/p?w=E:C=E}return Or(E)};x.prototype.temp=x.prototype.kelvin=x.prototype.temperature=function(){return zr(this._rgb)},I.temp=I.kelvin=I.temperature=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["temp"])))},M.format.temp=M.format.kelvin=M.format.temperature=vr;var Ut=Math.pow,_r=Math.sign,mr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"lab");var f=l[0],p=l[1],y=l[2],C=Ut(f+.3963377774*p+.2158037573*y,3),w=Ut(f-.1055613458*p-.0638541728*y,3),N=Ut(f-.0894841775*p-1.291485548*y,3);return[255*m(4.0767416621*C-3.3077115913*w+.2309699292*N),255*m(-1.2684380046*C+2.6097574011*w-.3413193965*N),255*m(-.0041960863*C-.7034186147*w+1.707614701*N),l.length>3?l[3]:1]};function m(l){var h=Math.abs(l);return h>.0031308?(_r(l)||1)*(1.055*Ut(h,1/2.4)-.055):l*12.92}var Tt=Math.cbrt,it=Math.pow,rr=Math.sign,Ft=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"rgb"),p=f[0],y=f[1],C=f[2],w=[pe(p/255),pe(y/255),pe(C/255)],N=w[0],E=w[1],D=w[2],k=Tt(.4122214708*N+.5363325363*E+.0514459929*D),H=Tt(.2119034982*N+.6806995451*E+.1073969566*D),O=Tt(.0883024619*N+.2817188376*E+.6299787005*D);return[.2104542553*k+.793617785*H-.0040720468*O,1.9779984951*k-2.428592205*H+.4505937099*O,.0259040371*k+.7827717662*H-.808675766*O]};function pe(l){var h=Math.abs(l);return h<.04045?l/12.92:(rr(l)||1)*it((h+.055)/1.055,2.4)}x.prototype.oklab=function(){return Ft(this._rgb)},I.oklab=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["oklab"])))},M.format.oklab=mr,M.autodetect.push({p:3,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"oklab"),u(l)==="array"&&l.length===3)return"oklab"}});var nt=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"lch");var f=l[0],p=l[1],y=l[2],C=er(f,p,y),w=C[0],N=C[1],E=C[2],D=mr(w,N,E),k=D[0],H=D[1],O=D[2];return[k,H,O,l.length>3?l[3]:1]},Hr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var f=o(l,"rgb"),p=f[0],y=f[1],C=f[2],w=Ft(p,y,C),N=w[0],E=w[1],D=w[2];return dr(N,E,D)};x.prototype.oklch=function(){return Hr(this._rgb)},I.oklch=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["oklch"])))},M.format.oklch=nt,M.autodetect.push({p:3,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"oklch"),u(l)==="array"&&l.length===3)return"oklch"}}),x.prototype.alpha=function(l,h){return h===void 0&&(h=!1),l!==void 0&&u(l)==="number"?h?(this._rgb[3]=l,this):new x([this._rgb[0],this._rgb[1],this._rgb[2],l],"rgb"):this._rgb[3]},x.prototype.clipped=function(){return this._rgb._clipped||!1},x.prototype.darken=function(l){l===void 0&&(l=1);var h=this,f=h.lab();return f[0]-=Ce.Kn*l,new x(f,"lab").alpha(h.alpha(),!0)},x.prototype.brighten=function(l){return l===void 0&&(l=1),this.darken(-l)},x.prototype.darker=x.prototype.darken,x.prototype.brighter=x.prototype.brighten,x.prototype.get=function(l){var h=l.split("."),f=h[0],p=h[1],y=this[f]();if(p){var C=f.indexOf(p)-(f.substr(0,2)==="ok"?2:0);if(C>-1)return y[C];throw new Error("unknown channel "+p+" in mode "+f)}else return y};var br=Math.pow,wr=1e-7,V=20;x.prototype.luminance=function(l,h){if(h===void 0&&(h="rgb"),l!==void 0&&u(l)==="number"){if(l===0)return new x([0,0,0,this._rgb[3]],"rgb");if(l===1)return new x([255,255,255,this._rgb[3]],"rgb");var f=this.luminance(),p=V,y=function(w,N){var E=w.interpolate(N,.5,h),D=E.luminance();return Math.abs(l-D)<wr||!p--?E:D>l?y(w,E):y(E,N)},C=(f>l?y(new x([0,0,0]),this):y(this,new x([255,255,255]))).rgb();return new x(C.concat([this._rgb[3]]))}return yr.apply(void 0,this._rgb.slice(0,3))};var yr=function(l,h,f){return l=ir(l),h=ir(h),f=ir(f),.2126*l+.7152*h+.0722*f},ir=function(l){return l/=255,l<=.03928?l/12.92:br((l+.055)/1.055,2.4)},Se={};function st(l,h,f){f===void 0&&(f=.5);for(var p=[],y=arguments.length-3;y-- >0;)p[y]=arguments[y+3];var C=p[0]||"lrgb";if(!Se[C]&&!p.length&&(C=Object.keys(Se)[0]),!Se[C])throw new Error("interpolation mode "+C+" is not defined");return u(l)!=="object"&&(l=new x(l)),u(h)!=="object"&&(h=new x(h)),Se[C](l,h,f).alpha(l.alpha()+f*(h.alpha()-l.alpha()))}x.prototype.mix=x.prototype.interpolate=function(l,h){h===void 0&&(h=.5);for(var f=[],p=arguments.length-2;p-- >0;)f[p]=arguments[p+2];return st.apply(void 0,[this,l,h].concat(f))},x.prototype.premultiply=function(l){l===void 0&&(l=!1);var h=this._rgb,f=h[3];return l?(this._rgb=[h[0]*f,h[1]*f,h[2]*f,f],this):new x([h[0]*f,h[1]*f,h[2]*f,f],"rgb")},x.prototype.saturate=function(l){l===void 0&&(l=1);var h=this,f=h.lch();return f[1]+=Ce.Kn*l,f[1]<0&&(f[1]=0),new x(f,"lch").alpha(h.alpha(),!0)},x.prototype.desaturate=function(l){return l===void 0&&(l=1),this.saturate(-l)},x.prototype.set=function(l,h,f){f===void 0&&(f=!1);var p=l.split("."),y=p[0],C=p[1],w=this[y]();if(C){var N=y.indexOf(C)-(y.substr(0,2)==="ok"?2:0);if(N>-1){if(u(h)=="string")switch(h.charAt(0)){case"+":w[N]+=+h;break;case"-":w[N]+=+h;break;case"*":w[N]*=+h.substr(1);break;case"/":w[N]/=+h.substr(1);break;default:w[N]=+h}else if(u(h)==="number")w[N]=h;else throw new Error("unsupported value for Color.set");var E=new x(w,y);return f?(this._rgb=E._rgb,this):E}throw new Error("unknown channel "+C+" in mode "+y)}else return w},x.prototype.tint=function(l){l===void 0&&(l=.5);for(var h=[],f=arguments.length-1;f-- >0;)h[f]=arguments[f+1];return st.apply(void 0,[this,"white",l].concat(h))},x.prototype.shade=function(l){l===void 0&&(l=.5);for(var h=[],f=arguments.length-1;f-- >0;)h[f]=arguments[f+1];return st.apply(void 0,[this,"black",l].concat(h))};var Fr=function(l,h,f){var p=l._rgb,y=h._rgb;return new x(p[0]+f*(y[0]-p[0]),p[1]+f*(y[1]-p[1]),p[2]+f*(y[2]-p[2]),"rgb")};Se.rgb=Fr;var Mt=Math.sqrt,Lt=Math.pow,Wr=function(l,h,f){var p=l._rgb,y=p[0],C=p[1],w=p[2],N=h._rgb,E=N[0],D=N[1],k=N[2];return new x(Mt(Lt(y,2)*(1-f)+Lt(E,2)*f),Mt(Lt(C,2)*(1-f)+Lt(D,2)*f),Mt(Lt(w,2)*(1-f)+Lt(k,2)*f),"rgb")};Se.lrgb=Wr;var Sr=function(l,h,f){var p=l.lab(),y=h.lab();return new x(p[0]+f*(y[0]-p[0]),p[1]+f*(y[1]-p[1]),p[2]+f*(y[2]-p[2]),"lab")};Se.lab=Sr;function St(l,h,f,p){var y,C,w,N;p==="hsl"?(w=l.hsl(),N=h.hsl()):p==="hsv"?(w=l.hsv(),N=h.hsv()):p==="hcg"?(w=l.hcg(),N=h.hcg()):p==="hsi"?(w=l.hsi(),N=h.hsi()):p==="lch"||p==="hcl"?(p="hcl",w=l.hcl(),N=h.hcl()):p==="oklch"&&(w=l.oklch().reverse(),N=h.oklch().reverse());var E,D,k,H,O,X;(p.substr(0,1)==="h"||p==="oklch")&&(y=w,E=y[0],k=y[1],O=y[2],C=N,D=C[0],H=C[1],X=C[2]);var W,ee,ie,se;return!isNaN(E)&&!isNaN(D)?(D>E&&D-E>180?se=D-(E+360):D<E&&E-D>180?se=D+360-E:se=D-E,ee=E+f*se):isNaN(E)?isNaN(D)?ee=Number.NaN:(ee=D,(O==1||O==0)&&p!="hsv"&&(W=H)):(ee=E,(X==1||X==0)&&p!="hsv"&&(W=k)),W===void 0&&(W=k+f*(H-k)),ie=O+f*(X-O),p==="oklch"?new x([ie,W,ee],p):new x([ee,W,ie],p)}var Ar=function(l,h,f){return St(l,h,f,"lch")};Se.lch=Ar,Se.hcl=Ar;var Cr=function(l,h,f){var p=l.num(),y=h.num();return new x(p+f*(y-p),"num")};Se.num=Cr;var Xr=function(l,h,f){return St(l,h,f,"hcg")};Se.hcg=Xr;var Vr=function(l,h,f){return St(l,h,f,"hsi")};Se.hsi=Vr;var qr=function(l,h,f){return St(l,h,f,"hsl")};Se.hsl=qr;var Yr=function(l,h,f){return St(l,h,f,"hsv")};Se.hsv=Yr;var Ur=function(l,h,f){var p=l.oklab(),y=h.oklab();return new x(p[0]+f*(y[0]-p[0]),p[1]+f*(y[1]-p[1]),p[2]+f*(y[2]-p[2]),"oklab")};Se.oklab=Ur;var Gr=function(l,h,f){return St(l,h,f,"oklch")};Se.oklch=Gr;var nr=Math.pow,T=Math.sqrt,v=Math.PI,$=Math.cos,R=Math.sin,z=Math.atan2;function F(l,h,f){h===void 0&&(h="lrgb"),f===void 0&&(f=null);var p=l.length;f||(f=Array.from(new Array(p)).map(function(){return 1}));var y=p/f.reduce(function(ee,ie){return ee+ie});if(f.forEach(function(ee,ie){f[ie]*=y}),l=l.map(function(ee){return new x(ee)}),h==="lrgb")return Y(l,f);for(var C=l.shift(),w=C.get(h),N=[],E=0,D=0,k=0;k<w.length;k++)if(w[k]=(w[k]||0)*f[0],N.push(isNaN(w[k])?0:f[0]),h.charAt(k)==="h"&&!isNaN(w[k])){var H=w[k]/180*v;E+=$(H)*f[0],D+=R(H)*f[0]}var O=C.alpha()*f[0];l.forEach(function(ee,ie){var se=ee.get(h);O+=ee.alpha()*f[ie+1];for(var he=0;he<w.length;he++)if(!isNaN(se[he]))if(N[he]+=f[ie+1],h.charAt(he)==="h"){var $e=se[he]/180*v;E+=$($e)*f[ie+1],D+=R($e)*f[ie+1]}else w[he]+=se[he]*f[ie+1]});for(var X=0;X<w.length;X++)if(h.charAt(X)==="h"){for(var W=z(D/N[X],E/N[X])/v*180;W<0;)W+=360;for(;W>=360;)W-=360;w[X]=W}else w[X]=w[X]/N[X];return O/=p,new x(w,h).alpha(O>.99999?1:O,!0)}var Y=function(l,h){for(var f=l.length,p=[0,0,0,0],y=0;y<l.length;y++){var C=l[y],w=h[y]/f,N=C._rgb;p[0]+=nr(N[0],2)*w,p[1]+=nr(N[1],2)*w,p[2]+=nr(N[2],2)*w,p[3]+=N[3]*w}return p[0]=T(p[0]),p[1]=T(p[1]),p[2]=T(p[2]),p[3]>.9999999&&(p[3]=1),new x(r(p))},Me=Math.pow;function He(l){var h="rgb",f=I("#ccc"),p=0,y=[0,1],C=[],w=[0,0],N=!1,E=[],D=!1,k=0,H=1,O=!1,X={},W=!0,ee=1,ie=function(_){if(_=_||["#fff","#000"],_&&u(_)==="string"&&I.brewer&&I.brewer[_.toLowerCase()]&&(_=I.brewer[_.toLowerCase()]),u(_)==="array"){_.length===1&&(_=[_[0],_[0]]),_=_.slice(0);for(var U=0;U<_.length;U++)_[U]=I(_[U]);C.length=0;for(var re=0;re<_.length;re++)C.push(re/(_.length-1))}return Ue(),E=_},se=function(_){if(N!=null){for(var U=N.length-1,re=0;re<U&&_>=N[re];)re++;return re-1}return 0},he=function(_){return _},$e=function(_){return _},Be=function(_,U){var re,te;if(U==null&&(U=!1),isNaN(_)||_===null)return f;if(U)te=_;else if(N&&N.length>2){var ke=se(_);te=ke/(N.length-2)}else H!==k?te=(_-k)/(H-k):te=1;te=$e(te),U||(te=he(te)),ee!==1&&(te=Me(te,ee)),te=w[0]+te*(1-w[0]-w[1]),te=t(te,0,1);var ve=Math.floor(te*1e4);if(W&&X[ve])re=X[ve];else{if(u(E)==="array")for(var ae=0;ae<C.length;ae++){var ue=C[ae];if(te<=ue){re=E[ae];break}if(te>=ue&&ae===C.length-1){re=E[ae];break}if(te>ue&&te<C[ae+1]){te=(te-ue)/(C[ae+1]-ue),re=I.interpolate(E[ae],E[ae+1],te,h);break}}else u(E)==="function"&&(re=E(te));W&&(X[ve]=re)}return re},Ue=function(){return X={}};ie(l);var ne=function(_){var U=I(Be(_));return D&&U[D]?U[D]():U};return ne.classes=function(_){if(_!=null){if(u(_)==="array")N=_,y=[_[0],_[_.length-1]];else{var U=I.analyze(y);_===0?N=[U.min,U.max]:N=I.limits(U,"e",_)}return ne}return N},ne.domain=function(_){if(!arguments.length)return y;k=_[0],H=_[_.length-1],C=[];var U=E.length;if(_.length===U&&k!==H)for(var re=0,te=Array.from(_);re<te.length;re+=1){var ke=te[re];C.push((ke-k)/(H-k))}else{for(var ve=0;ve<U;ve++)C.push(ve/(U-1));if(_.length>2){var ae=_.map(function(ge,fe){return fe/(_.length-1)}),ue=_.map(function(ge){return(ge-k)/(H-k)});ue.every(function(ge,fe){return ae[fe]===ge})||($e=function(ge){if(ge<=0||ge>=1)return ge;for(var fe=0;ge>=ue[fe+1];)fe++;var ut=(ge-ue[fe])/(ue[fe+1]-ue[fe]),Dt=ae[fe]+ut*(ae[fe+1]-ae[fe]);return Dt})}}return y=[k,H],ne},ne.mode=function(_){return arguments.length?(h=_,Ue(),ne):h},ne.range=function(_,U){return ie(_),ne},ne.out=function(_){return D=_,ne},ne.spread=function(_){return arguments.length?(p=_,ne):p},ne.correctLightness=function(_){return _==null&&(_=!0),O=_,Ue(),O?he=function(U){for(var re=Be(0,!0).lab()[0],te=Be(1,!0).lab()[0],ke=re>te,ve=Be(U,!0).lab()[0],ae=re+(te-re)*U,ue=ve-ae,ge=0,fe=1,ut=20;Math.abs(ue)>.01&&ut-- >0;)(function(){return ke&&(ue*=-1),ue<0?(ge=U,U+=(fe-U)*.5):(fe=U,U+=(ge-U)*.5),ve=Be(U,!0).lab()[0],ue=ve-ae})();return U}:he=function(U){return U},ne},ne.padding=function(_){return _!=null?(u(_)==="number"&&(_=[_,_]),w=_,ne):w},ne.colors=function(_,U){arguments.length<2&&(U="hex");var re=[];if(arguments.length===0)re=E.slice(0);else if(_===1)re=[ne(.5)];else if(_>1){var te=y[0],ke=y[1]-te;re=ot(0,_).map(function(fe){return ne(te+fe/(_-1)*ke)})}else{l=[];var ve=[];if(N&&N.length>2)for(var ae=1,ue=N.length,ge=1<=ue;ge?ae<ue:ae>ue;ge?ae++:ae--)ve.push((N[ae-1]+N[ae])*.5);else ve=y;re=ve.map(function(fe){return ne(fe)})}return I[U]&&(re=re.map(function(fe){return fe[U]()})),re},ne.cache=function(_){return _!=null?(W=_,ne):W},ne.gamma=function(_){return _!=null?(ee=_,ne):ee},ne.nodata=function(_){return _!=null?(f=I(_),ne):f},ne}function ot(l,h,f){for(var p=[],y=l<h,C=h,w=l;y?w<C:w>C;y?w++:w--)p.push(w);return p}var Ki=function(l){for(var h=[1,1],f=1;f<l;f++){for(var p=[1],y=1;y<=h.length;y++)p[y]=(h[y]||0)+h[y-1];h=p}return h},Ji=function(l){var h,f,p,y,C,w,N;if(l=l.map(function(O){return new x(O)}),l.length===2)h=l.map(function(O){return O.lab()}),C=h[0],w=h[1],y=function(O){var X=[0,1,2].map(function(W){return C[W]+O*(w[W]-C[W])});return new x(X,"lab")};else if(l.length===3)f=l.map(function(O){return O.lab()}),C=f[0],w=f[1],N=f[2],y=function(O){var X=[0,1,2].map(function(W){return(1-O)*(1-O)*C[W]+2*(1-O)*O*w[W]+O*O*N[W]});return new x(X,"lab")};else if(l.length===4){var E;p=l.map(function(O){return O.lab()}),C=p[0],w=p[1],N=p[2],E=p[3],y=function(O){var X=[0,1,2].map(function(W){return(1-O)*(1-O)*(1-O)*C[W]+3*(1-O)*(1-O)*O*w[W]+3*(1-O)*O*O*N[W]+O*O*O*E[W]});return new x(X,"lab")}}else if(l.length>=5){var D,k,H;D=l.map(function(O){return O.lab()}),H=l.length-1,k=Ki(H),y=function(O){var X=1-O,W=[0,1,2].map(function(ee){return D.reduce(function(ie,se,he){return ie+k[he]*Math.pow(X,H-he)*Math.pow(O,he)*se[ee]},0)});return new x(W,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return y};function Qi(l){var h=Ji(l);return h.scale=function(){return He(h)},h}var ht=function(l,h,f){if(!ht[f])throw new Error("unknown blend mode "+f);return ht[f](l,h)},Bt=function(l){return function(h,f){var p=I(f).rgb(),y=I(h).rgb();return I.rgb(l(p,y))}},Pt=function(l){return function(h,f){var p=[];return p[0]=l(h[0],f[0]),p[1]=l(h[1],f[1]),p[2]=l(h[2],f[2]),p}},ji=function(l){return l},en=function(l,h){return l*h/255},tn=function(l,h){return l>h?h:l},rn=function(l,h){return l>h?l:h},nn=function(l,h){return 255*(1-(1-l/255)*(1-h/255))},sn=function(l,h){return h<128?2*l*h/255:255*(1-2*(1-l/255)*(1-h/255))},an=function(l,h){return 255*(1-(1-h/255)/(l/255))},ln=function(l,h){return l===255?255:(l=255*(h/255)/(1-l/255),l>255?255:l)};ht.normal=Bt(Pt(ji)),ht.multiply=Bt(Pt(en)),ht.screen=Bt(Pt(nn)),ht.overlay=Bt(Pt(sn)),ht.darken=Bt(Pt(tn)),ht.lighten=Bt(Pt(rn)),ht.dodge=Bt(Pt(ln)),ht.burn=Bt(Pt(an));var on=Math.pow,hn=Math.sin,un=Math.cos;function gn(l,h,f,p,y){l===void 0&&(l=300),h===void 0&&(h=-1.5),f===void 0&&(f=1),p===void 0&&(p=1),y===void 0&&(y=[0,1]);var C=0,w;u(y)==="array"?w=y[1]-y[0]:(w=0,y=[y,y]);var N=function(E){var D=S*((l+120)/360+h*E),k=on(y[0]+w*E,p),H=C!==0?f[0]+E*C:f,O=H*k*(1-k)/2,X=un(D),W=hn(D),ee=k+O*(-.14861*X+1.78277*W),ie=k+O*(-.29227*X-.90649*W),se=k+O*(1.97294*X);return I(r([ee*255,ie*255,se*255,1]))};return N.start=function(E){return E==null?l:(l=E,N)},N.rotations=function(E){return E==null?h:(h=E,N)},N.gamma=function(E){return E==null?p:(p=E,N)},N.hue=function(E){return E==null?f:(f=E,u(f)==="array"?(C=f[1]-f[0],C===0&&(f=f[1])):C=0,N)},N.lightness=function(E){return E==null?y:(u(E)==="array"?(y=E,w=E[1]-E[0]):(y=[E,E],w=0),N)},N.scale=function(){return I.scale(N)},N.hue(f),N}var fn="0123456789abcdef",cn=Math.floor,dn=Math.random;function pn(){for(var l="#",h=0;h<6;h++)l+=fn.charAt(cn(dn()*16));return new x(l,"hex")}var di=Math.log,vn=Math.pow,mn=Math.floor,bn=Math.abs;function pi(l,h){h===void 0&&(h=null);var f={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return u(l)==="object"&&(l=Object.values(l)),l.forEach(function(p){h&&u(p)==="object"&&(p=p[h]),p!=null&&!isNaN(p)&&(f.values.push(p),f.sum+=p,p<f.min&&(f.min=p),p>f.max&&(f.max=p),f.count+=1)}),f.domain=[f.min,f.max],f.limits=function(p,y){return vi(f,p,y)},f}function vi(l,h,f){h===void 0&&(h="equal"),f===void 0&&(f=7),u(l)=="array"&&(l=pi(l));var p=l.min,y=l.max,C=l.values.sort(function(Kr,Jr){return Kr-Jr});if(f===1)return[p,y];var w=[];if(h.substr(0,1)==="c"&&(w.push(p),w.push(y)),h.substr(0,1)==="e"){w.push(p);for(var N=1;N<f;N++)w.push(p+N/f*(y-p));w.push(y)}else if(h.substr(0,1)==="l"){if(p<=0)throw new Error("Logarithmic scales are only possible for values > 0");var E=Math.LOG10E*di(p),D=Math.LOG10E*di(y);w.push(p);for(var k=1;k<f;k++)w.push(vn(10,E+k/f*(D-E)));w.push(y)}else if(h.substr(0,1)==="q"){w.push(p);for(var H=1;H<f;H++){var O=(C.length-1)*H/f,X=mn(O);if(X===O)w.push(C[X]);else{var W=O-X;w.push(C[X]*(1-W)+C[X+1]*W)}}w.push(y)}else if(h.substr(0,1)==="k"){var ee,ie=C.length,se=new Array(ie),he=new Array(f),$e=!0,Be=0,Ue=null;Ue=[],Ue.push(p);for(var ne=1;ne<f;ne++)Ue.push(p+ne/f*(y-p));for(Ue.push(y);$e;){for(var _=0;_<f;_++)he[_]=0;for(var U=0;U<ie;U++)for(var re=C[U],te=Number.MAX_VALUE,ke=void 0,ve=0;ve<f;ve++){var ae=bn(Ue[ve]-re);ae<te&&(te=ae,ke=ve),he[ke]++,se[U]=ke}for(var ue=new Array(f),ge=0;ge<f;ge++)ue[ge]=null;for(var fe=0;fe<ie;fe++)ee=se[fe],ue[ee]===null?ue[ee]=C[fe]:ue[ee]+=C[fe];for(var ut=0;ut<f;ut++)ue[ut]*=1/he[ut];$e=!1;for(var Dt=0;Dt<f;Dt++)if(ue[Dt]!==Ue[Dt]){$e=!0;break}Ue=ue,Be++,Be>200&&($e=!1)}for(var It={},Gt=0;Gt<f;Gt++)It[Gt]=[];for(var Zt=0;Zt<ie;Zt++)ee=se[Zt],It[ee].push(C[Zt]);for(var Ct=[],Wt=0;Wt<f;Wt++)Ct.push(It[Wt][0]),Ct.push(It[Wt][It[Wt].length-1]);Ct=Ct.sort(function(Kr,Jr){return Kr-Jr}),w.push(Ct[0]);for(var sr=1;sr<Ct.length;sr+=2){var Xt=Ct[sr];!isNaN(Xt)&&w.indexOf(Xt)===-1&&w.push(Xt)}}return w}function wn(l,h){l=new x(l),h=new x(h);var f=l.luminance(),p=h.luminance();return f>p?(f+.05)/(p+.05):(p+.05)/(f+.05)}var At=Math.sqrt,xe=Math.pow,yn=Math.min,Sn=Math.max,mi=Math.atan2,bi=Math.abs,xr=Math.cos,wi=Math.sin,An=Math.exp,yi=Math.PI;function Cn(l,h,f,p,y){f===void 0&&(f=1),p===void 0&&(p=1),y===void 0&&(y=1);var C=function(Xt){return 360*Xt/(2*yi)},w=function(Xt){return 2*yi*Xt/360};l=new x(l),h=new x(h);var N=Array.from(l.lab()),E=N[0],D=N[1],k=N[2],H=Array.from(h.lab()),O=H[0],X=H[1],W=H[2],ee=(E+O)/2,ie=At(xe(D,2)+xe(k,2)),se=At(xe(X,2)+xe(W,2)),he=(ie+se)/2,$e=.5*(1-At(xe(he,7)/(xe(he,7)+xe(25,7)))),Be=D*(1+$e),Ue=X*(1+$e),ne=At(xe(Be,2)+xe(k,2)),_=At(xe(Ue,2)+xe(W,2)),U=(ne+_)/2,re=C(mi(k,Be)),te=C(mi(W,Ue)),ke=re>=0?re:re+360,ve=te>=0?te:te+360,ae=bi(ke-ve)>180?(ke+ve+360)/2:(ke+ve)/2,ue=1-.17*xr(w(ae-30))+.24*xr(w(2*ae))+.32*xr(w(3*ae+6))-.2*xr(w(4*ae-63)),ge=ve-ke;ge=bi(ge)<=180?ge:ve<=ke?ge+360:ge-360,ge=2*At(ne*_)*wi(w(ge)/2);var fe=O-E,ut=_-ne,Dt=1+.015*xe(ee-50,2)/At(20+xe(ee-50,2)),It=1+.045*U,Gt=1+.015*U*ue,Zt=30*An(-xe((ae-275)/25,2)),Ct=2*At(xe(U,7)/(xe(U,7)+xe(25,7))),Wt=-Ct*wi(2*w(Zt)),sr=At(xe(fe/(f*Dt),2)+xe(ut/(p*It),2)+xe(ge/(y*Gt),2)+Wt*(ut/(p*It))*(ge/(y*Gt)));return Sn(0,yn(100,sr))}function xn(l,h,f){f===void 0&&(f="lab"),l=new x(l),h=new x(h);var p=l.get(f),y=h.get(f),C=0;for(var w in p){var N=(p[w]||0)-(y[w]||0);C+=N*N}return Math.sqrt(C)}function Nn(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];try{return new(Function.prototype.bind.apply(x,[null].concat(l))),!0}catch{return!1}}for(var Rn={cool:function(){return He([I.hsl(180,1,.9),I.hsl(250,.7,.4)])},hot:function(){return He(["#000","#f00","#ff0","#fff"]).mode("rgb")}},Nr={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Zr=0,Si=Object.keys(Nr);Zr<Si.length;Zr+=1){var Ai=Si[Zr];Nr[Ai.toLowerCase()]=Nr[Ai]}return Object.assign(I,{average:F,bezier:Qi,blend:ht,cubehelix:gn,mix:st,interpolate:st,random:pn,scale:He,analyze:pi,contrast:wn,deltaE:Cn,distance:xn,limits:vi,valid:Nn,scales:Rn,input:M,colors:yt,brewer:Nr}),I})})(Wi);var fs=Wi.exports;const Bi=$t,cs=gs,ds=fs;let ps=class{constructor(e,t,r,i,s=.3,a=0,n=null,u=1,o=!1){this.points=e,this.weights=t,this.width=r,this.height=i,this.sigma=s,this.interval=a,this.opacity=u,this.normalized=o,n===null&&(n=["#c51b7d","#de77ae","#f1b6da","#fde0ef","#ffffff","#e6f5d0","#b8e186","#7fbc41","#4d9221"]),this.colormap=n,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height}setFromArray(e,t){this.points=[],e.forEach(r=>{this.points.push(new Bi(r[0],r[1]))}),this.weights=[],t.forEach(r=>{this.weights.push(r)})}draw(){let e=[];for(let s=0;s<this.width;s++){let a=[];for(let n=0;n<this.height;n++)a.push(0);e.push(a)}let t=1/(2*this.sigma**2);for(let s=0;s<this.points.length;s++){let a=this.points[s],n=this.weights[s];for(let u=0;u<this.width;u++)for(let o=0;o<this.height;o++){let d=((u-a.x)**2+(o-a.y)**2)*t,g=n*Math.exp(-d);e[u][o]+=g}}let r=1;if(!this.normalized){let s=-Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER;for(let n=0;n<this.width;n++)for(let u=0;u<this.height;u++)e[n][u]<a&&(a=e[n][u]),e[n][u]>s&&(s=e[n][u]);r=Math.max(Math.abs(a),Math.abs(s))}const i=ds.scale(this.colormap).domain([-1,1]);for(let s=0;s<this.width;s++)for(let a=0;a<this.height;a++){this.normalized||(e[s][a]=e[s][a]/r),this.interval!==0&&(e[s][a]=Math.round(e[s][a]/this.interval)*this.interval);let[n,u,o]=i(e[s][a]).rgb();this.setPixel(new Bi(s,a),n,u,o)}}getImage(e){let t=new Image;t.onload=()=>{this.context.imageSmoothingEnabled=!1,this.context.drawImage(t,0,0,this.width,this.height),e&&e(t)},t.onerror=function(r){console.log(r)},t.src=this.canvas.toDataURL()}getSVG(){return cs(this.context.getImageData(0,0,this.width,this.height))}setPixel(e,t,r,i){this.context.fillStyle="rgba("+t+","+r+","+i+","+this.opacity+")",this.context.fillRect(e.x,e.y,1,1)}};var Xi=ps;const Pi=lr,vs=Mr(),ms=ss,Xe=oi,bs=gi,ws=hi,Ne=$t,ys=Xi;let Ss=class{constructor(e,t=!0){this.preprocessor=new ms(e),this.opts=this.preprocessor.opts,this.clear=t,this.svgWrapper=null}draw(e,t,r="light",i=null,s=!1,a=[],n=!1){t===null||t==="svg"?(t=document.createElementNS("http://www.w3.org/2000/svg","svg"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t.setAttributeNS(null,"width",this.opts.width),t.setAttributeNS(null,"height",this.opts.height)):t instanceof String&&(t=document.getElementById(t));let u={padding:this.opts.padding,compactDrawing:this.opts.compactDrawing};i!==null&&(this.opts.padding+=this.opts.weights.additionalPadding,this.opts.compactDrawing=!1);let o=this.preprocessor;return o.initDraw(e,r,s,a),s||(this.themeManager=new ws(this.opts.themes,r),(this.svgWrapper===null||this.clear)&&(this.svgWrapper=new bs(this.themeManager,t,this.opts,this.clear))),o.processGraph(),this.svgWrapper.determineDimensions(o.graph.vertices),this.drawAtomHighlights(o.opts.debug),this.drawEdges(o.opts.debug),this.drawVertices(o.opts.debug),i!==null&&this.drawWeights(i,n),o.opts.debug&&(console.log(o.graph),console.log(o.rings),console.log(o.ringConnections)),this.svgWrapper.constructSvg(),i!==null&&(this.opts.padding=u.padding,this.opts.compactDrawing=u.padding),t}drawCanvas(e,t,r="light",i=!1){let s=null;typeof t=="string"||t instanceof String?s=document.getElementById(t):s=t;let a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttributeNS(null,"viewBox","0 0 500 500"),a.setAttributeNS(null,"width","500"),a.setAttributeNS(null,"height","500"),a.setAttributeNS(null,"style","visibility: hidden: position: absolute; left: -1000px"),document.body.appendChild(a),this.svgDrawer.draw(e,a,r,i),this.svgDrawer.svgWrapper.toCanvas(s,this.svgDrawer.opts.width,this.svgDrawer.opts.height),document.body.removeChild(a),t}drawAromaticityRing(e){this.svgWrapper.drawRing(e.center.x,e.center.y,e.getSize())}drawEdges(e){let t=this.preprocessor,r=t.graph,i=t.rings,s=Array(this.preprocessor.graph.edges.length);if(s.fill(!1),r.traverseBF(0,n=>{let u=r.getEdges(n.id);for(var o=0;o<u.length;o++){let d=u[o];s[d]||(s[d]=!0,this.drawEdge(d,e))}}),!this.bridgedRing)for(var a=0;a<i.length;a++){let n=i[a];t.isRingAromatic(n)&&this.drawAromaticityRing(n)}}drawEdge(e,t){let r=this.preprocessor,i=r.opts,s=this.svgWrapper,a=r.graph.edges[e],n=r.graph.vertices[a.sourceId],u=r.graph.vertices[a.targetId],o=n.value.element,d=u.value.element;if((!n.value.isDrawn||!u.value.isDrawn)&&r.opts.atomVisualization==="default")return;let g=n.position,c=u.position,b=r.getEdgeNormals(a),S=Pi.clone(b);if(S[0].multiplyScalar(10).add(g),S[1].multiplyScalar(10).add(g),a.bondType==="="||r.getRingbondType(n,u)==="="||a.isPartOfAromaticRing&&r.bridgedRing){let A=r.areVerticesInSameRing(n,u),B=r.chooseSide(n,u,S);if(A){let M=r.getLargestOrAromaticCommonRing(n,u).center;b[0].multiplyScalar(i.bondSpacing),b[1].multiplyScalar(i.bondSpacing);let x=null;M.sameSideAs(n.position,u.position,Ne.add(g,b[0]))?x=new Xe(Ne.add(g,b[0]),Ne.add(c,b[0]),o,d):x=new Xe(Ne.add(g,b[1]),Ne.add(c,b[1]),o,d),x.shorten(i.bondLength-i.shortBondLength*i.bondLength),a.isPartOfAromaticRing?s.drawLine(x,!0):s.drawLine(x),s.drawLine(new Xe(g,c,o,d))}else if(a.center||n.isTerminal()&&u.isTerminal()||B.anCount==0&&B.bnCount>1||B.bnCount==0&&B.anCount>1){this.multiplyNormals(b,i.halfBondSpacing);let P=new Xe(Ne.add(g,b[0]),Ne.add(c,b[0]),o,d),M=new Xe(Ne.add(g,b[1]),Ne.add(c,b[1]),o,d);s.drawLine(P),s.drawLine(M)}else if(B.sideCount[0]>B.sideCount[1]||B.totalSideCount[0]>B.totalSideCount[1]){this.multiplyNormals(b,i.bondSpacing);let P=new Xe(Ne.add(g,b[0]),Ne.add(c,b[0]),o,d);P.shorten(i.bondLength-i.shortBondLength*i.bondLength),s.drawLine(P),s.drawLine(new Xe(g,c,o,d))}else if(B.sideCount[0]<B.sideCount[1]||B.totalSideCount[0]<=B.totalSideCount[1]){this.multiplyNormals(b,i.bondSpacing);let P=new Xe(Ne.add(g,b[1]),Ne.add(c,b[1]),o,d);P.shorten(i.bondLength-i.shortBondLength*i.bondLength),s.drawLine(P),s.drawLine(new Xe(g,c,o,d))}}else if(a.bondType==="#"){b[0].multiplyScalar(i.bondSpacing/1.5),b[1].multiplyScalar(i.bondSpacing/1.5);let A=new Xe(Ne.add(g,b[0]),Ne.add(c,b[0]),o,d),B=new Xe(Ne.add(g,b[1]),Ne.add(c,b[1]),o,d);s.drawLine(A),s.drawLine(B),s.drawLine(new Xe(g,c,o,d))}else if(a.bondType!=="."){let A=n.value.isStereoCenter,B=u.value.isStereoCenter;a.wedge==="up"?s.drawWedge(new Xe(g,c,o,d,A,B)):a.wedge==="down"?s.drawDashedWedge(new Xe(g,c,o,d,A,B)):s.drawLine(new Xe(g,c,o,d,A,B))}if(t){let A=Ne.midpoint(g,c);s.drawDebugText(A.x,A.y,"e: "+e)}}drawAtomHighlights(e){let t=this.preprocessor;t.opts;let r=t.graph;t.rings;let i=this.svgWrapper;for(var s=0;s<r.vertices.length;s++){let n=r.vertices[s],u=n.value;for(var a=0;a<t.highlight_atoms.length;a++){let o=t.highlight_atoms[a];u.class===o[0]&&i.drawAtomHighlight(n.position.x,n.position.y,o[1])}}}drawVertices(e){let t=this.preprocessor,r=t.opts,i=t.graph,s=t.rings,a=this.svgWrapper;for(var n=i.vertices.length,n=0;n<i.vertices.length;n++){let o=i.vertices[n],d=o.value,g=0,c=0,b=o.value.bondCount,S=d.element,A=vs.maxBonds[S]-b,B=o.getTextDirection(i.vertices,d.hasAttachedPseudoElements),P=r.terminalCarbons||S!=="C"||d.hasAttachedPseudoElements?o.isTerminal():!1,M=d.element==="C";if(i.vertices.length<3&&(M=!1),d.element==="N"&&d.isPartOfAromaticRing&&(A=0),d.bracket&&(A=d.bracket.hcount,g=d.bracket.charge,c=d.bracket.isotope),r.atomVisualization==="allballs")a.drawBall(o.position.x,o.position.y,S);else if(d.isDrawn&&(!M||d.drawExplicit||P||d.hasAttachedPseudoElements)||i.vertices.length===1)if(r.atomVisualization==="default"){let x=d.getAttachedPseudoElements();d.hasAttachedPseudoElements&&i.vertices.length===Object.keys(x).length+1&&(B="right"),a.drawText(o.position.x,o.position.y,S,A,B,P,g,c,i.vertices.length,x)}else r.atomVisualization==="balls"&&a.drawBall(o.position.x,o.position.y,S);else if(o.getNeighbourCount()===2&&o.forcePositioned==!0){let x=i.vertices[o.neighbours[0]].position,L=i.vertices[o.neighbours[1]].position,I=Ne.threePointangle(o.position,x,L);Math.abs(Math.PI-I)<.1&&a.drawPoint(o.position.x,o.position.y,S)}if(e){let x="v: "+o.id+" "+Pi.print(d.ringbonds);a.drawDebugText(o.position.x,o.position.y,x)}}if(r.debug)for(var n=0;n<s.length;n++){let o=s[n].center;a.drawDebugPoint(o.x,o.y,"r: "+s[n].id)}}drawWeights(e,t){if(e.every(s=>s===0))return;if(e.length!==this.preprocessor.graph.atomIdxToVertexId.length)throw new Error("The number of weights supplied must be equal to the number of (heavy) atoms in the molecule.");let r=[];for(const s of this.preprocessor.graph.atomIdxToVertexId){let a=this.preprocessor.graph.vertices[s];r.push(new Ne(a.position.x-this.svgWrapper.minX,a.position.y-this.svgWrapper.minY))}let i=new ys(r,e,this.svgWrapper.drawingWidth,this.svgWrapper.drawingHeight,this.opts.weights.sigma,this.opts.weights.interval,this.opts.weights.colormap,this.opts.weights.opacity,t);i.draw(),this.svgWrapper.addLayer(i.getSVG())}getTotalOverlapScore(){return this.preprocessor.getTotalOverlapScore()}getMolecularFormula(e=null){return this.preprocessor.getMolecularFormula(e)}multiplyNormals(e,t){e[0].multiplyScalar(t),e[1].multiplyScalar(t)}};var Lr=Ss;const As=Lr;let Cs=class{constructor(e){this.svgDrawer=new As(e)}draw(e,t,r="light",i=!1,s=[]){let a=null;typeof t=="string"||t instanceof String?a=document.getElementById(t):a=t;let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttributeNS(null,"viewBox","0 0 "+this.svgDrawer.opts.width+" "+this.svgDrawer.opts.height),n.setAttributeNS(null,"width",this.svgDrawer.opts.width+""),n.setAttributeNS(null,"height",this.svgDrawer.opts.height+""),this.svgDrawer.draw(e,n,r,i,s),this.svgDrawer.svgWrapper.toCanvas(a,this.svgDrawer.opts.width,this.svgDrawer.opts.height)}getTotalOverlapScore(){return this.svgDrawer.getTotalOverlapScore()}getMolecularFormula(){this.svgDrawer.getMolecularFormula()}};var xs=Cs,fi=function(){function q(r,i){function s(){this.constructor=r}s.prototype=i.prototype,r.prototype=new s}function e(r,i,s,a){this.message=r,this.expected=i,this.found=s,this.location=a,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)}q(e,Error),e.buildMessage=function(r,i){var s={literal:function(c){return'"'+n(c.text)+'"'},class:function(c){var b="",S;for(S=0;S<c.parts.length;S++)b+=c.parts[S]instanceof Array?u(c.parts[S][0])+"-"+u(c.parts[S][1]):u(c.parts[S]);return"["+(c.inverted?"^":"")+b+"]"},any:function(c){return"any character"},end:function(c){return"end of input"},other:function(c){return c.description}};function a(c){return c.charCodeAt(0).toString(16).toUpperCase()}function n(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}function u(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}function o(c){return s[c.type](c)}function d(c){var b=new Array(c.length),S,A;for(S=0;S<c.length;S++)b[S]=o(c[S]);if(b.sort(),b.length>0){for(S=1,A=1;S<b.length;S++)b[S-1]!==b[S]&&(b[A]=b[S],A++);b.length=A}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function g(c){return c?'"'+n(c)+'"':"end of input"}return"Expected "+d(r)+" but "+g(i)+" found."};function t(r,i){i=i!==void 0?i:{};var s=r.split("(").length-1,a=r.split(")").length-1;if(s!==a)throw yr("The number of opening parentheses does not match the number of closing parentheses.",0);var n={},u={chain:Se},o=Se,d=function(T){for(var v=[],$=[],R=0;R<T[1].length;R++)v.push(T[1][R]);for(var R=0;R<T[2].length;R++){var z=T[2][R][0]?T[2][R][0]:"-";$.push({bond:z,id:T[2][R][1]})}for(var R=0;R<T[3].length;R++)v.push(T[3][R]);for(var R=0;R<T[6].length;R++)v.push(T[6][R]);return{atom:T[0],isBracket:!!T[0].element,branches:v,branchCount:v.length,ringbonds:$,ringbondCount:$.length,bond:T[4]?T[4]:"-",next:T[5],hasNext:!!T[5]}},g="(",c=pe("(",!1),b=")",S=pe(")",!1),A=function(T){var v=T[1]?T[1]:"-";return T[2].branchBond=v,T[2]},B=function(T){return T},P=/^[\-=#$:\/\\.]/,M=nt(["-","=","#","$",":","/","\\","."],!1,!1),x=function(T){return T},L="[",I=pe("[",!1),J="se",oe=pe("se",!1),Q="as",K=pe("as",!1),j="]",be=pe("]",!1),le=function(T){return{isotope:T[1],element:T[2],chirality:T[3],hcount:T[4],charge:T[5],class:T[6]}},Re="B",Ke=pe("B",!1),ze="r",Ve=pe("r",!1),Je="C",ft=pe("C",!1),ye="l",Ee=pe("l",!1),xt=/^[NOPSFI]/,Nt=nt(["N","O","P","S","F","I"],!1,!1),vt=function(T){return T.length>1?T.join(""):T},kt=/^[bcnops]/,qt=nt(["b","c","n","o","p","s"],!1,!1),Ot="*",Z=pe("*",!1),Pe=function(T){return T},et=/^[A-Z]/,_e=nt([["A","Z"]],!1,!1),tt=/^[a-z]/,Le=nt([["a","z"]],!1,!1),qe=function(T){return T.join("")},Ye="%",zt=pe("%",!1),Qe=/^[1-9]/,De=nt([["1","9"]],!1,!1),Te=/^[0-9]/,Ie=nt([["0","9"]],!1,!1),mt=function(T){return T.length==1?Number(T):Number(T.join("").replace("%",""))},ct="@",_t=pe("@",!1),Ce="TH",Ht=pe("TH",!1),bt=/^[12]/,rt=nt(["1","2"],!1,!1),dt="AL",Rt=pe("AL",!1),Et="SP",wt=pe("SP",!1),jt=/^[1-3]/,Br=nt([["1","3"]],!1,!1),ur="TB",Pr=pe("TB",!1),er="OH",gr=pe("OH",!1),Dr=function(T){return T[1]?T[1]=="@"?"@@":T[1].join("").replace(",",""):"@"},Ir=function(T){return T},fr="+",cr=pe("+",!1),dr=function(T){return T[1]?T[1]!="+"?Number(T[1].join("")):2:1},tr="-",yt=pe("-",!1),$r=function(T){return T[1]?T[1]!="-"?-Number(T[1].join("")):-2:-1},kr="H",pr=pe("H",!1),Yt=function(T){return T[1]?Number(T[1]):1},vr=":",Or=pe(":",!1),zr=/^[0]/,Ut=nt(["0"],!1,!1),_r=function(T){return Number(T[1][0]+T[1][1].join(""))},mr=function(T){return Number(T.join(""))},m=0,Tt=[{line:1,column:1}],it=0,rr=[],Ft;if("startRule"in i){if(!(i.startRule in u))throw new Error(`Can't start parsing from rule "`+i.startRule+'".');o=u[i.startRule]}function pe(T,v){return{type:"literal",text:T,ignoreCase:v}}function nt(T,v,$){return{type:"class",parts:T,inverted:v,ignoreCase:$}}function Hr(){return{type:"end"}}function br(T){var v=Tt[T],$;if(v)return v;for($=T-1;!Tt[$];)$--;for(v=Tt[$],v={line:v.line,column:v.column};$<T;)r.charCodeAt($)===10?(v.line++,v.column=1):v.column++,$++;return Tt[T]=v,v}function wr(T,v){var $=br(T),R=br(v);return{start:{offset:T,line:$.line,column:$.column},end:{offset:v,line:R.line,column:R.column}}}function V(T){m<it||(m>it&&(it=m,rr=[]),rr.push(T))}function yr(T,v){return new e(T,null,null,v)}function ir(T,v,$){return new e(e.buildMessage(T,v),T,v,$)}function Se(){var T,v,$,R,z,F,Y,Me,He,ot;if(T=m,v=m,$=Fr(),$!==n){for(R=[],z=st();z!==n;)R.push(z),z=st();if(R!==n){for(z=[],F=m,Y=Mt(),Y===n&&(Y=null),Y!==n?(Me=Cr(),Me!==n?(Y=[Y,Me],F=Y):(m=F,F=n)):(m=F,F=n);F!==n;)z.push(F),F=m,Y=Mt(),Y===n&&(Y=null),Y!==n?(Me=Cr(),Me!==n?(Y=[Y,Me],F=Y):(m=F,F=n)):(m=F,F=n);if(z!==n){for(F=[],Y=st();Y!==n;)F.push(Y),Y=st();if(F!==n)if(Y=Mt(),Y===n&&(Y=null),Y!==n)if(Me=Se(),Me===n&&(Me=null),Me!==n){for(He=[],ot=st();ot!==n;)He.push(ot),ot=st();He!==n?($=[$,R,z,F,Y,Me,He],v=$):(m=v,v=n)}else m=v,v=n;else m=v,v=n;else m=v,v=n}else m=v,v=n}else m=v,v=n}else m=v,v=n;return v!==n&&(v=d(v)),T=v,T}function st(){var T,v,$,R,z,F;return T=m,v=m,r.charCodeAt(m)===40?($=g,m++):($=n,V(c)),$!==n?(R=Mt(),R===n&&(R=null),R!==n?(z=Se(),z!==n?(r.charCodeAt(m)===41?(F=b,m++):(F=n,V(S)),F!==n?($=[$,R,z,F],v=$):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(v=A(v)),T=v,T}function Fr(){var T,v;return T=m,v=Wr(),v===n&&(v=Sr(),v===n&&(v=Lt(),v===n&&(v=St()))),v!==n&&(v=B(v)),T=v,T}function Mt(){var T,v;if(T=m,P.test(r.charAt(m))){if(v=r.charAt(m),v===r.charAt(m+1))throw v=n,yr("The parser encountered a bond repetition.",m+1);m++}else v=n,V(M);return v!==n&&(v=x(v)),T=v,T}function Lt(){var T,v,$,R,z,F,Y,Me,He,ot;return T=m,v=m,r.charCodeAt(m)===91?($=L,m++):($=n,V(I)),$!==n?(R=nr(),R===n&&(R=null),R!==n?(r.substr(m,2)===J?(z=J,m+=2):(z=n,V(oe)),z===n&&(r.substr(m,2)===Q?(z=Q,m+=2):(z=n,V(K)),z===n&&(z=Sr(),z===n&&(z=Ar(),z===n&&(z=St())))),z!==n?(F=Xr(),F===n&&(F=null),F!==n?(Y=Ur(),Y===n&&(Y=null),Y!==n?(Me=Vr(),Me===n&&(Me=null),Me!==n?(He=Gr(),He===n&&(He=null),He!==n?(r.charCodeAt(m)===93?(ot=j,m++):(ot=n,V(be)),ot!==n?($=[$,R,z,F,Y,Me,He,ot],v=$):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(v=le(v)),T=v,T}function Wr(){var T,v,$,R;return T=m,v=m,r.charCodeAt(m)===66?($=Re,m++):($=n,V(Ke)),$!==n?(r.charCodeAt(m)===114?(R=ze,m++):(R=n,V(Ve)),R===n&&(R=null),R!==n?($=[$,R],v=$):(m=v,v=n)):(m=v,v=n),v===n&&(v=m,r.charCodeAt(m)===67?($=Je,m++):($=n,V(ft)),$!==n?(r.charCodeAt(m)===108?(R=ye,m++):(R=n,V(Ee)),R===n&&(R=null),R!==n?($=[$,R],v=$):(m=v,v=n)):(m=v,v=n),v===n&&(xt.test(r.charAt(m))?(v=r.charAt(m),m++):(v=n,V(Nt)))),v!==n&&(v=vt(v)),T=v,T}function Sr(){var T,v;return T=m,kt.test(r.charAt(m))?(v=r.charAt(m),m++):(v=n,V(qt)),v!==n&&(v=B(v)),T=v,T}function St(){var T,v;return T=m,r.charCodeAt(m)===42?(v=Ot,m++):(v=n,V(Z)),v!==n&&(v=Pe(v)),T=v,T}function Ar(){var T,v,$,R;return T=m,v=m,et.test(r.charAt(m))?($=r.charAt(m),m++):($=n,V(_e)),$!==n?(tt.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,V(Le)),R===n&&(R=null),R!==n?($=[$,R],v=$):(m=v,v=n)):(m=v,v=n),v!==n&&(v=qe(v)),T=v,T}function Cr(){var T,v,$,R,z;return T=m,v=m,r.charCodeAt(m)===37?($=Ye,m++):($=n,V(zt)),$!==n?(Qe.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,V(De)),R!==n?(Te.test(r.charAt(m))?(z=r.charAt(m),m++):(z=n,V(Ie)),z!==n?($=[$,R,z],v=$):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v===n&&(Te.test(r.charAt(m))?(v=r.charAt(m),m++):(v=n,V(Ie))),v!==n&&(v=mt(v)),T=v,T}function Xr(){var T,v,$,R,z,F,Y;return T=m,v=m,r.charCodeAt(m)===64?($=ct,m++):($=n,V(_t)),$!==n?(r.charCodeAt(m)===64?(R=ct,m++):(R=n,V(_t)),R===n&&(R=m,r.substr(m,2)===Ce?(z=Ce,m+=2):(z=n,V(Ht)),z!==n?(bt.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,V(rt)),F!==n?(z=[z,F],R=z):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,r.substr(m,2)===dt?(z=dt,m+=2):(z=n,V(Rt)),z!==n?(bt.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,V(rt)),F!==n?(z=[z,F],R=z):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,r.substr(m,2)===Et?(z=Et,m+=2):(z=n,V(wt)),z!==n?(jt.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,V(Br)),F!==n?(z=[z,F],R=z):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,r.substr(m,2)===ur?(z=ur,m+=2):(z=n,V(Pr)),z!==n?(Qe.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,V(De)),F!==n?(Te.test(r.charAt(m))?(Y=r.charAt(m),m++):(Y=n,V(Ie)),Y===n&&(Y=null),Y!==n?(z=[z,F,Y],R=z):(m=R,R=n)):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,r.substr(m,2)===er?(z=er,m+=2):(z=n,V(gr)),z!==n?(Qe.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,V(De)),F!==n?(Te.test(r.charAt(m))?(Y=r.charAt(m),m++):(Y=n,V(Ie)),Y===n&&(Y=null),Y!==n?(z=[z,F,Y],R=z):(m=R,R=n)):(m=R,R=n)):(m=R,R=n)))))),R===n&&(R=null),R!==n?($=[$,R],v=$):(m=v,v=n)):(m=v,v=n),v!==n&&(v=Dr(v)),T=v,T}function Vr(){var T,v;return T=m,v=qr(),v===n&&(v=Yr()),v!==n&&(v=Ir(v)),T=v,T}function qr(){var T,v,$,R,z,F;return T=m,v=m,r.charCodeAt(m)===43?($=fr,m++):($=n,V(cr)),$!==n?(r.charCodeAt(m)===43?(R=fr,m++):(R=n,V(cr)),R===n&&(R=m,Qe.test(r.charAt(m))?(z=r.charAt(m),m++):(z=n,V(De)),z!==n?(Te.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,V(Ie)),F===n&&(F=null),F!==n?(z=[z,F],R=z):(m=R,R=n)):(m=R,R=n)),R===n&&(R=null),R!==n?($=[$,R],v=$):(m=v,v=n)):(m=v,v=n),v!==n&&(v=dr(v)),T=v,T}function Yr(){var T,v,$,R,z,F;return T=m,v=m,r.charCodeAt(m)===45?($=tr,m++):($=n,V(yt)),$!==n?(r.charCodeAt(m)===45?(R=tr,m++):(R=n,V(yt)),R===n&&(R=m,Qe.test(r.charAt(m))?(z=r.charAt(m),m++):(z=n,V(De)),z!==n?(Te.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,V(Ie)),F===n&&(F=null),F!==n?(z=[z,F],R=z):(m=R,R=n)):(m=R,R=n)),R===n&&(R=null),R!==n?($=[$,R],v=$):(m=v,v=n)):(m=v,v=n),v!==n&&(v=$r(v)),T=v,T}function Ur(){var T,v,$,R;return T=m,v=m,r.charCodeAt(m)===72?($=kr,m++):($=n,V(pr)),$!==n?(Te.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,V(Ie)),R===n&&(R=null),R!==n?($=[$,R],v=$):(m=v,v=n)):(m=v,v=n),v!==n&&(v=Yt(v)),T=v,T}function Gr(){var T,v,$,R,z,F,Y;if(T=m,v=m,r.charCodeAt(m)===58?($=vr,m++):($=n,V(Or)),$!==n){if(R=m,Qe.test(r.charAt(m))?(z=r.charAt(m),m++):(z=n,V(De)),z!==n){for(F=[],Te.test(r.charAt(m))?(Y=r.charAt(m),m++):(Y=n,V(Ie));Y!==n;)F.push(Y),Te.test(r.charAt(m))?(Y=r.charAt(m),m++):(Y=n,V(Ie));F!==n?(z=[z,F],R=z):(m=R,R=n)}else m=R,R=n;R===n&&(zr.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,V(Ut))),R!==n?($=[$,R],v=$):(m=v,v=n)}else m=v,v=n;return v!==n&&(v=_r(v)),T=v,T}function nr(){var T,v,$,R,z;return T=m,v=m,Qe.test(r.charAt(m))?($=r.charAt(m),m++):($=n,V(De)),$!==n?(Te.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,V(Ie)),R===n&&(R=null),R!==n?(Te.test(r.charAt(m))?(z=r.charAt(m),m++):(z=n,V(Ie)),z===n&&(z=null),z!==n?($=[$,R,z],v=$):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(v=mr(v)),T=v,T}if(Ft=o(),Ft!==n&&m===r.length)return Ft;throw Ft!==n&&m<r.length&&V(Hr()),ir(rr,it<r.length?r.charAt(it):null,it<r.length?wr(it,it+1):wr(it,it))}return{SyntaxError:e,parse:t}}();const ri=fi;let Ns=class{constructor(e){this.reactantsSmiles=[],this.reagentsSmiles=[],this.productsSmiles=[],this.reactantsWeights=[],this.reagentsWeights=[],this.productsWeights=[],this.reactants=[],this.reagents=[],this.products=[];let t=e.split(">");if(t.length!==3)throw new Error("Invalid reaction SMILES. Did you add fewer than or more than two '>'?");t[0]!==""&&(this.reactantsSmiles=t[0].split(".")),t[1]!==""&&(this.reagentsSmiles=t[1].split(".")),t[2]!==""&&(this.productsSmiles=t[2].split("."));for(var r=0;r<this.reactantsSmiles.length;r++)this.reactants.push(ri.parse(this.reactantsSmiles[r]));for(var r=0;r<this.reagentsSmiles.length;r++)this.reagents.push(ri.parse(this.reagentsSmiles[r]));for(var r=0;r<this.productsSmiles.length;r++)this.products.push(ri.parse(this.productsSmiles[r]))}};var Rs=Ns;const Es=Rs;let Ts=class{static parse(e){return new Es(e)}};var Vi=Ts;const Ms={C2H4O2:"acetic acid",C3H6O:"acetone",C2H3N:"acetonitrile",C6H6:"benzene",CCl4:"carbon tetrachloride",C6H5Cl:"chlorobenzene",CHCl3:"chloroform",C6H12:"cyclohexane",C2H4Cl2:"1,2-dichloroethane",C4H10O3:"diethylene glycol",C6H14O3:"diglyme",C4H10O2:"DME",C3H7NO:"DMF",C2H6OS:"DMSO",C2H6O:"ethanol",C2H6O2:"ethylene glycol",C3H8O3:"glycerin",C7H16:"heptane",C6H18N3OP:"HMPA",C6H18N3P:"HMPT",C6H14:"hexane",CH4O:"methanol",C5H12O:"MTBE",CH2Cl2:"methylene chloride",CH5H9NO:"NMP",CH3NO2:"nitromethane",C5H12:"pentane",C5H5N:"pyridine",C7H8:"toluene",C6H15N:"triethyl amine",H2O:"water"};var Ls=Ms;const Bs=Lr,ii=gi,Ps=ui,Ds=hi,Di=Ls;let Is=class{constructor(e,t){this.defaultOptions={scale:t.scale>0?t.scale:1,fontSize:t.fontSizeLarge*.8,fontFamily:"Arial, Helvetica, sans-serif",spacing:10,plus:{size:9,thickness:1},arrow:{length:t.bondLength*4,headSize:6,thickness:1,margin:3},weights:{normalize:!1}},this.opts=Ps.extend(!0,this.defaultOptions,e),this.drawer=new Bs(t),this.molOpts=this.drawer.opts}draw(e,t,r="light",i=null,s="{reagents}",a="",n=!1){if(this.themeManager=new Ds(this.molOpts.themes,r),this.opts.weights.normalize){let P=-Number.MAX_SAFE_INTEGER,M=Number.MAX_SAFE_INTEGER;if(i.hasOwnProperty("reactants"))for(let L=0;L<i.reactants.length;L++)for(let I=0;I<i.reactants[L].length;I++)i.reactants[L][I]<M&&(M=i.reactants[L][I]),i.reactants[L][I]>P&&(P=i.reactants[L][I]);if(i.hasOwnProperty("reagents"))for(let L=0;L<i.reagents.length;L++)for(let I=0;I<i.reagents[L].length;I++)i.reagents[L][I]<M&&(M=i.reagents[L][I]),i.reagents[L][I]>P&&(P=i.reagents[L][I]);if(i.hasOwnProperty("products"))for(let L=0;L<i.products.length;L++)for(let I=0;I<i.products[L].length;I++)i.products[L][I]<M&&(M=i.products[L][I]),i.products[L][I]>P&&(P=i.products[L][I]);let x=Math.max(Math.abs(M),Math.abs(P));if(x===0&&(x=1),i.hasOwnProperty("reactants"))for(let L=0;L<i.reactants.length;L++)for(let I=0;I<i.reactants[L].length;I++)i.reactants[L][I]/=x;if(i.hasOwnProperty("reagents"))for(let L=0;L<i.reagents.length;L++)for(let I=0;I<i.reagents[L].length;I++)i.reagents[L][I]/=x;if(i.hasOwnProperty("products"))for(let L=0;L<i.products.length;L++)for(let I=0;I<i.products[L].length;I++)i.products[L][I]/=x}let u=null;for(t===null||t==="svg"?(u=document.createElementNS("http://www.w3.org/2000/svg","svg"),u.setAttribute("xmlns","http://www.w3.org/2000/svg"),u.setAttributeNS(null,"width","500"),u.setAttributeNS(null,"height","500")):typeof t=="string"||t instanceof String?u=document.getElementById(t):u=t;u.firstChild;)u.removeChild(u.firstChild);let o=[],d=0;for(var g=0;g<e.reactants.length;g++){g>0&&o.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let P=null;i&&i.hasOwnProperty("reactants")&&i.reactants.length>g&&(P=i.reactants[g]);let M=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(e.reactants[g],M,r,P,n,[],this.opts.weights.normalize);let x={width:M.viewBox.baseVal.width*this.opts.scale,height:M.viewBox.baseVal.height*this.opts.scale,svg:M};o.push(x),x.height>d&&(d=x.height)}o.push({width:this.opts.arrow.length*this.opts.scale,height:this.opts.arrow.headSize*2*this.opts.scale,svg:this.getArrow()});let c="";for(var g=0;g<e.reagents.length;g++){g>0&&(c+=", ");let M=this.drawer.getMolecularFormula(e.reagents[g]);M in Di&&(M=Di[M]),c+=ii.replaceNumbersWithSubscript(M)}s=s.replace("{reagents}",c);const b=ii.writeText(s,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale);let S=(this.opts.arrow.length*this.opts.scale-b.width)/2;o.push({svg:b.svg,height:b.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+S,offsetY:-(b.height/2)-this.opts.arrow.margin,position:"relative"});const A=ii.writeText(a,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale);S=(this.opts.arrow.length*this.opts.scale-A.width)/2,o.push({svg:A.svg,height:A.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+S,offsetY:A.height/2+this.opts.arrow.margin,position:"relative"});for(var g=0;g<e.products.length;g++){g>0&&o.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let M=null;i&&i.hasOwnProperty("products")&&i.products.length>g&&(M=i.products[g]);let x=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(e.products[g],x,r,M,n,[],this.opts.weights.normalize);let L={width:x.viewBox.baseVal.width*this.opts.scale,height:x.viewBox.baseVal.height*this.opts.scale,svg:x};o.push(L),L.height>d&&(d=L.height)}let B=0;return o.forEach(P=>{let M=P.offsetX??0,x=P.offsetY??0;P.svg.setAttributeNS(null,"x",Math.round(B+M)),P.svg.setAttributeNS(null,"y",Math.round((d-P.height)/2+x)),P.svg.setAttributeNS(null,"width",Math.round(P.width)),P.svg.setAttributeNS(null,"height",Math.round(P.height)),u.appendChild(P.svg),P.position!=="relative"&&(B+=Math.round(P.width+this.opts.spacing+M))}),u.setAttributeNS(null,"viewBox",`0 0 ${B} ${d}`),u.style.width=B+"px",u.style.height=d+"px",u}getPlus(){let e=this.opts.plus.size,t=this.opts.plus.thickness,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=document.createElementNS("http://www.w3.org/2000/svg","rect");return r.setAttributeNS(null,"id","plus"),i.setAttributeNS(null,"x",0),i.setAttributeNS(null,"y",e/2-t/2),i.setAttributeNS(null,"width",e),i.setAttributeNS(null,"height",t),i.setAttributeNS(null,"fill",this.themeManager.getColor("C")),s.setAttributeNS(null,"x",e/2-t/2),s.setAttributeNS(null,"y",0),s.setAttributeNS(null,"width",t),s.setAttributeNS(null,"height",e),s.setAttributeNS(null,"fill",this.themeManager.getColor("C")),r.appendChild(i),r.appendChild(s),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${e}`),r}getArrowhead(){let e=this.opts.arrow.headSize,t=document.createElementNS("http://www.w3.org/2000/svg","marker"),r=document.createElementNS("http://www.w3.org/2000/svg","polygon");return t.setAttributeNS(null,"id","arrowhead"),t.setAttributeNS(null,"viewBox",`0 0 ${e} ${e}`),t.setAttributeNS(null,"markerUnits","userSpaceOnUse"),t.setAttributeNS(null,"markerWidth",e),t.setAttributeNS(null,"markerHeight",e),t.setAttributeNS(null,"refX",0),t.setAttributeNS(null,"refY",e/2),t.setAttributeNS(null,"orient","auto"),t.setAttributeNS(null,"fill",this.themeManager.getColor("C")),r.setAttributeNS(null,"points",`0 0, ${e} ${e/2}, 0 ${e}`),t.appendChild(r),t}getCDArrowhead(){let e=this.opts.arrow.headSize,t=e*(7/4.5),r=document.createElementNS("http://www.w3.org/2000/svg","marker"),i=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttributeNS(null,"id","arrowhead"),r.setAttributeNS(null,"viewBox",`0 0 ${t} ${e}`),r.setAttributeNS(null,"markerUnits","userSpaceOnUse"),r.setAttributeNS(null,"markerWidth",t*2),r.setAttributeNS(null,"markerHeight",e*2),r.setAttributeNS(null,"refX",2.2),r.setAttributeNS(null,"refY",2.2),r.setAttributeNS(null,"orient","auto"),r.setAttributeNS(null,"fill",this.themeManager.getColor("C")),i.setAttributeNS(null,"style","fill-rule:nonzero;"),i.setAttributeNS(null,"d","m 0 0 l 7 2.25 l -7 2.25 c 0 0 0.735 -1.084 0.735 -2.28 c 0 -1.196 -0.735 -2.22 -0.735 -2.22 z"),r.appendChild(i),r}getArrow(){let e=this.opts.arrow.headSize,t=this.opts.arrow.length,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","defs"),s=document.createElementNS("http://www.w3.org/2000/svg","line");return i.appendChild(this.getCDArrowhead()),r.appendChild(i),r.setAttributeNS(null,"id","arrow"),s.setAttributeNS(null,"x1",0),s.setAttributeNS(null,"y1",-this.opts.arrow.thickness/2),s.setAttributeNS(null,"x2",t),s.setAttributeNS(null,"y2",-this.opts.arrow.thickness/2),s.setAttributeNS(null,"stroke-width",this.opts.arrow.thickness),s.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),s.setAttributeNS(null,"marker-end","url(#arrowhead)"),r.appendChild(s),r.setAttributeNS(null,"viewBox",`0 ${-e/2} ${t+e*(7/4.5)} ${e}`),r}};var qi=Is;const $s=fi,ks=Vi,Os=Lr,zs=qi,Ii=gi,_s=ui;let Hs=class ai{constructor(e={},t={}){this.drawer=new Os(e),this.reactionDrawer=new zs(t,JSON.parse(JSON.stringify(this.drawer.opts)))}static apply(e={},t={},r="data-smiles",i="light",s=null,a=null){new ai(e,t).apply(r,i,s,a)}apply(e="data-smiles",t="light",r=null,i=null){document.querySelectorAll(`[${e}]`).forEach(a=>{let n=a.getAttribute(e);if(n===null)throw Error("No SMILES provided.");let u=t,o=null;if(a.hasAttribute("data-smiles-theme")&&(u=a.getAttribute("data-smiles-theme")),a.hasAttribute("data-smiles-weights")&&(o=a.getAttribute("data-smiles-weights").split(",").map(parseFloat)),(a.hasAttribute("data-smiles-reactant-weights")||a.hasAttribute("data-smiles-reagent-weights")||a.hasAttribute("data-smiles-product-weights"))&&(o={reactants:[],reagents:[],products:[]},a.hasAttribute("data-smiles-reactant-weights")&&(o.reactants=a.getAttribute("data-smiles-reactant-weights").split(";").map(d=>d.split(",").map(parseFloat))),a.hasAttribute("data-smiles-reagent-weights")&&(o.reagents=a.getAttribute("data-smiles-reagent-weights").split(";").map(d=>d.split(",").map(parseFloat))),a.hasAttribute("data-smiles-product-weights")&&(o.products=a.getAttribute("data-smiles-product-weights").split(";").map(d=>d.split(",").map(parseFloat)))),a.hasAttribute("data-smiles-options")||a.hasAttribute("data-smiles-reaction-options")){let d={};a.hasAttribute("data-smiles-options")&&(d=JSON.parse(a.getAttribute("data-smiles-options").replaceAll("'",'"')));let g={};a.hasAttribute("data-smiles-reaction-options")&&(g=JSON.parse(a.getAttribute("data-smiles-reaction-options").replaceAll("'",'"'))),new ai(d,g).draw(n,a,u,r,i,o)}else this.draw(n,a,u,r,i,o)})}draw(e,t,r="light",i=null,s=null,a=null){let n=[];[e,...n]=e.split(" ");let u=n.join(" "),o={};if(u.includes("__")){let g=u.substring(u.indexOf("__")+2,u.lastIndexOf("__"));o=JSON.parse(g.replaceAll("'",'"'))}let d={textAboveArrow:"{reagents}",textBelowArrow:""};if(o=_s.extend(!0,d,o),e.includes(">"))try{this.drawReaction(e,t,r,o,a,i)}catch(g){s?s(g):console.error(g)}else try{this.drawMolecule(e,t,r,a,i)}catch(g){s?s(g):console.error(g)}}drawMolecule(e,t,r,i,s){let a=$s.parse(e);if(t===null||t==="svg"){let n=this.drawer.draw(a,null,r,i),u=this.getDimensions(n);n.setAttributeNS(null,"width",""+u.w),n.setAttributeNS(null,"height",""+u.h),s&&s(n)}else if(t==="canvas"){let n=this.svgToCanvas(this.drawer.draw(a,null,r,i));s&&s(n)}else if(t==="img"){let n=this.svgToImg(this.drawer.draw(a,null,r,i));s&&s(n)}else t instanceof HTMLImageElement?(this.svgToImg(this.drawer.draw(a,null,r,i),t),s&&s(t)):t instanceof SVGElement?(this.drawer.draw(a,t,r,i),s&&s(t)):document.querySelectorAll(t).forEach(u=>{let o=u.nodeName.toLowerCase();o==="svg"?(this.drawer.draw(a,u,r,i),s&&s(u)):o==="canvas"?(this.svgToCanvas(this.drawer.draw(a,null,r,i),u),s&&s(u)):o==="img"&&(this.svgToImg(this.drawer.draw(a,null,r,i),u),s&&s(u))})}drawReaction(e,t,r,i,s,a){let n=ks.parse(e);if(t===null||t==="svg"){let u=this.reactionDrawer.draw(n,null,r),o=this.getDimensions(u);u.setAttributeNS(null,"width",""+o.w),u.setAttributeNS(null,"height",""+o.h),a&&a(u)}else if(t==="canvas"){let u=this.svgToCanvas(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow));a&&a(u)}else if(t==="img"){let u=this.svgToImg(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow));a&&a(u)}else t instanceof HTMLImageElement?(this.svgToImg(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow),t),a&&a(t)):t instanceof SVGElement?(this.reactionDrawer.draw(n,t,r,s,i.textAboveArrow,i.textBelowArrow),a&&a(t)):document.querySelectorAll(t).forEach(o=>{let d=o.nodeName.toLowerCase();d==="svg"?(this.reactionDrawer.draw(n,o,r,s,i.textAboveArrow,i.textBelowArrow),this.reactionDrawer.opts.scale<=0&&(o.style.width=null,o.style.height=null),a&&a(o)):d==="canvas"?(this.svgToCanvas(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow),o),a&&a(o)):d==="img"&&(this.svgToImg(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow),o),a&&a(o))})}svgToCanvas(e,t=null){t===null&&(t=document.createElement("canvas"));let r=this.getDimensions(t,e);return Ii.svgToCanvas(e,t,r.w,r.h),t}svgToImg(e,t=null){t===null&&(t=document.createElement("img"));let r=this.getDimensions(t,e);return Ii.svgToImg(e,t,r.w,r.h),t}getDimensions(e,t=null){let r=this.drawer.opts.width,i=this.drawer.opts.height;return this.drawer.opts.scale<=0?(r===null&&(r=e.width),i===null&&(i=e.height),e.style.width!==""&&(r=parseInt(e.style.width)),e.style.height!==""&&(i=parseInt(e.style.height))):t&&(r=parseFloat(t.style.width),i=parseFloat(t.style.height)),{w:r,h:i}}};var Fs=Hs;const Yi=xs,Ui=fi,Gi=Vi,Ws=Lr,Xs=qi,Zi=Fs,Vs=Xi;var qs=!!(typeof window<"u"&&window.document&&window.document.createElement),Ze={Version:"1.0.0"};Ze.Drawer=Yi;Ze.Parser=Ui;Ze.SvgDrawer=Ws;Ze.ReactionDrawer=Xs;Ze.ReactionParser=Gi;Ze.GaussDrawer=Vs;Ze.clean=function(q){return q.replace(/[^A-Za-z0-9@\.\+\-\?!\(\)\[\]\{\}/\\=#\$:\*]/g,"")};Ze.apply=function(q,e="canvas[data-smiles]",t="light",r=null){let i=new Yi(q),s=document.querySelectorAll(e);for(var a=0;a<s.length;a++){let n=s[a];Ze.parse(n.getAttribute("data-smiles"),function(u){i.draw(u,n,t,!1)},function(u){r&&r(u)})}};Ze.parse=function(q,e,t){try{e&&e(Ui.parse(q))}catch(r){t&&t(r)}};Ze.parseReaction=function(q,e,t){try{e&&e(Gi.parse(q))}catch(r){t&&t(r)}};qs&&(window.SmilesDrawer=Ze,window.SmiDrawer=Zi);Ze.SmiDrawer=Zi;Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(q){if(this==null)throw new TypeError("this is null or not defined");for(var e=Object(this),t=e.length>>>0,r=arguments[1],i=r>>0,s=i<0?Math.max(t+i,0):Math.min(i,t),a=arguments[2],n=a===void 0?t:a>>0,u=n<0?Math.max(t+n,0):Math.min(n,t);s<u;)e[s]=q,s++;return e}});var Ys=Ze;const ni=Mn(Ys),Us=Ln`:host(clabs-chat-molecule){overflow:hidden}:host(clabs-chat-molecule) .clabs--chat-molecule-container{position:relative;display:flex;overflow:hidden;box-sizing:border-box;align-items:center;border:1px solid var(--cds-border-subtle-01, #c6c6c6);border-radius:8px;background:var(--cds-background, #ffffff);block-size:var(--chat-molecule-height, "auto");inline-size:var(--chat-molecule-width, "auto");min-block-size:var(--chat-molecule-height, "246px");min-inline-size:var(--chat-molecule-width, "246px")}:host(clabs-chat-molecule) .clabs--chat-molecule-target{inline-size:var(--chat-molecule-width, "auto")}:host(clabs-chat-molecule) .clabs--chat-molecule-target .element{text-shadow:var(--cds-background, #ffffff) 0 0 6px}:host(clabs-chat-molecule) .clabs--chat-molecule-target-fullscreen{block-size:100%;inline-size:100%}:host(clabs-chat-molecule) .clabs--chat-molecule-container-loader{display:flex;align-items:center;block-size:100%;inline-size:100%}:host(clabs-chat-molecule) .clabs--chat-molecule-light .element{fill:none;font-family:IBM Plex Sans,sans-serif;font-style:normal;font-weight:400}:host(clabs-chat-molecule) .clabs--chat-molecule-dark .element{fill:none;font-family:IBM Plex Sans,sans-serif;font-style:normal;font-weight:400}:host(clabs-chat-molecule) .clabs--chat-molecule-error{padding:10px;border:1px solid var(--cds-support-error, #da1e28);border-radius:8px;color:var(--cds-support-error, #da1e28);line-height:22px}:host(clabs-chat-molecule) .clabs--chat-molecule-tester{display:none;opacity:0;visibility:hidden}:host(clabs-chat-molecule) .clabs--chat-molecule-stream-text-container{position:absolute;overflow:hidden;box-sizing:border-box;font-family:IBM Plex Mono,monospace;font-size:14px;inset-block-end:8px;inset-inline:0 0;line-height:18px;padding-inline:8px;pointer-events:none}:host(clabs-chat-molecule) .clabs--chat-molecule-stream-text-content{box-sizing:border-box;color:var(--cds-text-placeholder, rgba(22, 22, 22, .4));letter-spacing:.16px;max-inline-size:100%;-ms-overflow-style:none;overflow-x:scroll;scrollbar-width:none;white-space:nowrap}:host(clabs-chat-molecule) .clabs--chat-molecule-stream-text-content::-webkit-scrollbar{display:none}:host(clabs-chat-molecule) .clabs--chat-molecule-options{position:absolute;display:flex;flex-direction:row;inset-block-start:10px;inset-inline-end:0}:host(clabs-chat-molecule) .clabs--chat-molecule-options-hidden{visibility:hidden}:host(clabs-chat-molecule) .clabs--chat-molecule-title{position:absolute;display:flex;overflow:hidden;flex-direction:row;font-family:IBM Plex Sans,system-ui,-apple-system,BlinkMacSystemFont,".SFNSText-Regular",sans-serif;font-size:16px;font-weight:600;inset-block-end:16px;inset-inline-start:16px;line-height:24px;text-overflow:ellipsis;white-space:nowrap}:host(clabs-chat-molecule) .clabs--chat-molecule-title-thumbnail{font-size:14px;font-weight:400;inset-block-end:8px;inset-inline-start:8px}:host(clabs-chat-molecule) .clabs--chat-molecule-options-prefade-dark{background:linear-gradient(to right,#16161600,#161616);block-size:32px;content:"";inline-size:30px;pointer-events:none;visibility:hidden}:host(clabs-chat-molecule) .clabs--chat-molecule-options-prefade-light{background:linear-gradient(to right,#f4f4f400,#f4f4f4);block-size:32px;content:"";inline-size:30px;pointer-events:none;visibility:hidden}:host(clabs-chat-molecule) .clabs--chat-molecule-options-buttons{display:flex;flex-direction:row;background:var(--cds-background, #ffffff);gap:4px;padding-inline-end:8px}:host(clabs-chat-molecule) .clabs--chat-molecule-fullscreen-container{position:fixed;z-index:999;display:flex;align-items:center;background:var(--cds-background, #ffffff);block-size:100%;inline-size:100%;top:0;right:0;bottom:0;left:0;visibility:var(--chat-molecule-container-visibility, "hidden")}:host(clabs-chat-molecule) .clabs--chat-molecule-fullscreen-container-close{position:fixed;z-index:9999;inset-block-start:32px;inset-inline-end:32px;pointer-events:none}`;var Gs=Object.defineProperty,we=(q,e,t,r)=>{for(var i=void 0,s=q.length-1,a;s>=0;s--)(a=q[s])&&(i=a(e,t,i)||i);return i&&Gs(e,t,i),i};const{stablePrefix:Zs}=li,ci=class ci extends Bn{constructor(){super(...arguments),this.isHovered=!1,this._invalid=!1,this.renderSuccessful=!1,this.loading=!0,this.fullscreenMode=!1,this._scaling=1,this._viewX=0,this._viewY=0}firstUpdated(){this.generateUniqueId(),this.width&&this.style.setProperty("--chat-molecule-width",this.width+"px"),this.height&&this.style.setProperty("--chat-molecule-height",this.height+"px"),this.style.setProperty("--chat-molecule-container-visibility","hidden"),this.molecularRenderer=new ni.SmiDrawer(this._buildOptions("default")),this.temporaryMolecularRenderer=new ni.SmiDrawer(this._buildOptions("default")),this.fullscreenMolecularRenderer=new ni.SmiDrawer(this._buildOptions("fullscreen")),this.theme||this._getTheme(),this.streaming||window.setTimeout(()=>{this._smilesContent=this.content,this._prepareMolecule("default")},200)}_buildOptions(e){let t=6,r=3,i=.7,s=!1,a=null,n=16,u=.18*10;const o=15;let d="default";return e==="fullscreen"?(t=5,r=3,s=!1):this.thumbNailMode&&(t=12,r=8,i=1.2,u=.18*15,s=!0,d="balls",n=8,a=1),{scale:a,compactDrawing:s,fontSizeLarge:t,fontSizeSmall:r,bondThickness:i,padding:n,bondLength:o,shortBondLength:.7,bondSpacing:u,atomVisualization:d,isomeric:!0,debug:!1,terminalCarbons:!0,explicitHydrogens:!1,overlapSensitivity:.1,overlapResolutionIterations:this.streaming?1:10,experimental:!1,themes:{dark:{C:"#c6c6c6",O:"#f45d56",N:"#33b1ff",F:"#42be65",CL:"#08bdba",BR:"#ff832b",I:"#be95ff",P:"#ff832b",S:"#fdd13a",B:"#f1c21b",SI:"#f1c21b",H:"#c6c6c6",BACKGROUND:"#161616",BONDS:"#3d3d3d"},light:{C:"#525252",O:"#da1e28",N:"#1192e8",F:"#24a148",CL:"#009d9a",BR:"#ba4e00",I:"#8a3ffc",P:"#db5b00",S:"#d6a602",B:"#c29800",SI:"#cca002",H:"#525252",BACKGROUND:"#f4f4f4",BONDS:"#e0e0e0"}}}}generateUniqueId(){const e=Math.random().toString(36).substr(2,9);this._uniqueID=e}_handleFullScreenScroll(e){e.preventDefault(),e.stopPropagation()}async updated(e){super.updated(e),e.has("content")&&this._prepareMolecule("default"),e.has("_smilesContent")&&this._scrollStreamArea(),e.has("renderSuccessful")&&(await this.checkPubChemAvailability(),this._appendCustomStyles())}_getTheme(){if(this.parentElement instanceof HTMLElement){const t=getComputedStyle(this.parentElement).getPropertyValue("--cds-background"),r=t.startsWith("#")&&parseInt(t.replace("#",""),16)<16777215/2;this.theme=r?"dark":"light"}}_zoomIn(e){var n;e.preventDefault();const t=.001,r=.5,i=3,s=Math.sign(e.deltaY)*t,a=(n=this.shadowRoot)==null?void 0:n.getElementById("clabs--chat-molecule-"+this._uniqueID);if(a instanceof SVGElement){const u=e.offsetX,o=e.offsetY,d=Math.min(i,Math.max(this._scaling-s,r));this._viewX=u-(u-this._viewX)*(d/this._scaling),this._viewY=o-(o-this._viewY)*(d/this._scaling),this._scaling=d;const g=a.querySelectorAll("g");for(const c of g)c.setAttribute("transform","translate("+this._viewY+" "+this._viewX+") scale("+this._scaling+")")}}_appendCustomStyles(){var e;{const t=(e=this.shadowRoot)==null?void 0:e.querySelectorAll("polygon");t&&t.forEach(r=>{if(r instanceof SVGPolygonElement){const i=r.getAttribute("points");if(i){const a=i.split(" ").map(S=>S.split(",").map(Number)),n=.75,[u,o]=a[0];let[d,g]=a[1],[c,b]=a[2];d=u+(d-u)*n,g=o+(g-o)*n,c=u+(c-u)*n,b=o+(b-o)*n,r.setAttribute("points",u+","+o+" "+d+","+g+" "+c+","+b)}}})}}_scrollStreamArea(){var t;const e=(t=this.shadowRoot)==null?void 0:t.querySelector(".clabs--chat-molecule-stream-text-content");e instanceof HTMLElement&&(e.scrollLeft=e.scrollWidth)}_openFullscreenView(){this.fullscreenMode=!0,this.style.setProperty("--chat-molecule-container-visibility","visible"),window.setTimeout(()=>{this._prepareMolecule("fullscreen")},200)}_closeFullscreenView(){this.fullscreenMode=!1,this.style.setProperty("--chat-molecule-container-visibility","hidden")}_handleMouseOut(){this.isHovered=!1}_handleMouseOver(){this.isHovered=!0}async _openEditorView(){this.pubChemUrl&&(window==null||window.open(this.pubChemUrl,"_blank"))}async checkPubChemAvailability(){try{const t=await(await fetch("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/smiles/"+encodeURIComponent(this.content)+"/cids/JSON")).json();if(t.IdentifierList&&t.IdentifierList.CID&&t.IdentifierList.CID.length>0){const r=t.IdentifierList.CID[0];r&&(this.pubChemUrl="https://pubchem.ncbi.nlm.nih.gov/compound/"+r)}}catch{this.pubChemUrl=null}}_exportToImage(){window.setTimeout(async()=>{var t;const e=(t=this.shadowRoot)==null?void 0:t.querySelector("#"+Zs+"--chat-molecule-"+this._uniqueID);if(e instanceof SVGElement){const r=new XMLSerializer().serializeToString(e),i=document.createElement("canvas"),s=i.getContext("2d"),a=e.getBoundingClientRect();i.height=a.height,i.width=a.width;const n=new Image;n.onload=()=>{s==null||s.drawImage(n,0,0);const u=i.toDataURL("image/png"),o=document.createElement("a"),d=this.title?this.title:"molecule";o.download=d,o.href=u,o.click()},n.src="data:image/svg+xml;base64,"+btoa(r)}},200)}_prepareMolecule(e){var u,o;this.loading=!1;let t="clabs--chat-molecule-"+this._uniqueID;const r="clabs--chat-molecule-test-"+this._uniqueID;e==="fullscreen"&&(t="clabs--chat-molecule-fullscreen-"+this._uniqueID);const i=(u=this.shadowRoot)==null?void 0:u.getElementById(t),s=(o=this.shadowRoot)==null?void 0:o.getElementById(r),a=this.content.replace(new RegExp("```","g"),"");this._smilesContent=a;let n=!1;if(i instanceof SVGElement&&s instanceof SVGElement)try{this.temporaryMolecularRenderer.draw(a,s,this.theme,()=>{n=!0,this.renderSuccessful=!0},()=>{n=!1})}catch{n=!1}if(n){if(this.streaming)if(!this.renderInProgress)this.renderInProgress=!0,this.renderInProgress=!1;else return"";e==="fullscreen"?this.fullscreenMolecularRenderer.draw(a,i,this.theme,()=>{this.renderInProgress=!1},()=>{this.renderInProgress=!1}):this.molecularRenderer.draw(a,i,this.theme,()=>{this.renderInProgress=!1},()=>{this.renderInProgress=!1}),this.requestUpdate()}return""}};ci.styles=Us;let de=ci;we([gt({type:String,attribute:"content",reflect:!0})],de.prototype,"content");we([gt({type:String,attribute:"title"})],de.prototype,"title");we([gt({type:Number,attribute:"width"})],de.prototype,"width");we([gt({type:Number,attribute:"height"})],de.prototype,"height");we([gt({type:String,attribute:"theme"})],de.prototype,"theme");we([gt({type:Boolean,attribute:"streaming"})],de.prototype,"streaming");we([gt({type:Boolean,attribute:"disable-options"})],de.prototype,"disableOptions");we([gt({type:Boolean,attribute:"disable-fullscreen"})],de.prototype,"disableFullscreen");we([gt({type:Boolean,attribute:"disable-export"})],de.prototype,"disableExport");we([gt({type:Boolean,attribute:"thumbnail-mode"})],de.prototype,"thumbNailMode");we([je()],de.prototype,"isHovered");we([gt({type:Boolean,attribute:"disable-code-inspector"})],de.prototype,"disableCodeInspector");we([je()],de.prototype,"_uniqueID");we([je()],de.prototype,"_invalid");we([je()],de.prototype,"drawer");we([je()],de.prototype,"renderSuccessful");we([je()],de.prototype,"loading");we([je()],de.prototype,"fullscreenMode");we([je()],de.prototype,"_smilesContent");we([je()],de.prototype,"_scaling");we([je()],de.prototype,"_viewX");we([je()],de.prototype,"_viewY");we([je()],de.prototype,"pubChemUrl");we([je()],de.prototype,"renderInProgress");/**
 * @license
 *
 * Copyright IBM Corp. 2023
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */const{stablePrefix:Oe}=li;function Ks(q){const{theme:e,title:t,_uniqueID:r,_smilesContent:i,streaming:s,loading:a,fullscreenMode:n,disableOptions:u,_openEditorView:o,disableFullscreen:d,_openFullscreenView:g,_closeFullscreenView:c,disableExport:b,thumbNailMode:S,_handleMouseOver:A,_handleMouseOut:B,isHovered:P,_exportToImage:M,disableCodeInspector:x,pubChemUrl:L,_handleFullScreenScroll:I}=q;return Ge`
    <div
      @mouseout="${B}"
      @mouseover="${A}"
      id="${Oe}--chat-molecule-container-id-${r}"
      class="${Oe}--chat-molecule-container ${Oe}--chat-molecule-${e}">
      ${a?Ge`
            <div class="${Oe}--chat-molecule-container-loader">
              <cds-loading></cds-loading>
            </div>
          `:""}

      <svg
        class="${Oe}--chat-molecule-target"
        id="clabs--chat-molecule-${r}"></svg>

      ${s?Ge`<div class="${Oe}--chat-molecule-stream-text-container">
            <div class="${Oe}--chat-molecule-stream-text-content">
              ${i}
            </div>
          </div>`:""}
      ${t&&!(!P&&S)?Ge`<div
            class="${Oe}--chat-molecule-title ${S?Oe+"--chat-molecule-title-thumbnail":""}">
            ${t}
          </div>`:Ge``}
      ${u||a||s?Ge``:Ge` <div
            class="${Oe}--chat-molecule-options ${S&&!P?Oe+"--chat-molecule-options-hidden":""}">
            <div class="${Oe}--chat-molecule-options-prefade-${e}">
              &nbsp;
            </div>
            <div class="${Oe}--chat-molecule-options-buttons">
              ${b?Ge``:Ge`
                    <cds-icon-button
                      kind="ghost"
                      size="sm"
                      aria-label="Export to PNG"
                      role="button"
                      align="bottom-right"
                      @click="${M}">
                      ${Rr(Pn,{slot:"icon"})}
                      <span slot="tooltip-content">Export to PNG</span>
                    </cds-icon-button>
                  `}
              ${!x&&L?Ge`
                    <cds-icon-button
                      kind="ghost"
                      size="sm"
                      aria-label="Open in PubChem"
                      role="button"
                      align="bottom-right"
                      disabled="${!L}"
                      @click="${o}">
                      ${Rr(In,{slot:"icon"})}
                      <span slot="tooltip-content">Open in PubChem</span>
                    </cds-icon-button>
                  `:Ge``}
              ${d?Ge``:Ge`
                    <cds-icon-button
                      kind="ghost"
                      aria-label="Fullscreen"
                      role="button"
                      size="sm"
                      align="bottom-right"
                      @click="${g}">
                      ${Rr(Dn,{slot:"icon"})}
                      <span slot="tooltip-content">Fullscreen</span>
                    </cds-icon-button>
                  `}
            </div>
          </div>`}
    </div>

    <div class="${Oe}--chat-molecule-tester">
      <svg id="clabs--chat-molecule-test-${r}"></svg>
    </div>

    ${n?Ge` <div
          class="${Oe}--chat-molecule-fullscreen-container-close">
          <cds-icon-button
            kind="tertiary"
            size="md"
            aria-label="Close Fullscreen"
            role="button"
            align="bottom-right"
            @click="${g}">
            ${Rr($n,{slot:"icon"})}
            <span slot="tooltip-content">Fullscreen</span>
          </cds-icon-button>
        </div>`:""}

    <div
      class="${Oe}--chat-molecule-fullscreen-container"
      @wheel="${I}"
      @click="${c}">
      <svg
        class="${Oe}--chat-molecule-target-fullscreen"
        id="clabs--chat-molecule-fullscreen-${r}"></svg>
    </div>
  `}var Js=Object.getOwnPropertyDescriptor,Qs=(q,e,t,r)=>{for(var i=r>1?void 0:r?Js(e,t):e,s=q.length-1,a;s>=0;s--)(a=q[s])&&(i=a(i)||i);return i};const{stablePrefix:js}=li;let $i=class extends de{render(){return Ks(this)}};$i=Qs([En(`${js}-chat-molecule`)],$i);
