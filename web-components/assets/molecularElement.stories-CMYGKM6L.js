import{n as gt,t as $n}from"./property-DRkoNOFH.js";import{i as Ln,r as In,x as Be}from"./lit-element-CKvUdWNz.js";import{s as oi}from"./settings-BQP9c3yA.js";import{r as je}from"./state-BaIcuqWU.js";import{c as Dn,g as kn}from"./_commonjsHelpers-Cpj98o6Y.js";import"./loading-CD7JLoL0.js";import{s as Hn,a as zn,b as _n}from"./16-BwWip7mp.js";import{s as Fn}from"./16-DIDCtVVX.js";let Wn=class ai{static clone(e){let t=Array.isArray(e)?Array():{};for(let r in e){let i=e[r];typeof i.clone=="function"?t[r]=i.clone():t[r]=typeof i=="object"?ai.clone(i):i}return t}static equals(e,t){if(e.length!==t.length)return!1;let r=e.slice().sort(),i=t.slice().sort();for(var s=0;s<r.length;s++)if(r[s]!==i[s])return!1;return!0}static print(e){if(e.length==0)return"";let t="(";for(let r=0;r<e.length;r++)t+=e[r].id?e[r].id+", ":e[r]+", ";return t=t.substring(0,t.length-2),t+")"}static each(e,t){for(let r=0;r<e.length;r++)t(e[r])}static get(e,t,r){for(let i=0;i<e.length;i++)if(e[i][t]==r)return e[i]}static contains(e,t){if(!t.property&&!t.func){for(let r=0;r<e.length;r++)if(e[r]==t.value)return!0}else if(t.func){for(let r=0;r<e.length;r++)if(t.func(e[r]))return!0}else for(let r=0;r<e.length;r++)if(e[r][t.property]==t.value)return!0;return!1}static intersection(e,t){let r=new Array;for(let i=0;i<e.length;i++)for(let s=0;s<t.length;s++)e[i]===t[s]&&r.push(e[i]);return r}static unique(e){let t={};return e.filter(function(r){return t[r]!==void 0?!1:t[r]=!0})}static count(e,t){let r=0;for(let i=0;i<e.length;i++)e[i]===t&&r++;return r}static toggle(e,t){let r=Array(),i=!1;for(let s=0;s<e.length;s++)e[s]!==t?r.push(e[s]):i=!0;return i||r.push(t),r}static remove(e,t){let r=Array();for(let i=0;i<e.length;i++)e[i]!==t&&r.push(e[i]);return r}static removeUnique(e,t){let r=e.indexOf(t);return r>-1&&e.splice(r,1),e}static removeAll(e,t){return e.filter(function(r){return t.indexOf(r)===-1})}static merge(e,t){let r=new Array(e.length+t.length);for(let i=0;i<e.length;i++)r[i]=e[i];for(let i=0;i<t.length;i++)r[e.length+i]=t[i];return r}static containsAll(e,t){let r=0;for(let i=0;i<e.length;i++)for(let s=0;s<t.length;s++)e[i]===t[s]&&r++;return r===t.length}static sortByAtomicNumberDesc(e){let t=e.map(function(r,i){return{index:i,value:r.atomicNumber.split(".").map(Number)}});return t.sort(function(r,i){let s=Math.min(i.value.length,r.value.length),a=0;for(;a<s&&i.value[a]===r.value[a];)a++;return a===s?i.value.length-r.value.length:i.value[a]-r.value[a]}),t.map(function(r){return e[r.index]})}static deepCopy(e){let t=Array();for(let r=0;r<e.length;r++){let i=e[r];i instanceof Array?t[r]=ai.deepCopy(i):t[r]=i}return t}};var hr=Wn;let Xn=class Vt{static round(e,t){return t=t||1,+(Math.round(e+"e"+t)+"e-"+t)}static meanAngle(e){let t=0,r=0;for(var i=0;i<e.length;i++)t+=Math.sin(e[i]),r+=Math.cos(e[i]);return Math.atan2(t/e.length,r/e.length)}static innerAngle(e){return Vt.toRad((e-2)*180/e)}static polyCircumradius(e,t){return e/(2*Math.sin(Math.PI/t))}static apothem(e,t){return e*Math.cos(Math.PI/t)}static apothemFromSideLength(e,t){let r=Vt.polyCircumradius(e,t);return Vt.apothem(r,t)}static centralAngle(e){return Vt.toRad(360/e)}static toDeg(e){return e*Vt.degFactor}static toRad(e){return e*Vt.radFactor}static parityOfPermutation(e){let t=new Uint8Array(e.length),r=0,i=function(a,n=0){return t[a]===1?n:(n++,t[a]=1,i(e[a],n))};for(var s=0;s<e.length;s++){if(t[s]===1)continue;let a=i(s);r+=1-a%2}return r%2?-1:1}static get radFactor(){return Math.PI/180}static get degFactor(){return 180/Math.PI}static get twoPI(){return 2*Math.PI}};var ur=Xn;let Vn=class fe{constructor(e,t){arguments.length==0?(this.x=0,this.y=0):arguments.length==1?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t)}clone(){return new fe(this.x,this.y)}toString(){return"("+this.x+","+this.y+")"}add(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}divide(e){return this.x/=e,this.y/=e,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}invert(){return this.x=-this.x,this.y=-this.y,this}angle(){return Math.atan2(this.y,this.x)}distance(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}distanceSq(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)}clockwise(e){let t=this.y*e.x,r=this.x*e.y;return t>r?-1:t===r?0:1}relativeClockwise(e,t){let r=(this.y-e.y)*(t.x-e.x),i=(this.x-e.x)*(t.y-e.y);return r>i?-1:r===i?0:1}rotate(e){let t=new fe(0,0),r=Math.cos(e),i=Math.sin(e);return t.x=this.x*r-this.y*i,t.y=this.x*i+this.y*r,this.x=t.x,this.y=t.y,this}rotateAround(e,t){let r=Math.sin(e),i=Math.cos(e);this.x-=t.x,this.y-=t.y;let s=this.x*i-this.y*r,a=this.x*r+this.y*i;return this.x=s+t.x,this.y=a+t.y,this}rotateTo(e,t,r=0){this.x+=.001,this.y-=.001;let i=fe.subtract(this,t),s=fe.subtract(e,t),a=fe.angle(s,i);return this.rotateAround(a+r,t),this}rotateAwayFrom(e,t,r){this.rotateAround(r,t);let i=this.distanceSq(e);this.rotateAround(-2*r,t),this.distanceSq(e)<i&&this.rotateAround(2*r,t)}getRotateAwayFromAngle(e,t,r){let i=this.clone();i.rotateAround(r,t);let s=i.distanceSq(e);return i.rotateAround(-2*r,t),i.distanceSq(e)<s?r:-r}getRotateTowardsAngle(e,t,r){let i=this.clone();i.rotateAround(r,t);let s=i.distanceSq(e);return i.rotateAround(-2*r,t),i.distanceSq(e)>s?r:-r}getRotateToAngle(e,t){let r=fe.subtract(this,t),i=fe.subtract(e,t),s=fe.angle(i,r);return Number.isNaN(s)?0:s}isInPolygon(e){let t=!1;for(let r=0,i=e.length-1;r<e.length;i=r++)e[r].y>this.y!=e[i].y>this.y&&this.x<(e[i].x-e[r].x)*(this.y-e[r].y)/(e[i].y-e[r].y)+e[r].x&&(t=!t);return t}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}normalize(){return this.divide(this.length()),this}normalized(){return fe.divideScalar(this,this.length())}whichSide(e,t){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}sameSideAs(e,t,r){let i=this.whichSide(e,t),s=r.whichSide(e,t);return i<0&&s<0||i==0&&s==0||i>0&&s>0}static add(e,t){return new fe(e.x+t.x,e.y+t.y)}static subtract(e,t){return new fe(e.x-t.x,e.y-t.y)}static multiply(e,t){return new fe(e.x*t.x,e.y*t.y)}static multiplyScalar(e,t){return new fe(e.x,e.y).multiplyScalar(t)}static midpoint(e,t){return new fe((e.x+t.x)/2,(e.y+t.y)/2)}static normals(e,t){let r=fe.subtract(t,e);return[new fe(-r.y,r.x),new fe(r.y,-r.x)]}static units(e,t){let r=fe.subtract(t,e);return[new fe(-r.y,r.x).normalize(),new fe(r.y,-r.x).normalize()]}static divide(e,t){return new fe(e.x/t.x,e.y/t.y)}static divideScalar(e,t){return new fe(e.x/t,e.y/t)}static dot(e,t){return e.x*t.x+e.y*t.y}static angle(e,t){let r=fe.dot(e,t);return Math.acos(r/(e.length()*t.length()))}static threePointangle(e,t,r){let i=fe.subtract(t,e),s=fe.subtract(r,t),a=e.distance(t),n=t.distance(r);return Math.acos(fe.dot(i,s)/(a*n))}static scalarProjection(e,t){let r=t.normalized();return fe.dot(e,r)}static averageDirection(e){let t=new fe(0,0);for(var r=0;r<e.length;r++){let i=e[r];t.add(i)}return t.normalize()}};var It=Vn,jr,xi;function Qt(){if(xi)return jr;xi=1;const X=ur,e=hr,t=It;Mr();class r{constructor(s,a=0,n=0){this.id=null,this.value=s,this.position=new t(a||0,n||0),this.previousPosition=new t(0,0),this.parentVertexId=null,this.children=Array(),this.spanningTreeChildren=Array(),this.edges=Array(),this.positioned=!1,this.angle=null,this.dir=1,this.neighbourCount=0,this.neighbours=Array(),this.neighbouringElements=Array(),this.forcePositioned=!1}setPosition(s,a){this.position.x=s,this.position.y=a}setPositionFromVector(s){this.position.x=s.x,this.position.y=s.y}addChild(s){this.children.push(s),this.neighbours.push(s),this.neighbourCount++}addRingbondChild(s,a){if(this.children.push(s),this.value.bracket){let n=1;this.id===0&&this.value.bracket.hcount===0&&(n=0),this.value.bracket.hcount===1&&a===0&&(n=2),this.value.bracket.hcount===1&&a===1&&(this.neighbours.length<3?n=2:n=3),this.value.bracket.hcount===null&&a===0&&(n=1),this.value.bracket.hcount===null&&a===1&&(this.neighbours.length<3?n=1:n=2),this.neighbours.splice(n,0,s)}else this.neighbours.push(s);this.neighbourCount++}setParentVertexId(s){this.neighbourCount++,this.parentVertexId=s,this.neighbours.push(s)}isTerminal(){return this.value.hasAttachedPseudoElements?!0:this.parentVertexId===null&&this.children.length<2||this.children.length===0}clone(){let s=new r(this.value,this.position.x,this.position.y);return s.id=this.id,s.previousPosition=new t(this.previousPosition.x,this.previousPosition.y),s.parentVertexId=this.parentVertexId,s.children=e.clone(this.children),s.spanningTreeChildren=e.clone(this.spanningTreeChildren),s.edges=e.clone(this.edges),s.positioned=this.positioned,s.angle=this.angle,s.forcePositioned=this.forcePositioned,s}equals(s){return this.id===s.id}getAngle(s=null,a=!1){let n=null;return s?n=t.subtract(this.position,s):n=t.subtract(this.position,this.previousPosition),a?X.toDeg(n.angle()):n.angle()}getTextDirection(s,a=!1){let n=this.getDrawnNeighbours(s),u=Array();if(s.length===1)return"right";for(let d=0;d<n.length;d++)u.push(this.getAngle(s[n[d]].position));let o=X.meanAngle(u);if(this.isTerminal()||a)Math.round(o*100)/100===1.57&&(o=o-.2),o=Math.round(Math.round(o/Math.PI)*Math.PI);else{let d=Math.PI/2;o=Math.round(Math.round(o/d)*d)}return o===2?"down":o===-2?"up":o===0||o===-0?"right":o===3||o===-3?"left":"down"}getNeighbours(s=null){if(s===null)return this.neighbours.slice();let a=Array();for(let n=0;n<this.neighbours.length;n++)this.neighbours[n]!==s&&a.push(this.neighbours[n]);return a}getDrawnNeighbours(s){let a=Array();for(let n=0;n<this.neighbours.length;n++)s[this.neighbours[n]].value.isDrawn&&a.push(this.neighbours[n]);return a}getNeighbourCount(){return this.neighbourCount}getSpanningTreeNeighbours(s=null){let a=Array();for(let n=0;n<this.spanningTreeChildren.length;n++)(s===void 0||s!=this.spanningTreeChildren[n])&&a.push(this.spanningTreeChildren[n]);return this.parentVertexId!=null&&(s===void 0||s!=this.parentVertexId)&&a.push(this.parentVertexId),a}getNextInRing(s,a,n){let u=this.getNeighbours();for(let o=0;o<u.length;o++)if(e.contains(s[u[o]].value.rings,{value:a})&&u[o]!=n)return u[o];return null}}return jr=r,jr}var ei,Ni;function Xi(){if(Ni)return ei;Ni=1,Qt(),gr();class X{constructor(t,r){this.id=null,this.firstRingId=t.id,this.secondRingId=r.id,this.vertices=new Set;for(var i=0;i<t.members.length;i++){let s=t.members[i];for(let a=0;a<r.members.length;a++){let n=r.members[a];s===n&&this.addVertex(s)}}}addVertex(t){this.vertices.add(t)}updateOther(t,r){this.firstRingId===r?this.secondRingId=t:this.firstRingId=t}containsRing(t){return this.firstRingId===t||this.secondRingId===t}isBridge(t){if(this.vertices.size>2)return!0;for(let r of this.vertices)if(t[r].value.rings.length>2)return!0;return!1}static isBridge(t,r,i,s){let a=null;for(let n=0;n<t.length;n++)if(a=t[n],a.firstRingId===i&&a.secondRingId===s||a.firstRingId===s&&a.secondRingId===i)return a.isBridge(r);return!1}static getNeighbours(t,r){let i=[];for(let s=0;s<t.length;s++){let a=t[s];a.firstRingId===r?i.push(a.secondRingId):a.secondRingId===r&&i.push(a.firstRingId)}return i}static getVertices(t,r,i){for(let s=0;s<t.length;s++){let a=t[s];if(a.firstRingId===r&&a.secondRingId===i||a.firstRingId===i&&a.secondRingId===r)return[...a.vertices]}}}return ei=X,ei}var ti,Oi;function gr(){if(Oi)return ti;Oi=1;const X=hr,e=It;Qt();const t=Xi();class r{constructor(s){this.id=null,this.members=s,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new e(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}clone(){let s=new r(this.members);return s.id=this.id,s.insiders=X.clone(this.insiders),s.neighbours=X.clone(this.neighbours),s.positioned=this.positioned,s.center=this.center.clone(),s.rings=X.clone(this.rings),s.isBridged=this.isBridged,s.isPartOfBridged=this.isPartOfBridged,s.isSpiro=this.isSpiro,s.isFused=this.isFused,s.centralAngle=this.centralAngle,s.canFlip=this.canFlip,s}getSize(){return this.members.length}getPolygon(s){let a=[];for(let n=0;n<this.members.length;n++)a.push(s[this.members[n]].position);return a}getAngle(){return Math.PI-this.centralAngle}eachMember(s,a,n,u){n=n||n===0?n:this.members[0];let o=n,d=0;for(;o!=null&&d<100;){let g=o;a(g),o=s[o].getNextInRing(s,this.id,u),u=g,o==n&&(o=null),d++}}getOrderedNeighbours(s){let a=Array(this.neighbours.length);for(let n=0;n<this.neighbours.length;n++){let u=t.getVertices(s,this.id,this.neighbours[n]);a[n]={n:u.length,neighbour:this.neighbours[n]}}return a.sort(function(n,u){return u.n-n.n}),a}isBenzeneLike(s){let a=this.getDoubleBondCount(s),n=this.members.length;return a===3&&n===6||a===2&&n===5}getDoubleBondCount(s){let a=0;for(let n=0;n<this.members.length;n++){let u=s[this.members[n]].value;(u.bondType==="="||u.branchBond==="=")&&a++}return a}contains(s){for(let a=0;a<this.members.length;a++)if(this.members[a]==s)return!0;return!1}}return ti=r,ti}var ri,Ri;function Mr(){if(Ri)return ri;Ri=1;const X=hr;Qt(),gr();class e{constructor(r,i="-"){this.idx=null,this.element=r.length===1?r.toUpperCase():r,this.drawExplicit=!1,this.ringbonds=Array(),this.rings=Array(),this.bondType=i,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=Array(),this.bridgedRing=null,this.anchoredRings=Array(),this.bracket=null,this.plane=0,this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=Array(),this.isPartOfAromaticRing=r!==this.element,this.bondCount=0,this.chirality="",this.isStereoCenter=!1,this.priority=0,this.mainChain=!1,this.hydrogenDirection="down",this.subtreeDepth=1,this.hasHydrogen=!1,this.class=void 0}addNeighbouringElement(r){this.neighbouringElements.push(r)}attachPseudoElement(r,i,s=0,a=0){s===null&&(s=0),a===null&&(a=0);let n=s+r+a;this.attachedPseudoElements[n]?this.attachedPseudoElements[n].count+=1:this.attachedPseudoElements[n]={element:r,count:1,hydrogenCount:s,previousElement:i,charge:a},this.hasAttachedPseudoElements=!0}getAttachedPseudoElements(){let r={},i=this;return Object.keys(this.attachedPseudoElements).sort().forEach(function(s){r[s]=i.attachedPseudoElements[s]}),r}getAttachedPseudoElementsCount(){return Object.keys(this.attachedPseudoElements).length}isHeteroAtom(){return this.element!=="C"&&this.element!=="H"}addAnchoredRing(r){X.contains(this.anchoredRings,{value:r})||this.anchoredRings.push(r)}getRingbondCount(){return this.ringbonds.length}backupRings(){this.originalRings=Array(this.rings.length);for(let r=0;r<this.rings.length;r++)this.originalRings[r]=this.rings[r]}restoreRings(){this.rings=Array(this.originalRings.length);for(let r=0;r<this.originalRings.length;r++)this.rings[r]=this.originalRings[r]}haveCommonRingbond(r,i){for(let s=0;s<r.ringbonds.length;s++)for(let a=0;a<i.ringbonds.length;a++)if(r.ringbonds[s].id==i.ringbonds[a].id)return!0;return!1}neighbouringElementsEqual(r){if(r.length!==this.neighbouringElements.length)return!1;r.sort(),this.neighbouringElements.sort();for(var i=0;i<this.neighbouringElements.length;i++)if(r[i]!==this.neighbouringElements[i])return!1;return!0}getAtomicNumber(){return e.atomicNumbers[this.element]}getMaxBonds(){return e.maxBonds[this.element]}static get maxBonds(){return{H:1,C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}static get atomicNumbers(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}static get mass(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}}return ri=e,ri}const Kt=It;let qn=class Vi{constructor(e=new Kt(0,0),t=new Kt(0,0),r=null,i=null,s=!1,a=!1){this.from=e,this.to=t,this.elementFrom=r,this.elementTo=i,this.chiralFrom=s,this.chiralTo=a}clone(){return new Vi(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}getLength(){return Math.sqrt(Math.pow(this.to.x-this.from.x,2)+Math.pow(this.to.y-this.from.y,2))}getAngle(){return Kt.subtract(this.getRightVector(),this.getLeftVector()).angle()}getRightVector(){return this.from.x<this.to.x?this.to:this.from}getLeftVector(){return this.from.x<this.to.x?this.from:this.to}getRightElement(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}getLeftElement(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}getRightChiral(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}getLeftChiral(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}setRightVector(e,t){return this.from.x<this.to.x?(this.to.x=e,this.to.y=t):(this.from.x=e,this.from.y=t),this}setLeftVector(e,t){return this.from.x<this.to.x?(this.from.x=e,this.from.y=t):(this.to.x=e,this.to.y=t),this}rotateToXAxis(){let e=this.getLeftVector();return this.setRightVector(e.x+this.getLength(),e.y),this}rotate(e){let t=this.getLeftVector(),r=this.getRightVector(),i=Math.sin(e),s=Math.cos(e),a=s*(r.x-t.x)-i*(r.y-t.y)+t.x,n=i*(r.x-t.x)-s*(r.y-t.y)+t.y;return this.setRightVector(a,n),this}shortenFrom(e){let t=Kt.subtract(this.to,this.from);return t.normalize(),t.multiplyScalar(e),this.from.add(t),this}shortenTo(e){let t=Kt.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e),this.to.add(t),this}shortenRight(e){return this.from.x<this.to.x?this.shortenTo(e):this.shortenFrom(e),this}shortenLeft(e){return this.from.x<this.to.x?this.shortenFrom(e):this.shortenTo(e),this}shorten(e){let t=Kt.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e/2),this.to.add(t),this.from.subtract(t),this}};var hi=qn;let Yn=class qi{constructor(e,t,r=1){this.id=null,this.sourceId=e,this.targetId=t,this.weight=r,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.wedge=""}setBondType(e){this.bondType=e,this.weight=qi.bonds[e]}static get bonds(){return{"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}};var Yi=Yn;function Un(X){return X===1?"+":X===2?"2+":X===-1?"-":X===-2?"2-":""}var Gn={getChargeText:Un};const Jt=ur,We=It;Qt();gr();const{getChargeText:Ei}=Gn;let Zn=class{constructor(e,t,r){typeof e=="string"||e instanceof String?this.canvas=document.getElementById(e):this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.themeManager=t,this.opts=r,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2,this.halfBondThickness=this.opts.bondThickness/2}updateSize(e,t){this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,this.ratio!==1?(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0)):(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio)}setTheme(e){this.colors=e}scale(e){let t=-Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,s=Number.MAX_VALUE;for(var a=0;a<e.length;a++){if(!e[a].value.isDrawn)continue;let g=e[a].position;t<g.x&&(t=g.x),r<g.y&&(r=g.y),i>g.x&&(i=g.x),s>g.y&&(s=g.y)}var n=this.opts.padding;t+=n,r+=n,i-=n,s-=n,this.drawingWidth=t-i,this.drawingHeight=r-s;var u=this.canvas.offsetWidth/this.drawingWidth,o=this.canvas.offsetHeight/this.drawingHeight,d=u<o?u:o;this.ctx.scale(d,d),this.offsetX=-i,this.offsetY=-s,u<o?this.offsetY+=this.canvas.offsetHeight/(2*d)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*d)-this.drawingWidth/2}reset(){this.ctx.setTransform(1,0,0,1,0,0)}getColor(e){return e=e.toUpperCase(),e in this.colors?this.colors[e]:this.colors.C}drawCircle(e,t,r,i,s=!0,a=!1,n=""){let u=this.ctx,o=this.offsetX,d=this.offsetY;u.save(),u.lineWidth=1.5,u.beginPath(),u.arc(e+o,t+d,r,0,Jt.twoPI,!0),u.closePath(),a?(s?(u.fillStyle="#f00",u.fill()):(u.strokeStyle="#f00",u.stroke()),this.drawDebugText(e,t,n)):s?(u.fillStyle=i,u.fill()):(u.strokeStyle=i,u.stroke()),u.restore()}drawLine(e,t=!1,r=1){let i=this.ctx,s=this.offsetX,a=this.offsetY,n=e.clone().shorten(4),u=n.getLeftVector().clone(),o=n.getRightVector().clone();u.x+=s,u.y+=a,o.x+=s,o.y+=a,t||(i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.moveTo(u.x,u.y),i.lineTo(o.x,o.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness+1.2,i.strokeStyle=this.themeManager.getColor("BACKGROUND"),i.stroke(),i.globalCompositeOperation="source-over",i.restore()),u=e.getLeftVector().clone(),o=e.getRightVector().clone(),u.x+=s,u.y+=a,o.x+=s,o.y+=a,i.save(),i.beginPath(),i.moveTo(u.x,u.y),i.lineTo(o.x,o.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness;let d=this.ctx.createLinearGradient(u.x,u.y,o.x,o.y);d.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),t&&(i.setLineDash([1,1.5]),i.lineWidth=this.opts.bondThickness/1.5),r<1&&(i.globalAlpha=r),i.strokeStyle=d,i.stroke(),i.restore()}drawWedge(e,t=1){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let r=this.ctx,i=this.offsetX,s=this.offsetY,a=e.clone().shorten(5),n=a.getLeftVector().clone(),u=a.getRightVector().clone();n.x+=i,n.y+=s,u.x+=i,u.y+=s,n=e.getLeftVector().clone(),u=e.getRightVector().clone(),n.x+=i,n.y+=s,u.x+=i,u.y+=s,r.save();let o=We.normals(n,u);o[0].normalize(),o[1].normalize();let d=e.getRightChiral(),g=n,f=u;d&&(g=u,f=n);let b=We.add(g,We.multiplyScalar(o[0],this.halfBondThickness)),y=We.add(f,We.multiplyScalar(o[0],1.5+this.halfBondThickness)),S=We.add(f,We.multiplyScalar(o[1],1.5+this.halfBondThickness)),P=We.add(g,We.multiplyScalar(o[1],this.halfBondThickness));r.beginPath(),r.moveTo(b.x,b.y),r.lineTo(y.x,y.y),r.lineTo(S.x,S.y),r.lineTo(P.x,P.y);let B=this.ctx.createRadialGradient(u.x,u.y,this.opts.bondLength,u.x,u.y,0);B.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),B.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),r.fillStyle=B,r.fill(),r.restore()}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let t=this.ctx,r=this.offsetX,i=this.offsetY,s=e.getLeftVector().clone(),a=e.getRightVector().clone();s.x+=r,s.y+=i,a.x+=r,a.y+=i,t.save();let n=We.normals(s,a);n[0].normalize(),n[1].normalize();let u=e.getRightChiral(),o,d,g,f,b=e.clone();u?(o=a,d=s,b.shortenRight(1),g=b.getRightVector().clone(),f=b.getLeftVector().clone()):(o=s,d=a,b.shortenLeft(1),g=b.getLeftVector().clone(),f=b.getRightVector().clone()),g.x+=r,g.y+=i,f.x+=r,f.y+=i;let y=We.subtract(d,o).normalize();t.strokeStyle=this.themeManager.getColor("C"),t.lineCap="round",t.lineWidth=this.opts.bondThickness,t.beginPath();let S=e.getLength(),P=1.25/(S/(this.opts.bondThickness*3)),B=!1;for(var T=0;T<1;T+=P){let x=We.multiplyScalar(y,T*S),M=We.add(o,x),L=1.5*T,J=We.multiplyScalar(n[0],L);!B&&T>.5&&(t.stroke(),t.beginPath(),t.strokeStyle=this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C"),B=!0),M.subtract(J),t.moveTo(M.x,M.y),M.add(We.multiplyScalar(J,2)),t.lineTo(M.x,M.y)}t.stroke(),t.restore()}drawDebugText(e,t,r){let i=this.ctx;i.save(),i.font="5px Droid Sans, sans-serif",i.textAlign="start",i.textBaseline="top",i.fillStyle="#ff0000",i.fillText(r,e+this.offsetX,t+this.offsetY),i.restore()}drawBall(e,t,r){let i=this.ctx;i.save(),i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,this.opts.bondLength/4.5,0,Jt.twoPI,!1),i.fillStyle=this.themeManager.getColor(r),i.fill(),i.restore()}drawPoint(e,t,r){let i=this.ctx,s=this.offsetX,a=this.offsetY;i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.arc(e+s,t+a,1.5,0,Jt.twoPI,!0),i.closePath(),i.fill(),i.globalCompositeOperation="source-over",i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,.75,0,Jt.twoPI,!1),i.fillStyle=this.themeManager.getColor(r),i.fill(),i.restore()}drawText(e,t,r,i,s,a,n,u,o,d={}){let g=this.ctx,f=this.offsetX,b=this.offsetY;g.save(),g.textAlign="start",g.textBaseline="alphabetic";let y="",S=0;n&&(y=Ei(n),g.font=this.fontSmall,S=g.measureText(y).width);let P="0",B=0;u>0&&(P=u.toString(),g.font=this.fontSmall,B=g.measureText(P).width),n===1&&r==="N"&&d.hasOwnProperty("0O")&&d.hasOwnProperty("0O-1")&&(d={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},n=0),g.font=this.fontLarge,g.fillStyle=this.themeManager.getColor("BACKGROUND");let T=g.measureText(r);T.totalWidth=T.width+S,T.height=parseInt(this.fontLarge,10);let x=T.width>this.opts.fontSizeLarge?T.width:this.opts.fontSizeLarge;x/=1.5,g.globalCompositeOperation="destination-out",g.beginPath(),g.arc(e+f,t+b,x,0,Jt.twoPI,!0),g.closePath(),g.fill(),g.globalCompositeOperation="source-over";let M=-T.width/2,L=-T.width/2;g.fillStyle=this.themeManager.getColor(r),g.fillText(r,e+f+M,t+this.opts.halfFontSizeLarge+b),M+=T.width,n&&(g.font=this.fontSmall,g.fillText(y,e+f+M,t-this.opts.fifthFontSizeSmall+b),M+=S),u>0&&(g.font=this.fontSmall,g.fillText(P,e+f+L-B,t-this.opts.fifthFontSizeSmall+b),L-=B),g.font=this.fontLarge;let J=0,oe=0;if(i===1){let Q=e+f,K=t+b+this.opts.halfFontSizeLarge;J=this.hydrogenWidth,L-=J,s==="left"?Q+=L:s==="right"||s==="up"&&a||s==="down"&&a?Q+=M:s==="up"&&!a?(K-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,Q-=this.halfHydrogenWidth):s==="down"&&!a&&(K+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,Q-=this.halfHydrogenWidth),g.fillText("H",Q,K),M+=J}else if(i>1){let Q=e+f,K=t+b+this.opts.halfFontSizeLarge;J=this.hydrogenWidth,g.font=this.fontSmall,oe=g.measureText(i).width,L-=J+oe,s==="left"?Q+=L:s==="right"||s==="up"&&a||s==="down"&&a?Q+=M:s==="up"&&!a?(K-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,Q-=this.halfHydrogenWidth):s==="down"&&!a&&(K+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,Q-=this.halfHydrogenWidth),g.font=this.fontLarge,g.fillText("H",Q,K),g.font=this.fontSmall,g.fillText(i,Q+this.halfHydrogenWidth+oe,K+this.opts.fifthFontSizeSmall),M+=J+this.halfHydrogenWidth+oe}for(let Q in d){if(!d.hasOwnProperty(Q))continue;let K=0,j=0,be=d[Q].element,le=d[Q].count,Oe=d[Q].hydrogenCount,Ke=d[Q].charge;g.font=this.fontLarge,le>1&&Oe>0&&(K=g.measureText("(").width,j=g.measureText(")").width);let ze=g.measureText(be).width,qe=0,Je="",ct=0;J=0,Oe>0&&(J=this.hydrogenWidth),g.font=this.fontSmall,le>1&&(qe=g.measureText(le).width),Ke!==0&&(Je=Ei(Ke),ct=g.measureText(Je).width),oe=0,Oe>1&&(oe=g.measureText(Oe).width),g.font=this.fontLarge;let we=e+f,Re=t+b+this.opts.halfFontSizeLarge;g.fillStyle=this.themeManager.getColor(be),le>0&&(L-=qe),le>1&&Oe>0&&(s==="left"?(L-=j,g.fillText(")",we+L,Re)):(g.fillText("(",we+M,Re),M+=K)),s==="left"?(L-=ze,g.fillText(be,we+L,Re)):(g.fillText(be,we+M,Re),M+=ze),Oe>0&&(s==="left"?(L-=J+oe,g.fillText("H",we+L,Re),Oe>1&&(g.font=this.fontSmall,g.fillText(Oe,we+L+J,Re+this.opts.fifthFontSizeSmall))):(g.fillText("H",we+M,Re),M+=J,Oe>1&&(g.font=this.fontSmall,g.fillText(Oe,we+M,Re+this.opts.fifthFontSizeSmall),M+=oe))),g.font=this.fontLarge,le>1&&Oe>0&&(s==="left"?(L-=K,g.fillText("(",we+L,Re)):(g.fillText(")",we+M,Re),M+=j)),g.font=this.fontSmall,le>1&&(s==="left"?g.fillText(le,we+L+K+j+J+oe+ze,Re+this.opts.fifthFontSizeSmall):(g.fillText(le,we+M,Re+this.opts.fifthFontSizeSmall),M+=qe)),Ke!==0&&(s==="left"?g.fillText(Je,we+L+K+j+J+oe+ze,t-this.opts.fifthFontSizeSmall+b):(g.fillText(Je,we+M,t-this.opts.fifthFontSizeSmall+b),M+=ct))}g.restore()}getChargeText(e){return e===1?"+":e===2?"2+":e===-1?"-":e===-2?"2-":""}drawDebugPoint(e,t,r="",i="#f00"){this.drawCircle(e,t,2,i,!0,!0,r)}drawAromaticityRing(e){let t=this.ctx,r=Jt.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.themeManager.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,r-this.opts.bondSpacing,0,Math.PI*2,!0),t.closePath(),t.stroke(),t.restore()}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}};var Kn=Zn;const Ti=ur,Jn=Qt(),Qn=Yi;gr();const jn=Mr();let es=class ar{constructor(e,t=!1){this.vertices=Array(),this.edges=Array(),this.atomIdxToVertexId=Array(),this.vertexIdsToEdgeId={},this.isomeric=t,this._atomIdx=0,this._time=0,this._init(e)}_init(e,t=0,r=null,i=!1){const s=e.atom.element?e.atom.element:e.atom;let a=new jn(s,e.bond);(s!=="H"||!e.hasNext&&r===null)&&(a.idx=this._atomIdx,this._atomIdx++),a.branchBond=e.branchBond,a.ringbonds=e.ringbonds,a.bracket=e.atom.element?e.atom:null,a.class=e.atom.class;let n=new Jn(a),u=this.vertices[r];if(this.addVertex(n),a.idx!==null&&this.atomIdxToVertexId.push(n.id),r!==null){n.setParentVertexId(r),n.value.addNeighbouringElement(u.value.element),u.addChild(n.id),u.value.addNeighbouringElement(a.element),u.spanningTreeChildren.push(n.id);let f=new Qn(r,n.id,1);i?(f.setBondType(n.value.branchBond||"-"),n.id,f.setBondType(n.value.branchBond||"-"),n.id):(f.setBondType(u.value.bondType||"-"),u.id),this.addEdge(f)}let o=e.ringbondCount+1;a.bracket&&(o+=a.bracket.hcount);let d=0;if(a.bracket&&a.bracket.chirality){a.isStereoCenter=!0,d=a.bracket.hcount;for(var g=0;g<d;g++)this._init({atom:"H",isBracket:"false",branches:Array(),branchCount:0,ringbonds:Array(),ringbondCount:!1,next:null,hasNext:!1,bond:"-"},g,n.id,!0)}for(var g=0;g<e.branchCount;g++)this._init(e.branches[g],g+o,n.id,!0);e.hasNext&&this._init(e.next,e.branchCount+o,n.id)}clear(){this.vertices=Array(),this.edges=Array(),this.vertexIdsToEdgeId={}}addVertex(e){return e.id=this.vertices.length,this.vertices.push(e),e.id}addEdge(e){let t=this.vertices[e.sourceId],r=this.vertices[e.targetId];return e.id=this.edges.length,this.edges.push(e),this.vertexIdsToEdgeId[e.sourceId+"_"+e.targetId]=e.id,this.vertexIdsToEdgeId[e.targetId+"_"+e.sourceId]=e.id,e.isPartOfAromaticRing=t.value.isPartOfAromaticRing&&r.value.isPartOfAromaticRing,t.value.bondCount+=e.weight,r.value.bondCount+=e.weight,t.edges.push(e.id),r.edges.push(e.id),e.id}getEdge(e,t){let r=this.vertexIdsToEdgeId[e+"_"+t];return r===void 0?null:this.edges[r]}getEdges(e){let t=Array(),r=this.vertices[e];for(var i=0;i<r.neighbours.length;i++)t.push(this.vertexIdsToEdgeId[e+"_"+r.neighbours[i]]);return t}hasEdge(e,t){return this.vertexIdsToEdgeId[e+"_"+t]!==void 0}getVertexList(){let e=[this.vertices.length];for(var t=0;t<this.vertices.length;t++)e[t]=this.vertices[t].id;return e}getEdgeList(){let e=Array(this.edges.length);for(var t=0;t<this.edges.length;t++)e[t]=[this.edges[t].sourceId,this.edges[t].targetId];return e}getAdjacencyMatrix(){let e=this.vertices.length,t=Array(e);for(var r=0;r<e;r++)t[r]=new Array(e),t[r].fill(0);for(var r=0;r<this.edges.length;r++){let s=this.edges[r];t[s.sourceId][s.targetId]=1,t[s.targetId][s.sourceId]=1}return t}getComponentsAdjacencyMatrix(){let e=this.vertices.length,t=Array(e),r=this.getBridges();for(var i=0;i<e;i++)t[i]=new Array(e),t[i].fill(0);for(var i=0;i<this.edges.length;i++){let a=this.edges[i];t[a.sourceId][a.targetId]=1,t[a.targetId][a.sourceId]=1}for(var i=0;i<r.length;i++)t[r[i][0]][r[i][1]]=0,t[r[i][1]][r[i][0]]=0;return t}getSubgraphAdjacencyMatrix(e){let t=e.length,r=Array(t);for(var i=0;i<t;i++){r[i]=new Array(t),r[i].fill(0);for(var s=0;s<t;s++)i!==s&&this.hasEdge(e[i],e[s])&&(r[i][s]=1)}return r}getDistanceMatrix(){let e=this.vertices.length,t=this.getAdjacencyMatrix(),r=Array(e);for(var i=0;i<e;i++)r[i]=Array(e),r[i].fill(1/0);for(var i=0;i<e;i++)for(var s=0;s<e;s++)t[i][s]===1&&(r[i][s]=1);for(var a=0;a<e;a++)for(var i=0;i<e;i++)for(var s=0;s<e;s++)r[i][s]>r[i][a]+r[a][s]&&(r[i][s]=r[i][a]+r[a][s]);return r}getSubgraphDistanceMatrix(e){let t=e.length,r=this.getSubgraphAdjacencyMatrix(e),i=Array(t);for(var s=0;s<t;s++)i[s]=Array(t),i[s].fill(1/0);for(var s=0;s<t;s++)for(var a=0;a<t;a++)r[s][a]===1&&(i[s][a]=1);for(var n=0;n<t;n++)for(var s=0;s<t;s++)for(var a=0;a<t;a++)i[s][a]>i[s][n]+i[n][a]&&(i[s][a]=i[s][n]+i[n][a]);return i}getAdjacencyList(){let e=this.vertices.length,t=Array(e);for(var r=0;r<e;r++){t[r]=[];for(var i=0;i<e;i++)r!==i&&this.hasEdge(this.vertices[r].id,this.vertices[i].id)&&t[r].push(i)}return t}getSubgraphAdjacencyList(e){let t=e.length,r=Array(t);for(var i=0;i<t;i++){r[i]=Array();for(var s=0;s<t;s++)i!==s&&this.hasEdge(e[i],e[s])&&r[i].push(s)}return r}getBridges(){let e=this.vertices.length,t=new Array(e),r=new Array(e),i=new Array(e),s=new Array(e),a=this.getAdjacencyList(),n=Array();t.fill(!1),s.fill(null),this._time=0;for(var u=0;u<e;u++)t[u]||this._bridgeDfs(u,t,r,i,s,a,n);return n}traverseBF(e,t){let r=this.vertices.length,i=new Array(r);i.fill(!1);for(var s=[e];s.length>0;){let n=s.shift(),u=this.vertices[n];t(u);for(var a=0;a<u.neighbours.length;a++){let o=u.neighbours[a];i[o]||(i[o]=!0,s.push(o))}}}getTreeDepth(e,t){if(e===null||t===null)return 0;let r=this.vertices[e].getSpanningTreeNeighbours(t),i=0;for(var s=0;s<r.length;s++){let a=r[s],n=this.getTreeDepth(a,e);n>i&&(i=n)}return i+1}traverseTree(e,t,r,i=999999,s=!1,a=1,n=null){if(n===null&&(n=new Uint8Array(this.vertices.length)),a>i+1||n[e]===1)return;n[e]=1;let u=this.vertices[e],o=u.getNeighbours(t);(!s||a>1)&&r(u);for(var d=0;d<o.length;d++)this.traverseTree(o[d],e,r,i,s,a+1,n)}kkLayout(e,t,r,i,s,a=.1,n=.1,u=2e3,o=50,d=1e9){let g=s;for(var f=e.length;f--;)var b=this.vertices[e[f]].neighbours.length;let y=this.getSubgraphDistanceMatrix(e),S=e.length,P=Ti.polyCircumradius(500,S),B=Ti.centralAngle(S),T=0,x=new Float32Array(S),M=new Float32Array(S),L=Array(S);for(f=S;f--;){let Z=this.vertices[e[f]];Z.positioned?(x[f]=Z.position.x,M[f]=Z.position.y):(x[f]=t.x+Math.cos(T)*P,M[f]=t.y+Math.sin(T)*P),L[f]=Z.positioned,T+=B}let J=Array(S);for(f=S;f--;){J[f]=new Array(S);for(var b=S;b--;)J[f][b]=s*y[f][b]}let oe=Array(S);for(f=S;f--;){oe[f]=Array(S);for(var b=S;b--;)oe[f][b]=g*Math.pow(y[f][b],-2)}let Q=Array(S),K=new Float32Array(S),j=new Float32Array(S);for(f=S;f--;)Q[f]=Array(S);f=S;let be,le,Oe,Ke,ze,qe,Je;for(;f--;){be=x[f],le=M[f],Oe=0,Ke=0;let Z=S;for(;Z--;)f!==Z&&(ze=x[Z],qe=M[Z],Je=1/Math.sqrt((be-ze)*(be-ze)+(le-qe)*(le-qe)),Q[f][Z]=[oe[f][Z]*(be-ze-J[f][Z]*(be-ze)*Je),oe[f][Z]*(le-qe-J[f][Z]*(le-qe)*Je)],Q[Z][f]=Q[f][Z],Oe+=Q[f][Z][0],Ke+=Q[f][Z][1]);K[f]=Oe,j[f]=Ke}let ct=function(Z){return[K[Z]*K[Z]+j[Z]*j[Z],K[Z],j[Z]]},we=function(){let Z=0,$e=0,et=0,_e=0;for(f=S;f--;){let[tt,Me,Ye]=ct(f);tt>Z&&L[f]===!1&&(Z=tt,$e=f,et=Me,_e=Ye)}return[$e,Z,et,_e]},Re=function(Z,$e,et){let _e=0,tt=0,Me=0,Ye=x[Z],Ue=M[Z],Ht=J[Z],Qe=oe[Z];for(f=S;f--;){if(f===Z)continue;let bt=x[f],rt=M[f],dt=Ht[f],Ot=Qe[f],Rt=(Ye-bt)*(Ye-bt),Ct=1/Math.pow(Rt+(Ue-rt)*(Ue-rt),1.5);_e+=Ot*(1-dt*(Ue-rt)*(Ue-rt)*Ct),tt+=Ot*(1-dt*Rt*Ct),Me+=Ot*(dt*(Ye-bt)*(Ue-rt)*Ct)}_e===0&&(_e=.1),tt===0&&(tt=.1),Me===0&&(Me=.1);let Le=$e/_e+et/Me;Le/=Me/_e-tt/Me;let Ee=-(Me*Le+$e)/_e;x[Z]+=Ee,M[Z]+=Le;let Ie=Q[Z];$e=0,et=0,Ye=x[Z],Ue=M[Z];let mt,ft,zt,Ae,_t;for(f=S;f--;)Z!==f&&(mt=x[f],ft=M[f],zt=Ie[f][0],Ae=Ie[f][1],_t=1/Math.sqrt((Ye-mt)*(Ye-mt)+(Ue-ft)*(Ue-ft)),Ee=Qe[f]*(Ye-mt-Ht[f]*(Ye-mt)*_t),Le=Qe[f]*(Ue-ft-Ht[f]*(Ue-ft)*_t),Ie[f]=[Ee,Le],$e+=Ee,et+=Le,K[f]+=Ee-zt,j[f]+=Le-Ae);K[Z]=$e,j[Z]=et},xt=0,Nt=0,vt=0,Dt=0,qt=0,kt=0;for(;d>a&&u>qt;)for(qt++,[xt,d,Nt,vt]=we(),Dt=d,kt=0;Dt>n&&o>kt;)kt++,Re(xt,Nt,vt),[Dt,Nt,vt]=ct(xt);for(f=S;f--;){let Z=e[f],$e=this.vertices[Z];$e.position.x=x[f],$e.position.y=M[f],$e.positioned=!0,$e.forcePositioned=!0}}_bridgeDfs(e,t,r,i,s,a,n){t[e]=!0,r[e]=i[e]=++this._time;for(var u=0;u<a[e].length;u++){let o=a[e][u];t[o]?o!==s[e]&&(i[e]=Math.min(i[e],r[o])):(s[o]=e,this._bridgeDfs(o,t,r,i,s,a,n),i[e]=Math.min(i[e],i[o]),i[o]>r[e]&&n.push([e,o]))}}static getConnectedComponents(e){let t=e.length,r=new Array(t),i=new Array;r.fill(!1);for(var s=0;s<t;s++)if(!r[s]){let a=Array();r[s]=!0,a.push(s),ar._ccGetDfs(s,r,e,a),a.length>1&&i.push(a)}return i}static getConnectedComponentCount(e){let t=e.length,r=new Array(t),i=0;r.fill(!1);for(var s=0;s<t;s++)r[s]||(r[s]=!0,i++,ar._ccCountDfs(s,r,e));return i}static _ccCountDfs(e,t,r){for(var i=0;i<r[e].length;i++)!r[e][i]||t[i]||e===i||(t[i]=!0,ar._ccCountDfs(i,t,r))}static _ccGetDfs(e,t,r,i){for(var s=0;s<r[e].length;s++)!r[e][s]||t[s]||e===s||(t[s]=!0,i.push(s),ar._ccGetDfs(s,t,r,i))}};var Ui=es;const ts=Ui;let rs=class at{static getRings(e,t=!1){let r=e.getComponentsAdjacencyMatrix();if(r.length===0)return null;let i=ts.getConnectedComponents(r),s=Array();for(var a=0;a<i.length;a++){let o=i[a],d=e.getSubgraphAdjacencyMatrix([...o]),g=new Uint16Array(d.length),f=new Uint16Array(d.length);for(var n=0;n<d.length;n++){f[n]=0,g[n]=0;for(var u=0;u<d[n].length;u++)g[n]+=d[n][u]}let b=0;for(var n=0;n<d.length;n++)for(var u=n+1;u<d.length;u++)b+=d[n][u];let y=b-d.length+1,S=!0;for(var n=0;n<g.length;n++)g[n]!==3&&(S=!1);if(S&&(y=2+b-d.length),y===1){s.push([...o]);continue}t&&(y=999);let{d:P,pe:B,pe_prime:T}=at.getPathIncludedDistanceMatrices(d),x=at.getRingCandidates(P,B,T),M=at.getSSSR(x,P,d,B,T,g,f,y);for(var n=0;n<M.length;n++){let J=Array(M[n].size),oe=0;for(let Q of M[n])J[oe++]=o[Q];s.push(J)}}return s}static matrixToString(e){let t="";for(var r=0;r<e.length;r++){for(var i=0;i<e[r].length;i++)t+=e[r][i]+" ";t+=`
`}return t}static getPathIncludedDistanceMatrices(e){let t=e.length,r=Array(t),i=Array(t),s=Array(t);for(var a=0,n=0,u=0,o=t;o--;){r[o]=Array(t),i[o]=Array(t),s[o]=Array(t);for(var g=t;g--;)r[o][g]=o===g||e[o][g]===1?e[o][g]:Number.POSITIVE_INFINITY,r[o][g]===1?i[o][g]=[[[o,g]]]:i[o][g]=Array(),s[o][g]=Array()}for(var d=t,g;d--;)for(o=t;o--;)for(g=t;g--;){const f=r[o][g],b=r[o][d]+r[d][g];if(f>b){var a,n,u;if(f===b+1)for(s[o][g]=[i[o][g].length],a=i[o][g].length;a--;)for(s[o][g][a]=[i[o][g][a].length],n=i[o][g][a].length;n--;)for(s[o][g][a][n]=[i[o][g][a][n].length],u=i[o][g][a][n].length;u--;)s[o][g][a][n][u]=[i[o][g][a][n][0],i[o][g][a][n][1]];else s[o][g]=Array();for(r[o][g]=b,i[o][g]=[[]],a=i[o][d][0].length;a--;)i[o][g][0].push(i[o][d][0][a]);for(a=i[d][g][0].length;a--;)i[o][g][0].push(i[d][g][0][a])}else if(f===b){if(i[o][d].length&&i[d][g].length){var a;if(i[o][g].length){let S=Array();for(a=i[o][d][0].length;a--;)S.push(i[o][d][0][a]);for(a=i[d][g][0].length;a--;)S.push(i[d][g][0][a]);i[o][g].push(S)}else{let S=Array();for(a=i[o][d][0].length;a--;)S.push(i[o][d][0][a]);for(a=i[d][g][0].length;a--;)S.push(i[d][g][0][a]);i[o][g][0]=S}}}else if(f===b-1){var a;if(s[o][g].length){let S=Array();for(a=i[o][d][0].length;a--;)S.push(i[o][d][0][a]);for(a=i[d][g][0].length;a--;)S.push(i[d][g][0][a]);s[o][g].push(S)}else{let S=Array();for(a=i[o][d][0].length;a--;)S.push(i[o][d][0][a]);for(a=i[d][g][0].length;a--;)S.push(i[d][g][0][a]);s[o][g][0]=S}}}return{d:r,pe:i,pe_prime:s}}static getRingCandidates(e,t,r){let i=e.length,s=Array(),a=0;for(let n=0;n<i;n++)for(let u=0;u<i;u++)e[n][u]===0||t[n][u].length===1&&r[n][u]===0||(r[n][u].length!==0?a=2*(e[n][u]+.5):a=2*e[n][u],a!==1/0&&s.push([a,t[n][u],r[n][u]]));return s.sort(function(n,u){return n[0]-u[0]}),s}static getSSSR(e,t,r,i,s,a,n,u){let o=Array(),d=Array();for(let f=0;f<e.length;f++)if(e[f][0]%2!==0)for(let b=0;b<e[f][2].length;b++){let y=e[f][1][0].concat(e[f][2][b]);for(var g=0;g<y.length;g++)y[g][0].constructor===Array&&(y[g]=y[g][0]);let S=at.bondsToAtoms(y);if(at.getBondCount(S,r)===S.size&&!at.pathSetsContain(o,S,y,d,a,n)&&(o.push(S),d=d.concat(y)),o.length>u)return o}else for(let b=0;b<e[f][1].length-1;b++){let y=e[f][1][b].concat(e[f][1][b+1]);for(var g=0;g<y.length;g++)y[g][0].constructor===Array&&(y[g]=y[g][0]);let S=at.bondsToAtoms(y);if(at.getBondCount(S,r)===S.size&&!at.pathSetsContain(o,S,y,d,a,n)&&(o.push(S),d=d.concat(y)),o.length>u)return o}return o}static getEdgeCount(e){let t=0,r=e.length;for(var i=r-1;i--;)for(var s=r;s--;)e[i][s]===1&&t++;return t}static getEdgeList(e){let t=e.length,r=Array();for(var i=t-1;i--;)for(var s=t;s--;)e[i][s]===1&&r.push([i,s]);return r}static bondsToAtoms(e){let t=new Set;for(var r=e.length;r--;)t.add(e[r][0]),t.add(e[r][1]);return t}static getBondCount(e,t){let r=0;for(let i of e)for(let s of e)i!==s&&(r+=t[i][s]);return r/2}static pathSetsContain(e,t,r,i,s,a){for(var n=e.length;n--;){if(at.isSupersetOf(t,e[n]))return!0;if(e[n].size===t.size&&at.areSetsEqual(e[n],t))return!0}let u=0,o=!1;for(n=r.length;n--;)for(var d=i.length;d--;)(r[n][0]===i[d][0]&&r[n][1]===i[d][1]||r[n][1]===i[d][0]&&r[n][0]===i[d][1])&&u++,u===r.length&&(o=!0);let g=!1;if(o){for(let f of t)if(a[f]<s[f]){g=!0;break}}if(o&&!g)return!0;for(let f of t)a[f]++;return!1}static areSetsEqual(e,t){if(e.size!==t.size)return!1;for(let r of e)if(!t.has(r))return!1;return!0}static isSupersetOf(e,t){for(var r of t)if(!e.has(r))return!1;return!0}};var is=rs;let ns=class{constructor(e,t){this.colors=e,this.theme=this.colors[t]}getColor(e){return e&&(e=e.toUpperCase(),e in this.theme)?this.theme[e]:this.theme.C}setTheme(e){this.colors.hasOwnProperty(e)&&(this.theme=this.colors[e])}};var ui=ns;let ss=class{static extend(){let e=this,t={},r=!1,i=0,s=arguments.length;Object.prototype.toString.call(arguments[0])==="[object Boolean]"&&(r=arguments[0],i++);let a=function(n){for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&(r&&Object.prototype.toString.call(n[u])==="[object Object]"?t[u]=e.extend(!0,t[u],n[u]):t[u]=n[u])};for(;i<s;i++){let n=arguments[i];a(n)}return t}};var gi=ss;const me=ur,pt=hr,G=It,Se=hi;Qt();const as=Yi,Er=Mr(),Mi=gr(),Tr=Xi(),ls=Kn,Pi=Ui,os=is,hs=ui,us=gi;let gs=class{constructor(e){this.graph=null,this.doubleBondConfigCount=0,this.doubleBondConfig=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,scale:0,bondThickness:1,bondLength:30,shortBondLength:.8,bondSpacing:.17*30,atomVisualization:"default",isomeric:!0,debug:!1,terminalCarbons:!1,explicitHydrogens:!0,overlapSensitivity:.42,overlapResolutionIterations:1,compactDrawing:!0,fontFamily:"Arial, Helvetica, sans-serif",fontSizeLarge:11,fontSizeSmall:3,padding:10,experimentalSSSR:!1,kkThreshold:.1,kkInnerThreshold:.1,kkMaxIteration:2e4,kkMaxInnerIteration:50,kkMaxEnergy:1e9,weights:{colormap:null,additionalPadding:20,sigma:10,interval:0,opacity:1},themes:{dark:{C:"#fff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#aaa",BACKGROUND:"#141414"},light:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666",BACKGROUND:"#fff"},oldschool:{C:"#000",O:"#000",N:"#000",F:"#000",CL:"#000",BR:"#000",I:"#000",P:"#000",S:"#000",B:"#000",SI:"#000",H:"#000",BACKGROUND:"#fff"},solarized:{C:"#586e75",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#657b83",BACKGROUND:"#fff"},"solarized-dark":{C:"#93a1a1",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#839496",BACKGROUND:"#fff"},matrix:{C:"#678c61",O:"#2fc079",N:"#4f7e7e",F:"#90d762",CL:"#82d967",BR:"#23755a",I:"#409931",P:"#c1ff8a",S:"#faff00",B:"#50b45a",SI:"#409931",H:"#426644",BACKGROUND:"#fff"},github:{C:"#24292f",O:"#cf222e",N:"#0969da",F:"#2da44e",CL:"#6fdd8b",BR:"#bc4c00",I:"#8250df",P:"#bf3989",S:"#d4a72c",B:"#fb8f44",SI:"#bc4c00",H:"#57606a",BACKGROUND:"#fff"},carbon:{C:"#161616",O:"#da1e28",N:"#0f62fe",F:"#198038",CL:"#007d79",BR:"#fa4d56",I:"#8a3ffc",P:"#ff832b",S:"#f1c21b",B:"#8a3800",SI:"#e67e22",H:"#525252",BACKGROUND:"#fff"},cyberpunk:{C:"#ea00d9",O:"#ff3131",N:"#0abdc6",F:"#00ff9f",CL:"#00fe00",BR:"#fe9f20",I:"#ff00ff",P:"#fe7f00",S:"#fcee0c",B:"#ff00ff",SI:"#ffffff",H:"#913cb1",BACKGROUND:"#fff"},gruvbox:{C:"#665c54",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#79740e",BR:"#d65d0e",I:"#b16286",P:"#af3a03",S:"#d79921",B:"#689d6a",SI:"#427b58",H:"#7c6f64",BACKGROUND:"#fbf1c7"},"gruvbox-dark":{C:"#ebdbb2",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#b8bb26",BR:"#d65d0e",I:"#b16286",P:"#fe8019",S:"#d79921",B:"#8ec07c",SI:"#83a598",H:"#bdae93",BACKGROUND:"#282828"},custom:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666",BACKGROUND:"#fff"}}},this.opts=us.extend(!0,this.defaultOptions,e),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}draw(e,t,r="light",i=!1){this.initDraw(e,r,i),this.infoOnly||(this.themeManager=new hs(this.opts.themes,r),this.canvasWrapper=new ls(t,this.themeManager,this.opts)),i||(this.processGraph(),this.canvasWrapper.scale(this.graph.vertices),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset(),this.opts.debug&&(console.log(this.graph),console.log(this.rings),console.log(this.ringConnections)))}edgeRingCount(e){let t=this.graph.edges[e],r=this.graph.vertices[t.sourceId],i=this.graph.vertices[t.targetId];return Math.min(r.value.rings.length,i.value.rings.length)}getBridgedRings(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&e.push(this.rings[t]);return e}getFusedRings(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isFused&&e.push(this.rings[t]);return e}getSpiros(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isSpiro&&e.push(this.rings[t]);return e}printRingInfo(){let e="";for(var t=0;t<this.rings.length;t++){const r=this.rings[t];e+=r.id+";",e+=r.members.length+";",e+=r.neighbours.length+";",e+=r.isSpiro?"true;":"false;",e+=r.isFused?"true;":"false;",e+=r.isBridged?"true;":"false;",e+=r.rings.length+";",e+=`
`}return e}rotateDrawing(){let e=0,t=0,r=0;for(var i=0;i<this.graph.vertices.length;i++){let n=this.graph.vertices[i];if(n.value.isDrawn)for(var s=i+1;s<this.graph.vertices.length;s++){let u=this.graph.vertices[s];if(!u.value.isDrawn)continue;let o=n.position.distanceSq(u.position);o>r&&(r=o,e=i,t=s)}}let a=-G.subtract(this.graph.vertices[e].position,this.graph.vertices[t].position).angle();if(!isNaN(a)){let n=a%.523599;n<.2617995?a=a-n:a+=.523599-n;for(var i=0;i<this.graph.vertices.length;i++)i!==t&&this.graph.vertices[i].position.rotateAround(a,this.graph.vertices[t].position);for(var i=0;i<this.rings.length;i++)this.rings[i].center.rotateAround(a,this.graph.vertices[t].position)}}getTotalOverlapScore(){return this.totalOverlapScore}getRingCount(){return this.rings.length}hasBridgedRing(){return this.bridgedRing}getHeavyAtomCount(){let e=0;for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.element!=="H"&&e++;return e}getMolecularFormula(e=null){let t="",r=new Map,i=e===null?this.graph:new Pi(e,this.opts.isomeric);for(var s=0;s<i.vertices.length;s++){let n=i.vertices[s].value;if(r.has(n.element)?r.set(n.element,r.get(n.element)+1):r.set(n.element,1),n.bracket&&!n.bracket.chirality&&(r.has("H")?r.set("H",r.get("H")+n.bracket.hcount):r.set("H",n.bracket.hcount)),!n.bracket){let u=Er.maxBonds[n.element]-n.bondCount;n.isPartOfAromaticRing&&u--,r.has("H")?r.set("H",r.get("H")+u):r.set("H",u)}}if(r.has("C")){let n=r.get("C");t+="C"+(n>1?n:""),r.delete("C")}if(r.has("H")){let n=r.get("H");t+="H"+(n>1?n:""),r.delete("H")}return Object.keys(Er.atomicNumbers).sort().map(n=>{if(r.has(n)){let u=r.get(n);t+=n+(u>1?u:"")}}),t}getRingbondType(e,t){if(e.value.getRingbondCount()<1||t.value.getRingbondCount()<1)return null;for(var r=0;r<e.value.ringbonds.length;r++)for(var i=0;i<t.value.ringbonds.length;i++)if(e.value.ringbonds[r].id===t.value.ringbonds[i].id)return e.value.ringbonds[r].bondType==="-"?t.value.ringbonds[i].bond:e.value.ringbonds[r].bond;return null}initDraw(e,t,r,i){this.data=e,this.infoOnly=r,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new Pi(e,this.opts.isomeric),this.rings=Array(),this.ringConnections=Array(),this.originalRings=Array(),this.originalRingConnections=Array(),this.bridgedRing=!1,this.doubleBondConfigCount=null,this.doubleBondConfig=null,this.highlight_atoms=i,this.initRings(),this.initHydrogens()}processGraph(){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();let e=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(var t=0;t<this.opts.overlapResolutionIterations;t++)for(var r=0;r<this.graph.edges.length;r++){let i=this.graph.edges[r];if(this.isEdgeRotatable(i)){let s=this.graph.getTreeDepth(i.sourceId,i.targetId),a=this.graph.getTreeDepth(i.targetId,i.sourceId),n=i.targetId,u=i.sourceId;if(s>a&&(n=i.sourceId,u=i.targetId),this.getSubtreeOverlapScore(u,n,e.vertexScores).value>this.opts.overlapSensitivity){let d=this.graph.vertices[n],g=this.graph.vertices[u],f=g.getNeighbours(n);if(f.length===1){let b=this.graph.vertices[f[0]],y=b.position.getRotateAwayFromAngle(d.position,g.position,me.toRad(120));this.rotateSubtree(b.id,g.id,y,g.position);let S=this.getOverlapScore().total;S>this.totalOverlapScore?this.rotateSubtree(b.id,g.id,-y,g.position):this.totalOverlapScore=S}else if(f.length===2){if(g.value.rings.length!==0&&d.value.rings.length!==0)continue;let b=this.graph.vertices[f[0]],y=this.graph.vertices[f[1]];if(b.value.rings.length===1&&y.value.rings.length===1){if(b.value.rings[0]!==y.value.rings[0])continue}else{if(b.value.rings.length!==0||y.value.rings.length!==0)continue;{let S=b.position.getRotateAwayFromAngle(d.position,g.position,me.toRad(120)),P=y.position.getRotateAwayFromAngle(d.position,g.position,me.toRad(120));this.rotateSubtree(b.id,g.id,S,g.position),this.rotateSubtree(y.id,g.id,P,g.position);let B=this.getOverlapScore().total;B>this.totalOverlapScore?(this.rotateSubtree(b.id,g.id,-S,g.position),this.rotateSubtree(y.id,g.id,-P,g.position)):this.totalOverlapScore=B}}}e=this.getOverlapScore()}}}this.resolveSecondaryOverlaps(e.scores),this.opts.isomeric&&this.annotateStereochemistry(),this.opts.compactDrawing&&this.opts.atomVisualization==="default"&&this.initPseudoElements(),this.rotateDrawing()}initRings(){let e=new Map;for(var t=this.graph.vertices.length-1;t>=0;t--){let s=this.graph.vertices[t];if(s.value.ringbonds.length!==0)for(var r=0;r<s.value.ringbonds.length;r++){let a=s.value.ringbonds[r].id,n=s.value.ringbonds[r].bond;if(!e.has(a))e.set(a,[s.id,n]);else{let u=s.id,o=e.get(a)[0],d=e.get(a)[1],g=new as(u,o,1);g.setBondType(d||n||"-");let f=this.graph.addEdge(g),b=this.graph.vertices[o];s.addRingbondChild(o,r),s.value.addNeighbouringElement(b.value.element),b.addRingbondChild(u,r),b.value.addNeighbouringElement(s.value.element),s.edges.push(f),b.edges.push(f),e.delete(a)}}}let i=os.getRings(this.graph,this.opts.experimentalSSSR);if(i!==null){for(var t=0;t<i.length;t++){let a=[...i[t]],n=this.addRing(new Mi(a));for(var r=0;r<a.length;r++)this.graph.vertices[a[r]].value.rings.push(n)}for(var t=0;t<this.rings.length-1;t++)for(var r=t+1;r<this.rings.length;r++){let n=this.rings[t],u=this.rings[r],o=new Tr(n,u);o.vertices.size>0&&this.addRingConnection(o)}for(var t=0;t<this.rings.length;t++){let a=this.rings[t];a.neighbours=Tr.getNeighbours(this.ringConnections,a.id)}for(var t=0;t<this.rings.length;t++){let a=this.rings[t];this.graph.vertices[a.members[0]].value.addAnchoredRing(a.id)}for(this.backupRingInformation();this.rings.length>0;){let s=-1;for(var t=0;t<this.rings.length;t++){let o=this.rings[t];this.isPartOfBridgedRing(o.id)&&!o.isBridged&&(s=o.id)}if(s===-1)break;let a=this.getRing(s),n=this.getBridgedRingRings(a.id);this.bridgedRing=!0,this.createBridgedRing(n,a.members[0]);for(var t=0;t<n.length;t++)this.removeRing(n[t])}}}initHydrogens(){if(!this.opts.explicitHydrogens)for(var e=0;e<this.graph.vertices.length;e++){let t=this.graph.vertices[e];if(t.value.element!=="H")continue;let r=this.graph.vertices[t.neighbours[0]];r.value.hasHydrogen=!0,(!r.value.isStereoCenter||r.value.rings.length<2&&!r.value.bridgedRing||r.value.bridgedRing&&r.value.originalRings.length<2)&&(t.value.isDrawn=!1)}}getBridgedRingRings(e){let t=Array(),r=this,i=function(s){let a=r.getRing(s);t.push(s);for(var n=0;n<a.neighbours.length;n++){let u=a.neighbours[n];t.indexOf(u)===-1&&u!==s&&Tr.isBridge(r.ringConnections,r.graph.vertices,s,u)&&i(u)}};return i(e),pt.unique(t)}isPartOfBridgedRing(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].containsRing(e)&&this.ringConnections[t].isBridge(this.graph.vertices))return!0;return!1}createBridgedRing(e,t){let r=new Set,i=new Set,s=new Set;for(var a=0;a<e.length;a++){let g=this.getRing(e[a]);g.isPartOfBridged=!0;for(var n=0;n<g.members.length;n++)i.add(g.members[n]);for(var n=0;n<g.neighbours.length;n++){let b=g.neighbours[n];e.indexOf(b)===-1&&s.add(g.neighbours[n])}}let u=new Set;for(let g of i){let f=this.graph.vertices[g],b=pt.intersection(e,f.value.rings);f.value.rings.length===1||b.length===1?r.add(f.id):u.add(f.id)}Array();let o=Array();for(let g of u){let f=this.graph.vertices[g],b=!1;for(let y=0;y<f.edges.length;y++)this.edgeRingCount(f.edges[y])===1&&(b=!0);b?(f.value.isBridgeNode=!0,r.add(f.id)):(f.value.isBridge=!0,r.add(f.id))}let d=new Mi([...r]);this.addRing(d),d.isBridged=!0,d.neighbours=[...s];for(var a=0;a<e.length;a++)d.rings.push(this.getRing(e[a]).clone());for(var a=0;a<d.members.length;a++)this.graph.vertices[d.members[a]].value.bridgedRing=d.id;for(var a=0;a<o.length;a++){let f=this.graph.vertices[o[a]];f.value.rings=Array()}for(let g of r){let f=this.graph.vertices[g];f.value.rings=pt.removeAll(f.value.rings,e),f.value.rings.push(d.id)}for(var a=0;a<e.length;a++)for(var n=a+1;n<e.length;n++)this.removeRingConnectionsBetween(e[a],e[n]);for(let g of s){let f=this.getRingConnections(g,e);for(var n=0;n<f.length;n++)this.getRingConnection(f[n]).updateOther(d.id,g);this.getRing(g).neighbours.push(d.id)}return d}areVerticesInSameRing(e,t){for(var r=0;r<e.value.rings.length;r++)for(var i=0;i<t.value.rings.length;i++)if(e.value.rings[r]===t.value.rings[i])return!0;return!1}getCommonRings(e,t){let r=Array();for(var i=0;i<e.value.rings.length;i++)for(var s=0;s<t.value.rings.length;s++)e.value.rings[i]==t.value.rings[s]&&r.push(e.value.rings[i]);return r}getLargestOrAromaticCommonRing(e,t){let r=this.getCommonRings(e,t),i=0,s=null;for(var a=0;a<r.length;a++){let n=this.getRing(r[a]),u=n.getSize();if(n.isBenzeneLike(this.graph.vertices))return n;u>i&&(i=u,s=n)}return s}getVerticesAt(e,t,r){let i=Array();for(var s=0;s<this.graph.vertices.length;s++){let a=this.graph.vertices[s];if(a.id===r||!a.positioned)continue;e.distanceSq(a.position)<=t*t&&i.push(a.id)}return i}getClosestVertex(e){let t=99999,r=null;for(var i=0;i<this.graph.vertices.length;i++){let s=this.graph.vertices[i];if(s.id===e.id)continue;let a=e.position.distanceSq(s.position);a<t&&(t=a,r=s)}return r}addRing(e){return e.id=this.ringIdCounter++,this.rings.push(e),e.id}removeRing(e){this.rings=this.rings.filter(function(r){return r.id!==e}),this.ringConnections=this.ringConnections.filter(function(r){return r.firstRingId!==e&&r.secondRingId!==e});for(var t=0;t<this.rings.length;t++){let r=this.rings[t];r.neighbours=r.neighbours.filter(function(i){return i!==e})}}getRing(e){for(var t=0;t<this.rings.length;t++)if(this.rings[t].id==e)return this.rings[t]}addRingConnection(e){return e.id=this.ringConnectionIdCounter++,this.ringConnections.push(e),e.id}removeRingConnection(e){this.ringConnections=this.ringConnections.filter(function(t){return t.id!==e})}removeRingConnectionsBetween(e,t){let r=Array();for(var i=0;i<this.ringConnections.length;i++){let s=this.ringConnections[i];(s.firstRingId===e&&s.secondRingId===t||s.firstRingId===t&&s.secondRingId===e)&&r.push(s.id)}for(var i=0;i<r.length;i++)this.removeRingConnection(r[i])}getRingConnection(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].id==e)return this.ringConnections[t]}getRingConnections(e,t){let r=Array();for(var i=0;i<this.ringConnections.length;i++){let a=this.ringConnections[i];for(var s=0;s<t.length;s++){let n=t[s];(a.firstRingId===e&&a.secondRingId===n||a.firstRingId===n&&a.secondRingId===e)&&r.push(a.id)}}return r}getOverlapScore(){let e=0,t=new Float32Array(this.graph.vertices.length);for(var r=0;r<this.graph.vertices.length;r++)t[r]=0;for(var r=0;r<this.graph.vertices.length;r++)for(var i=this.graph.vertices.length;--i>r;){let n=this.graph.vertices[r],u=this.graph.vertices[i];if(!n.value.isDrawn||!u.value.isDrawn)continue;let o=G.subtract(n.position,u.position).lengthSq();if(o<this.opts.bondLengthSq){let d=(this.opts.bondLength-Math.sqrt(o))/this.opts.bondLength;e+=d,t[r]+=d,t[i]+=d}}let s=Array();for(var r=0;r<this.graph.vertices.length;r++)s.push({id:r,score:t[r]});return s.sort(function(a,n){return n.score-a.score}),{total:e,scores:s,vertexScores:t}}chooseSide(e,t,r){let i=e.getNeighbours(t.id),s=t.getNeighbours(e.id),a=i.length,n=s.length,u=pt.merge(i,s),o=[0,0];for(var d=0;d<u.length;d++)this.graph.vertices[u[d]].position.sameSideAs(e.position,t.position,r[0])?o[0]++:o[1]++;let g=[0,0];for(var d=0;d<this.graph.vertices.length;d++)this.graph.vertices[d].position.sameSideAs(e.position,t.position,r[0])?g[0]++:g[1]++;return{totalSideCount:g,totalPosition:g[0]>g[1]?0:1,sideCount:o,position:o[0]>o[1]?0:1,anCount:a,bnCount:n}}setRingCenter(e){let t=e.getSize(),r=new G(0,0);for(var i=0;i<t;i++)r.add(this.graph.vertices[e.members[i]].position);e.center=r.divide(t)}getSubringCenter(e,t){let r=t.value.originalRings,i=e.center,s=Number.MAX_VALUE;for(var a=0;a<r.length;a++)for(var n=0;n<e.rings.length;n++)r[a]===e.rings[n].id&&e.rings[n].getSize()<s&&(i=e.rings[n].center,s=e.rings[n].getSize());return i}drawEdges(e){let t=this,r=Array(this.graph.edges.length);if(r.fill(!1),this.graph.traverseBF(0,function(s){let a=t.graph.getEdges(s.id);for(var n=0;n<a.length;n++){let u=a[n];r[u]||(r[u]=!0,t.drawEdge(u,e))}}),!this.bridgedRing)for(var i=0;i<this.rings.length;i++){let s=this.rings[i];this.isRingAromatic(s)&&this.canvasWrapper.drawAromaticityRing(s)}}drawEdge(e,t){let r=this,i=this.graph.edges[e],s=this.graph.vertices[i.sourceId],a=this.graph.vertices[i.targetId],n=s.value.element,u=a.value.element;if((!s.value.isDrawn||!a.value.isDrawn)&&this.opts.atomVisualization==="default")return;let o=s.position,d=a.position,g=this.getEdgeNormals(i),f=pt.clone(g);if(f[0].multiplyScalar(10).add(o),f[1].multiplyScalar(10).add(o),i.bondType==="="||this.getRingbondType(s,a)==="="||i.isPartOfAromaticRing&&this.bridgedRing){let b=this.areVerticesInSameRing(s,a),y=this.chooseSide(s,a,f);if(b){let P=this.getLargestOrAromaticCommonRing(s,a).center;g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let B=null;P.sameSideAs(s.position,a.position,G.add(o,g[0]))?B=new Se(G.add(o,g[0]),G.add(d,g[0]),n,u):B=new Se(G.add(o,g[1]),G.add(d,g[1]),n,u),B.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),i.isPartOfAromaticRing?this.canvasWrapper.drawLine(B,!0):this.canvasWrapper.drawLine(B),this.canvasWrapper.drawLine(new Se(o,d,n,u))}else if(i.center||s.isTerminal()&&a.isTerminal()){g[0].multiplyScalar(r.opts.halfBondSpacing),g[1].multiplyScalar(r.opts.halfBondSpacing);let S=new Se(G.add(o,g[0]),G.add(d,g[0]),n,u),P=new Se(G.add(o,g[1]),G.add(d,g[1]),n,u);this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(P)}else if(y.anCount==0&&y.bnCount>1||y.bnCount==0&&y.anCount>1){g[0].multiplyScalar(r.opts.halfBondSpacing),g[1].multiplyScalar(r.opts.halfBondSpacing);let S=new Se(G.add(o,g[0]),G.add(d,g[0]),n,u),P=new Se(G.add(o,g[1]),G.add(d,g[1]),n,u);this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(P)}else if(y.sideCount[0]>y.sideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let S=new Se(G.add(o,g[0]),G.add(d,g[0]),n,u);S.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(new Se(o,d,n,u))}else if(y.sideCount[0]<y.sideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let S=new Se(G.add(o,g[1]),G.add(d,g[1]),n,u);S.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(new Se(o,d,n,u))}else if(y.totalSideCount[0]>y.totalSideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let S=new Se(G.add(o,g[0]),G.add(d,g[0]),n,u);S.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(new Se(o,d,n,u))}else if(y.totalSideCount[0]<=y.totalSideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let S=new Se(G.add(o,g[1]),G.add(d,g[1]),n,u);S.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(new Se(o,d,n,u))}}else if(i.bondType==="#"){g[0].multiplyScalar(r.opts.bondSpacing/1.5),g[1].multiplyScalar(r.opts.bondSpacing/1.5);let b=new Se(G.add(o,g[0]),G.add(d,g[0]),n,u),y=new Se(G.add(o,g[1]),G.add(d,g[1]),n,u);this.canvasWrapper.drawLine(b),this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(new Se(o,d,n,u))}else if(i.bondType!=="."){let b=s.value.isStereoCenter,y=a.value.isStereoCenter;i.wedge==="up"?this.canvasWrapper.drawWedge(new Se(o,d,n,u,b,y)):i.wedge==="down"?this.canvasWrapper.drawDashedWedge(new Se(o,d,n,u,b,y)):this.canvasWrapper.drawLine(new Se(o,d,n,u,b,y))}if(t){let b=G.midpoint(o,d);this.canvasWrapper.drawDebugText(b.x,b.y,"e: "+e)}}drawVertices(e){for(var t=this.graph.vertices.length,t=0;t<this.graph.vertices.length;t++){let i=this.graph.vertices[t],s=i.value,a=0,n=0,u=i.value.bondCount,o=s.element,d=Er.maxBonds[o]-u,g=i.getTextDirection(this.graph.vertices),f=this.opts.terminalCarbons||o!=="C"||s.hasAttachedPseudoElements?i.isTerminal():!1,b=s.element==="C";if(s.element==="N"&&s.isPartOfAromaticRing&&(d=0),s.bracket&&(d=s.bracket.hcount,a=s.bracket.charge,n=s.bracket.isotope),this.opts.atomVisualization==="allballs")this.canvasWrapper.drawBall(i.position.x,i.position.y,o);else if(s.isDrawn&&(!b||s.drawExplicit||f||s.hasAttachedPseudoElements)||this.graph.vertices.length===1)this.opts.atomVisualization==="default"?this.canvasWrapper.drawText(i.position.x,i.position.y,o,d,g,f,a,n,this.graph.vertices.length,s.getAttachedPseudoElements()):this.opts.atomVisualization==="balls"&&this.canvasWrapper.drawBall(i.position.x,i.position.y,o);else if(i.getNeighbourCount()===2&&i.forcePositioned==!0){let y=this.graph.vertices[i.neighbours[0]].position,S=this.graph.vertices[i.neighbours[1]].position,P=G.threePointangle(i.position,y,S);Math.abs(Math.PI-P)<.1&&this.canvasWrapper.drawPoint(i.position.x,i.position.y,o)}if(e){let y="v: "+i.id+" "+pt.print(s.ringbonds);this.canvasWrapper.drawDebugText(i.position.x,i.position.y,y)}}if(this.opts.debug)for(var t=0;t<this.rings.length;t++){let i=this.rings[t].center;this.canvasWrapper.drawDebugPoint(i.x,i.y,"r: "+this.rings[t].id)}}position(){let e=null;for(var t=0;t<this.graph.vertices.length;t++)if(this.graph.vertices[t].value.bridgedRing!==null){e=this.graph.vertices[t];break}for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&(e=this.graph.vertices[this.rings[t].members[0]]);this.rings.length>0&&e===null&&(e=this.graph.vertices[this.rings[0].members[0]]),e===null&&(e=this.graph.vertices[0]),this.createNextBond(e,null,0)}backupRingInformation(){this.originalRings=Array(),this.originalRingConnections=Array();for(var e=0;e<this.rings.length;e++)this.originalRings.push(this.rings[e]);for(var e=0;e<this.ringConnections.length;e++)this.originalRingConnections.push(this.ringConnections[e]);for(var e=0;e<this.graph.vertices.length;e++)this.graph.vertices[e].value.backupRings()}restoreRingInformation(){let e=this.getBridgedRings();this.rings=Array(),this.ringConnections=Array();for(var t=0;t<e.length;t++){let i=e[t];for(var r=0;r<i.rings.length;r++){let s=i.rings[r];this.originalRings[s.id].center=s.center}}for(var t=0;t<this.originalRings.length;t++)this.rings.push(this.originalRings[t]);for(var t=0;t<this.originalRingConnections.length;t++)this.ringConnections.push(this.originalRingConnections[t]);for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.restoreRings()}createRing(e,t=null,r=null,i=null){if(e.positioned)return;t=t||new G(0,0);let s=e.getOrderedNeighbours(this.ringConnections),a=r?G.subtract(r.position,t).angle():0,n=me.polyCircumradius(this.opts.bondLength,e.getSize()),u=me.centralAngle(e.getSize());e.centralAngle=u;let o=a,d=this,g=r?r.id:null;if(e.members.indexOf(g)===-1&&(r&&(r.positioned=!1),g=e.members[0]),e.isBridged){this.graph.kkLayout(e.members.slice(),t,r.id,e,this.opts.bondLength,this.opts.kkThreshold,this.opts.kkInnerThreshold,this.opts.kkMaxIteration,this.opts.kkMaxInnerIteration,this.opts.kkMaxEnergy),e.positioned=!0,this.setRingCenter(e),t=e.center;for(var f=0;f<e.rings.length;f++)this.setRingCenter(e.rings[f])}else e.eachMember(this.graph.vertices,function(y){let S=d.graph.vertices[y];S.positioned||S.setPosition(t.x+Math.cos(o)*n,t.y+Math.sin(o)*n),o+=u,(!e.isBridged||e.rings.length<3)&&(S.angle=o,S.positioned=!0)},g,i?i.id:null);e.positioned=!0,e.center=t;for(var f=0;f<s.length;f++){let S=this.getRing(s[f].neighbour);if(S.positioned)continue;let P=Tr.getVertices(this.ringConnections,e.id,S.id);if(P.length===2){e.isFused=!0,S.isFused=!0;let B=this.graph.vertices[P[0]],T=this.graph.vertices[P[1]],x=G.midpoint(B.position,T.position),M=G.normals(B.position,T.position);M[0].normalize(),M[1].normalize();let L=me.polyCircumradius(this.opts.bondLength,S.getSize()),J=me.apothem(L,S.getSize());M[0].multiplyScalar(J).add(x),M[1].multiplyScalar(J).add(x);let oe=M[0];G.subtract(t,M[1]).lengthSq()>G.subtract(t,M[0]).lengthSq()&&(oe=M[1]);let Q=G.subtract(B.position,oe),K=G.subtract(T.position,oe);Q.clockwise(K)===-1?S.positioned||this.createRing(S,oe,B,T):S.positioned||this.createRing(S,oe,T,B)}else if(P.length===1){e.isSpiro=!0,S.isSpiro=!0;let B=this.graph.vertices[P[0]],T=G.subtract(t,B.position);T.invert(),T.normalize();let x=me.polyCircumradius(this.opts.bondLength,S.getSize());T.multiplyScalar(x),T.add(B.position),S.positioned||this.createRing(S,T,B)}}for(var f=0;f<e.members.length;f++){let S=this.graph.vertices[e.members[f]],P=S.neighbours;for(var b=0;b<P.length;b++){let B=this.graph.vertices[P[b]];B.positioned||(B.value.isConnectedToRing=!0,this.createNextBond(B,S,0))}}}rotateSubtree(e,t,r,i){let s=this;this.graph.traverseTree(e,t,function(a){a.position.rotateAround(r,i);for(var n=0;n<a.value.anchoredRings.length;n++){let u=s.rings[a.value.anchoredRings[n]];u&&u.center.rotateAround(r,i)}})}getSubtreeOverlapScore(e,t,r){let i=this,s=0,a=new G(0,0),n=0;return this.graph.traverseTree(e,t,function(u){if(!u.value.isDrawn)return;let o=r[u.id];o>i.opts.overlapSensitivity&&(s+=o,n++);let d=i.graph.vertices[u.id].position.clone();d.multiplyScalar(o),a.add(d)}),a.divide(s),{value:s/n,center:a}}getCurrentCenterOfMass(){let e=new G(0,0),t=0;for(var r=0;r<this.graph.vertices.length;r++){let i=this.graph.vertices[r];i.positioned&&(e.add(i.position),t++)}return e.divide(t)}getCurrentCenterOfMassInNeigbourhood(e,t=this.opts.bondLength*2){let r=new G(0,0),i=0,s=t*t;for(var a=0;a<this.graph.vertices.length;a++){let n=this.graph.vertices[a];n.positioned&&e.distanceSq(n.position)<s&&(r.add(n.position),i++)}return r.divide(i)}resolvePrimaryOverlaps(){let e=Array(),t=Array(this.graph.vertices.length);for(var r=0;r<this.rings.length;r++){let a=this.rings[r];for(var i=0;i<a.members.length;i++){let n=this.graph.vertices[a.members[i]];if(t[n.id])continue;t[n.id]=!0;let u=this.getNonRingNeighbours(n.id);if(u.length>1){let o=Array();for(var s=0;s<n.value.rings.length;s++)o.push(n.value.rings[s]);e.push({common:n,rings:o,vertices:u})}else if(u.length===1&&n.value.rings.length===2){let o=Array();for(var s=0;s<n.value.rings.length;s++)o.push(n.value.rings[s]);e.push({common:n,rings:o,vertices:u})}}}for(var r=0;r<e.length;r++){let n=e[r];if(n.vertices.length===2){let u=n.vertices[0],o=n.vertices[1];if(!u.value.isDrawn||!o.value.isDrawn)continue;let d=(2*Math.PI-this.getRing(n.rings[0]).getAngle())/6;this.rotateSubtree(u.id,n.common.id,d,n.common.position),this.rotateSubtree(o.id,n.common.id,-d,n.common.position);let g=this.getOverlapScore(),f=this.getSubtreeOverlapScore(u.id,n.common.id,g.vertexScores),b=this.getSubtreeOverlapScore(o.id,n.common.id,g.vertexScores),y=f.value+b.value;this.rotateSubtree(u.id,n.common.id,-2*d,n.common.position),this.rotateSubtree(o.id,n.common.id,2*d,n.common.position),g=this.getOverlapScore(),f=this.getSubtreeOverlapScore(u.id,n.common.id,g.vertexScores),b=this.getSubtreeOverlapScore(o.id,n.common.id,g.vertexScores),f.value+b.value>y&&(this.rotateSubtree(u.id,n.common.id,2*d,n.common.position),this.rotateSubtree(o.id,n.common.id,-2*d,n.common.position))}else n.vertices.length===1&&n.rings.length}}resolveSecondaryOverlaps(e){for(var t=0;t<e.length;t++)if(e[t].score>this.opts.overlapSensitivity){let r=this.graph.vertices[e[t].id];if(r.isTerminal()){let i=this.getClosestVertex(r);if(i){let s=null;i.isTerminal()?s=i.id===0?this.graph.vertices[1].position:i.previousPosition:s=i.id===0?this.graph.vertices[1].position:i.position;let a=r.id===0?this.graph.vertices[1].position:r.previousPosition;r.position.rotateAwayFrom(s,a,me.toRad(20))}}}}getLastVertexWithAngle(e){let t=0,r=null;for(;!t&&e;)r=this.graph.vertices[e],t=r.angle,e=r.parentVertexId;return r}createNextBond(e,t=null,r=0,i=!1,s=!1){if(e.positioned&&!s)return;let a=!1;if(t){let u=this.graph.getEdge(e.id,t.id);(u.bondType==="/"||u.bondType==="\\")&&++this.doubleBondConfigCount%2===1&&this.doubleBondConfig===null&&(this.doubleBondConfig=u.bondType,a=!0,t.parentVertexId===null&&e.value.branchBond&&(this.doubleBondConfig==="/"?this.doubleBondConfig="\\":this.doubleBondConfig==="\\"&&(this.doubleBondConfig="/")))}if(!s)if(t)if(t.value.rings.length>0){let u=t.neighbours,o=null,d=new G(0,0);if(t.value.bridgedRing===null&&t.value.rings.length>1)for(var n=0;n<u.length;n++){let g=this.graph.vertices[u[n]];if(pt.containsAll(g.value.rings,t.value.rings)){o=g;break}}if(o===null){for(var n=0;n<u.length;n++){let f=this.graph.vertices[u[n]];f.positioned&&this.areVerticesInSameRing(f,t)&&d.add(G.subtract(f.position,t.position))}d.invert().normalize().multiplyScalar(this.opts.bondLength).add(t.position)}else d=o.position.clone().rotateAround(Math.PI,t.position);e.previousPosition=t.position,e.setPositionFromVector(d),e.positioned=!0}else{let u=new G(this.opts.bondLength,0);u.rotate(r),u.add(t.position),e.setPositionFromVector(u),e.previousPosition=t.position,e.positioned=!0}else{let u=new G(this.opts.bondLength,0);u.rotate(me.toRad(-60)),e.previousPosition=u,e.setPosition(this.opts.bondLength,0),e.angle=me.toRad(-60),e.value.bridgedRing===null&&(e.positioned=!0)}if(e.value.bridgedRing!==null){let u=this.getRing(e.value.bridgedRing);if(!u.positioned){let o=G.subtract(e.previousPosition,e.position);o.invert(),o.normalize();let d=me.polyCircumradius(this.opts.bondLength,u.members.length);o.multiplyScalar(d),o.add(e.position),this.createRing(u,o,e)}}else if(e.value.rings.length>0){let u=this.getRing(e.value.rings[0]);if(!u.positioned){let o=G.subtract(e.previousPosition,e.position);o.invert(),o.normalize();let d=me.polyCircumradius(this.opts.bondLength,u.getSize());o.multiplyScalar(d),o.add(e.position),this.createRing(u,o,e)}}else{e.value.isStereoCenter;let u=e.getNeighbours(),o=Array();for(var n=0;n<u.length;n++)this.graph.vertices[u[n]].value.isDrawn&&o.push(u[n]);t&&(o=pt.remove(o,t.id));let d=e.getAngle();if(o.length===1){let g=this.graph.vertices[o[0]];if(e.value.bondType==="#"||t&&t.value.bondType==="#"||e.value.bondType==="="&&t&&t.value.rings.length===0&&t.value.bondType==="="&&e.value.branchBond!=="-"){if(e.value.drawExplicit=!1,t){let b=this.graph.getEdge(e.id,t.id);b.center=!0}let f=this.graph.getEdge(e.id,g.id);f.center=!0,(e.value.bondType==="#"||t&&t.value.bondType==="#")&&(g.angle=0),g.drawExplicit=!0,this.createNextBond(g,e,d+g.angle)}else if(t&&t.value.rings.length>0){let f=me.toRad(60),b=-f,y=new G(this.opts.bondLength,0),S=new G(this.opts.bondLength,0);y.rotate(f).add(e.position),S.rotate(b).add(e.position);let P=this.getCurrentCenterOfMass(),B=y.distanceSq(P),T=S.distanceSq(P);g.angle=B<T?b:f,this.createNextBond(g,e,d+g.angle)}else{let f=e.angle;if(t&&t.neighbours.length>3?f>0?f=Math.min(1.0472,f):f<0?f=Math.max(-1.0472,f):f=1.0472:f||(f=this.getLastVertexWithAngle(e.id).angle,f||(f=1.0472)),t&&!a){let b=this.graph.getEdge(e.id,g.id).bondType;b==="/"?(this.doubleBondConfig==="/"||this.doubleBondConfig==="\\"&&(f=-f),this.doubleBondConfig=null):b==="\\"&&(this.doubleBondConfig==="/"?f=-f:this.doubleBondConfig,this.doubleBondConfig=null)}i?g.angle=f:g.angle=-f,this.createNextBond(g,e,d+g.angle)}}else if(o.length===2){let g=e.angle;g||(g=1.0472);let f=this.graph.getTreeDepth(o[0],e.id),b=this.graph.getTreeDepth(o[1],e.id),y=this.graph.vertices[o[0]],S=this.graph.vertices[o[1]];y.value.subtreeDepth=f,S.value.subtreeDepth=b;let P=this.graph.getTreeDepth(t?t.id:null,e.id);t&&(t.value.subtreeDepth=P);let B=0,T=1;S.value.element==="C"&&y.value.element!=="C"&&b>1&&f<5?(B=1,T=0):S.value.element!=="C"&&y.value.element==="C"&&f>1&&b<5?(B=0,T=1):b>f&&(B=1,T=0);let x=this.graph.vertices[o[B]],M=this.graph.vertices[o[T]];this.graph.getEdge(e.id,x.id),this.graph.getEdge(e.id,M.id);let L=!1;P<f&&P<b&&(L=!0),M.angle=g,x.angle=-g,this.doubleBondConfig==="\\"?M.value.branchBond==="\\"&&(M.angle=-g,x.angle=g):this.doubleBondConfig==="/"&&M.value.branchBond==="/"&&(M.angle=-g,x.angle=g),this.createNextBond(M,e,d+M.angle,L),this.createNextBond(x,e,d+x.angle,L)}else if(o.length===3){let g=this.graph.getTreeDepth(o[0],e.id),f=this.graph.getTreeDepth(o[1],e.id),b=this.graph.getTreeDepth(o[2],e.id),y=this.graph.vertices[o[0]],S=this.graph.vertices[o[1]],P=this.graph.vertices[o[2]];y.value.subtreeDepth=g,S.value.subtreeDepth=f,P.value.subtreeDepth=b,f>g&&f>b?(y=this.graph.vertices[o[1]],S=this.graph.vertices[o[0]],P=this.graph.vertices[o[2]]):b>g&&b>f&&(y=this.graph.vertices[o[2]],S=this.graph.vertices[o[0]],P=this.graph.vertices[o[1]]),t&&t.value.rings.length<1&&y.value.rings.length<1&&S.value.rings.length<1&&P.value.rings.length<1&&this.graph.getTreeDepth(S.id,e.id)===1&&this.graph.getTreeDepth(P.id,e.id)===1&&this.graph.getTreeDepth(y.id,e.id)>1?(y.angle=-e.angle,e.angle>=0?(S.angle=me.toRad(30),P.angle=me.toRad(90)):(S.angle=-me.toRad(30),P.angle=-me.toRad(90)),this.createNextBond(y,e,d+y.angle),this.createNextBond(S,e,d+S.angle),this.createNextBond(P,e,d+P.angle)):(y.angle=0,S.angle=me.toRad(90),P.angle=-me.toRad(90),this.createNextBond(y,e,d+y.angle),this.createNextBond(S,e,d+S.angle),this.createNextBond(P,e,d+P.angle))}else if(o.length===4){let g=this.graph.getTreeDepth(o[0],e.id),f=this.graph.getTreeDepth(o[1],e.id),b=this.graph.getTreeDepth(o[2],e.id),y=this.graph.getTreeDepth(o[3],e.id),S=this.graph.vertices[o[0]],P=this.graph.vertices[o[1]],B=this.graph.vertices[o[2]],T=this.graph.vertices[o[3]];S.value.subtreeDepth=g,P.value.subtreeDepth=f,B.value.subtreeDepth=b,T.value.subtreeDepth=y,f>g&&f>b&&f>y?(S=this.graph.vertices[o[1]],P=this.graph.vertices[o[0]],B=this.graph.vertices[o[2]],T=this.graph.vertices[o[3]]):b>g&&b>f&&b>y?(S=this.graph.vertices[o[2]],P=this.graph.vertices[o[0]],B=this.graph.vertices[o[1]],T=this.graph.vertices[o[3]]):y>g&&y>f&&y>b&&(S=this.graph.vertices[o[3]],P=this.graph.vertices[o[0]],B=this.graph.vertices[o[1]],T=this.graph.vertices[o[2]]),S.angle=-me.toRad(36),P.angle=me.toRad(36),B.angle=-me.toRad(108),T.angle=me.toRad(108),this.createNextBond(S,e,d+S.angle),this.createNextBond(P,e,d+P.angle),this.createNextBond(B,e,d+B.angle),this.createNextBond(T,e,d+T.angle)}}}getCommonRingbondNeighbour(e){let t=e.neighbours;for(var r=0;r<t.length;r++){let i=this.graph.vertices[t[r]];if(pt.containsAll(i.value.rings,e.value.rings))return i}return null}isPointInRing(e){for(var t=0;t<this.rings.length;t++){let r=this.rings[t];if(!r.positioned)continue;let i=me.polyCircumradius(this.opts.bondLength,r.getSize()),s=i*i;if(e.distanceSq(r.center)<s)return!0}return!1}isEdgeInRing(e){let t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return this.areVerticesInSameRing(t,r)}isEdgeRotatable(e){let t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return!(e.bondType!=="-"||t.isTerminal()||r.isTerminal()||t.value.rings.length>0&&r.value.rings.length>0&&this.areVerticesInSameRing(t,r))}isRingAromatic(e){for(var t=0;t<e.members.length;t++)if(!this.graph.vertices[e.members[t]].value.isPartOfAromaticRing)return!1;return!0}getEdgeNormals(e){let t=this.graph.vertices[e.sourceId].position,r=this.graph.vertices[e.targetId].position;return G.units(t,r)}getNonRingNeighbours(e){let t=Array(),r=this.graph.vertices[e],i=r.neighbours;for(var s=0;s<i.length;s++){let a=this.graph.vertices[i[s]];pt.intersection(r.value.rings,a.value.rings).length===0&&a.value.isBridge==!1&&t.push(a)}return t}annotateStereochemistry(){let e=10;for(var t=0;t<this.graph.vertices.length;t++){let a=this.graph.vertices[t];if(!a.value.isStereoCenter)continue;let n=a.getNeighbours(),u=n.length,o=Array(u);for(var r=0;r<u;r++){let K=new Uint8Array(this.graph.vertices.length),j=Array(Array());K[a.id]=1,this.visitStereochemistry(n[r],a.id,K,j,e,0);for(var i=0;i<j.length;i++)j[i].sort(function(be,le){return le-be});o[r]=[r,j]}let d=0,g=0;for(var r=0;r<o.length;r++){o[r][1].length>d&&(d=o[r][1].length);for(var i=0;i<o[r][1].length;i++)o[r][1][i].length>g&&(g=o[r][1][i].length)}for(var r=0;r<o.length;r++){let j=d-o[r][1].length;for(var i=0;i<j;i++)o[r][1].push([]);o[r][1].push([n[r]]);for(var i=0;i<o[r][1].length;i++){let le=g-o[r][1][i].length;for(var s=0;s<le;s++)o[r][1][i].push(0)}}o.sort(function(K,j){for(var be=0;be<K[1].length;be++)for(var le=0;le<K[1][be].length;le++){if(K[1][be][le]>j[1][be][le])return-1;if(K[1][be][le]<j[1][be][le])return 1}return 0});let f=new Uint8Array(u);for(var r=0;r<u;r++)f[r]=o[r][0],a.value.priority=r;let b=this.graph.vertices[n[f[0]]].position,y=this.graph.vertices[n[f[1]]].position,S=this.graph.vertices[n[f[2]]].position,P=b.relativeClockwise(y,a.position);b.relativeClockwise(S,a.position);let B=P===-1,T=a.value.bracket.chirality==="@"?-1:1,x=me.parityOfPermutation(f)*T===1?"R":"S",M="down",L="up";(B&&x!=="R"||!B&&x!=="S")&&(a.value.hydrogenDirection="up",M="up",L="down"),a.value.hasHydrogen&&(this.graph.getEdge(a.id,n[f[f.length-1]]).wedge=M);let J=new Array(n.length-1),oe=a.value.rings.length>1&&a.value.hasHydrogen,Q=a.value.hasHydrogen?1:0;for(var r=0;r<f.length-Q;r++){J[r]=new Uint32Array(2);let j=this.graph.vertices[n[f[r]]];J[r][0]+=j.value.isStereoCenter?0:1e5,J[r][0]+=this.areVerticesInSameRing(j,a)?0:1e4,J[r][0]+=j.value.isHeteroAtom()?1e3:0,J[r][0]-=j.value.subtreeDepth===0?1e3:0,J[r][0]+=1e3-j.value.subtreeDepth,J[r][1]=n[f[r]]}if(J.sort(function(K,j){return K[0]>j[0]?-1:K[0]<j[0]?1:0}),!oe){let K=J[0][1];if(a.value.hasHydrogen)this.graph.getEdge(a.id,K).wedge=L;else{let j=L;for(var r=f.length-1;r>=0&&(j===M?j=L:j=M,n[f[r]]!==K);r--);this.graph.getEdge(a.id,K).wedge=j}}a.value.chirality=x}}visitStereochemistry(e,t,r,i,s,a,n=0){r[e]=1;let u=this.graph.vertices[e],o=u.value.getAtomicNumber();i.length<=a&&i.push(Array());for(var d=0;d<this.graph.getEdge(e,t).weight;d++)i[a].push(n*1e3+o);let g=this.graph.vertices[e].neighbours;for(var d=0;d<g.length;d++)r[g[d]]!==1&&a<s-1&&this.visitStereochemistry(g[d],e,r.slice(),i,s,a+1,o);if(a<s-1){let f=0;for(var d=0;d<g.length;d++)f+=this.graph.getEdge(e,g[d]).weight;for(var d=0;d<u.value.getMaxBonds()-f;d++)i.length<=a+1&&i.push(Array()),i[a+1].push(o*1e3+1)}}initPseudoElements(){for(var e=0;e<this.graph.vertices.length;e++){const r=this.graph.vertices[e],i=r.neighbours;let s=Array(i.length);for(var t=0;t<i.length;t++)s[t]=this.graph.vertices[i[t]];if(r.getNeighbourCount()<3||r.value.rings.length>0||r.value.element==="P"||r.value.element==="C"&&s.length===3&&s[0].value.element==="N"&&s[1].value.element==="N"&&s[2].value.element==="N")continue;let a=0,n=0;for(var t=0;t<s.length;t++){let d=s[t],g=d.value.element,f=d.getNeighbourCount();g!=="C"&&g!=="H"&&f===1&&a++,f>1&&n++}if(n>1||a<2)continue;let u=null;for(var t=0;t<s.length;t++){let d=s[t];d.getNeighbourCount()>1&&(u=d)}for(var t=0;t<s.length;t++){let d=s[t];if(d.getNeighbourCount()>1)continue;d.value.isDrawn=!1;let g=Er.maxBonds[d.value.element]-d.value.bondCount,f="";d.value.bracket&&(g=d.value.bracket.hcount,f=d.value.bracket.charge||0),r.value.attachPseudoElement(d.value.element,u?u.value.element:null,g,f)}}for(var e=0;e<this.graph.vertices.length;e++){const i=this.graph.vertices[e],s=i.value,a=s.element;if(a==="C"||a==="H"||!s.isDrawn)continue;const n=i.neighbours;let u=Array(n.length);for(var t=0;t<n.length;t++)u[t]=this.graph.vertices[n[t]];for(var t=0;t<u.length;t++){let d=u[t].value;if(!d.hasAttachedPseudoElements||d.getAttachedPseudoElementsCount()!==2)continue;const g=d.getAttachedPseudoElements();g.hasOwnProperty("0O")&&g.hasOwnProperty("3C")&&(d.isDrawn=!1,i.value.attachPseudoElement("Ac","",0))}}}};var cs=gs;const fs=hi,Xe=It,ds=ur;function ps(X){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=t.length,i=0;i<X;i++)e+=t.charAt(Math.floor(Math.random()*r));return e}let vs=class lt{constructor(e,t,r,i=!0){if(typeof t=="string"||t instanceof String?this.svg=document.getElementById(t):this.svg=t,this.container=null,this.opts=r,this.uid=ps(5),this.gradientId=0,this.backgroundItems=[],this.paths=[],this.vertices=[],this.gradients=[],this.highlights=[],this.drawingWidth=0,this.drawingHeight=0,this.halfBondThickness=this.opts.bondThickness/2,this.themeManager=e,this.maskElements=[],this.maxX=-Number.MAX_VALUE,this.maxY=-Number.MAX_VALUE,this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,i)for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this.style=document.createElementNS("http://www.w3.org/2000/svg","style"),this.style.appendChild(document.createTextNode(`
                .element {
                    font: ${this.opts.fontSizeLarge}pt ${this.opts.fontFamily};
                }
                .sub {
                    font: ${this.opts.fontSizeSmall}pt ${this.opts.fontFamily};
                }
            `)),this.svg?this.svg.appendChild(this.style):(this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),container.appendChild(this.style))}constructSvg(){let e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t=document.createElementNS("http://www.w3.org/2000/svg","mask"),r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","g"),a=document.createElementNS("http://www.w3.org/2000/svg","g"),n=this.paths,u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttributeNS(null,"x",this.minX),u.setAttributeNS(null,"y",this.minY),u.setAttributeNS(null,"width",this.maxX-this.minX),u.setAttributeNS(null,"height",this.maxY-this.minY),u.setAttributeNS(null,"fill","white"),t.appendChild(u),t.setAttributeNS(null,"id",this.uid+"-text-mask");for(let o of n)s.appendChild(o);for(let o of this.backgroundItems)r.appendChild(o);for(let o of this.highlights)i.appendChild(o);for(let o of this.vertices)a.appendChild(o);for(let o of this.maskElements)t.appendChild(o);for(let o of this.gradients)e.appendChild(o);if(s.setAttributeNS(null,"mask","url(#"+this.uid+"-text-mask)"),this.updateViewbox(this.opts.scale),r.setAttributeNS(null,"style",`transform: translateX(${this.minX}px) translateY(${this.minY}px)`),this.svg)this.svg.appendChild(e),this.svg.appendChild(t),this.svg.appendChild(r),this.svg.appendChild(i),this.svg.appendChild(s),this.svg.appendChild(a);else return this.container.appendChild(e),this.container.appendChild(t),this.container.appendChild(r),this.container.appendChild(s),this.container.appendChild(a),this.container}addLayer(e){this.backgroundItems.push(e.firstChild)}createGradient(e){let t=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),r=this.uid+`-line-${this.gradientId++}`,i=e.getLeftVector(),s=e.getRightVector(),a=i.x,n=i.y,u=s.x,o=s.y;t.setAttributeNS(null,"id",r),t.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),t.setAttributeNS(null,"x1",a),t.setAttributeNS(null,"y1",n),t.setAttributeNS(null,"x2",u),t.setAttributeNS(null,"y2",o);let d=document.createElementNS("http://www.w3.org/2000/svg","stop");d.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.setAttributeNS(null,"offset","20%");let g=document.createElementNS("http://www.w3.org/2000/svg","stop");return g.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getRightElement()||this.themeManager.getColor("C"))),g.setAttributeNS(null,"offset","100%"),t.appendChild(d),t.appendChild(g),this.gradients.push(t),r}createSubSuperScripts(e,t){let r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.setAttributeNS(null,"baseline-shift",t),r.appendChild(document.createTextNode(e)),r.setAttributeNS(null,"class","sub"),r}static createUnicodeCharge(e){return e===1?"":e===-1?"":e>1?lt.createUnicodeSuperscript(e)+"":e<-1?lt.createUnicodeSuperscript(e)+"":""}determineDimensions(e){for(var t=0;t<e.length;t++){if(!e[t].value.isDrawn)continue;let i=e[t].position;this.maxX<i.x&&(this.maxX=i.x),this.maxY<i.y&&(this.maxY=i.y),this.minX>i.x&&(this.minX=i.x),this.minY>i.y&&(this.minY=i.y)}let r=this.opts.padding;this.maxX+=r,this.maxY+=r,this.minX-=r,this.minY-=r,this.drawingWidth=this.maxX-this.minX,this.drawingHeight=this.maxY-this.minY}updateViewbox(e){let t=this.minX,r=this.minY,i=this.maxX-this.minX,s=this.maxY-this.minY;if(e<=0)if(i>s){let a=i-s;s=i,r-=a/2}else{let a=s-i;i=s,t-=a/2}else this.svg&&(this.svg.style.width=e*i+"px",this.svg.style.height=e*s+"px");this.svg.setAttributeNS(null,"viewBox",`${t} ${r} ${i} ${s}`)}drawBall(e,t,r){let i=this.opts.bondLength/4.5;e-i<this.minX&&(this.minX=e-i),e+i>this.maxX&&(this.maxX=e+i),t-i<this.minY&&(this.minY=t-i),t+i>this.maxY&&(this.maxY=t+i);let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",t),s.setAttributeNS(null,"r",i),s.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(s)}drawWedge(e){let t=e.getLeftVector().clone(),r=e.getRightVector().clone(),i=Xe.normals(t,r);i[0].normalize(),i[1].normalize();let s=e.getRightChiral(),a=t,n=r;s&&(a=r,n=t);let u=Xe.add(a,Xe.multiplyScalar(i[0],this.halfBondThickness)),o=Xe.add(n,Xe.multiplyScalar(i[0],3+this.opts.fontSizeLarge/4)),d=Xe.add(n,Xe.multiplyScalar(i[1],3+this.opts.fontSizeLarge/4)),g=Xe.add(a,Xe.multiplyScalar(i[1],this.halfBondThickness)),f=document.createElementNS("http://www.w3.org/2000/svg","polygon"),b=this.createGradient(e,t.x,t.y,r.x,r.y);f.setAttributeNS(null,"points",`${u.x},${u.y} ${o.x},${o.y} ${d.x},${d.y} ${g.x},${g.y}`),f.setAttributeNS(null,"fill",`url('#${b}')`),this.paths.push(f)}drawAtomHighlight(e,t,r="#03fc9d"){let i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",t),i.setAttributeNS(null,"r",this.opts.bondLength/3),i.setAttributeNS(null,"fill",r),this.highlights.push(i)}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let t=e.getLeftVector().clone(),r=e.getRightVector().clone(),i=Xe.normals(t,r);i[0].normalize(),i[1].normalize();let s=e.getRightChiral(),a,n;s?(a=r,n=t):(a=t,n=r);let u=Xe.subtract(n,a).normalize(),o=e.getLength(),d=1.25/(o/(this.opts.bondLength/10)),g=this.createGradient(e);for(let f=0;f<1;f+=d){let b=Xe.multiplyScalar(u,f*o),y=Xe.add(a,b),S=this.opts.fontSizeLarge/2*f,P=Xe.multiplyScalar(i[0],S);y.subtract(P);let B=y.clone();B.add(Xe.multiplyScalar(P,2)),this.drawLine(new fs(y,B),null,g)}}drawDebugPoint(e,t,r="",i="#f00"){let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",t),s.setAttributeNS(null,"r","2"),s.setAttributeNS(null,"fill","#f00"),this.vertices.push(s),this.drawDebugText(e,t,r)}drawDebugText(e,t,r){let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttributeNS(null,"x",e),i.setAttributeNS(null,"y",t),i.setAttributeNS(null,"class","debug"),i.setAttributeNS(null,"fill","#ff0000"),i.setAttributeNS(null,"style",`
                font: 5px Droid Sans, sans-serif;
            `),i.appendChild(document.createTextNode(r)),this.vertices.push(i)}drawRing(e,t,r){let i=document.createElementNS("http://www.w3.org/2000/svg","circle"),s=ds.apothemFromSideLength(this.opts.bondLength,r);i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",t),i.setAttributeNS(null,"r",s-this.opts.bondSpacing),i.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),i.setAttributeNS(null,"stroke-width",this.opts.bondThickness),i.setAttributeNS(null,"fill","none"),this.paths.push(i)}drawLine(e,t=!1,r=null,i="round"){this.opts;let s=[["stroke-width",this.opts.bondThickness],["stroke-linecap",i],["stroke-dasharray",t?"5, 5":"none"]],a=e.getLeftVector(),n=e.getRightVector(),u=a.x,o=a.y,d=n.x,g=n.y,f=s.map(y=>y.join(":")).join(";"),b=document.createElementNS("http://www.w3.org/2000/svg","line");b.setAttributeNS(null,"x1",u),b.setAttributeNS(null,"y1",o),b.setAttributeNS(null,"x2",d),b.setAttributeNS(null,"y2",g),b.setAttributeNS(null,"style",f),this.paths.push(b),r==null&&(r=this.createGradient(e,u,o,d,g)),b.setAttributeNS(null,"stroke",`url('#${r}')`)}drawPoint(e,t,r){let i=.75;e-i<this.minX&&(this.minX=e-i),e+i>this.maxX&&(this.maxX=e+i),t-i<this.minY&&(this.minY=t-i),t+i>this.maxY&&(this.maxY=t+i);let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",t),s.setAttributeNS(null,"r","1.5"),s.setAttributeNS(null,"fill","black"),this.maskElements.push(s);let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttributeNS(null,"cx",e),a.setAttributeNS(null,"cy",t),a.setAttributeNS(null,"r",i),a.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(a)}drawText(e,t,r,i,s,a,n,u,o,d={}){let g=[],f=r;n!==0&&n!==null&&(f+=lt.createUnicodeCharge(n)),u!==0&&u!==null&&(f=lt.createUnicodeSuperscript(u)+f),g.push([f,r]),i===1?g.push(["H","H"]):i>1&&g.push(["H"+lt.createUnicodeSubscript(i),"H"]),n===1&&r==="N"&&d.hasOwnProperty("0O")&&d.hasOwnProperty("0O-1")&&(d={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},n=0);for(let b in d){if(!d.hasOwnProperty(b))continue;let y=d[b],S=y.element;y.count>1&&(S+=lt.createUnicodeSubscript(y.count)),y.charge!==""&&(S+=lt.createUnicodeCharge(n)),g.push([S,y.element]),y.hydrogenCount===1?g.push(["H","H"]):y.hydrogenCount>1&&g.push(["H"+lt.createUnicodeSubscript(y.hydrogenCount),"H"])}this.write(g,s,e,t,o===1)}write(e,t,r,i,s){let a=lt.measureText(e[0][1],this.opts.fontSizeLarge,this.opts.fontFamily);t==="left"&&e[0][0]!==e[0][1]&&(a.width*=2),s?(r+a.width*e.length>this.maxX&&(this.maxX=r+a.width*e.length),r-a.width/2<this.minX&&(this.minX=r-a.width/2),i-a.height<this.minY&&(this.minY=i-a.height),i+a.height>this.maxY&&(this.maxY=i+a.height)):(t!=="right"?(r+a.width*e.length>this.maxX&&(this.maxX=r+a.width*e.length),r-a.width*e.length<this.minX&&(this.minX=r-a.width*e.length)):t!=="left"&&(r+a.width*e.length>this.maxX&&(this.maxX=r+a.width*e.length),r-a.width/2<this.minX&&(this.minX=r-a.width/2)),i-a.height<this.minY&&(this.minY=i-a.height),i+a.height>this.maxY&&(this.maxY=i+a.height),t==="down"&&i+.8*a.height*e.length>this.maxY&&(this.maxY=i+.8*a.height*e.length),t==="up"&&i-.8*a.height*e.length<this.minY&&(this.minY=i-.8*a.height*e.length));let n=r,u=i,o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttributeNS(null,"class","element");let d=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"fill","#ffffff"),t==="left"&&(e=e.reverse()),(t==="right"||t==="down"||t==="up")&&(r-=a.width/2),t==="left"&&(r+=a.width/2),e.forEach((b,y)=>{const S=b[0],P=b[1];let B=document.createElementNS("http://www.w3.org/2000/svg","tspan");B.setAttributeNS(null,"fill",this.themeManager.getColor(P)),B.textContent=S,(t==="up"||t==="down")&&(B.setAttributeNS(null,"x","0px"),t==="up"?B.setAttributeNS(null,"y",`-${.9*y}em`):B.setAttributeNS(null,"y",`${.9*y}em`)),o.appendChild(B)}),o.setAttributeNS(null,"data-direction",t),t==="left"||t==="right"?(o.setAttributeNS(null,"dominant-baseline","alphabetic"),o.setAttributeNS(null,"y","0.36em")):o.setAttributeNS(null,"dominant-baseline","central"),t==="left"&&o.setAttributeNS(null,"text-anchor","end"),d.appendChild(o),d.setAttributeNS(null,"style",`transform: translateX(${r}px) translateY(${i}px)`);let g=this.opts.fontSizeLarge*.75;e[0][1].length>1&&(g=this.opts.fontSizeLarge*1.1);let f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttributeNS(null,"cx",n),f.setAttributeNS(null,"cy",u),f.setAttributeNS(null,"r",g),f.setAttributeNS(null,"fill","black"),this.maskElements.push(f),this.vertices.push(d)}toCanvas(e,t,r){(typeof e=="string"||e instanceof String)&&(e=document.getElementById(e));let i=new Image;i.onload=function(){e.width=t,e.height=r,e.getContext("2d").drawImage(i,0,0,t,r)},i.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(this.svg.outerHTML)}static createUnicodeSubscript(e){let t="";return e.toString().split("").forEach(r=>{t+=["","","","","","","","","",""][parseInt(r)]}),t}static createUnicodeSuperscript(e){let t="";return e.toString().split("").forEach(r=>{parseInt(r)&&(t+=["","","","","","","","","",""][parseInt(r)])}),t}static replaceNumbersWithSubscript(e){let t={0:"",1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:""};for(const[r,i]of Object.entries(t))e=e.replaceAll(r,i);return e}static measureText(e,t,r,i=.9){const a=document.createElement("canvas").getContext("2d");a.font=`${t}pt ${r}`;let n=a.measureText(e),u=Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight);return{width:n.width>u?n.width:u,height:(Math.abs(n.actualBoundingBoxAscent)+Math.abs(n.actualBoundingBoxAscent))*i}}static svgToCanvas(e,t,r,i,s=null){e.setAttributeNS(null,"width",r),e.setAttributeNS(null,"height",i);let a=new Image;return a.onload=function(){t.width=r,t.height=i;let n=t.getContext("2d");n.imageSmoothingEnabled=!1,n.drawImage(a,0,0,r,i),s&&s(t)},a.onerror=function(n){console.log(n)},a.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(e.outerHTML),t}static svgToImg(e,t,r,i){let s=document.createElement("canvas");this.svgToCanvas(e,s,r,i,a=>{t.src=s.toDataURL("image/png")})}static writeText(e,t,r,i,s=Number.MAX_SAFE_INTEGER){let a=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","style");n.appendChild(document.createTextNode(`
        .text {
            font: ${r}pt ${i};
            dominant-baseline: ideographic;
        }
    `)),a.appendChild(n);let u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttributeNS(null,"class","text");let o=0,d=0,g=[];return e.split(`
`).forEach(f=>{let b=lt.measureText(f,r,i,1);if(b.width>=s){let y=0,S=0,P=f.split(" "),B=0;for(let T=0;T<P.length;T++){let x=lt.measureText(P[T],r,i,1);y+x.width>s&&(g.push({text:P.slice(B,T).join(" "),width:y,height:S}),y=0,S=0,B=T),x.height>S&&(S=x.height),y+=x.width}B<P.length&&g.push({text:P.slice(B,P.length).join(" "),width:y,height:S})}else g.push({text:f,width:b.width,height:b.height})}),g.forEach((f,b)=>{d+=f.height;let y=document.createElementNS("http://www.w3.org/2000/svg","tspan");y.setAttributeNS(null,"fill",t.getColor("C")),y.textContent=f.text,y.setAttributeNS(null,"x","0px"),y.setAttributeNS(null,"y",`${d}px`),u.appendChild(y),f.width>o&&(o=f.width)}),a.appendChild(u),{svg:a,width:o,height:d}}};var ci=vs;function ms(X){function e(f,b){var y=f.length,S=y===0||y>0&&y-1 in f,P=0;if(S)for(;P<y&&b.call(f[P],P,f[P])!==!1;P++);else for(P in f)if(b.call(f[P],P,f[P])===!1)break}function t(f){var b=parseInt(f).toString(16);return b.length==1?"0"+b:b}function r(f,b,y,S){return S=parseInt(S),S===void 0||S===255?"#"+t(f)+t(b)+t(y):S===0?!1:"rgba("+f+","+b+","+y+","+S/255+")"}function i(f,b,y){return"M"+f+" "+b+"h"+y}function s(f,b){return'<path stroke="'+f+'" d="'+b+`" />
`}function a(f){var b="";return e(f,function(y,S){if(y=r.apply(null,y.split(",")),y!==!1){var P=[],B,T=1;e(S,function(){B&&this[1]===B[1]&&this[0]===B[0]+T?T++:(B&&(P.push(i(B[0],B[1],T)),T=1),B=this)}),P.push(i(B[0],B[1],T)),b+=s(y,P.join(""))}}),b}var n=function(f){var b={},y=f.data,S=y.length,P=f.width;f.height;for(var B=0,T=0,x=0,M;x<S;x+=4)y[x+3]>0&&(M=y[x]+","+y[x+1]+","+y[x+2]+","+y[x+3],b[M]=b[M]||[],B=x/4%P,T=Math.floor(x/4/P),b[M].push([B,T]));return b};let u=n(X),o=a(u),d='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -0.5 '+X.width+" "+X.height+'" shape-rendering="crispEdges"><g shape-rendering="crispEdges">'+o+"</g></svg>";var g=document.createElement("div");return g.innerHTML=d,g.firstChild}var bs=ms,Gi={exports:{}};/**
 * chroma.js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2024, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 * derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -------------------------------------------------------
 *
 * chroma.js includes colors from colorbrewer2.org, which are released under
 * the following license:
 *
 * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
 * and The Pennsylvania State University.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 *
 * ------------------------------------------------------
 *
 * Named colors are taken from X11 Color Names.
 * http://www.w3.org/TR/css3-color/#svg-color
 *
 * @preserve
 */(function(X,e){(function(t,r){X.exports=r()})(Dn,function(){function t(l,h,c){return h===void 0&&(h=0),c===void 0&&(c=1),f(b(h,l),c)}function r(l){l._clipped=!1,l._unclipped=l.slice(0);for(var h=0;h<=3;h++)h<3?((l[h]<0||l[h]>255)&&(l._clipped=!0),l[h]=t(l[h],0,255)):h===3&&(l[h]=t(l[h],0,1));return l}for(var i={},s=0,a=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];s<a.length;s+=1){var n=a[s];i["[object "+n+"]"]=n.toLowerCase()}function u(l){return i[Object.prototype.toString.call(l)]||"object"}function o(l,h){return h===void 0&&(h=null),l.length>=3?Array.prototype.slice.call(l):u(l[0])=="object"&&h?h.split("").filter(function(c){return l[0][c]!==void 0}).map(function(c){return l[0][c]}):l[0]}function d(l){if(l.length<2)return null;var h=l.length-1;return u(l[h])=="string"?l[h].toLowerCase():null}var g=Math.PI,f=Math.min,b=Math.max,y=g*2,S=g/3,P=g/180,B=180/g,T={format:{},autodetect:[]},x=function(){for(var h=[],c=arguments.length;c--;)h[c]=arguments[c];var p=this;if(u(h[0])==="object"&&h[0].constructor&&h[0].constructor===this.constructor)return h[0];var w=d(h),A=!1;if(!w){A=!0,T.sorted||(T.autodetect=T.autodetect.sort(function(D,_){return _.p-D.p}),T.sorted=!0);for(var C=0,N=T.autodetect;C<N.length;C+=1){var R=N[C];if(w=R.test.apply(R,h),w)break}}if(T.format[w]){var $=T.format[w].apply(null,A?h:h.slice(0,-1));p._rgb=r($)}else throw new Error("unknown format: "+h);p._rgb.length===3&&p._rgb.push(1)};x.prototype.toString=function(){return u(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var M="2.6.0",L=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(L.Color,[null].concat(l)))};L.Color=x,L.version=M;var J=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"cmyk");var c=l[0],p=l[1],w=l[2],A=l[3],C=l.length>4?l[4]:1;return A===1?[0,0,0,C]:[c>=1?0:255*(1-c)*(1-A),p>=1?0:255*(1-p)*(1-A),w>=1?0:255*(1-w)*(1-A),C]},oe=Math.max,Q=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"rgb"),p=c[0],w=c[1],A=c[2];p=p/255,w=w/255,A=A/255;var C=1-oe(p,oe(w,A)),N=C<1?1/(1-C):0,R=(1-p-C)*N,$=(1-w-C)*N,D=(1-A-C)*N;return[R,$,D,C]};x.prototype.cmyk=function(){return Q(this._rgb)},L.cmyk=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["cmyk"])))},T.format.cmyk=J,T.autodetect.push({p:2,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"cmyk"),u(l)==="array"&&l.length===4)return"cmyk"}});var K=function(l){return Math.round(l*100)/100},j=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"hsla"),p=d(l)||"lsa";return c[0]=K(c[0]||0),c[1]=K(c[1]*100)+"%",c[2]=K(c[2]*100)+"%",p==="hsla"||c.length>3&&c[3]<1?(c[3]=c.length>3?c[3]:1,p="hsla"):c.length=3,p+"("+c.join(",")+")"},be=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"rgba");var c=l[0],p=l[1],w=l[2];c/=255,p/=255,w/=255;var A=f(c,p,w),C=b(c,p,w),N=(C+A)/2,R,$;return C===A?(R=0,$=Number.NaN):R=N<.5?(C-A)/(C+A):(C-A)/(2-C-A),c==C?$=(p-w)/(C-A):p==C?$=2+(w-c)/(C-A):w==C&&($=4+(c-p)/(C-A)),$*=60,$<0&&($+=360),l.length>3&&l[3]!==void 0?[$,R,N,l[3]]:[$,R,N]},le=Math.round,Oe=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"rgba"),p=d(l)||"rgb";return p.substr(0,3)=="hsl"?j(be(c),p):(c[0]=le(c[0]),c[1]=le(c[1]),c[2]=le(c[2]),(p==="rgba"||c.length>3&&c[3]<1)&&(c[3]=c.length>3?c[3]:1,p="rgba"),p+"("+c.slice(0,p==="rgb"?3:4).join(",")+")")},Ke=Math.round,ze=function(){for(var l,h=[],c=arguments.length;c--;)h[c]=arguments[c];h=o(h,"hsl");var p=h[0],w=h[1],A=h[2],C,N,R;if(w===0)C=N=R=A*255;else{var $=[0,0,0],D=[0,0,0],_=A<.5?A*(1+w):A+w-A*w,k=2*A-_,V=p/360;$[0]=V+1/3,$[1]=V,$[2]=V-1/3;for(var W=0;W<3;W++)$[W]<0&&($[W]+=1),$[W]>1&&($[W]-=1),6*$[W]<1?D[W]=k+(_-k)*6*$[W]:2*$[W]<1?D[W]=_:3*$[W]<2?D[W]=k+(_-k)*(2/3-$[W])*6:D[W]=k;l=[Ke(D[0]*255),Ke(D[1]*255),Ke(D[2]*255)],C=l[0],N=l[1],R=l[2]}return h.length>3?[C,N,R,h[3]]:[C,N,R,1]},qe=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,Je=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,ct=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,we=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Re=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,xt=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Nt=Math.round,vt=function(l){l=l.toLowerCase().trim();var h;if(T.format.named)try{return T.format.named(l)}catch{}if(h=l.match(qe)){for(var c=h.slice(1,4),p=0;p<3;p++)c[p]=+c[p];return c[3]=1,c}if(h=l.match(Je)){for(var w=h.slice(1,5),A=0;A<4;A++)w[A]=+w[A];return w}if(h=l.match(ct)){for(var C=h.slice(1,4),N=0;N<3;N++)C[N]=Nt(C[N]*2.55);return C[3]=1,C}if(h=l.match(we)){for(var R=h.slice(1,5),$=0;$<3;$++)R[$]=Nt(R[$]*2.55);return R[3]=+R[3],R}if(h=l.match(Re)){var D=h.slice(1,4);D[1]*=.01,D[2]*=.01;var _=ze(D);return _[3]=1,_}if(h=l.match(xt)){var k=h.slice(1,4);k[1]*=.01,k[2]*=.01;var V=ze(k);return V[3]=+h[4],V}};vt.test=function(l){return qe.test(l)||Je.test(l)||ct.test(l)||we.test(l)||Re.test(l)||xt.test(l)},x.prototype.css=function(l){return Oe(this._rgb,l)},L.css=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["css"])))},T.format.css=vt,T.autodetect.push({p:5,test:function(l){for(var h=[],c=arguments.length-1;c-- >0;)h[c]=arguments[c+1];if(!h.length&&u(l)==="string"&&vt.test(l))return"css"}}),T.format.gl=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"rgba");return c[0]*=255,c[1]*=255,c[2]*=255,c},L.gl=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["gl"])))},x.prototype.gl=function(){var l=this._rgb;return[l[0]/255,l[1]/255,l[2]/255,l[3]]};var Dt=Math.floor,qt=function(){for(var l,h,c,p,w,A,C=[],N=arguments.length;N--;)C[N]=arguments[N];C=o(C,"hcg");var R=C[0],$=C[1],D=C[2],_,k,V;D=D*255;var W=$*255;if($===0)_=k=V=D;else{R===360&&(R=0),R>360&&(R-=360),R<0&&(R+=360),R/=60;var ee=Dt(R),ie=R-ee,se=D*(1-$),he=se+W*(1-ie),De=se+W*ie,Pe=se+W;switch(ee){case 0:l=[Pe,De,se],_=l[0],k=l[1],V=l[2];break;case 1:h=[he,Pe,se],_=h[0],k=h[1],V=h[2];break;case 2:c=[se,Pe,De],_=c[0],k=c[1],V=c[2];break;case 3:p=[se,he,Pe],_=p[0],k=p[1],V=p[2];break;case 4:w=[De,se,Pe],_=w[0],k=w[1],V=w[2];break;case 5:A=[Pe,se,he],_=A[0],k=A[1],V=A[2];break}}return[_,k,V,C.length>3?C[3]:1]},kt=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"rgb"),p=c[0],w=c[1],A=c[2],C=f(p,w,A),N=b(p,w,A),R=N-C,$=R*100/255,D=C/(255-R)*100,_;return R===0?_=Number.NaN:(p===N&&(_=(w-A)/R),w===N&&(_=2+(A-p)/R),A===N&&(_=4+(p-w)/R),_*=60,_<0&&(_+=360)),[_,$,D]};x.prototype.hcg=function(){return kt(this._rgb)},L.hcg=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["hcg"])))},T.format.hcg=qt,T.autodetect.push({p:1,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"hcg"),u(l)==="array"&&l.length===3)return"hcg"}});var Z=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,$e=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,et=function(l){if(l.match(Z)){(l.length===4||l.length===7)&&(l=l.substr(1)),l.length===3&&(l=l.split(""),l=l[0]+l[0]+l[1]+l[1]+l[2]+l[2]);var h=parseInt(l,16),c=h>>16,p=h>>8&255,w=h&255;return[c,p,w,1]}if(l.match($e)){(l.length===5||l.length===9)&&(l=l.substr(1)),l.length===4&&(l=l.split(""),l=l[0]+l[0]+l[1]+l[1]+l[2]+l[2]+l[3]+l[3]);var A=parseInt(l,16),C=A>>24&255,N=A>>16&255,R=A>>8&255,$=Math.round((A&255)/255*100)/100;return[C,N,R,$]}throw new Error("unknown hex color: "+l)},_e=Math.round,tt=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"rgba"),p=c[0],w=c[1],A=c[2],C=c[3],N=d(l)||"auto";C===void 0&&(C=1),N==="auto"&&(N=C<1?"rgba":"rgb"),p=_e(p),w=_e(w),A=_e(A);var R=p<<16|w<<8|A,$="000000"+R.toString(16);$=$.substr($.length-6);var D="0"+_e(C*255).toString(16);switch(D=D.substr(D.length-2),N.toLowerCase()){case"rgba":return"#"+$+D;case"argb":return"#"+D+$;default:return"#"+$}};x.prototype.hex=function(l){return tt(this._rgb,l)},L.hex=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["hex"])))},T.format.hex=et,T.autodetect.push({p:4,test:function(l){for(var h=[],c=arguments.length-1;c-- >0;)h[c]=arguments[c+1];if(!h.length&&u(l)==="string"&&[3,4,5,6,7,8,9].indexOf(l.length)>=0)return"hex"}});var Me=Math.cos,Ye=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"hsi");var c=l[0],p=l[1],w=l[2],A,C,N;return isNaN(c)&&(c=0),isNaN(p)&&(p=0),c>360&&(c-=360),c<0&&(c+=360),c/=360,c<1/3?(N=(1-p)/3,A=(1+p*Me(y*c)/Me(S-y*c))/3,C=1-(N+A)):c<2/3?(c-=1/3,A=(1-p)/3,C=(1+p*Me(y*c)/Me(S-y*c))/3,N=1-(A+C)):(c-=2/3,C=(1-p)/3,N=(1+p*Me(y*c)/Me(S-y*c))/3,A=1-(C+N)),A=t(w*A*3),C=t(w*C*3),N=t(w*N*3),[A*255,C*255,N*255,l.length>3?l[3]:1]},Ue=Math.min,Ht=Math.sqrt,Qe=Math.acos,Le=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"rgb"),p=c[0],w=c[1],A=c[2];p/=255,w/=255,A/=255;var C,N=Ue(p,w,A),R=(p+w+A)/3,$=R>0?1-N/R:0;return $===0?C=NaN:(C=(p-w+(p-A))/2,C/=Ht((p-w)*(p-w)+(p-A)*(w-A)),C=Qe(C),A>w&&(C=y-C),C/=y),[C*360,$,R]};x.prototype.hsi=function(){return Le(this._rgb)},L.hsi=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["hsi"])))},T.format.hsi=Ye,T.autodetect.push({p:2,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"hsi"),u(l)==="array"&&l.length===3)return"hsi"}}),x.prototype.hsl=function(){return be(this._rgb)},L.hsl=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["hsl"])))},T.format.hsl=ze,T.autodetect.push({p:2,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"hsl"),u(l)==="array"&&l.length===3)return"hsl"}});var Ee=Math.floor,Ie=function(){for(var l,h,c,p,w,A,C=[],N=arguments.length;N--;)C[N]=arguments[N];C=o(C,"hsv");var R=C[0],$=C[1],D=C[2],_,k,V;if(D*=255,$===0)_=k=V=D;else{R===360&&(R=0),R>360&&(R-=360),R<0&&(R+=360),R/=60;var W=Ee(R),ee=R-W,ie=D*(1-$),se=D*(1-$*ee),he=D*(1-$*(1-ee));switch(W){case 0:l=[D,he,ie],_=l[0],k=l[1],V=l[2];break;case 1:h=[se,D,ie],_=h[0],k=h[1],V=h[2];break;case 2:c=[ie,D,he],_=c[0],k=c[1],V=c[2];break;case 3:p=[ie,se,D],_=p[0],k=p[1],V=p[2];break;case 4:w=[he,ie,D],_=w[0],k=w[1],V=w[2];break;case 5:A=[D,ie,se],_=A[0],k=A[1],V=A[2];break}}return[_,k,V,C.length>3?C[3]:1]},mt=Math.min,ft=Math.max,zt=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"rgb");var c=l[0],p=l[1],w=l[2],A=mt(c,p,w),C=ft(c,p,w),N=C-A,R,$,D;return D=C/255,C===0?(R=Number.NaN,$=0):($=N/C,c===C&&(R=(p-w)/N),p===C&&(R=2+(w-c)/N),w===C&&(R=4+(c-p)/N),R*=60,R<0&&(R+=360)),[R,$,D]};x.prototype.hsv=function(){return zt(this._rgb)},L.hsv=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["hsv"])))},T.format.hsv=Ie,T.autodetect.push({p:2,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"hsv"),u(l)==="array"&&l.length===3)return"hsv"}});var Ae={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},_t=Math.pow,bt=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"lab");var c=l[0],p=l[1],w=l[2],A,C,N,R,$,D;return C=(c+16)/116,A=isNaN(p)?C:C+p/500,N=isNaN(w)?C:C-w/200,C=Ae.Yn*dt(C),A=Ae.Xn*dt(A),N=Ae.Zn*dt(N),R=rt(3.2404542*A-1.5371385*C-.4985314*N),$=rt(-.969266*A+1.8760108*C+.041556*N),D=rt(.0556434*A-.2040259*C+1.0572252*N),[R,$,D,l.length>3?l[3]:1]},rt=function(l){return 255*(l<=.00304?12.92*l:1.055*_t(l,1/2.4)-.055)},dt=function(l){return l>Ae.t1?l*l*l:Ae.t2*(l-Ae.t0)},Ot=Math.pow,Rt=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"rgb"),p=c[0],w=c[1],A=c[2],C=Br(p,w,A),N=C[0],R=C[1],$=C[2],D=116*R-16;return[D<0?0:D,500*(N-R),200*(R-$)]},Ct=function(l){return(l/=255)<=.04045?l/12.92:Ot((l+.055)/1.055,2.4)},jt=function(l){return l>Ae.t3?Ot(l,1/3):l/Ae.t2+Ae.t0},Br=function(l,h,c){l=Ct(l),h=Ct(h),c=Ct(c);var p=jt((.4124564*l+.3575761*h+.1804375*c)/Ae.Xn),w=jt((.2126729*l+.7151522*h+.072175*c)/Ae.Yn),A=jt((.0193339*l+.119192*h+.9503041*c)/Ae.Zn);return[p,w,A]};x.prototype.lab=function(){return Rt(this._rgb)},L.lab=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["lab"])))},T.format.lab=bt,T.autodetect.push({p:2,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"lab"),u(l)==="array"&&l.length===3)return"lab"}});var cr=Math.sin,$r=Math.cos,er=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"lch"),p=c[0],w=c[1],A=c[2];return isNaN(A)&&(A=0),A=A*P,[p,$r(A)*w,cr(A)*w]},fr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"lch");var c=l[0],p=l[1],w=l[2],A=er(c,p,w),C=A[0],N=A[1],R=A[2],$=bt(C,N,R),D=$[0],_=$[1],k=$[2];return[D,_,k,l.length>3?l[3]:1]},Lr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"hcl").reverse();return fr.apply(void 0,c)},Ir=Math.sqrt,dr=Math.atan2,pr=Math.round,vr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"lab"),p=c[0],w=c[1],A=c[2],C=Ir(w*w+A*A),N=(dr(A,w)*B+360)%360;return pr(C*1e4)===0&&(N=Number.NaN),[p,C,N]},tr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"rgb"),p=c[0],w=c[1],A=c[2],C=Rt(p,w,A),N=C[0],R=C[1],$=C[2];return vr(N,R,$)};x.prototype.lch=function(){return tr(this._rgb)},x.prototype.hcl=function(){return tr(this._rgb).reverse()},L.lch=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["lch"])))},L.hcl=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["hcl"])))},T.format.lch=fr,T.format.hcl=Lr,["lch","hcl"].forEach(function(l){return T.autodetect.push({p:2,test:function(){for(var h=[],c=arguments.length;c--;)h[c]=arguments[c];if(h=o(h,l),u(h)==="array"&&h.length===3)return l}})});var wt={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};x.prototype.name=function(){for(var l=tt(this._rgb,"rgb"),h=0,c=Object.keys(wt);h<c.length;h+=1){var p=c[h];if(wt[p]===l)return p.toLowerCase()}return l},T.format.named=function(l){if(l=l.toLowerCase(),wt[l])return et(wt[l]);throw new Error("unknown color name: "+l)},T.autodetect.push({p:5,test:function(l){for(var h=[],c=arguments.length-1;c-- >0;)h[c]=arguments[c+1];if(!h.length&&u(l)==="string"&&wt[l.toLowerCase()])return"named"}});var Dr=function(l){if(u(l)=="number"&&l>=0&&l<=16777215){var h=l>>16,c=l>>8&255,p=l&255;return[h,c,p,1]}throw new Error("unknown num color: "+l)},kr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"rgb"),p=c[0],w=c[1],A=c[2];return(p<<16)+(w<<8)+A};x.prototype.num=function(){return kr(this._rgb)},L.num=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["num"])))},T.format.num=Dr,T.autodetect.push({p:5,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l.length===1&&u(l[0])==="number"&&l[0]>=0&&l[0]<=16777215)return"num"}});var mr=Math.round;x.prototype.rgb=function(l){return l===void 0&&(l=!0),l===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(mr)},x.prototype.rgba=function(l){return l===void 0&&(l=!0),this._rgb.slice(0,4).map(function(h,c){return c<3?l===!1?h:mr(h):h})},L.rgb=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["rgb"])))},T.format.rgb=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"rgba");return c[3]===void 0&&(c[3]=1),c},T.autodetect.push({p:3,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"rgba"),u(l)==="array"&&(l.length===3||l.length===4&&u(l[3])=="number"&&l[3]>=0&&l[3]<=1))return"rgb"}});var Yt=Math.log,br=function(l){var h=l/100,c,p,w;return h<66?(c=255,p=h<6?0:-155.25485562709179-.44596950469579133*(p=h-2)+104.49216199393888*Yt(p),w=h<20?0:-254.76935184120902+.8274096064007395*(w=h-10)+115.67994401066147*Yt(w)):(c=351.97690566805693+.114206453784165*(c=h-55)-40.25366309332127*Yt(c),p=325.4494125711974+.07943456536662342*(p=h-50)-28.0852963507957*Yt(p),w=255),[c,p,w,1]},Hr=Math.round,zr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];for(var c=o(l,"rgb"),p=c[0],w=c[2],A=1e3,C=4e4,N=.4,R;C-A>N;){R=(C+A)*.5;var $=br(R);$[2]/$[0]>=w/p?C=R:A=R}return Hr(R)};x.prototype.temp=x.prototype.kelvin=x.prototype.temperature=function(){return zr(this._rgb)},L.temp=L.kelvin=L.temperature=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["temp"])))},T.format.temp=T.format.kelvin=T.format.temperature=br;var Ut=Math.pow,_r=Math.sign,Cr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"lab");var c=l[0],p=l[1],w=l[2],A=Ut(c+.3963377774*p+.2158037573*w,3),C=Ut(c-.1055613458*p-.0638541728*w,3),N=Ut(c-.0894841775*p-1.291485548*w,3);return[255*m(4.0767416621*A-3.3077115913*C+.2309699292*N),255*m(-1.2684380046*A+2.6097574011*C-.3413193965*N),255*m(-.0041960863*A-.7034186147*C+1.707614701*N),l.length>3?l[3]:1]};function m(l){var h=Math.abs(l);return h>.0031308?(_r(l)||1)*(1.055*Ut(h,1/2.4)-.055):l*12.92}var Et=Math.cbrt,it=Math.pow,rr=Math.sign,Ft=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"rgb"),p=c[0],w=c[1],A=c[2],C=[pe(p/255),pe(w/255),pe(A/255)],N=C[0],R=C[1],$=C[2],D=Et(.4122214708*N+.5363325363*R+.0514459929*$),_=Et(.2119034982*N+.6806995451*R+.1073969566*$),k=Et(.0883024619*N+.2817188376*R+.6299787005*$);return[.2104542553*D+.793617785*_-.0040720468*k,1.9779984951*D-2.428592205*_+.4505937099*k,.0259040371*D+.7827717662*_-.808675766*k]};function pe(l){var h=Math.abs(l);return h<.04045?l/12.92:(rr(l)||1)*it((h+.055)/1.055,2.4)}x.prototype.oklab=function(){return Ft(this._rgb)},L.oklab=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["oklab"])))},T.format.oklab=Cr,T.autodetect.push({p:3,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"oklab"),u(l)==="array"&&l.length===3)return"oklab"}});var nt=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];l=o(l,"lch");var c=l[0],p=l[1],w=l[2],A=er(c,p,w),C=A[0],N=A[1],R=A[2],$=Cr(C,N,R),D=$[0],_=$[1],k=$[2];return[D,_,k,l.length>3?l[3]:1]},Fr=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];var c=o(l,"rgb"),p=c[0],w=c[1],A=c[2],C=Ft(p,w,A),N=C[0],R=C[1],$=C[2];return vr(N,R,$)};x.prototype.oklch=function(){return Fr(this._rgb)},L.oklch=function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];return new(Function.prototype.bind.apply(x,[null].concat(l,["oklch"])))},T.format.oklch=nt,T.autodetect.push({p:3,test:function(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];if(l=o(l,"oklch"),u(l)==="array"&&l.length===3)return"oklch"}}),x.prototype.alpha=function(l,h){return h===void 0&&(h=!1),l!==void 0&&u(l)==="number"?h?(this._rgb[3]=l,this):new x([this._rgb[0],this._rgb[1],this._rgb[2],l],"rgb"):this._rgb[3]},x.prototype.clipped=function(){return this._rgb._clipped||!1},x.prototype.darken=function(l){l===void 0&&(l=1);var h=this,c=h.lab();return c[0]-=Ae.Kn*l,new x(c,"lab").alpha(h.alpha(),!0)},x.prototype.brighten=function(l){return l===void 0&&(l=1),this.darken(-l)},x.prototype.darker=x.prototype.darken,x.prototype.brighter=x.prototype.brighten,x.prototype.get=function(l){var h=l.split("."),c=h[0],p=h[1],w=this[c]();if(p){var A=c.indexOf(p)-(c.substr(0,2)==="ok"?2:0);if(A>-1)return w[A];throw new Error("unknown channel "+p+" in mode "+c)}else return w};var wr=Math.pow,yr=1e-7,q=20;x.prototype.luminance=function(l,h){if(h===void 0&&(h="rgb"),l!==void 0&&u(l)==="number"){if(l===0)return new x([0,0,0,this._rgb[3]],"rgb");if(l===1)return new x([255,255,255,this._rgb[3]],"rgb");var c=this.luminance(),p=q,w=function(C,N){var R=C.interpolate(N,.5,h),$=R.luminance();return Math.abs(l-$)<yr||!p--?R:$>l?w(C,R):w(R,N)},A=(c>l?w(new x([0,0,0]),this):w(this,new x([255,255,255]))).rgb();return new x(A.concat([this._rgb[3]]))}return Sr.apply(void 0,this._rgb.slice(0,3))};var Sr=function(l,h,c){return l=ir(l),h=ir(h),c=ir(c),.2126*l+.7152*h+.0722*c},ir=function(l){return l/=255,l<=.03928?l/12.92:wr((l+.055)/1.055,2.4)},ye={};function st(l,h,c){c===void 0&&(c=.5);for(var p=[],w=arguments.length-3;w-- >0;)p[w]=arguments[w+3];var A=p[0]||"lrgb";if(!ye[A]&&!p.length&&(A=Object.keys(ye)[0]),!ye[A])throw new Error("interpolation mode "+A+" is not defined");return u(l)!=="object"&&(l=new x(l)),u(h)!=="object"&&(h=new x(h)),ye[A](l,h,c).alpha(l.alpha()+c*(h.alpha()-l.alpha()))}x.prototype.mix=x.prototype.interpolate=function(l,h){h===void 0&&(h=.5);for(var c=[],p=arguments.length-2;p-- >0;)c[p]=arguments[p+2];return st.apply(void 0,[this,l,h].concat(c))},x.prototype.premultiply=function(l){l===void 0&&(l=!1);var h=this._rgb,c=h[3];return l?(this._rgb=[h[0]*c,h[1]*c,h[2]*c,c],this):new x([h[0]*c,h[1]*c,h[2]*c,c],"rgb")},x.prototype.saturate=function(l){l===void 0&&(l=1);var h=this,c=h.lch();return c[1]+=Ae.Kn*l,c[1]<0&&(c[1]=0),new x(c,"lch").alpha(h.alpha(),!0)},x.prototype.desaturate=function(l){return l===void 0&&(l=1),this.saturate(-l)},x.prototype.set=function(l,h,c){c===void 0&&(c=!1);var p=l.split("."),w=p[0],A=p[1],C=this[w]();if(A){var N=w.indexOf(A)-(w.substr(0,2)==="ok"?2:0);if(N>-1){if(u(h)=="string")switch(h.charAt(0)){case"+":C[N]+=+h;break;case"-":C[N]+=+h;break;case"*":C[N]*=+h.substr(1);break;case"/":C[N]/=+h.substr(1);break;default:C[N]=+h}else if(u(h)==="number")C[N]=h;else throw new Error("unsupported value for Color.set");var R=new x(C,w);return c?(this._rgb=R._rgb,this):R}throw new Error("unknown channel "+A+" in mode "+w)}else return C},x.prototype.tint=function(l){l===void 0&&(l=.5);for(var h=[],c=arguments.length-1;c-- >0;)h[c]=arguments[c+1];return st.apply(void 0,[this,"white",l].concat(h))},x.prototype.shade=function(l){l===void 0&&(l=.5);for(var h=[],c=arguments.length-1;c-- >0;)h[c]=arguments[c+1];return st.apply(void 0,[this,"black",l].concat(h))};var Wr=function(l,h,c){var p=l._rgb,w=h._rgb;return new x(p[0]+c*(w[0]-p[0]),p[1]+c*(w[1]-p[1]),p[2]+c*(w[2]-p[2]),"rgb")};ye.rgb=Wr;var Tt=Math.sqrt,Mt=Math.pow,Xr=function(l,h,c){var p=l._rgb,w=p[0],A=p[1],C=p[2],N=h._rgb,R=N[0],$=N[1],D=N[2];return new x(Tt(Mt(w,2)*(1-c)+Mt(R,2)*c),Tt(Mt(A,2)*(1-c)+Mt($,2)*c),Tt(Mt(C,2)*(1-c)+Mt(D,2)*c),"rgb")};ye.lrgb=Xr;var Ar=function(l,h,c){var p=l.lab(),w=h.lab();return new x(p[0]+c*(w[0]-p[0]),p[1]+c*(w[1]-p[1]),p[2]+c*(w[2]-p[2]),"lab")};ye.lab=Ar;function yt(l,h,c,p){var w,A,C,N;p==="hsl"?(C=l.hsl(),N=h.hsl()):p==="hsv"?(C=l.hsv(),N=h.hsv()):p==="hcg"?(C=l.hcg(),N=h.hcg()):p==="hsi"?(C=l.hsi(),N=h.hsi()):p==="lch"||p==="hcl"?(p="hcl",C=l.hcl(),N=h.hcl()):p==="oklch"&&(C=l.oklch().reverse(),N=h.oklch().reverse());var R,$,D,_,k,V;(p.substr(0,1)==="h"||p==="oklch")&&(w=C,R=w[0],D=w[1],k=w[2],A=N,$=A[0],_=A[1],V=A[2]);var W,ee,ie,se;return!isNaN(R)&&!isNaN($)?($>R&&$-R>180?se=$-(R+360):$<R&&R-$>180?se=$+360-R:se=$-R,ee=R+c*se):isNaN(R)?isNaN($)?ee=Number.NaN:(ee=$,(k==1||k==0)&&p!="hsv"&&(W=_)):(ee=R,(V==1||V==0)&&p!="hsv"&&(W=D)),W===void 0&&(W=D+c*(_-D)),ie=k+c*(V-k),p==="oklch"?new x([ie,W,ee],p):new x([ee,W,ie],p)}var xr=function(l,h,c){return yt(l,h,c,"lch")};ye.lch=xr,ye.hcl=xr;var Nr=function(l,h,c){var p=l.num(),w=h.num();return new x(p+c*(w-p),"num")};ye.num=Nr;var Vr=function(l,h,c){return yt(l,h,c,"hcg")};ye.hcg=Vr;var qr=function(l,h,c){return yt(l,h,c,"hsi")};ye.hsi=qr;var Yr=function(l,h,c){return yt(l,h,c,"hsl")};ye.hsl=Yr;var Ur=function(l,h,c){return yt(l,h,c,"hsv")};ye.hsv=Ur;var Gr=function(l,h,c){var p=l.oklab(),w=h.oklab();return new x(p[0]+c*(w[0]-p[0]),p[1]+c*(w[1]-p[1]),p[2]+c*(w[2]-p[2]),"oklab")};ye.oklab=Gr;var Zr=function(l,h,c){return yt(l,h,c,"oklch")};ye.oklch=Zr;var nr=Math.pow,E=Math.sqrt,v=Math.PI,I=Math.cos,O=Math.sin,H=Math.atan2;function F(l,h,c){h===void 0&&(h="lrgb"),c===void 0&&(c=null);var p=l.length;c||(c=Array.from(new Array(p)).map(function(){return 1}));var w=p/c.reduce(function(ee,ie){return ee+ie});if(c.forEach(function(ee,ie){c[ie]*=w}),l=l.map(function(ee){return new x(ee)}),h==="lrgb")return Y(l,c);for(var A=l.shift(),C=A.get(h),N=[],R=0,$=0,D=0;D<C.length;D++)if(C[D]=(C[D]||0)*c[0],N.push(isNaN(C[D])?0:c[0]),h.charAt(D)==="h"&&!isNaN(C[D])){var _=C[D]/180*v;R+=I(_)*c[0],$+=O(_)*c[0]}var k=A.alpha()*c[0];l.forEach(function(ee,ie){var se=ee.get(h);k+=ee.alpha()*c[ie+1];for(var he=0;he<C.length;he++)if(!isNaN(se[he]))if(N[he]+=c[ie+1],h.charAt(he)==="h"){var De=se[he]/180*v;R+=I(De)*c[ie+1],$+=O(De)*c[ie+1]}else C[he]+=se[he]*c[ie+1]});for(var V=0;V<C.length;V++)if(h.charAt(V)==="h"){for(var W=H($/N[V],R/N[V])/v*180;W<0;)W+=360;for(;W>=360;)W-=360;C[V]=W}else C[V]=C[V]/N[V];return k/=p,new x(C,h).alpha(k>.99999?1:k,!0)}var Y=function(l,h){for(var c=l.length,p=[0,0,0,0],w=0;w<l.length;w++){var A=l[w],C=h[w]/c,N=A._rgb;p[0]+=nr(N[0],2)*C,p[1]+=nr(N[1],2)*C,p[2]+=nr(N[2],2)*C,p[3]+=N[3]*C}return p[0]=E(p[0]),p[1]=E(p[1]),p[2]=E(p[2]),p[3]>.9999999&&(p[3]=1),new x(r(p))},Te=Math.pow;function Fe(l){var h="rgb",c=L("#ccc"),p=0,w=[0,1],A=[],C=[0,0],N=!1,R=[],$=!1,D=0,_=1,k=!1,V={},W=!0,ee=1,ie=function(z){if(z=z||["#fff","#000"],z&&u(z)==="string"&&L.brewer&&L.brewer[z.toLowerCase()]&&(z=L.brewer[z.toLowerCase()]),u(z)==="array"){z.length===1&&(z=[z[0],z[0]]),z=z.slice(0);for(var U=0;U<z.length;U++)z[U]=L(z[U]);A.length=0;for(var re=0;re<z.length;re++)A.push(re/(z.length-1))}return Ge(),R=z},se=function(z){if(N!=null){for(var U=N.length-1,re=0;re<U&&z>=N[re];)re++;return re-1}return 0},he=function(z){return z},De=function(z){return z},Pe=function(z,U){var re,te;if(U==null&&(U=!1),isNaN(z)||z===null)return c;if(U)te=z;else if(N&&N.length>2){var ke=se(z);te=ke/(N.length-2)}else _!==D?te=(z-D)/(_-D):te=1;te=De(te),U||(te=he(te)),ee!==1&&(te=Te(te,ee)),te=C[0]+te*(1-C[0]-C[1]),te=t(te,0,1);var ve=Math.floor(te*1e4);if(W&&V[ve])re=V[ve];else{if(u(R)==="array")for(var ae=0;ae<A.length;ae++){var ue=A[ae];if(te<=ue){re=R[ae];break}if(te>=ue&&ae===A.length-1){re=R[ae];break}if(te>ue&&te<A[ae+1]){te=(te-ue)/(A[ae+1]-ue),re=L.interpolate(R[ae],R[ae+1],te,h);break}}else u(R)==="function"&&(re=R(te));W&&(V[ve]=re)}return re},Ge=function(){return V={}};ie(l);var ne=function(z){var U=L(Pe(z));return $&&U[$]?U[$]():U};return ne.classes=function(z){if(z!=null){if(u(z)==="array")N=z,w=[z[0],z[z.length-1]];else{var U=L.analyze(w);z===0?N=[U.min,U.max]:N=L.limits(U,"e",z)}return ne}return N},ne.domain=function(z){if(!arguments.length)return w;D=z[0],_=z[z.length-1],A=[];var U=R.length;if(z.length===U&&D!==_)for(var re=0,te=Array.from(z);re<te.length;re+=1){var ke=te[re];A.push((ke-D)/(_-D))}else{for(var ve=0;ve<U;ve++)A.push(ve/(U-1));if(z.length>2){var ae=z.map(function(ge,ce){return ce/(z.length-1)}),ue=z.map(function(ge){return(ge-D)/(_-D)});ue.every(function(ge,ce){return ae[ce]===ge})||(De=function(ge){if(ge<=0||ge>=1)return ge;for(var ce=0;ge>=ue[ce+1];)ce++;var ut=(ge-ue[ce])/(ue[ce+1]-ue[ce]),$t=ae[ce]+ut*(ae[ce+1]-ae[ce]);return $t})}}return w=[D,_],ne},ne.mode=function(z){return arguments.length?(h=z,Ge(),ne):h},ne.range=function(z,U){return ie(z),ne},ne.out=function(z){return $=z,ne},ne.spread=function(z){return arguments.length?(p=z,ne):p},ne.correctLightness=function(z){return z==null&&(z=!0),k=z,Ge(),k?he=function(U){for(var re=Pe(0,!0).lab()[0],te=Pe(1,!0).lab()[0],ke=re>te,ve=Pe(U,!0).lab()[0],ae=re+(te-re)*U,ue=ve-ae,ge=0,ce=1,ut=20;Math.abs(ue)>.01&&ut-- >0;)(function(){return ke&&(ue*=-1),ue<0?(ge=U,U+=(ce-U)*.5):(ce=U,U+=(ge-U)*.5),ve=Pe(U,!0).lab()[0],ue=ve-ae})();return U}:he=function(U){return U},ne},ne.padding=function(z){return z!=null?(u(z)==="number"&&(z=[z,z]),C=z,ne):C},ne.colors=function(z,U){arguments.length<2&&(U="hex");var re=[];if(arguments.length===0)re=R.slice(0);else if(z===1)re=[ne(.5)];else if(z>1){var te=w[0],ke=w[1]-te;re=ot(0,z).map(function(ce){return ne(te+ce/(z-1)*ke)})}else{l=[];var ve=[];if(N&&N.length>2)for(var ae=1,ue=N.length,ge=1<=ue;ge?ae<ue:ae>ue;ge?ae++:ae--)ve.push((N[ae-1]+N[ae])*.5);else ve=w;re=ve.map(function(ce){return ne(ce)})}return L[U]&&(re=re.map(function(ce){return ce[U]()})),re},ne.cache=function(z){return z!=null?(W=z,ne):W},ne.gamma=function(z){return z!=null?(ee=z,ne):ee},ne.nodata=function(z){return z!=null?(c=L(z),ne):c},ne}function ot(l,h,c){for(var p=[],w=l<h,A=h,C=l;w?C<A:C>A;w?C++:C--)p.push(C);return p}var rn=function(l){for(var h=[1,1],c=1;c<l;c++){for(var p=[1],w=1;w<=h.length;w++)p[w]=(h[w]||0)+h[w-1];h=p}return h},nn=function(l){var h,c,p,w,A,C,N;if(l=l.map(function(k){return new x(k)}),l.length===2)h=l.map(function(k){return k.lab()}),A=h[0],C=h[1],w=function(k){var V=[0,1,2].map(function(W){return A[W]+k*(C[W]-A[W])});return new x(V,"lab")};else if(l.length===3)c=l.map(function(k){return k.lab()}),A=c[0],C=c[1],N=c[2],w=function(k){var V=[0,1,2].map(function(W){return(1-k)*(1-k)*A[W]+2*(1-k)*k*C[W]+k*k*N[W]});return new x(V,"lab")};else if(l.length===4){var R;p=l.map(function(k){return k.lab()}),A=p[0],C=p[1],N=p[2],R=p[3],w=function(k){var V=[0,1,2].map(function(W){return(1-k)*(1-k)*(1-k)*A[W]+3*(1-k)*(1-k)*k*C[W]+3*(1-k)*k*k*N[W]+k*k*k*R[W]});return new x(V,"lab")}}else if(l.length>=5){var $,D,_;$=l.map(function(k){return k.lab()}),_=l.length-1,D=rn(_),w=function(k){var V=1-k,W=[0,1,2].map(function(ee){return $.reduce(function(ie,se,he){return ie+D[he]*Math.pow(V,_-he)*Math.pow(k,he)*se[ee]},0)});return new x(W,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return w};function sn(l){var h=nn(l);return h.scale=function(){return Fe(h)},h}var ht=function(l,h,c){if(!ht[c])throw new Error("unknown blend mode "+c);return ht[c](l,h)},Pt=function(l){return function(h,c){var p=L(c).rgb(),w=L(h).rgb();return L.rgb(l(p,w))}},Bt=function(l){return function(h,c){var p=[];return p[0]=l(h[0],c[0]),p[1]=l(h[1],c[1]),p[2]=l(h[2],c[2]),p}},an=function(l){return l},ln=function(l,h){return l*h/255},on=function(l,h){return l>h?h:l},hn=function(l,h){return l>h?l:h},un=function(l,h){return 255*(1-(1-l/255)*(1-h/255))},gn=function(l,h){return h<128?2*l*h/255:255*(1-2*(1-l/255)*(1-h/255))},cn=function(l,h){return 255*(1-(1-h/255)/(l/255))},fn=function(l,h){return l===255?255:(l=255*(h/255)/(1-l/255),l>255?255:l)};ht.normal=Pt(Bt(an)),ht.multiply=Pt(Bt(ln)),ht.screen=Pt(Bt(un)),ht.overlay=Pt(Bt(gn)),ht.darken=Pt(Bt(on)),ht.lighten=Pt(Bt(hn)),ht.dodge=Pt(Bt(fn)),ht.burn=Pt(Bt(cn));var dn=Math.pow,pn=Math.sin,vn=Math.cos;function mn(l,h,c,p,w){l===void 0&&(l=300),h===void 0&&(h=-1.5),c===void 0&&(c=1),p===void 0&&(p=1),w===void 0&&(w=[0,1]);var A=0,C;u(w)==="array"?C=w[1]-w[0]:(C=0,w=[w,w]);var N=function(R){var $=y*((l+120)/360+h*R),D=dn(w[0]+C*R,p),_=A!==0?c[0]+R*A:c,k=_*D*(1-D)/2,V=vn($),W=pn($),ee=D+k*(-.14861*V+1.78277*W),ie=D+k*(-.29227*V-.90649*W),se=D+k*(1.97294*V);return L(r([ee*255,ie*255,se*255,1]))};return N.start=function(R){return R==null?l:(l=R,N)},N.rotations=function(R){return R==null?h:(h=R,N)},N.gamma=function(R){return R==null?p:(p=R,N)},N.hue=function(R){return R==null?c:(c=R,u(c)==="array"?(A=c[1]-c[0],A===0&&(c=c[1])):A=0,N)},N.lightness=function(R){return R==null?w:(u(R)==="array"?(w=R,C=R[1]-R[0]):(w=[R,R],C=0),N)},N.scale=function(){return L.scale(N)},N.hue(c),N}var bn="0123456789abcdef",Cn=Math.floor,wn=Math.random;function yn(){for(var l="#",h=0;h<6;h++)l+=bn.charAt(Cn(wn()*16));return new x(l,"hex")}var pi=Math.log,Sn=Math.pow,An=Math.floor,xn=Math.abs;function vi(l,h){h===void 0&&(h=null);var c={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return u(l)==="object"&&(l=Object.values(l)),l.forEach(function(p){h&&u(p)==="object"&&(p=p[h]),p!=null&&!isNaN(p)&&(c.values.push(p),c.sum+=p,p<c.min&&(c.min=p),p>c.max&&(c.max=p),c.count+=1)}),c.domain=[c.min,c.max],c.limits=function(p,w){return mi(c,p,w)},c}function mi(l,h,c){h===void 0&&(h="equal"),c===void 0&&(c=7),u(l)=="array"&&(l=vi(l));var p=l.min,w=l.max,A=l.values.sort(function(Jr,Qr){return Jr-Qr});if(c===1)return[p,w];var C=[];if(h.substr(0,1)==="c"&&(C.push(p),C.push(w)),h.substr(0,1)==="e"){C.push(p);for(var N=1;N<c;N++)C.push(p+N/c*(w-p));C.push(w)}else if(h.substr(0,1)==="l"){if(p<=0)throw new Error("Logarithmic scales are only possible for values > 0");var R=Math.LOG10E*pi(p),$=Math.LOG10E*pi(w);C.push(p);for(var D=1;D<c;D++)C.push(Sn(10,R+D/c*($-R)));C.push(w)}else if(h.substr(0,1)==="q"){C.push(p);for(var _=1;_<c;_++){var k=(A.length-1)*_/c,V=An(k);if(V===k)C.push(A[V]);else{var W=k-V;C.push(A[V]*(1-W)+A[V+1]*W)}}C.push(w)}else if(h.substr(0,1)==="k"){var ee,ie=A.length,se=new Array(ie),he=new Array(c),De=!0,Pe=0,Ge=null;Ge=[],Ge.push(p);for(var ne=1;ne<c;ne++)Ge.push(p+ne/c*(w-p));for(Ge.push(w);De;){for(var z=0;z<c;z++)he[z]=0;for(var U=0;U<ie;U++)for(var re=A[U],te=Number.MAX_VALUE,ke=void 0,ve=0;ve<c;ve++){var ae=xn(Ge[ve]-re);ae<te&&(te=ae,ke=ve),he[ke]++,se[U]=ke}for(var ue=new Array(c),ge=0;ge<c;ge++)ue[ge]=null;for(var ce=0;ce<ie;ce++)ee=se[ce],ue[ee]===null?ue[ee]=A[ce]:ue[ee]+=A[ce];for(var ut=0;ut<c;ut++)ue[ut]*=1/he[ut];De=!1;for(var $t=0;$t<c;$t++)if(ue[$t]!==Ge[$t]){De=!0;break}Ge=ue,Pe++,Pe>200&&(De=!1)}for(var Lt={},Gt=0;Gt<c;Gt++)Lt[Gt]=[];for(var Zt=0;Zt<ie;Zt++)ee=se[Zt],Lt[ee].push(A[Zt]);for(var At=[],Wt=0;Wt<c;Wt++)At.push(Lt[Wt][0]),At.push(Lt[Wt][Lt[Wt].length-1]);At=At.sort(function(Jr,Qr){return Jr-Qr}),C.push(At[0]);for(var sr=1;sr<At.length;sr+=2){var Xt=At[sr];!isNaN(Xt)&&C.indexOf(Xt)===-1&&C.push(Xt)}}return C}function Nn(l,h){l=new x(l),h=new x(h);var c=l.luminance(),p=h.luminance();return c>p?(c+.05)/(p+.05):(p+.05)/(c+.05)}var St=Math.sqrt,xe=Math.pow,On=Math.min,Rn=Math.max,bi=Math.atan2,Ci=Math.abs,Or=Math.cos,wi=Math.sin,En=Math.exp,yi=Math.PI;function Tn(l,h,c,p,w){c===void 0&&(c=1),p===void 0&&(p=1),w===void 0&&(w=1);var A=function(Xt){return 360*Xt/(2*yi)},C=function(Xt){return 2*yi*Xt/360};l=new x(l),h=new x(h);var N=Array.from(l.lab()),R=N[0],$=N[1],D=N[2],_=Array.from(h.lab()),k=_[0],V=_[1],W=_[2],ee=(R+k)/2,ie=St(xe($,2)+xe(D,2)),se=St(xe(V,2)+xe(W,2)),he=(ie+se)/2,De=.5*(1-St(xe(he,7)/(xe(he,7)+xe(25,7)))),Pe=$*(1+De),Ge=V*(1+De),ne=St(xe(Pe,2)+xe(D,2)),z=St(xe(Ge,2)+xe(W,2)),U=(ne+z)/2,re=A(bi(D,Pe)),te=A(bi(W,Ge)),ke=re>=0?re:re+360,ve=te>=0?te:te+360,ae=Ci(ke-ve)>180?(ke+ve+360)/2:(ke+ve)/2,ue=1-.17*Or(C(ae-30))+.24*Or(C(2*ae))+.32*Or(C(3*ae+6))-.2*Or(C(4*ae-63)),ge=ve-ke;ge=Ci(ge)<=180?ge:ve<=ke?ge+360:ge-360,ge=2*St(ne*z)*wi(C(ge)/2);var ce=k-R,ut=z-ne,$t=1+.015*xe(ee-50,2)/St(20+xe(ee-50,2)),Lt=1+.045*U,Gt=1+.015*U*ue,Zt=30*En(-xe((ae-275)/25,2)),At=2*St(xe(U,7)/(xe(U,7)+xe(25,7))),Wt=-At*wi(2*C(Zt)),sr=St(xe(ce/(c*$t),2)+xe(ut/(p*Lt),2)+xe(ge/(w*Gt),2)+Wt*(ut/(p*Lt))*(ge/(w*Gt)));return Rn(0,On(100,sr))}function Mn(l,h,c){c===void 0&&(c="lab"),l=new x(l),h=new x(h);var p=l.get(c),w=h.get(c),A=0;for(var C in p){var N=(p[C]||0)-(w[C]||0);A+=N*N}return Math.sqrt(A)}function Pn(){for(var l=[],h=arguments.length;h--;)l[h]=arguments[h];try{return new(Function.prototype.bind.apply(x,[null].concat(l))),!0}catch{return!1}}for(var Bn={cool:function(){return Fe([L.hsl(180,1,.9),L.hsl(250,.7,.4)])},hot:function(){return Fe(["#000","#f00","#ff0","#fff"]).mode("rgb")}},Rr={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Kr=0,Si=Object.keys(Rr);Kr<Si.length;Kr+=1){var Ai=Si[Kr];Rr[Ai.toLowerCase()]=Rr[Ai]}return Object.assign(L,{average:F,bezier:sn,blend:ht,cubehelix:mn,mix:st,interpolate:st,random:yn,scale:Fe,analyze:vi,contrast:Nn,deltaE:Tn,distance:Mn,limits:mi,valid:Pn,scales:Bn,input:T,colors:wt,brewer:Rr}),L})})(Gi);var Cs=Gi.exports;const Bi=It,ws=bs,ys=Cs;let Ss=class{constructor(e,t,r,i,s=.3,a=0,n=null,u=1,o=!1){this.points=e,this.weights=t,this.width=r,this.height=i,this.sigma=s,this.interval=a,this.opacity=u,this.normalized=o,n===null&&(n=["#c51b7d","#de77ae","#f1b6da","#fde0ef","#ffffff","#e6f5d0","#b8e186","#7fbc41","#4d9221"]),this.colormap=n,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height}setFromArray(e,t){this.points=[],e.forEach(r=>{this.points.push(new Bi(r[0],r[1]))}),this.weights=[],t.forEach(r=>{this.weights.push(r)})}draw(){let e=[];for(let s=0;s<this.width;s++){let a=[];for(let n=0;n<this.height;n++)a.push(0);e.push(a)}let t=1/(2*this.sigma**2);for(let s=0;s<this.points.length;s++){let a=this.points[s],n=this.weights[s];for(let u=0;u<this.width;u++)for(let o=0;o<this.height;o++){let d=((u-a.x)**2+(o-a.y)**2)*t,g=n*Math.exp(-d);e[u][o]+=g}}let r=1;if(!this.normalized){let s=-Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER;for(let n=0;n<this.width;n++)for(let u=0;u<this.height;u++)e[n][u]<a&&(a=e[n][u]),e[n][u]>s&&(s=e[n][u]);r=Math.max(Math.abs(a),Math.abs(s))}const i=ys.scale(this.colormap).domain([-1,1]);for(let s=0;s<this.width;s++)for(let a=0;a<this.height;a++){this.normalized||(e[s][a]=e[s][a]/r),this.interval!==0&&(e[s][a]=Math.round(e[s][a]/this.interval)*this.interval);let[n,u,o]=i(e[s][a]).rgb();this.setPixel(new Bi(s,a),n,u,o)}}getImage(e){let t=new Image;t.onload=()=>{this.context.imageSmoothingEnabled=!1,this.context.drawImage(t,0,0,this.width,this.height),e&&e(t)},t.onerror=function(r){console.log(r)},t.src=this.canvas.toDataURL()}getSVG(){return ws(this.context.getImageData(0,0,this.width,this.height))}setPixel(e,t,r,i){this.context.fillStyle="rgba("+t+","+r+","+i+","+this.opacity+")",this.context.fillRect(e.x,e.y,1,1)}};var Zi=Ss;const $i=hr,As=Mr(),xs=cs,Ve=hi,Ns=ci,Os=ui,Ne=It,Rs=Zi;let Es=class{constructor(e,t=!0){this.preprocessor=new xs(e),this.opts=this.preprocessor.opts,this.clear=t,this.svgWrapper=null}draw(e,t,r="light",i=null,s=!1,a=[],n=!1){t===null||t==="svg"?(t=document.createElementNS("http://www.w3.org/2000/svg","svg"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t.setAttributeNS(null,"width",this.opts.width),t.setAttributeNS(null,"height",this.opts.height)):t instanceof String&&(t=document.getElementById(t));let u={padding:this.opts.padding,compactDrawing:this.opts.compactDrawing};i!==null&&(this.opts.padding+=this.opts.weights.additionalPadding,this.opts.compactDrawing=!1);let o=this.preprocessor;return o.initDraw(e,r,s,a),s||(this.themeManager=new Os(this.opts.themes,r),(this.svgWrapper===null||this.clear)&&(this.svgWrapper=new Ns(this.themeManager,t,this.opts,this.clear))),o.processGraph(),this.svgWrapper.determineDimensions(o.graph.vertices),this.drawAtomHighlights(o.opts.debug),this.drawEdges(o.opts.debug),this.drawVertices(o.opts.debug),i!==null&&this.drawWeights(i,n),o.opts.debug&&(console.log(o.graph),console.log(o.rings),console.log(o.ringConnections)),this.svgWrapper.constructSvg(),i!==null&&(this.opts.padding=u.padding,this.opts.compactDrawing=u.padding),t}drawCanvas(e,t,r="light",i=!1){let s=null;typeof t=="string"||t instanceof String?s=document.getElementById(t):s=t;let a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttributeNS(null,"viewBox","0 0 500 500"),a.setAttributeNS(null,"width","500"),a.setAttributeNS(null,"height","500"),a.setAttributeNS(null,"style","visibility: hidden: position: absolute; left: -1000px"),document.body.appendChild(a),this.svgDrawer.draw(e,a,r,i),this.svgDrawer.svgWrapper.toCanvas(s,this.svgDrawer.opts.width,this.svgDrawer.opts.height),document.body.removeChild(a),t}drawAromaticityRing(e){this.svgWrapper.drawRing(e.center.x,e.center.y,e.getSize())}drawEdges(e){let t=this.preprocessor,r=t.graph,i=t.rings,s=Array(this.preprocessor.graph.edges.length);if(s.fill(!1),r.traverseBF(0,n=>{let u=r.getEdges(n.id);for(var o=0;o<u.length;o++){let d=u[o];s[d]||(s[d]=!0,this.drawEdge(d,e))}}),!this.bridgedRing)for(var a=0;a<i.length;a++){let n=i[a];t.isRingAromatic(n)&&this.drawAromaticityRing(n)}}drawEdge(e,t){let r=this.preprocessor,i=r.opts,s=this.svgWrapper,a=r.graph.edges[e],n=r.graph.vertices[a.sourceId],u=r.graph.vertices[a.targetId],o=n.value.element,d=u.value.element;if((!n.value.isDrawn||!u.value.isDrawn)&&r.opts.atomVisualization==="default")return;let g=n.position,f=u.position,b=r.getEdgeNormals(a),y=$i.clone(b);if(y[0].multiplyScalar(10).add(g),y[1].multiplyScalar(10).add(g),a.bondType==="="||r.getRingbondType(n,u)==="="||a.isPartOfAromaticRing&&r.bridgedRing){let S=r.areVerticesInSameRing(n,u),P=r.chooseSide(n,u,y);if(S){let T=r.getLargestOrAromaticCommonRing(n,u).center;b[0].multiplyScalar(i.bondSpacing),b[1].multiplyScalar(i.bondSpacing);let x=null;T.sameSideAs(n.position,u.position,Ne.add(g,b[0]))?x=new Ve(Ne.add(g,b[0]),Ne.add(f,b[0]),o,d):x=new Ve(Ne.add(g,b[1]),Ne.add(f,b[1]),o,d),x.shorten(i.bondLength-i.shortBondLength*i.bondLength),a.isPartOfAromaticRing?s.drawLine(x,!0):s.drawLine(x),s.drawLine(new Ve(g,f,o,d))}else if(a.center||n.isTerminal()&&u.isTerminal()||P.anCount==0&&P.bnCount>1||P.bnCount==0&&P.anCount>1){this.multiplyNormals(b,i.halfBondSpacing);let B=new Ve(Ne.add(g,b[0]),Ne.add(f,b[0]),o,d),T=new Ve(Ne.add(g,b[1]),Ne.add(f,b[1]),o,d);s.drawLine(B),s.drawLine(T)}else if(P.sideCount[0]>P.sideCount[1]||P.totalSideCount[0]>P.totalSideCount[1]){this.multiplyNormals(b,i.bondSpacing);let B=new Ve(Ne.add(g,b[0]),Ne.add(f,b[0]),o,d);B.shorten(i.bondLength-i.shortBondLength*i.bondLength),s.drawLine(B),s.drawLine(new Ve(g,f,o,d))}else if(P.sideCount[0]<P.sideCount[1]||P.totalSideCount[0]<=P.totalSideCount[1]){this.multiplyNormals(b,i.bondSpacing);let B=new Ve(Ne.add(g,b[1]),Ne.add(f,b[1]),o,d);B.shorten(i.bondLength-i.shortBondLength*i.bondLength),s.drawLine(B),s.drawLine(new Ve(g,f,o,d))}}else if(a.bondType==="#"){b[0].multiplyScalar(i.bondSpacing/1.5),b[1].multiplyScalar(i.bondSpacing/1.5);let S=new Ve(Ne.add(g,b[0]),Ne.add(f,b[0]),o,d),P=new Ve(Ne.add(g,b[1]),Ne.add(f,b[1]),o,d);s.drawLine(S),s.drawLine(P),s.drawLine(new Ve(g,f,o,d))}else if(a.bondType!=="."){let S=n.value.isStereoCenter,P=u.value.isStereoCenter;a.wedge==="up"?s.drawWedge(new Ve(g,f,o,d,S,P)):a.wedge==="down"?s.drawDashedWedge(new Ve(g,f,o,d,S,P)):s.drawLine(new Ve(g,f,o,d,S,P))}if(t){let S=Ne.midpoint(g,f);s.drawDebugText(S.x,S.y,"e: "+e)}}drawAtomHighlights(e){let t=this.preprocessor;t.opts;let r=t.graph;t.rings;let i=this.svgWrapper;for(var s=0;s<r.vertices.length;s++){let n=r.vertices[s],u=n.value;for(var a=0;a<t.highlight_atoms.length;a++){let o=t.highlight_atoms[a];u.class===o[0]&&i.drawAtomHighlight(n.position.x,n.position.y,o[1])}}}drawVertices(e){let t=this.preprocessor,r=t.opts,i=t.graph,s=t.rings,a=this.svgWrapper;for(var n=i.vertices.length,n=0;n<i.vertices.length;n++){let o=i.vertices[n],d=o.value,g=0,f=0,b=o.value.bondCount,y=d.element,S=As.maxBonds[y]-b,P=o.getTextDirection(i.vertices,d.hasAttachedPseudoElements),B=r.terminalCarbons||y!=="C"||d.hasAttachedPseudoElements?o.isTerminal():!1,T=d.element==="C";if(i.vertices.length<3&&(T=!1),d.element==="N"&&d.isPartOfAromaticRing&&(S=0),d.bracket&&(S=d.bracket.hcount,g=d.bracket.charge,f=d.bracket.isotope),r.atomVisualization==="allballs")a.drawBall(o.position.x,o.position.y,y);else if(d.isDrawn&&(!T||d.drawExplicit||B||d.hasAttachedPseudoElements)||i.vertices.length===1)if(r.atomVisualization==="default"){let x=d.getAttachedPseudoElements();d.hasAttachedPseudoElements&&i.vertices.length===Object.keys(x).length+1&&(P="right"),a.drawText(o.position.x,o.position.y,y,S,P,B,g,f,i.vertices.length,x)}else r.atomVisualization==="balls"&&a.drawBall(o.position.x,o.position.y,y);else if(o.getNeighbourCount()===2&&o.forcePositioned==!0){let x=i.vertices[o.neighbours[0]].position,M=i.vertices[o.neighbours[1]].position,L=Ne.threePointangle(o.position,x,M);Math.abs(Math.PI-L)<.1&&a.drawPoint(o.position.x,o.position.y,y)}if(e){let x="v: "+o.id+" "+$i.print(d.ringbonds);a.drawDebugText(o.position.x,o.position.y,x)}}if(r.debug)for(var n=0;n<s.length;n++){let o=s[n].center;a.drawDebugPoint(o.x,o.y,"r: "+s[n].id)}}drawWeights(e,t){if(e.every(s=>s===0))return;if(e.length!==this.preprocessor.graph.atomIdxToVertexId.length)throw new Error("The number of weights supplied must be equal to the number of (heavy) atoms in the molecule.");let r=[];for(const s of this.preprocessor.graph.atomIdxToVertexId){let a=this.preprocessor.graph.vertices[s];r.push(new Ne(a.position.x-this.svgWrapper.minX,a.position.y-this.svgWrapper.minY))}let i=new Rs(r,e,this.svgWrapper.drawingWidth,this.svgWrapper.drawingHeight,this.opts.weights.sigma,this.opts.weights.interval,this.opts.weights.colormap,this.opts.weights.opacity,t);i.draw(),this.svgWrapper.addLayer(i.getSVG())}getTotalOverlapScore(){return this.preprocessor.getTotalOverlapScore()}getMolecularFormula(e=null){return this.preprocessor.getMolecularFormula(e)}multiplyNormals(e,t){e[0].multiplyScalar(t),e[1].multiplyScalar(t)}};var Pr=Es;const Ts=Pr;let Ms=class{constructor(e){this.svgDrawer=new Ts(e)}draw(e,t,r="light",i=!1,s=[]){let a=null;typeof t=="string"||t instanceof String?a=document.getElementById(t):a=t;let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttributeNS(null,"viewBox","0 0 "+this.svgDrawer.opts.width+" "+this.svgDrawer.opts.height),n.setAttributeNS(null,"width",this.svgDrawer.opts.width+""),n.setAttributeNS(null,"height",this.svgDrawer.opts.height+""),this.svgDrawer.draw(e,n,r,i,s),this.svgDrawer.svgWrapper.toCanvas(a,this.svgDrawer.opts.width,this.svgDrawer.opts.height)}getTotalOverlapScore(){return this.svgDrawer.getTotalOverlapScore()}getMolecularFormula(){this.svgDrawer.getMolecularFormula()}};var Ps=Ms,fi=function(){function X(r,i){function s(){this.constructor=r}s.prototype=i.prototype,r.prototype=new s}function e(r,i,s,a){this.message=r,this.expected=i,this.found=s,this.location=a,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)}X(e,Error),e.buildMessage=function(r,i){var s={literal:function(f){return'"'+n(f.text)+'"'},class:function(f){var b="",y;for(y=0;y<f.parts.length;y++)b+=f.parts[y]instanceof Array?u(f.parts[y][0])+"-"+u(f.parts[y][1]):u(f.parts[y]);return"["+(f.inverted?"^":"")+b+"]"},any:function(f){return"any character"},end:function(f){return"end of input"},other:function(f){return f.description}};function a(f){return f.charCodeAt(0).toString(16).toUpperCase()}function n(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}function u(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}function o(f){return s[f.type](f)}function d(f){var b=new Array(f.length),y,S;for(y=0;y<f.length;y++)b[y]=o(f[y]);if(b.sort(),b.length>0){for(y=1,S=1;y<b.length;y++)b[y-1]!==b[y]&&(b[S]=b[y],S++);b.length=S}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function g(f){return f?'"'+n(f)+'"':"end of input"}return"Expected "+d(r)+" but "+g(i)+" found."};function t(r,i){i=i!==void 0?i:{};var s=r.split("(").length-1,a=r.split(")").length-1;if(s!==a)throw Sr("The number of opening parentheses does not match the number of closing parentheses.",0);var n={},u={chain:ye},o=ye,d=function(E){for(var v=[],I=[],O=0;O<E[1].length;O++)v.push(E[1][O]);for(var O=0;O<E[2].length;O++){var H=E[2][O][0]?E[2][O][0]:"-";I.push({bond:H,id:E[2][O][1]})}for(var O=0;O<E[3].length;O++)v.push(E[3][O]);for(var O=0;O<E[6].length;O++)v.push(E[6][O]);return{atom:E[0],isBracket:!!E[0].element,branches:v,branchCount:v.length,ringbonds:I,ringbondCount:I.length,bond:E[4]?E[4]:"-",next:E[5],hasNext:!!E[5]}},g="(",f=pe("(",!1),b=")",y=pe(")",!1),S=function(E){var v=E[1]?E[1]:"-";return E[2].branchBond=v,E[2]},P=function(E){return E},B=/^[\-=#$:\/\\.]/,T=nt(["-","=","#","$",":","/","\\","."],!1,!1),x=function(E){return E},M="[",L=pe("[",!1),J="se",oe=pe("se",!1),Q="as",K=pe("as",!1),j="]",be=pe("]",!1),le=function(E){return{isotope:E[1],element:E[2],chirality:E[3],hcount:E[4],charge:E[5],class:E[6]}},Oe="B",Ke=pe("B",!1),ze="r",qe=pe("r",!1),Je="C",ct=pe("C",!1),we="l",Re=pe("l",!1),xt=/^[NOPSFI]/,Nt=nt(["N","O","P","S","F","I"],!1,!1),vt=function(E){return E.length>1?E.join(""):E},Dt=/^[bcnops]/,qt=nt(["b","c","n","o","p","s"],!1,!1),kt="*",Z=pe("*",!1),$e=function(E){return E},et=/^[A-Z]/,_e=nt([["A","Z"]],!1,!1),tt=/^[a-z]/,Me=nt([["a","z"]],!1,!1),Ye=function(E){return E.join("")},Ue="%",Ht=pe("%",!1),Qe=/^[1-9]/,Le=nt([["1","9"]],!1,!1),Ee=/^[0-9]/,Ie=nt([["0","9"]],!1,!1),mt=function(E){return E.length==1?Number(E):Number(E.join("").replace("%",""))},ft="@",zt=pe("@",!1),Ae="TH",_t=pe("TH",!1),bt=/^[12]/,rt=nt(["1","2"],!1,!1),dt="AL",Ot=pe("AL",!1),Rt="SP",Ct=pe("SP",!1),jt=/^[1-3]/,Br=nt([["1","3"]],!1,!1),cr="TB",$r=pe("TB",!1),er="OH",fr=pe("OH",!1),Lr=function(E){return E[1]?E[1]=="@"?"@@":E[1].join("").replace(",",""):"@"},Ir=function(E){return E},dr="+",pr=pe("+",!1),vr=function(E){return E[1]?E[1]!="+"?Number(E[1].join("")):2:1},tr="-",wt=pe("-",!1),Dr=function(E){return E[1]?E[1]!="-"?-Number(E[1].join("")):-2:-1},kr="H",mr=pe("H",!1),Yt=function(E){return E[1]?Number(E[1]):1},br=":",Hr=pe(":",!1),zr=/^[0]/,Ut=nt(["0"],!1,!1),_r=function(E){return Number(E[1][0]+E[1][1].join(""))},Cr=function(E){return Number(E.join(""))},m=0,Et=[{line:1,column:1}],it=0,rr=[],Ft;if("startRule"in i){if(!(i.startRule in u))throw new Error(`Can't start parsing from rule "`+i.startRule+'".');o=u[i.startRule]}function pe(E,v){return{type:"literal",text:E,ignoreCase:v}}function nt(E,v,I){return{type:"class",parts:E,inverted:v,ignoreCase:I}}function Fr(){return{type:"end"}}function wr(E){var v=Et[E],I;if(v)return v;for(I=E-1;!Et[I];)I--;for(v=Et[I],v={line:v.line,column:v.column};I<E;)r.charCodeAt(I)===10?(v.line++,v.column=1):v.column++,I++;return Et[E]=v,v}function yr(E,v){var I=wr(E),O=wr(v);return{start:{offset:E,line:I.line,column:I.column},end:{offset:v,line:O.line,column:O.column}}}function q(E){m<it||(m>it&&(it=m,rr=[]),rr.push(E))}function Sr(E,v){return new e(E,null,null,v)}function ir(E,v,I){return new e(e.buildMessage(E,v),E,v,I)}function ye(){var E,v,I,O,H,F,Y,Te,Fe,ot;if(E=m,v=m,I=Wr(),I!==n){for(O=[],H=st();H!==n;)O.push(H),H=st();if(O!==n){for(H=[],F=m,Y=Tt(),Y===n&&(Y=null),Y!==n?(Te=Nr(),Te!==n?(Y=[Y,Te],F=Y):(m=F,F=n)):(m=F,F=n);F!==n;)H.push(F),F=m,Y=Tt(),Y===n&&(Y=null),Y!==n?(Te=Nr(),Te!==n?(Y=[Y,Te],F=Y):(m=F,F=n)):(m=F,F=n);if(H!==n){for(F=[],Y=st();Y!==n;)F.push(Y),Y=st();if(F!==n)if(Y=Tt(),Y===n&&(Y=null),Y!==n)if(Te=ye(),Te===n&&(Te=null),Te!==n){for(Fe=[],ot=st();ot!==n;)Fe.push(ot),ot=st();Fe!==n?(I=[I,O,H,F,Y,Te,Fe],v=I):(m=v,v=n)}else m=v,v=n;else m=v,v=n;else m=v,v=n}else m=v,v=n}else m=v,v=n}else m=v,v=n;return v!==n&&(v=d(v)),E=v,E}function st(){var E,v,I,O,H,F;return E=m,v=m,r.charCodeAt(m)===40?(I=g,m++):(I=n,q(f)),I!==n?(O=Tt(),O===n&&(O=null),O!==n?(H=ye(),H!==n?(r.charCodeAt(m)===41?(F=b,m++):(F=n,q(y)),F!==n?(I=[I,O,H,F],v=I):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(v=S(v)),E=v,E}function Wr(){var E,v;return E=m,v=Xr(),v===n&&(v=Ar(),v===n&&(v=Mt(),v===n&&(v=yt()))),v!==n&&(v=P(v)),E=v,E}function Tt(){var E,v;if(E=m,B.test(r.charAt(m))){if(v=r.charAt(m),v===r.charAt(m+1))throw v=n,Sr("The parser encountered a bond repetition.",m+1);m++}else v=n,q(T);return v!==n&&(v=x(v)),E=v,E}function Mt(){var E,v,I,O,H,F,Y,Te,Fe,ot;return E=m,v=m,r.charCodeAt(m)===91?(I=M,m++):(I=n,q(L)),I!==n?(O=nr(),O===n&&(O=null),O!==n?(r.substr(m,2)===J?(H=J,m+=2):(H=n,q(oe)),H===n&&(r.substr(m,2)===Q?(H=Q,m+=2):(H=n,q(K)),H===n&&(H=Ar(),H===n&&(H=xr(),H===n&&(H=yt())))),H!==n?(F=Vr(),F===n&&(F=null),F!==n?(Y=Gr(),Y===n&&(Y=null),Y!==n?(Te=qr(),Te===n&&(Te=null),Te!==n?(Fe=Zr(),Fe===n&&(Fe=null),Fe!==n?(r.charCodeAt(m)===93?(ot=j,m++):(ot=n,q(be)),ot!==n?(I=[I,O,H,F,Y,Te,Fe,ot],v=I):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(v=le(v)),E=v,E}function Xr(){var E,v,I,O;return E=m,v=m,r.charCodeAt(m)===66?(I=Oe,m++):(I=n,q(Ke)),I!==n?(r.charCodeAt(m)===114?(O=ze,m++):(O=n,q(qe)),O===n&&(O=null),O!==n?(I=[I,O],v=I):(m=v,v=n)):(m=v,v=n),v===n&&(v=m,r.charCodeAt(m)===67?(I=Je,m++):(I=n,q(ct)),I!==n?(r.charCodeAt(m)===108?(O=we,m++):(O=n,q(Re)),O===n&&(O=null),O!==n?(I=[I,O],v=I):(m=v,v=n)):(m=v,v=n),v===n&&(xt.test(r.charAt(m))?(v=r.charAt(m),m++):(v=n,q(Nt)))),v!==n&&(v=vt(v)),E=v,E}function Ar(){var E,v;return E=m,Dt.test(r.charAt(m))?(v=r.charAt(m),m++):(v=n,q(qt)),v!==n&&(v=P(v)),E=v,E}function yt(){var E,v;return E=m,r.charCodeAt(m)===42?(v=kt,m++):(v=n,q(Z)),v!==n&&(v=$e(v)),E=v,E}function xr(){var E,v,I,O;return E=m,v=m,et.test(r.charAt(m))?(I=r.charAt(m),m++):(I=n,q(_e)),I!==n?(tt.test(r.charAt(m))?(O=r.charAt(m),m++):(O=n,q(Me)),O===n&&(O=null),O!==n?(I=[I,O],v=I):(m=v,v=n)):(m=v,v=n),v!==n&&(v=Ye(v)),E=v,E}function Nr(){var E,v,I,O,H;return E=m,v=m,r.charCodeAt(m)===37?(I=Ue,m++):(I=n,q(Ht)),I!==n?(Qe.test(r.charAt(m))?(O=r.charAt(m),m++):(O=n,q(Le)),O!==n?(Ee.test(r.charAt(m))?(H=r.charAt(m),m++):(H=n,q(Ie)),H!==n?(I=[I,O,H],v=I):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v===n&&(Ee.test(r.charAt(m))?(v=r.charAt(m),m++):(v=n,q(Ie))),v!==n&&(v=mt(v)),E=v,E}function Vr(){var E,v,I,O,H,F,Y;return E=m,v=m,r.charCodeAt(m)===64?(I=ft,m++):(I=n,q(zt)),I!==n?(r.charCodeAt(m)===64?(O=ft,m++):(O=n,q(zt)),O===n&&(O=m,r.substr(m,2)===Ae?(H=Ae,m+=2):(H=n,q(_t)),H!==n?(bt.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,q(rt)),F!==n?(H=[H,F],O=H):(m=O,O=n)):(m=O,O=n),O===n&&(O=m,r.substr(m,2)===dt?(H=dt,m+=2):(H=n,q(Ot)),H!==n?(bt.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,q(rt)),F!==n?(H=[H,F],O=H):(m=O,O=n)):(m=O,O=n),O===n&&(O=m,r.substr(m,2)===Rt?(H=Rt,m+=2):(H=n,q(Ct)),H!==n?(jt.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,q(Br)),F!==n?(H=[H,F],O=H):(m=O,O=n)):(m=O,O=n),O===n&&(O=m,r.substr(m,2)===cr?(H=cr,m+=2):(H=n,q($r)),H!==n?(Qe.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,q(Le)),F!==n?(Ee.test(r.charAt(m))?(Y=r.charAt(m),m++):(Y=n,q(Ie)),Y===n&&(Y=null),Y!==n?(H=[H,F,Y],O=H):(m=O,O=n)):(m=O,O=n)):(m=O,O=n),O===n&&(O=m,r.substr(m,2)===er?(H=er,m+=2):(H=n,q(fr)),H!==n?(Qe.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,q(Le)),F!==n?(Ee.test(r.charAt(m))?(Y=r.charAt(m),m++):(Y=n,q(Ie)),Y===n&&(Y=null),Y!==n?(H=[H,F,Y],O=H):(m=O,O=n)):(m=O,O=n)):(m=O,O=n)))))),O===n&&(O=null),O!==n?(I=[I,O],v=I):(m=v,v=n)):(m=v,v=n),v!==n&&(v=Lr(v)),E=v,E}function qr(){var E,v;return E=m,v=Yr(),v===n&&(v=Ur()),v!==n&&(v=Ir(v)),E=v,E}function Yr(){var E,v,I,O,H,F;return E=m,v=m,r.charCodeAt(m)===43?(I=dr,m++):(I=n,q(pr)),I!==n?(r.charCodeAt(m)===43?(O=dr,m++):(O=n,q(pr)),O===n&&(O=m,Qe.test(r.charAt(m))?(H=r.charAt(m),m++):(H=n,q(Le)),H!==n?(Ee.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,q(Ie)),F===n&&(F=null),F!==n?(H=[H,F],O=H):(m=O,O=n)):(m=O,O=n)),O===n&&(O=null),O!==n?(I=[I,O],v=I):(m=v,v=n)):(m=v,v=n),v!==n&&(v=vr(v)),E=v,E}function Ur(){var E,v,I,O,H,F;return E=m,v=m,r.charCodeAt(m)===45?(I=tr,m++):(I=n,q(wt)),I!==n?(r.charCodeAt(m)===45?(O=tr,m++):(O=n,q(wt)),O===n&&(O=m,Qe.test(r.charAt(m))?(H=r.charAt(m),m++):(H=n,q(Le)),H!==n?(Ee.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,q(Ie)),F===n&&(F=null),F!==n?(H=[H,F],O=H):(m=O,O=n)):(m=O,O=n)),O===n&&(O=null),O!==n?(I=[I,O],v=I):(m=v,v=n)):(m=v,v=n),v!==n&&(v=Dr(v)),E=v,E}function Gr(){var E,v,I,O;return E=m,v=m,r.charCodeAt(m)===72?(I=kr,m++):(I=n,q(mr)),I!==n?(Ee.test(r.charAt(m))?(O=r.charAt(m),m++):(O=n,q(Ie)),O===n&&(O=null),O!==n?(I=[I,O],v=I):(m=v,v=n)):(m=v,v=n),v!==n&&(v=Yt(v)),E=v,E}function Zr(){var E,v,I,O,H,F,Y;if(E=m,v=m,r.charCodeAt(m)===58?(I=br,m++):(I=n,q(Hr)),I!==n){if(O=m,Qe.test(r.charAt(m))?(H=r.charAt(m),m++):(H=n,q(Le)),H!==n){for(F=[],Ee.test(r.charAt(m))?(Y=r.charAt(m),m++):(Y=n,q(Ie));Y!==n;)F.push(Y),Ee.test(r.charAt(m))?(Y=r.charAt(m),m++):(Y=n,q(Ie));F!==n?(H=[H,F],O=H):(m=O,O=n)}else m=O,O=n;O===n&&(zr.test(r.charAt(m))?(O=r.charAt(m),m++):(O=n,q(Ut))),O!==n?(I=[I,O],v=I):(m=v,v=n)}else m=v,v=n;return v!==n&&(v=_r(v)),E=v,E}function nr(){var E,v,I,O,H;return E=m,v=m,Qe.test(r.charAt(m))?(I=r.charAt(m),m++):(I=n,q(Le)),I!==n?(Ee.test(r.charAt(m))?(O=r.charAt(m),m++):(O=n,q(Ie)),O===n&&(O=null),O!==n?(Ee.test(r.charAt(m))?(H=r.charAt(m),m++):(H=n,q(Ie)),H===n&&(H=null),H!==n?(I=[I,O,H],v=I):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(v=Cr(v)),E=v,E}if(Ft=o(),Ft!==n&&m===r.length)return Ft;throw Ft!==n&&m<r.length&&q(Fr()),ir(rr,it<r.length?r.charAt(it):null,it<r.length?yr(it,it+1):yr(it,it))}return{SyntaxError:e,parse:t}}();const ii=fi;let Bs=class{constructor(e){this.reactantsSmiles=[],this.reagentsSmiles=[],this.productsSmiles=[],this.reactantsWeights=[],this.reagentsWeights=[],this.productsWeights=[],this.reactants=[],this.reagents=[],this.products=[];let t=e.split(">");if(t.length!==3)throw new Error("Invalid reaction SMILES. Did you add fewer than or more than two '>'?");t[0]!==""&&(this.reactantsSmiles=t[0].split(".")),t[1]!==""&&(this.reagentsSmiles=t[1].split(".")),t[2]!==""&&(this.productsSmiles=t[2].split("."));for(var r=0;r<this.reactantsSmiles.length;r++)this.reactants.push(ii.parse(this.reactantsSmiles[r]));for(var r=0;r<this.reagentsSmiles.length;r++)this.reagents.push(ii.parse(this.reagentsSmiles[r]));for(var r=0;r<this.productsSmiles.length;r++)this.products.push(ii.parse(this.productsSmiles[r]))}};var $s=Bs;const Ls=$s;let Is=class{static parse(e){return new Ls(e)}};var Ki=Is;const Ds={C2H4O2:"acetic acid",C3H6O:"acetone",C2H3N:"acetonitrile",C6H6:"benzene",CCl4:"carbon tetrachloride",C6H5Cl:"chlorobenzene",CHCl3:"chloroform",C6H12:"cyclohexane",C2H4Cl2:"1,2-dichloroethane",C4H10O3:"diethylene glycol",C6H14O3:"diglyme",C4H10O2:"DME",C3H7NO:"DMF",C2H6OS:"DMSO",C2H6O:"ethanol",C2H6O2:"ethylene glycol",C3H8O3:"glycerin",C7H16:"heptane",C6H18N3OP:"HMPA",C6H18N3P:"HMPT",C6H14:"hexane",CH4O:"methanol",C5H12O:"MTBE",CH2Cl2:"methylene chloride",CH5H9NO:"NMP",CH3NO2:"nitromethane",C5H12:"pentane",C5H5N:"pyridine",C7H8:"toluene",C6H15N:"triethyl amine",H2O:"water"};var ks=Ds;const Hs=Pr,ni=ci,zs=gi,_s=ui,Li=ks;let Fs=class{constructor(e,t){this.defaultOptions={scale:t.scale>0?t.scale:1,fontSize:t.fontSizeLarge*.8,fontFamily:"Arial, Helvetica, sans-serif",spacing:10,plus:{size:9,thickness:1},arrow:{length:t.bondLength*4,headSize:6,thickness:1,margin:3},weights:{normalize:!1}},this.opts=zs.extend(!0,this.defaultOptions,e),this.drawer=new Hs(t),this.molOpts=this.drawer.opts}draw(e,t,r="light",i=null,s="{reagents}",a="",n=!1){if(this.themeManager=new _s(this.molOpts.themes,r),this.opts.weights.normalize){let B=-Number.MAX_SAFE_INTEGER,T=Number.MAX_SAFE_INTEGER;if(i.hasOwnProperty("reactants"))for(let M=0;M<i.reactants.length;M++)for(let L=0;L<i.reactants[M].length;L++)i.reactants[M][L]<T&&(T=i.reactants[M][L]),i.reactants[M][L]>B&&(B=i.reactants[M][L]);if(i.hasOwnProperty("reagents"))for(let M=0;M<i.reagents.length;M++)for(let L=0;L<i.reagents[M].length;L++)i.reagents[M][L]<T&&(T=i.reagents[M][L]),i.reagents[M][L]>B&&(B=i.reagents[M][L]);if(i.hasOwnProperty("products"))for(let M=0;M<i.products.length;M++)for(let L=0;L<i.products[M].length;L++)i.products[M][L]<T&&(T=i.products[M][L]),i.products[M][L]>B&&(B=i.products[M][L]);let x=Math.max(Math.abs(T),Math.abs(B));if(x===0&&(x=1),i.hasOwnProperty("reactants"))for(let M=0;M<i.reactants.length;M++)for(let L=0;L<i.reactants[M].length;L++)i.reactants[M][L]/=x;if(i.hasOwnProperty("reagents"))for(let M=0;M<i.reagents.length;M++)for(let L=0;L<i.reagents[M].length;L++)i.reagents[M][L]/=x;if(i.hasOwnProperty("products"))for(let M=0;M<i.products.length;M++)for(let L=0;L<i.products[M].length;L++)i.products[M][L]/=x}let u=null;for(t===null||t==="svg"?(u=document.createElementNS("http://www.w3.org/2000/svg","svg"),u.setAttribute("xmlns","http://www.w3.org/2000/svg"),u.setAttributeNS(null,"width","500"),u.setAttributeNS(null,"height","500")):typeof t=="string"||t instanceof String?u=document.getElementById(t):u=t;u.firstChild;)u.removeChild(u.firstChild);let o=[],d=0;for(var g=0;g<e.reactants.length;g++){g>0&&o.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let B=null;i&&i.hasOwnProperty("reactants")&&i.reactants.length>g&&(B=i.reactants[g]);let T=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(e.reactants[g],T,r,B,n,[],this.opts.weights.normalize);let x={width:T.viewBox.baseVal.width*this.opts.scale,height:T.viewBox.baseVal.height*this.opts.scale,svg:T};o.push(x),x.height>d&&(d=x.height)}o.push({width:this.opts.arrow.length*this.opts.scale,height:this.opts.arrow.headSize*2*this.opts.scale,svg:this.getArrow()});let f="";for(var g=0;g<e.reagents.length;g++){g>0&&(f+=", ");let T=this.drawer.getMolecularFormula(e.reagents[g]);T in Li&&(T=Li[T]),f+=ni.replaceNumbersWithSubscript(T)}s=s.replace("{reagents}",f);const b=ni.writeText(s,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale);let y=(this.opts.arrow.length*this.opts.scale-b.width)/2;o.push({svg:b.svg,height:b.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+y,offsetY:-(b.height/2)-this.opts.arrow.margin,position:"relative"});const S=ni.writeText(a,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale);y=(this.opts.arrow.length*this.opts.scale-S.width)/2,o.push({svg:S.svg,height:S.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+y,offsetY:S.height/2+this.opts.arrow.margin,position:"relative"});for(var g=0;g<e.products.length;g++){g>0&&o.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let T=null;i&&i.hasOwnProperty("products")&&i.products.length>g&&(T=i.products[g]);let x=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(e.products[g],x,r,T,n,[],this.opts.weights.normalize);let M={width:x.viewBox.baseVal.width*this.opts.scale,height:x.viewBox.baseVal.height*this.opts.scale,svg:x};o.push(M),M.height>d&&(d=M.height)}let P=0;return o.forEach(B=>{let T=B.offsetX??0,x=B.offsetY??0;B.svg.setAttributeNS(null,"x",Math.round(P+T)),B.svg.setAttributeNS(null,"y",Math.round((d-B.height)/2+x)),B.svg.setAttributeNS(null,"width",Math.round(B.width)),B.svg.setAttributeNS(null,"height",Math.round(B.height)),u.appendChild(B.svg),B.position!=="relative"&&(P+=Math.round(B.width+this.opts.spacing+T))}),u.setAttributeNS(null,"viewBox",`0 0 ${P} ${d}`),u.style.width=P+"px",u.style.height=d+"px",u}getPlus(){let e=this.opts.plus.size,t=this.opts.plus.thickness,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=document.createElementNS("http://www.w3.org/2000/svg","rect");return r.setAttributeNS(null,"id","plus"),i.setAttributeNS(null,"x",0),i.setAttributeNS(null,"y",e/2-t/2),i.setAttributeNS(null,"width",e),i.setAttributeNS(null,"height",t),i.setAttributeNS(null,"fill",this.themeManager.getColor("C")),s.setAttributeNS(null,"x",e/2-t/2),s.setAttributeNS(null,"y",0),s.setAttributeNS(null,"width",t),s.setAttributeNS(null,"height",e),s.setAttributeNS(null,"fill",this.themeManager.getColor("C")),r.appendChild(i),r.appendChild(s),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${e}`),r}getArrowhead(){let e=this.opts.arrow.headSize,t=document.createElementNS("http://www.w3.org/2000/svg","marker"),r=document.createElementNS("http://www.w3.org/2000/svg","polygon");return t.setAttributeNS(null,"id","arrowhead"),t.setAttributeNS(null,"viewBox",`0 0 ${e} ${e}`),t.setAttributeNS(null,"markerUnits","userSpaceOnUse"),t.setAttributeNS(null,"markerWidth",e),t.setAttributeNS(null,"markerHeight",e),t.setAttributeNS(null,"refX",0),t.setAttributeNS(null,"refY",e/2),t.setAttributeNS(null,"orient","auto"),t.setAttributeNS(null,"fill",this.themeManager.getColor("C")),r.setAttributeNS(null,"points",`0 0, ${e} ${e/2}, 0 ${e}`),t.appendChild(r),t}getCDArrowhead(){let e=this.opts.arrow.headSize,t=e*(7/4.5),r=document.createElementNS("http://www.w3.org/2000/svg","marker"),i=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttributeNS(null,"id","arrowhead"),r.setAttributeNS(null,"viewBox",`0 0 ${t} ${e}`),r.setAttributeNS(null,"markerUnits","userSpaceOnUse"),r.setAttributeNS(null,"markerWidth",t*2),r.setAttributeNS(null,"markerHeight",e*2),r.setAttributeNS(null,"refX",2.2),r.setAttributeNS(null,"refY",2.2),r.setAttributeNS(null,"orient","auto"),r.setAttributeNS(null,"fill",this.themeManager.getColor("C")),i.setAttributeNS(null,"style","fill-rule:nonzero;"),i.setAttributeNS(null,"d","m 0 0 l 7 2.25 l -7 2.25 c 0 0 0.735 -1.084 0.735 -2.28 c 0 -1.196 -0.735 -2.22 -0.735 -2.22 z"),r.appendChild(i),r}getArrow(){let e=this.opts.arrow.headSize,t=this.opts.arrow.length,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","defs"),s=document.createElementNS("http://www.w3.org/2000/svg","line");return i.appendChild(this.getCDArrowhead()),r.appendChild(i),r.setAttributeNS(null,"id","arrow"),s.setAttributeNS(null,"x1",0),s.setAttributeNS(null,"y1",-this.opts.arrow.thickness/2),s.setAttributeNS(null,"x2",t),s.setAttributeNS(null,"y2",-this.opts.arrow.thickness/2),s.setAttributeNS(null,"stroke-width",this.opts.arrow.thickness),s.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),s.setAttributeNS(null,"marker-end","url(#arrowhead)"),r.appendChild(s),r.setAttributeNS(null,"viewBox",`0 ${-e/2} ${t+e*(7/4.5)} ${e}`),r}};var Ji=Fs;const Ws=fi,Xs=Ki,Vs=Pr,qs=Ji,Ii=ci,Ys=gi;let Us=class li{constructor(e={},t={}){this.drawer=new Vs(e),this.reactionDrawer=new qs(t,JSON.parse(JSON.stringify(this.drawer.opts)))}static apply(e={},t={},r="data-smiles",i="light",s=null,a=null){new li(e,t).apply(r,i,s,a)}apply(e="data-smiles",t="light",r=null,i=null){document.querySelectorAll(`[${e}]`).forEach(a=>{let n=a.getAttribute(e);if(n===null)throw Error("No SMILES provided.");let u=t,o=null;if(a.hasAttribute("data-smiles-theme")&&(u=a.getAttribute("data-smiles-theme")),a.hasAttribute("data-smiles-weights")&&(o=a.getAttribute("data-smiles-weights").split(",").map(parseFloat)),(a.hasAttribute("data-smiles-reactant-weights")||a.hasAttribute("data-smiles-reagent-weights")||a.hasAttribute("data-smiles-product-weights"))&&(o={reactants:[],reagents:[],products:[]},a.hasAttribute("data-smiles-reactant-weights")&&(o.reactants=a.getAttribute("data-smiles-reactant-weights").split(";").map(d=>d.split(",").map(parseFloat))),a.hasAttribute("data-smiles-reagent-weights")&&(o.reagents=a.getAttribute("data-smiles-reagent-weights").split(";").map(d=>d.split(",").map(parseFloat))),a.hasAttribute("data-smiles-product-weights")&&(o.products=a.getAttribute("data-smiles-product-weights").split(";").map(d=>d.split(",").map(parseFloat)))),a.hasAttribute("data-smiles-options")||a.hasAttribute("data-smiles-reaction-options")){let d={};a.hasAttribute("data-smiles-options")&&(d=JSON.parse(a.getAttribute("data-smiles-options").replaceAll("'",'"')));let g={};a.hasAttribute("data-smiles-reaction-options")&&(g=JSON.parse(a.getAttribute("data-smiles-reaction-options").replaceAll("'",'"'))),new li(d,g).draw(n,a,u,r,i,o)}else this.draw(n,a,u,r,i,o)})}draw(e,t,r="light",i=null,s=null,a=null){let n=[];[e,...n]=e.split(" ");let u=n.join(" "),o={};if(u.includes("__")){let g=u.substring(u.indexOf("__")+2,u.lastIndexOf("__"));o=JSON.parse(g.replaceAll("'",'"'))}let d={textAboveArrow:"{reagents}",textBelowArrow:""};if(o=Ys.extend(!0,d,o),e.includes(">"))try{this.drawReaction(e,t,r,o,a,i)}catch(g){s?s(g):console.error(g)}else try{this.drawMolecule(e,t,r,a,i)}catch(g){s?s(g):console.error(g)}}drawMolecule(e,t,r,i,s){let a=Ws.parse(e);if(t===null||t==="svg"){let n=this.drawer.draw(a,null,r,i),u=this.getDimensions(n);n.setAttributeNS(null,"width",""+u.w),n.setAttributeNS(null,"height",""+u.h),s&&s(n)}else if(t==="canvas"){let n=this.svgToCanvas(this.drawer.draw(a,null,r,i));s&&s(n)}else if(t==="img"){let n=this.svgToImg(this.drawer.draw(a,null,r,i));s&&s(n)}else t instanceof HTMLImageElement?(this.svgToImg(this.drawer.draw(a,null,r,i),t),s&&s(t)):t instanceof SVGElement?(this.drawer.draw(a,t,r,i),s&&s(t)):document.querySelectorAll(t).forEach(u=>{let o=u.nodeName.toLowerCase();o==="svg"?(this.drawer.draw(a,u,r,i),s&&s(u)):o==="canvas"?(this.svgToCanvas(this.drawer.draw(a,null,r,i),u),s&&s(u)):o==="img"&&(this.svgToImg(this.drawer.draw(a,null,r,i),u),s&&s(u))})}drawReaction(e,t,r,i,s,a){let n=Xs.parse(e);if(t===null||t==="svg"){let u=this.reactionDrawer.draw(n,null,r),o=this.getDimensions(u);u.setAttributeNS(null,"width",""+o.w),u.setAttributeNS(null,"height",""+o.h),a&&a(u)}else if(t==="canvas"){let u=this.svgToCanvas(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow));a&&a(u)}else if(t==="img"){let u=this.svgToImg(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow));a&&a(u)}else t instanceof HTMLImageElement?(this.svgToImg(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow),t),a&&a(t)):t instanceof SVGElement?(this.reactionDrawer.draw(n,t,r,s,i.textAboveArrow,i.textBelowArrow),a&&a(t)):document.querySelectorAll(t).forEach(o=>{let d=o.nodeName.toLowerCase();d==="svg"?(this.reactionDrawer.draw(n,o,r,s,i.textAboveArrow,i.textBelowArrow),this.reactionDrawer.opts.scale<=0&&(o.style.width=null,o.style.height=null),a&&a(o)):d==="canvas"?(this.svgToCanvas(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow),o),a&&a(o)):d==="img"&&(this.svgToImg(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow),o),a&&a(o))})}svgToCanvas(e,t=null){t===null&&(t=document.createElement("canvas"));let r=this.getDimensions(t,e);return Ii.svgToCanvas(e,t,r.w,r.h),t}svgToImg(e,t=null){t===null&&(t=document.createElement("img"));let r=this.getDimensions(t,e);return Ii.svgToImg(e,t,r.w,r.h),t}getDimensions(e,t=null){let r=this.drawer.opts.width,i=this.drawer.opts.height;return this.drawer.opts.scale<=0?(r===null&&(r=e.width),i===null&&(i=e.height),e.style.width!==""&&(r=parseInt(e.style.width)),e.style.height!==""&&(i=parseInt(e.style.height))):t&&(r=parseFloat(t.style.width),i=parseFloat(t.style.height)),{w:r,h:i}}};var Gs=Us;const Qi=Ps,ji=fi,en=Ki,Zs=Pr,Ks=Ji,tn=Gs,Js=Zi;var Qs=!!(typeof window<"u"&&window.document&&window.document.createElement),Ze={Version:"1.0.0"};Ze.Drawer=Qi;Ze.Parser=ji;Ze.SvgDrawer=Zs;Ze.ReactionDrawer=Ks;Ze.ReactionParser=en;Ze.GaussDrawer=Js;Ze.clean=function(X){return X.replace(/[^A-Za-z0-9@\.\+\-\?!\(\)\[\]\{\}/\\=#\$:\*]/g,"")};Ze.apply=function(X,e="canvas[data-smiles]",t="light",r=null){let i=new Qi(X),s=document.querySelectorAll(e);for(var a=0;a<s.length;a++){let n=s[a];Ze.parse(n.getAttribute("data-smiles"),function(u){i.draw(u,n,t,!1)},function(u){r&&r(u)})}};Ze.parse=function(X,e,t){try{e&&e(ji.parse(X))}catch(r){t&&t(r)}};Ze.parseReaction=function(X,e,t){try{e&&e(en.parse(X))}catch(r){t&&t(r)}};Qs&&(window.SmilesDrawer=Ze,window.SmiDrawer=tn);Ze.SmiDrawer=tn;Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(X){if(this==null)throw new TypeError("this is null or not defined");for(var e=Object(this),t=e.length>>>0,r=arguments[1],i=r>>0,s=i<0?Math.max(t+i,0):Math.min(i,t),a=arguments[2],n=a===void 0?t:a>>0,u=n<0?Math.max(t+n,0):Math.min(n,t);s<u;)e[s]=X,s++;return e}});var js=Ze;const si=kn(js),ea=Ln`:host(clabs-chat-molecule){overflow:hidden}:host(clabs-chat-molecule) .clabs--chat-molecule-container{position:relative;display:flex;overflow:hidden;box-sizing:border-box;align-items:center;border:1px solid var(--cds-border-subtle-01, #c6c6c6);border-radius:8px;background:var(--cds-background, #ffffff);block-size:var(--chat-molecule-height, "auto");inline-size:var(--chat-molecule-width, "auto");min-block-size:var(--chat-molecule-height, "246px");min-inline-size:var(--chat-molecule-width, "246px")}:host(clabs-chat-molecule) .clabs--chat-molecule-target{inline-size:var(--chat-molecule-width, "auto")}:host(clabs-chat-molecule) .clabs--chat-molecule-target .element{text-shadow:var(--cds-background, #ffffff) 0 0 6px}:host(clabs-chat-molecule) .clabs--chat-molecule-target-fullscreen{block-size:100%;inline-size:100%}:host(clabs-chat-molecule) .clabs--chat-molecule-container-loader{display:flex;align-items:center;block-size:100%;inline-size:100%}:host(clabs-chat-molecule) .clabs--chat-molecule-light .element{fill:none;font-family:IBM Plex Sans,sans-serif;font-style:normal;font-weight:400}:host(clabs-chat-molecule) .clabs--chat-molecule-dark .element{fill:none;font-family:IBM Plex Sans,sans-serif;font-style:normal;font-weight:400}:host(clabs-chat-molecule) .clabs--chat-molecule-error{padding:10px;border:1px solid var(--cds-support-error, #da1e28);border-radius:8px;color:var(--cds-support-error, #da1e28);line-height:22px}:host(clabs-chat-molecule) .clabs--chat-molecule-tester{display:none;opacity:0;visibility:hidden}:host(clabs-chat-molecule) .clabs--chat-molecule-stream-text-container{position:absolute;overflow:hidden;box-sizing:border-box;font-family:IBM Plex Mono,monospace;font-size:14px;inset-block-end:8px;inset-inline:0 0;line-height:18px;padding-inline:8px;pointer-events:none}:host(clabs-chat-molecule) .clabs--chat-molecule-stream-text-content{box-sizing:border-box;color:var(--cds-text-placeholder, rgba(22, 22, 22, .4));letter-spacing:.16px;max-inline-size:100%;-ms-overflow-style:none;overflow-x:scroll;scrollbar-width:none;white-space:nowrap}:host(clabs-chat-molecule) .clabs--chat-molecule-stream-text-content::-webkit-scrollbar{display:none}:host(clabs-chat-molecule) .clabs--chat-molecule-options{position:absolute;display:flex;flex-direction:row;inset-block-start:10px;inset-inline-end:0}:host(clabs-chat-molecule) .clabs--chat-molecule-options-hidden{visibility:hidden}:host(clabs-chat-molecule) .clabs--chat-molecule-title{position:absolute;display:flex;overflow:hidden;flex-direction:row;font-family:IBM Plex Sans,system-ui,-apple-system,BlinkMacSystemFont,".SFNSText-Regular",sans-serif;font-size:16px;font-weight:600;inset-block-end:16px;inset-inline-start:16px;line-height:24px;text-overflow:ellipsis;white-space:nowrap}:host(clabs-chat-molecule) .clabs--chat-molecule-title-thumbnail{font-size:14px;font-weight:400;inset-block-end:8px;inset-inline-start:8px}:host(clabs-chat-molecule) .clabs--chat-molecule-options-prefade-dark{background:linear-gradient(to right,#16161600,#161616);block-size:32px;content:"";inline-size:30px;pointer-events:none;visibility:hidden}:host(clabs-chat-molecule) .clabs--chat-molecule-options-prefade-light{background:linear-gradient(to right,#f4f4f400,#f4f4f4);block-size:32px;content:"";inline-size:30px;pointer-events:none;visibility:hidden}:host(clabs-chat-molecule) .clabs--chat-molecule-options-buttons{display:flex;flex-direction:row;background:var(--cds-background, #ffffff);gap:4px;padding-inline-end:8px}:host(clabs-chat-molecule) .clabs--chat-molecule-fullscreen-container{position:fixed;z-index:999;display:flex;align-items:center;background:var(--cds-background, #ffffff);block-size:100%;inline-size:100%;top:0;right:0;bottom:0;left:0;visibility:var(--chat-molecule-container-visibility, "hidden")}:host(clabs-chat-molecule) .clabs--chat-molecule-fullscreen-container-close{position:fixed;z-index:9999;inset-block-start:32px;inset-inline-end:32px;pointer-events:none}`;var ta=Object.defineProperty,Ce=(X,e,t,r)=>{for(var i=void 0,s=X.length-1,a;s>=0;s--)(a=X[s])&&(i=a(e,t,i)||i);return i&&ta(e,t,i),i};const{stablePrefix:ra}=oi,di=class di extends In{constructor(){super(...arguments),this.isHovered=!1,this._invalid=!1,this.renderSuccessful=!1,this.loading=!0,this.fullscreenMode=!1,this._scaling=1,this._viewX=0,this._viewY=0}firstUpdated(){this.generateUniqueId(),this.width&&this.style.setProperty("--chat-molecule-width",this.width+"px"),this.height&&this.style.setProperty("--chat-molecule-height",this.height+"px"),this.style.setProperty("--chat-molecule-container-visibility","hidden"),this.molecularRenderer=new si.SmiDrawer(this._buildOptions("default")),this.temporaryMolecularRenderer=new si.SmiDrawer(this._buildOptions("default")),this.fullscreenMolecularRenderer=new si.SmiDrawer(this._buildOptions("fullscreen")),this.theme||this._getTheme(),this.streaming||window.setTimeout(()=>{this._smilesContent=this.content,this._prepareMolecule("default")},200)}_buildOptions(e){let t=6,r=3,i=.7,s=!1,a=null,n=16,u=.18*10;const o=15;let d="default";return e==="fullscreen"?(t=5,r=3,s=!1):this.thumbNailMode&&(t=12,r=8,i=1.2,u=.18*15,s=!0,d="balls",n=8,a=1),{scale:a,compactDrawing:s,fontSizeLarge:t,fontSizeSmall:r,bondThickness:i,padding:n,bondLength:o,shortBondLength:.7,bondSpacing:u,atomVisualization:d,isomeric:!0,debug:!1,terminalCarbons:!0,explicitHydrogens:!1,overlapSensitivity:.1,overlapResolutionIterations:this.streaming?1:10,experimental:!1,themes:{dark:{C:"#c6c6c6",O:"#f45d56",N:"#33b1ff",F:"#42be65",CL:"#08bdba",BR:"#ff832b",I:"#be95ff",P:"#ff832b",S:"#fdd13a",B:"#f1c21b",SI:"#f1c21b",H:"#c6c6c6",BACKGROUND:"#161616",BONDS:"#3d3d3d"},light:{C:"#525252",O:"#da1e28",N:"#1192e8",F:"#24a148",CL:"#009d9a",BR:"#ba4e00",I:"#8a3ffc",P:"#db5b00",S:"#d6a602",B:"#c29800",SI:"#cca002",H:"#525252",BACKGROUND:"#f4f4f4",BONDS:"#e0e0e0"}}}}generateUniqueId(){const e=Math.random().toString(36).substr(2,9);this._uniqueID=e}_handleFullScreenScroll(e){e.preventDefault(),e.stopPropagation()}async updated(e){super.updated(e),e.has("content")&&this._prepareMolecule("default"),e.has("_smilesContent")&&this._scrollStreamArea(),e.has("renderSuccessful")&&(await this.checkPubChemAvailability(),this._appendCustomStyles())}_getTheme(){if(this.parentElement instanceof HTMLElement){const t=getComputedStyle(this.parentElement).getPropertyValue("--cds-background"),r=t.startsWith("#")&&parseInt(t.replace("#",""),16)<16777215/2;this.theme=r?"dark":"light"}}_zoomIn(e){var n;e.preventDefault();const t=.001,r=.5,i=3,s=Math.sign(e.deltaY)*t,a=(n=this.shadowRoot)==null?void 0:n.getElementById("clabs--chat-molecule-"+this._uniqueID);if(a instanceof SVGElement){const u=e.offsetX,o=e.offsetY,d=Math.min(i,Math.max(this._scaling-s,r));this._viewX=u-(u-this._viewX)*(d/this._scaling),this._viewY=o-(o-this._viewY)*(d/this._scaling),this._scaling=d;const g=a.querySelectorAll("g");for(const f of g)f.setAttribute("transform","translate("+this._viewY+" "+this._viewX+") scale("+this._scaling+")")}}_appendCustomStyles(){var e;{const t=(e=this.shadowRoot)==null?void 0:e.querySelectorAll("polygon");t&&t.forEach(r=>{if(r instanceof SVGPolygonElement){const i=r.getAttribute("points");if(i){const a=i.split(" ").map(y=>y.split(",").map(Number)),n=.75,[u,o]=a[0];let[d,g]=a[1],[f,b]=a[2];d=u+(d-u)*n,g=o+(g-o)*n,f=u+(f-u)*n,b=o+(b-o)*n,r.setAttribute("points",u+","+o+" "+d+","+g+" "+f+","+b)}}})}}_scrollStreamArea(){var t;const e=(t=this.shadowRoot)==null?void 0:t.querySelector(".clabs--chat-molecule-stream-text-content");e instanceof HTMLElement&&(e.scrollLeft=e.scrollWidth)}_openFullscreenView(){this.fullscreenMode=!0,this.style.setProperty("--chat-molecule-container-visibility","visible"),window.setTimeout(()=>{this._prepareMolecule("fullscreen")},200)}_closeFullscreenView(){this.fullscreenMode=!1,this.style.setProperty("--chat-molecule-container-visibility","hidden")}_handleMouseOut(){this.isHovered=!1}_handleMouseOver(){this.isHovered=!0}async _openEditorView(){this.pubChemUrl&&(window==null||window.open(this.pubChemUrl,"_blank"))}async checkPubChemAvailability(){try{const t=await(await fetch("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/smiles/"+encodeURIComponent(this.content)+"/cids/JSON")).json();if(t.IdentifierList&&t.IdentifierList.CID&&t.IdentifierList.CID.length>0){const r=t.IdentifierList.CID[0];r&&(this.pubChemUrl="https://pubchem.ncbi.nlm.nih.gov/compound/"+r)}}catch{this.pubChemUrl=null}}_exportToImage(){window.setTimeout(async()=>{var t;const e=(t=this.shadowRoot)==null?void 0:t.querySelector("#"+ra+"--chat-molecule-"+this._uniqueID);if(e instanceof SVGElement){const r=new XMLSerializer().serializeToString(e),i=document.createElement("canvas"),s=i.getContext("2d"),a=e.getBoundingClientRect();i.height=a.height,i.width=a.width;const n=new Image;n.onload=()=>{s==null||s.drawImage(n,0,0);const u=i.toDataURL("image/png"),o=document.createElement("a"),d=this.title?this.title:"molecule";o.download=d,o.href=u,o.click()},n.src="data:image/svg+xml;base64,"+btoa(r)}},200)}_prepareMolecule(e){var u,o;this.loading=!1;let t="clabs--chat-molecule-"+this._uniqueID;const r="clabs--chat-molecule-test-"+this._uniqueID;e==="fullscreen"&&(t="clabs--chat-molecule-fullscreen-"+this._uniqueID);const i=(u=this.shadowRoot)==null?void 0:u.getElementById(t),s=(o=this.shadowRoot)==null?void 0:o.getElementById(r),a=this.content.replace(new RegExp("```","g"),"");this._smilesContent=a;let n=!1;if(i instanceof SVGElement&&s instanceof SVGElement)try{this.temporaryMolecularRenderer.draw(a,s,this.theme,()=>{n=!0,this.renderSuccessful=!0},()=>{n=!1})}catch{n=!1}if(n){if(this.streaming)if(!this.renderInProgress)this.renderInProgress=!0,this.renderInProgress=!1;else return"";e==="fullscreen"?this.fullscreenMolecularRenderer.draw(a,i,this.theme,()=>{this.renderInProgress=!1},()=>{this.renderInProgress=!1}):this.molecularRenderer.draw(a,i,this.theme,()=>{this.renderInProgress=!1},()=>{this.renderInProgress=!1}),this.requestUpdate()}return""}};di.styles=ea;let de=di;Ce([gt({type:String,attribute:"content",reflect:!0})],de.prototype,"content");Ce([gt({type:String,attribute:"title"})],de.prototype,"title");Ce([gt({type:Number,attribute:"width"})],de.prototype,"width");Ce([gt({type:Number,attribute:"height"})],de.prototype,"height");Ce([gt({type:String,attribute:"theme"})],de.prototype,"theme");Ce([gt({type:Boolean,attribute:"streaming"})],de.prototype,"streaming");Ce([gt({type:Boolean,attribute:"disable-options"})],de.prototype,"disableOptions");Ce([gt({type:Boolean,attribute:"disable-fullscreen"})],de.prototype,"disableFullscreen");Ce([gt({type:Boolean,attribute:"disable-export"})],de.prototype,"disableExport");Ce([gt({type:Boolean,attribute:"thumbnail-mode"})],de.prototype,"thumbNailMode");Ce([je()],de.prototype,"isHovered");Ce([gt({type:Boolean,attribute:"disable-code-inspector"})],de.prototype,"disableCodeInspector");Ce([je()],de.prototype,"_uniqueID");Ce([je()],de.prototype,"_invalid");Ce([je()],de.prototype,"drawer");Ce([je()],de.prototype,"renderSuccessful");Ce([je()],de.prototype,"loading");Ce([je()],de.prototype,"fullscreenMode");Ce([je()],de.prototype,"_smilesContent");Ce([je()],de.prototype,"_scaling");Ce([je()],de.prototype,"_viewX");Ce([je()],de.prototype,"_viewY");Ce([je()],de.prototype,"pubChemUrl");Ce([je()],de.prototype,"renderInProgress");/**
 * @license
 *
 * Copyright IBM Corp. 2023
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */const{stablePrefix:He}=oi;function ia(X){const{theme:e,title:t,_uniqueID:r,_smilesContent:i,streaming:s,loading:a,fullscreenMode:n,disableOptions:u,_openEditorView:o,disableFullscreen:d,_openFullscreenView:g,_closeFullscreenView:f,disableExport:b,thumbNailMode:y,_handleMouseOver:S,_handleMouseOut:P,isHovered:B,_exportToImage:T,disableCodeInspector:x,pubChemUrl:M,_handleFullScreenScroll:L}=X;return Be`
    <div
      @mouseout="${P}"
      @mouseover="${S}"
      id="${He}--chat-molecule-container-id-${r}"
      class="${He}--chat-molecule-container ${He}--chat-molecule-${e}">
      ${a?Be`
            <div class="${He}--chat-molecule-container-loader">
              <cds-loading></cds-loading>
            </div>
          `:""}

      <svg
        class="${He}--chat-molecule-target"
        id="clabs--chat-molecule-${r}"></svg>

      ${s?Be`<div class="${He}--chat-molecule-stream-text-container">
            <div class="${He}--chat-molecule-stream-text-content">
              ${i}
            </div>
          </div>`:""}
      ${t&&!(!B&&y)?Be`<div
            class="${He}--chat-molecule-title ${y?He+"--chat-molecule-title-thumbnail":""}">
            ${t}
          </div>`:Be``}
      ${u||a||s?Be``:Be` <div
            class="${He}--chat-molecule-options ${y&&!B?He+"--chat-molecule-options-hidden":""}">
            <div class="${He}--chat-molecule-options-prefade-${e}">
              &nbsp;
            </div>
            <div class="${He}--chat-molecule-options-buttons">
              ${b?Be``:Be`
                    <cds-icon-button
                      kind="ghost"
                      size="sm"
                      aria-label="Export to PNG"
                      role="button"
                      align="bottom-right"
                      @click="${T}">
                      ${Hn({slot:"icon"})}
                      <span slot="tooltip-content">Export to PNG</span>
                    </cds-icon-button>
                  `}
              ${!x&&M?Be`
                    <cds-icon-button
                      kind="ghost"
                      size="sm"
                      aria-label="Open in PubChem"
                      role="button"
                      align="bottom-right"
                      disabled="${!M}"
                      @click="${o}">
                      ${zn({slot:"icon"})}
                      <span slot="tooltip-content">Open in PubChem</span>
                    </cds-icon-button>
                  `:Be``}
              ${d?Be``:Be`
                    <cds-icon-button
                      kind="ghost"
                      aria-label="Fullscreen"
                      role="button"
                      size="sm"
                      align="bottom-right"
                      @click="${g}">
                      ${_n({slot:"icon"})}
                      <span slot="tooltip-content">Fullscreen</span>
                    </cds-icon-button>
                  `}
            </div>
          </div>`}
    </div>

    <div class="${He}--chat-molecule-tester">
      <svg id="clabs--chat-molecule-test-${r}"></svg>
    </div>

    ${n?Be` <div
          class="${He}--chat-molecule-fullscreen-container-close">
          <cds-icon-button
            kind="tertiary"
            size="md"
            aria-label="Close Fullscreen"
            role="button"
            align="bottom-right"
            @click="${g}">
            ${Fn({slot:"icon"})}
            <span slot="tooltip-content">Fullscreen</span>
          </cds-icon-button>
        </div>`:""}

    <div
      class="${He}--chat-molecule-fullscreen-container"
      @wheel="${L}"
      @click="${f}">
      <svg
        class="${He}--chat-molecule-target-fullscreen"
        id="clabs--chat-molecule-fullscreen-${r}"></svg>
    </div>
  `}var na=Object.defineProperty,sa=Object.getOwnPropertyDescriptor,aa=(X,e,t,r)=>{for(var i=r>1?void 0:r?sa(e,t):e,s=X.length-1,a;s>=0;s--)(a=X[s])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&na(e,t,i),i};const{stablePrefix:la}=oi;let Di=class extends de{render(){return ia(this)}};Di=aa([$n(`${la}-chat-molecule`)],Di);/**
 * @license
 *
 * Copyright IBM Corp. 2023
 *
 * This source code is licensed under the Apache-2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */const oa={title:"Components/AI Components/Molecule"},ha=[{title:"Bergenin",width:126,height:126,thumbnail:!0,smiles:"OC[C@@H](O1)[C@@H](O)[C@H](O)[C@@H]2[C@@H]1c3c(O)c(OC)c(O)cc3C(=O)O2"},{title:"Custom Molecule",width:126,height:126,thumbnail:!0,smiles:"OC(C(=O)O[C@H]1C[N+]2(CCC0C3=CC=CC=C3)CCC1CC2)(C1=CC=CS1)C1=CC=CS1"},{title:"Cephalostatin-1",width:126,height:126,thumbnail:!0,smiles:"CC(C)(O1)C[C@@H](O)[C@@]1(O2)[C@@H](C)[C@@H]3CC=C4[C@]3(C2)C(=O)C[C@H]5[C@H]4CC[C@@H](C6)[C@]5(C)Cc(n7)c6nc(C[C@@]89(C))c7C[C@@H]8CC[C@@H]%10[C@@H]9C[C@@H](O)[C@@]%11(C)C%10=C[C@H](O%12)[C@]%11(O)[C@H](C)[C@]%12(O%13)[C@H](O)C[C@@]%13(C)CO"},{title:"Color test",smiles:"[H]C([SiH3])(Cl)C([H])(F)C([H])(Br)C([H])(I)C([H])(N)C([H])(S)P(B)"},{title:"Bergenin",width:246,height:246,smiles:"OC[C@@H](O1)[C@@H](O)[C@H](O)[C@@H]2[C@@H]1c3c(O)c(OC)c(O)cc3C(=O)O2"},{title:"Custom Molecule",width:446,height:446,smiles:"OC(C(=O)O[C@H]1C[N+]2(CCC0C3=CC=CC=C3)CCC1CC2)(C1=CC=CS1)C1=CC=CS1"},{title:"Cephalostatin-1",smiles:"CC(C)(O1)C[C@@H](O)[C@@]1(O2)[C@@H](C)[C@@H]3CC=C4[C@]3(C2)C(=O)C[C@H]5[C@H]4CC[C@@H](C6)[C@]5(C)Cc(n7)c6nc(C[C@@]89(C))c7C[C@@H]8CC[C@@H]%10[C@@H]9C[C@@H](O)[C@@]%11(C)C%10=C[C@H](O%12)[C@]%11(O)[C@H](C)[C@]%12(O%13)[C@H](O)C[C@@]%13(C)CO"},{title:"Acetate",width:200,height:200,smiles:"CC(=O)[O-]"},{title:"Benzene (C6H6)",width:200,height:200,smiles:"C1=CC=CC=C1"},{title:"5-amino-4-methylpentanamide",width:496,height:496,smiles:"CC(CCC(=O)N)CN"},{title:"Bromobenzene",width:200,height:200,smiles:"C1=CC=C(C=C1)Br"},{title:"Caffeine",width:496,height:496,smiles:"CN1C=NC2=C1C(=O)N(C(=O)N2C)C"},{title:"Thyroxine",width:496,height:496,smiles:"C1=C(C=C(C(=C1I)OC2=CC(=C(C(=C2)I)O)I)I)C[C@@H](C(=O)O)N"},{title:"Cholesterol",smiles:"CC(C)CCCC(C)C1CCC2C1(CCCC2=CC=C3CC4CC(CC(C4)O)C(O)C3(C)C)C"},{title:"Chlorine",smiles:"CCC1=C(C2=NC1=CC3=C(C4=C(C(C(=C4[N-]3)C5=NC(=CC6=NC(=C2)C(=C6C)C=C)C(C5CCC(=O)OCC=C(C)CCCC(C)CCCC(C)CCCC(C)C)C)C(=O)OC)[O-])C)C.[Mg+2]"},{title:"Paclitaxel (Taxol)",smiles:"CC1=C2C(C(=O)C3(C(CC4C(C3C(C(C2(C)C)(CC1OC(=O)C(C(C5=CC=CC=C5)NC(=O)C6=CC=CC=C6)O)O)OC(=O)C7=CC=CC=C7)(CO4)OC(=O)C)O)C)OC(=O)C"},{title:"ATP (Adenosine Triphosphate)",smiles:"C1=NC(=C2C(=N1)N(C=N2)C3C(C(C(O3)COP(=O)(O)OP(=O)(O)OP(=O)(O)O)O)O)N.C1=NC(=C2C(=N1)N(C=N2)C3C(C(C(O3)COP(=O)(O)OP(=O)(O)OP(=O)(O)O)O)O)N"},{title:"Cyclosporine",smiles:"CCC1C(=O)N(CC(=O)N(C(C(=O)NC(C(=O)N(C(C(=O)NC(C(=O)NC(C(=O)N(C(C(=O)N(C(C(=O)N(C(C(=O)N(C(C(=O)N1)C(C(C)CC=CC)O)C)C(C)C)C)CC(C)C)C)CC(C)C)C)C)C)CC(C)C)C)C(C)C)CC(C)C)C)C"},{title:"Vitamin B12",smiles:"CC1=CC2=C(C=C1C)N(C=N2)C3C(C(C(O3)CO)OP(=O)([O-])OC(C)CNC(=O)CCC4(C(C5C6(C(C(C(=C(C7=NC(=CC8=NC(=C(C4=N5)C)C(C8(C)C)CCC(=O)N)C(C7(C)CC(=O)N)CCC(=O)N)C)[N-]6)CCC(=O)N)(C)CC(=O)N)C)CC(=O)N)C)O.[C-]#N.[Co+3]"},{title:"Insulin",smiles:"CCC(C)C1C(=O)NC2CSSCC(C(=O)NC(CSSCC(C(=O)NCC(=O)NC(C(=O)NC(C(=O)NC(C(=O)NC(C(=O)NC(C(=O)NC(C(=O)NC(C(=O)NC(C(=O)NC(C(=O)NC(C(=O)NC(CSSCC(NC(=O)C(NC(=O)C(NC(=O)C(NC(=O)C(NC(=O)C(NC(=O)C(NC(=O)C(NC(=O)C(NC2=O)CO)CC(C)C)CC3=CC=C(C=C3)O)CCC(=O)N)CC(C)C)CCC(=O)O)CC(=O)N)CC4=CC=C(C=C4)O)C(=O)NC(CC(=O)N)C(=O)O)C(=O)NCC(=O)NC(CCC(=O)O)C(=O)NC(CCCNC(=N)N)C(=O)NCC(=O)NC(CC5=CC=CC=C5)C(=O)NC(CC6=CC=CC=C6)C(=O)NC(CC7=CC=C(C=C7)O)C(=O)NC(C(C)O)C(=O)N8CCCC8C(=O)NC(CCCCN)C(=O)NC(C(C)O)C(=O)O)C(C)C)CC(C)C)CC9=CC=C(C=C9)O)CC(C)C)C)CCC(=O)O)C(C)C)CC(C)C)CC2=CNC=N2)CO)NC(=O)C(CC(C)C)NC(=O)C(CC2=CNC=N2)NC(=O)C(CCC(=O)N)NC(=O)C(C(=O)N)NC(=O)C(C(C)C)NC(=O)C(CC2=CC=CC=C2)N)C(=O)NC(C(=O)NC(C(=O)N1)CO)C(C)O)NC(=O)C(CCC(=O)N)NC(=O)C(CCC(=O)O)NC(=O)C(C(C)C)NC(=O)C(C(C)CC)NC(=O)CN"}],lr={render:()=>Be` <clabs-chat-molecule content="CC(CCC(=O)N)CN">
    </clabs-chat-molecule>`},or={render:()=>Be` ${ha.map(X=>Be`
          ${X.width&&X.height?Be`<p style="font-style:italic;font-size:14px;">
                (${X.width}px x ${X.height}px)
                ${X.thumbnail?"- thumbail-mode enabled":""}
              </p>`:""}
          <br />
          <clabs-chat-code
            ?disable-line-ticks="${!0}"
            ?disable-copy-button="${!0}"
            content="SMILES String: ${X.smiles}">
          </clabs-chat-code>

          <clabs-chat-molecule
            title="${X.title}"
            width="${X.width}"
            height="${X.height}"
            ?thumbnail-mode=${X.thumbnail}
            content="${X.smiles}">
          </clabs-chat-molecule>
          <br />
        `)}`};var ki,Hi,zi;lr.parameters={...lr.parameters,docs:{...(ki=lr.parameters)==null?void 0:ki.docs,source:{originalSource:`{
  /**
   * Renders the template for Storybook
   *
   * @returns {TemplateResult<1>}
   */
  render: () => html\` <clabs-chat-molecule content="CC(CCC(=O)N)CN">
    </clabs-chat-molecule>\`
}`,...(zi=(Hi=lr.parameters)==null?void 0:Hi.docs)==null?void 0:zi.source}}};var _i,Fi,Wi;or.parameters={...or.parameters,docs:{...(_i=or.parameters)==null?void 0:_i.docs,source:{originalSource:`{
  /**
   * Renders the template for Storybook
   *
   * @returns {TemplateResult<1>}
   */
  render: () => html\` \${examples.map(example => html\`
          \${example.width && example.height ? html\`<p style="font-style:italic;font-size:14px;">
                (\${example.width}px x \${example.height}px)
                \${example.thumbnail ? '- thumbail-mode enabled' : ''}
              </p>\` : \`\`}
          <br />
          <clabs-chat-code
            ?disable-line-ticks="\${true}"
            ?disable-copy-button="\${true}"
            content="SMILES String: \${example.smiles}">
          </clabs-chat-code>

          <clabs-chat-molecule
            title="\${example.title}"
            width="\${example.width}"
            height="\${example.height}"
            ?thumbnail-mode=\${example.thumbnail}
            content="\${example.smiles}">
          </clabs-chat-molecule>
          <br />
        \`)}\`
}`,...(Wi=(Fi=or.parameters)==null?void 0:Fi.docs)==null?void 0:Wi.source}}};const ua=["Default","Showcase"],Ta=Object.freeze(Object.defineProperty({__proto__:null,Default:lr,Showcase:or,__namedExportsOrder:ua,default:oa},Symbol.toStringTag,{value:"Module"}));export{Ta as e};
